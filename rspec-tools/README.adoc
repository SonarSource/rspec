:source-highlighter: highlightjs

rspec-tools: Tools automating RSPEC workflows
=============================================

Install
-------

.Install Pipenv
[source,shell]
----
# macos
$ brew install pipenv
----

.Install rspec-tools
[source,shell]
----
$ cd rspec-tools
$ pipenv install -e .
----


Usage
-----

.See all commands
[source,sh]
----
$ pipenv run rspec-tools --help
----

.Export security standards
[source,sh]
----
$ pipenv run rspec-tools export-security-standards standard --name "OWASP Top 10 2021" --output ./output-dir
----

This command exports a specific security standard from the rules repository into a YAML file that follows the format defined in `report.schema.json`. The command scans all rules in the specified directory (default: `~/Sources/AT/rspec/rules`) and extracts their `securityStandards` metadata for the requested standard.

The `--name` parameter specifies which security standard to export (e.g., "OWASP Top 10 2021", "CWE", "ASVS 4.0"). This name is also used as the version name in the generated YAML file.

Features:

* Creates a YAML file named after the standard (e.g., `OWASP_Top_10_2021.yaml`)
* Organizes rules hierarchically if categories are in "x.y.z" format (e.g., ASVS 4.0 uses categories → subcategories → subsubcategories)
* Uses a flat structure for standards with simple categories (e.g., OWASP, CWE)
* Uses the security standard name as the version name
* Includes "CHANGE ME" placeholders in the taxonomy fields

If the specified security standard is not found, the command will display a list of available standards.

.Generate ASVS report from specification
[source,sh]
----
$ pipenv run rspec-tools export-security-standards asvs --name "ASVS 4.0" --spec asvs-4.0.3.json --output asvs-report.yaml
----

This command generates a comprehensive ASVS (Application Security Verification Standard) report by:

* Filtering rules from the repository that reference the specified security standard (via `--name`)
* Parsing the ASVS JSON specification file (download from https://github.com/OWASP/ASVS/tree/v5.0.0/4.0/docs_en[OWASP ASVS repository])
* Mapping the filtered rules to ASVS requirements based on their `securityStandards` metadata
* Creating a structured report with:
  - Taxonomy fields set to "Requirement"
  - Application Security Verification Levels (Level 1, 2, and 3)
  - Complete hierarchy of categories → subcategories → requirements
  - Rules mapped to their corresponding ASVS requirements
  - Level information for each requirement

The `--name` parameter specifies which security standard to filter from the rules repository (e.g., "ASVS 4.0"). Example output shows which requirements have mapped rules and provides statistics on coverage.


Development
-----------

.Install dev dependencies

[source,sh]
----
$ pipenv install --dev
----

.Run tests
[source,sh]
----
$ pipenv run pytest
----

.Format
[source,sh]
----
$ pipenv run black rspec_tools tests
$ pipenv run usort format rspec_tools tests
----

.Lint

Note, this step is not run in CI because it is not configured in CAYC mode.
You can also run flake8 in your IDE.
[source,sh]
----
$ pipenv run flake8
----

.Fixtures

When writing a new test, create a fixture rule in `tests/resources/{invalid_rules, rules}`.

In order to generate an HTML file from the ASCIIdoc, you can use [asciidoctor](https://docs.asciidoctor.org/) as follows:

[source,sh]
----
$ asciidoctor rule.adoc
----
