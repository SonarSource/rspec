<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>Cloneable</code> is the marker <code>Interface</code> that indicates that <code>clone()</code> may be called on an object.
Overriding <code>clone()</code> without implementing <code>Cloneable</code> can be helpful if you want to control how subclasses clone themselves, but
otherwise, it&#8217;s probably a mistake.</p>
</div>
<div class="paragraph">
<p>The usual convention for <code>Object.clone()</code> according to Oracle&#8217;s Javadoc is:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>x.clone() != x</code></p>
</li>
<li>
<p><code>x.clone().getClass() == x.getClass()</code></p>
</li>
<li>
<p><code>x.clone().equals(x)</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Obtaining the object that will be returned by calling <code>super.clone()</code> helps to satisfy those invariants:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>super.clone()</code> returns a new object instance</p>
</li>
<li>
<p><code>super.clone()</code> returns an object of the same type as the one <code>clone()</code> was called on</p>
</li>
<li>
<p><code>Object.clone()</code> performs a shallow copy of the object&#8217;s state.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ensure that the <code>clone()</code> method calls <code>super.clone()</code> and implement <code>Cloneable</code> in the class or remove the clone method.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">class BaseClass {  // Noncompliant - should implement Cloneable
  @Override
  public Object clone() throws CloneNotSupportedException {    // Noncompliant - should return the super.clone() instance
    return new BaseClass();
  }
}

class DerivedClass extends BaseClass implements Cloneable {
  /* Does not override clone() */

  public void sayHello() {
    System.out.println("Hello, world!");
  }
}

class Application {
  public static void main(String[] args) throws Exception {
    DerivedClass instance = new DerivedClass();
    ((DerivedClass) instance.clone()).sayHello();              // Throws a ClassCastException because invariant #2 is violated
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">class BaseClass implements Cloneable {
  @Override
  public Object clone() throws CloneNotSupportedException {    // Compliant
    return super.clone();
  }
}

class DerivedClass extends BaseClass implements Cloneable {
  /* Does not override clone() */

  public void sayHello() {
    System.out.println("Hello, world!");
  }
}

class Application {
  public static void main(String[] args) throws Exception {
    DerivedClass instance = new DerivedClass();
    ((DerivedClass) instance.clone()).sayHello();              // Displays "Hello, world!" as expected. Invariant #2 is satisfied
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/580">CWE-580 - clone() Method Without super.clone()</a></p>
</li>
<li>
<p><a href="https://wiki.sei.cmu.edu/confluence/x/FjZGBQ">CERT, MET53-J.</a> - Ensure that the clone() method calls super.clone()</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="ulist">
<ul>
<li>
<p>Use super.clone() to create and seed the cloned instance to be returned.</p>
</li>
<li>
<p>Implement "Cloneable" in this class or remove the clone method.</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_is_related_to_s2975">is related to: <a data-rspec-id="S2975" class="rspec-auto-link">S2975</a></h3>

</div>
<div class="sect2">
<h3 id="_on_7_aug_2013_095921_freddy_mallet_wrote">on 7 Aug 2013, 09:59:21 Freddy Mallet wrote:</h3>
<div class="paragraph">
<p>Is implemented by http://jira.codehaus.org/browse/SONARJAVA-271</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_7_aug_2013_132027_dinesh_bolkensteyn_wrote">on 7 Aug 2013, 13:20:27 Dinesh Bolkensteyn wrote:</h3>
<div class="paragraph">
<p>I fail to see why it would be mandatory to have the method throw the CloneNotSupportedException.</p>
</div>
<div class="paragraph">
<p>You can perfectly catch and propagate (as an unchecked exception) the instance thrown by super.clone().</p>
</div>
<div class="paragraph">
<p>So the PMD rule does not seem to make a lot of sense.</p>
</div>
<div class="paragraph">
<p>In any case, I doubt that this method is mean to verify this, isn&#8217;t it?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_8_aug_2013_062734_dinesh_bolkensteyn_wrote">on 8 Aug 2013, 06:27:34 Dinesh Bolkensteyn wrote:</h3>
<div class="paragraph">
<p>Thanks for the updates Ann!</p>
</div>
</div>
</div>
</div>