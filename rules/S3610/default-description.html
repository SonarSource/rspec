<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Calling <a href="https://learn.microsoft.com/en-us/dotnet/api/system.object.gettype">GetType()</a> on a <a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/builtin-types/nullable-value-types">nullable value type</a> object returns the underlying value type. Therefore, comparing the returned <a href="https://learn.microsoft.com/en-us/dotnet/api/system.type"><code>Type</code></a> object to <code>typeof(Nullable&lt;SomeType&gt;)</code> will either throw an <a href="https://learn.microsoft.com/en-us/dotnet/api/system.nullreferenceexception">NullReferenceException</a> or the result will always be <code>true</code> or <code>false</code> and can be known at compile time.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">void DoChecks&lt;T&gt;(Nullable&lt;T&gt; value) where T : struct
{
    bool areEqual = value.GetType() == typeof(Nullable&lt;int&gt;); // Noncompliant: always false
    bool areNotEqual = value.GetType() != typeof(Nullable&lt;int&gt;); // Noncompliant: always true

    Nullable&lt;int&gt; nullable = null;
    bool nullComparison = nullable.GetType() != typeof(Nullable&lt;int&gt;); // Noncompliant: throws NullReferenceException
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">void DoChecks&lt;T&gt;(Nullable&lt;T&gt; value) where T : struct
{
    bool areEqual = value.GetType() == typeof(int); // Compliant: can be true or false
    bool areNotEqual = value.GetType() != typeof(int); // Compliant: can be true or false

    Nullable&lt;int&gt; nullable = null;
    bool nullComparison = nullable is not null &amp;&amp; nullable.GetType() == typeof(int); // Compliant: does not throw NullReferenceException
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Microsoft Learn - <a href="https://learn.microsoft.com/en-us/dotnet/api/system.object.gettype">Object.GetType Method</a></p>
</li>
<li>
<p>Microsoft Learn - <a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/builtin-types/nullable-value-types">Nullable value types (C# reference)</a></p>
</li>
<li>
<p>Microsoft Learn - <a href="https://learn.microsoft.com/en-us/dotnet/api/system.type">Type Class</a></p>
</li>
<li>
<p>Microsoft Learn - <a href="https://learn.microsoft.com/en-us/dotnet/api/system.nullreferenceexception">NullReferenceException Class</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Remove this redundant type comparison.</p>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="paragraph">
<p>full expression</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_relates_to_s2219">relates to: <a data-rspec-id="S2219" class="rspec-auto-link">S2219</a></h3>

</div>
<div class="sect2">
<h3 id="_on_25_apr_2016_102459_tamas_vajk_wrote">on 25 Apr 2016, 10:24:59 Tamas Vajk wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2], could you review this RSPEC? Thanks.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_26_apr_2016_174016_ann_campbell_wrote">on 26 Apr 2016, 17:40:16 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~tamas.vajk] this rule is a subset of what would be covered by an implementation of <a data-rspec-id="S2583" class="rspec-auto-link">RSPEC-2583</a>. When reading it my first thought was that you wrote it stand-alone to cover a R# rule, but there are no references&#8230;&#8203;?</p>
</div>
<div class="paragraph">
<p>Also, if we retain this RSpec, IMO you should add a compliant solution. From the description and code sample, I&#8217;m <em>guessing</em> compliance is a straightforward code change&#8230;&#8203;?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_27_apr_2016_084157_tamas_vajk_wrote">on 27 Apr 2016, 08:41:57 Tamas Vajk wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] yes, it&#8217;s a special case of <a data-rspec-id="S2583" class="rspec-auto-link">RSPEC-2583</a>.</p>
</div>
<div class="paragraph">
<p>No, it&#8217;s not a R# rule. It&#8217;s the outcome of a bug in one of our rules (<a data-rspec-id="S2219" class="rspec-auto-link">RSPEC-2219</a>, added an exception there).</p>
</div>
<div class="paragraph">
<p>The compliant solution is not straightforward. We can&#8217;t simply replace the comparison with <code>true</code> or <code>false</code> because that was definitely not what was meant. We could change the <code>typeof(Nullable&lt;int&gt;)</code> to <code>typeof(int)</code>, but I don&#8217;t think that covers the user intent. Most probably the user wanted to check if <code>nullable</code> is a <code>Nullable&lt;T&gt;</code> or not, but that&#8217;s not possible with <code>GetType</code>. And there&#8217;s no straightforward way to do it, unless you have the type of <code>nullable</code> at compile time.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_27_apr_2016_174422_ann_campbell_wrote">on 27 Apr 2016, 17:44:22 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~tamas.vajk] I had assumed you&#8217;d want to use <code>is</code> (or something similar) instead. Glad I didn&#8217;t fill in a compliant solution! :-)</p>
</div>
<div class="paragraph">
<p>For me, the description moves very quickly from</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Calling GetType() on a nullable object returns the underlying value type.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>to</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Thus, comparing the returned Type object to typeof(Nullable&lt;SomeType&gt;) doesn&#8217;t make sense.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>But if C#ers will understand, I&#8217;m good with it.</p>
</div>
</div>
</div>
</div>