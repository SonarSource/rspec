== How to fix it in Java Cryptography Extension

=== Code examples

==== Noncompliant code example

The following code is vulnerable because it uses a legacy digest-based password
encoding that is not considered secure.

[source,kotlin,diff-id=1,diff-type=noncompliant]
----
private SecretKey deriveKey(String password, byte[] salt) throws Exception {
    PBEKeySpec keySpec = new PBEKeySpec(password.toCharArray(), salt, 120000, 256); // Noncompliant
    SecretKeyFactory secretKeyFactory = SecretKeyFactory.getInstance("PBKDF2withHmacSHA512");
    return secretKeyFactory.generateSecret(keySpec);
}
----

==== Compliant solution

[source,kotlin,diff-id=1,diff-type=compliant]
----
private SecretKey deriveKey(String password, byte[] salt) throws Exception {
    PBEKeySpec keySpec = new PBEKeySpec(password.toCharArray(), salt, 210000, 256);
    SecretKeyFactory secretKeyFactory = SecretKeyFactory.getInstance("PBKDF2withHmacSHA512");
    return secretKeyFactory.generateSecret(keySpec);
}
----

=== How does this work?

include::../../common/fix/pbkdf2-parameters.adoc[]

=== Going the extra mile

include::../../common/extra-mile/peppering.adoc[]