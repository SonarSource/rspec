== How to fix it in Security Framework

=== Code examples

==== Noncompliant code example

include::../../common/fix/rsa-noncompliant-example.adoc[]

[source,swift,diff-id=11,diff-type=noncompliant]
----
import Security

func rsaEncrypt(publicKey: SecKey, data: Data) -> Data? {
    let algorithm: SecKeyAlgorithm = .rsaEncryptionRaw // Noncompliant
    var error: Unmanaged<CFError>?
    guard SecKeyIsAlgorithmSupported(publicKey, .encrypt, algorithm) else {
        // ...
        return nil
    }
    guard let ciphertext = SecKeyCreateEncryptedData(publicKey, algorithm, data as CFData, &error) as Data? else {
        // ...
        return nil
    }
    return ciphertext
}
----


==== Compliant solution

include::../../common/fix/rsa-compliant-example.adoc[]

[source,swift,diff-id=11,diff-type=compliant]
----
import Security

func rsaEncrypt(publicKey: SecKey, data: Data) -> Data? {
    let algorithm: SecKeyAlgorithm = .rsaEncryptionOAEPSHA256
    var error: Unmanaged<CFError>?
    guard SecKeyIsAlgorithmSupported(publicKey, .encrypt, algorithm) else {
        // ...
        return nil
    }
    guard let ciphertext = SecKeyCreateEncryptedData(publicKey, algorithm, data as CFData, &error) as Data? else {
        // ...
        return nil
    }
    return ciphertext
}
----

=== How does this work?

include::../../common/fix/fix.adoc[]
