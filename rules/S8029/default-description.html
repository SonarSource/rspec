<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This rule raises an issue when DML operations (insert, update, delete, upsert) are performed on the same records (<code>Trigger.new</code> or <code>Trigger.old</code>) within an after trigger context.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In Salesforce Apex, after triggers have a specific purpose and limitation that developers must understand.</p>
</div>
<div class="paragraph">
<p>After triggers fire after the database operation has completed. At this point, the records that triggered the event (<code>Trigger.new</code> and <code>Trigger.old</code>) are read-only and cannot be modified through DML operations. This is by design in the Salesforce platform.</p>
</div>
<div class="paragraph">
<p>The Salesforce trigger framework provides two distinct contexts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Before triggers</strong> execute before the record is saved to the database. In this context, you can directly modify field values on the triggering records without performing DML operations.</p>
</li>
<li>
<p><strong>After triggers</strong> execute after the record is committed to the database. These records now have system-generated values like <code>Id</code> and <code>LastModifiedDate</code>, but they cannot be modified.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Attempting DML operations on the same records in an after trigger will result in a runtime exception, causing the entire transaction to fail. This can break functionality and create a poor user experience.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>When this pattern is used, the application will throw a runtime exception during trigger execution, causing the entire database transaction to roll back. This results in:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Failed record operations that users expect to succeed</p>
</li>
<li>
<p>Poor user experience with cryptic error messages</p>
</li>
<li>
<p>Potential data inconsistency if the failure occurs in complex business processes</p>
</li>
<li>
<p>Increased support burden from users reporting "broken" functionality</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Move the field updates to a before trigger where you can directly modify the record fields without DML operations.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-apex" data-lang="apex">trigger AccountAfterTrigger on Account (after insert) {
    List&lt;Account&gt; accountsToUpdate = new List&lt;Account&gt;();
    for(Account acc : Trigger.new) {
        acc.Description = 'Updated in after trigger'; // Noncompliant
        accountsToUpdate.add(acc);
    }
    update accountsToUpdate; // Noncompliant
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-apex" data-lang="apex">trigger AccountBeforeTrigger on Account (before insert) {
    for(Account acc : Trigger.new) {
        acc.Description = 'Updated in before trigger';
        // No DML needed - direct field assignment
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Apex Triggers - <a href="https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/apex_triggers.htm">Official Salesforce documentation on Apex triggers</a></p>
</li>
<li>
<p>Trigger Context Variables - <a href="https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/apex_triggers_context_variables.htm">Documentation on trigger context variables and their usage</a></p>
</li>
<li>
<p>Before vs After Triggers - <a href="https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/apex_triggers_best_practices.htm">Best practices for using before and after triggers</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>