<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is important to be careful when searching for characters within a substring. Let&#8217;s consider the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">if (str.SubString(startIndex).IndexOf(char1) == -1) // Noncompliant: a new string is going to be created by "Substring"
{
   // ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A new <code>string</code> object is created with every call to the <a href="https://learn.microsoft.com/en-us/dotnet/api/system.string.substring"><code>Substring</code></a> method. When chaining it with any of the following methods, it creates a new object for one-time use only:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.string.indexof"><code>IndexOf</code></a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.string.indexofany"><code>IndexOfAny</code></a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.string.lastindexof"><code>LastIndexOf</code></a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.string.lastindexofany"><code>LastIndexOfAny</code></a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>Creating a new object consumes significant <a href="https://en.wikipedia.org/wiki/System_resource">system resources</a>, especially CPU and memory. When using <code>Substring</code> repeatedly, such as in a loop, it can greatly impact the overall performance of the application or program.</p>
</div>
<div class="paragraph">
<p>To mitigate the creation of new objects while searching for characters within a substring, it is possible to use an overload of the mentioned methods with a <code>startIndex</code> parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">if (str.IndexOf(char1, startIndex) == -1)           // Compliant: no new instance of string is created
{
   // ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using these methods gives the same result while avoiding the creation of additional <code>string</code> objects.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.string.substring"><code>String.Substring</code> Method</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.string.indexof"><code>String.IndexOf</code> Method</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.string.indexofany"><code>String.IndexOfAny</code> Method</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.string.lastindexof"><code>String.LastIndexOf</code> Method</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.string.lastindexofany"><code>String.LastIndexOfAny</code> Method</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_benchmarks">Benchmarks</h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Runtime</th>
<th class="tableblock halign-left valign-top">StringSize</th>
<th class="tableblock halign-left valign-top">Mean</th>
<th class="tableblock halign-left valign-top">StdDev</th>
<th class="tableblock halign-left valign-top">Ratio</th>
<th class="tableblock halign-left valign-top">Allocated</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SubstringThenIndexOf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET 7.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">11.234 ms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.1319 ms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">40000008 B</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IndexOfOnly</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET 7.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.477 ms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.0473 ms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.22</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 B</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SubstringThenIndexOf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET Framework 4.6.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8.634 ms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.4195 ms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">48141349 B</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IndexOfOnly</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET Framework 4.6.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.724 ms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.0346 ms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.19</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SubstringThenIndexOf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET 7.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">14.651 ms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.2977 ms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">176000008 B</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IndexOfOnly</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET 7.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.464 ms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.0501 ms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.17</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 B</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SubstringThenIndexOf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET Framework 4.6.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">13.363 ms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.2044 ms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">176518761 B</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IndexOfOnly</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET Framework 4.6.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.689 ms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.0290 ms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SubstringThenIndexOf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET 7.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">78.688 ms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.4727 ms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1528000072 B</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IndexOfOnly</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET 7.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.456 ms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.0397 ms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.03</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 B</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SubstringThenIndexOf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET Framework 4.6.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">75.994 ms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.2650 ms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1532637240 B</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IndexOfOnly</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET Framework 4.6.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.699 ms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.0216 ms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.02</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The results were generated by running the following snippet with <a href="https://github.com/dotnet/BenchmarkDotNet">BenchmarkDotNet</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">private string theString;
private int iteration = 1_000_000;

[Params(10, 100, 1_000)]
public int StringSize { get; set; }

[GlobalSetup]
public void Setup() =&gt;
    theString = new string('a', StringSize);

[Benchmark(Baseline = true)]
public void SubstringThenIndexOf()
{
    for (var i = 0; i &lt; iteration; i++)
    {
        _ = theString.Substring(StringSize / 4).IndexOf('a');
    }
}

[Benchmark]
public void IndexOfOnly()
{
    for (var i = 0; i &lt; iteration; i++)
    {
        _ = theString.IndexOf('a', StringSize / 4) - StringSize / 4;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Hardware configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>BenchmarkDotNet=v0.13.5, OS=Windows 10 (10.0.19045.2965/22H2/2022Update)
12th Gen Intel Core i7-12800H, 1 CPU, 20 logical and 14 physical cores
.NET SDK=7.0.203
  [Host]               : .NET 7.0.5 (7.0.523.17405), X64 RyuJIT AVX2
  .NET 7.0             : .NET 7.0.5 (7.0.523.17405), X64 RyuJIT AVX2
  .NET Framework 4.6.2 : .NET Framework 4.8 (4.8.4614.0), X64 RyuJIT VectorSize=256</code></pre>
</div>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Replace 'XXX' with the overload that accepts a startIndex parameter.</p>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="paragraph">
<p>substring(beginIndex).indexOf(char1)</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_8_oct_2019_181815_sammy_baraka_wrote">on 8 Oct 2019, 18:18:15 Sammy Baraka wrote:</h3>
<div class="paragraph">
<p>I can take this issue if its still available.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_8_oct_2019_194424_ann_campbell_wrote">on 8 Oct 2019, 19:44:24 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>Thanks for the offer [~sbaraka]! C# is listed in the targeted languages, so that&#8217;s still open. Before you get started though it would be best to open a new thread in the <a href="https://community.sonarsource.com">community</a></p>
</div>
</div>
</div>
</div>