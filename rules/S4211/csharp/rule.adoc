Transparency attributes in .NET Framework are a set of security features designed to protect your code from unauthorized access and to protect security-critical operations. However, they can become a vulnerability if not correctly implemented.

== Why is this an issue?

Transparency attributes can be declared at several levels. If two different attributes are declared at two different levels, the result can be surprising and not what you may expect. For example, you can declare that a class is SecuritySafeCritical and that a method of this class is SecurityCritical:

[source,csharp]
----
    [SecuritySafeCritical]
    public class Foo
    {
        [SecurityCritical]
        public void Bar() // Is the method SecurityCritical or SecuritySafeCritical?
        {
        }
    }
----

You may think the method ``Bar`` is protected by the ``SecurityCritical`` attribute and can't be called from tranparent code. But in fact, the attribute that prevails is the ``SecuritySafeCritical`` attribute at the level of the class and the ``Bar`` method can be called from transparent code.


=== What is the potential impact?

Conflicting transparency attributes in .NET Framework can lead to serious security issues. 

==== Elevation of Privileges

An attacker could potentially exploit these conflicting transparency attributes to perform actions with higher privileges than intended. For instance, if a member is marked as SecurityCritical but the class is declared as SecuritySafeCritical, it might be called by regular code to perform security-sensitive operations that it shouldn't be able to.

==== Data Exposure

If a member with conflicting attributes is involved in handling sensitive data, an attacker could exploit the vulnerability to gain unauthorized access to this data. This could lead to breaches of confidentiality and potential data loss.


== How to fix it

To fix this vulnerability in the .NET Framework, you need to ensure that all members of a class or structure have consistent transparency attributes.

=== Code examples

==== Noncompliant code example

[source,csharp,diff-id=1,diff-type=noncompliant]
----
using System;
using System.Security;

namespace MyLibrary
{
    [SecuritySafeCritical]
    public class Foo
    {
        [SecurityCritical] // Noncompliant
        public void Bar()
        {
        }
    }
}
----


==== Compliant solution

[source,csharp,diff-id=1,diff-type=compliant]
----
using System;
using System.Security;

namespace MyLibrary
{
    public class Foo
    {
        [SecurityCritical]
        public void Bar()
        {
        }
    }
}
----


== Resources

=== Articles & blog posts

* Redgate Hub - https://www.red-gate.com/simple-talk/development/dotnet-development/whats-new-in-code-access-security-in-net-framework-4-0-part-i/[What’s New in Code Access Security in .NET Framework 4.0 – Part I]

=== Standards

* OWASP - https://owasp.org/Top10/A05_2021-Security_Misconfiguration/[Top 10 2021 Category A5 - Security Misconfiguration]
* OWASP - https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration[Top 10 2017 Category A6 - Security Misconfiguration]

ifdef::env-github,rspecator-view[]

'''
== Implementation Specification
(visible only on this page)

=== Message

Change or remove this attribute to be consistent with its container


=== Highlighting

primary: Attribute declaration of member

secondary: Attribute declaration of container


endif::env-github,rspecator-view[]
