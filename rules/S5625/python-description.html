<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="https://www.python.org/dev/peps/pep-0234/#python-api-specification">iterator protocol</a> specifies that an iterator object should have</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a <code>__next__</code> method retrieving the next value or raising <code>StopIteration</code> when there are no more values left.</p>
</li>
<li>
<p>an <code>__iter__</code> method which should always return <code>self</code>. This enables iterators to be used as sequences in for-loops and other places.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This rule raises an issue when a class has a <code>__next__</code> method and either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>it doesn&#8217;t have an <code>__iter__</code> method.</p>
</li>
<li>
<p>or its <code>__iter__</code> method does not return "self".</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_noncompliant_code_example">Noncompliant code example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">class MyIterator:  # Noncompliant. Class has a __next__ method but no __iter__ method

    def __init__(self, values):
        self._values = values
        self._index = 0

    def __next__(self):
        if self._index &gt;= len(self._values):
            raise StopIteration()
        value = self._values[self._index]
        self._index += 1
        return value


class MyIterator:
    def __init__(self, values):
        self._values = values
        self._index = 0

    def __next__(self):
        if self._index &gt;= len(self._values):
            raise StopIteration()
        value = self._values[self._index]
        self._index += 1
        return value

    def __iter__(self):
        return 42  # Noncompliant. This __iter__ method does not return self


class MyIterable:  # Ok. This is an iterable, not an iterator, i.e. it has an __iter__ method but no __next__ method. Thus __iter__ doesn't have to return "self"

    def __init__(self, values):
        self._values = values

    def __iter__(self):
        return MyIterator(self._values)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_compliant_solution">Compliant solution</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">class MyIterator:
    def __init__(self, values):
        self._values = values
        self._index = 0

    def __next__(self):
        if self._index &gt;= len(self._values):
            raise StopIteration()
        value = self._values[self._index]
        self._index += 1
        return value

    def __iter__(self):
        return self

class MyIterable:
    def __init__(self, values):
        self._values = values

    def __iter__(self):
        return MyIterator(self._values)</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://www.python.org/dev/peps/pep-0234/#python-api-specification">PEP 234 - Iterators</a></p>
</li>
<li>
<p><a href="https://docs.python.org/3/library/stdtypes.html#iterator-types">Python documentation - Iterator Types</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="ulist">
<ul>
<li>
<p>Add an <em>iter</em> method to this class.</p>
</li>
<li>
<p>Return "self" from this "<em>iter</em>" method.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="ulist">
<ul>
<li>
<p>If the __iter__ method is present but does not return "self"</p>
<div class="ulist">
<ul>
<li>
<p>Primary: The __iter__ method signature</p>
</li>
<li>
<p>Secondary: The returned value if there is one</p>
</li>
</ul>
</div>
</li>
<li>
<p>If there is no __iter__ method</p>
<div class="ulist">
<ul>
<li>
<p>Primary: The class signature</p>
</li>
<li>
<p>Secondary: The __next__ method signature</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_relates_to_s2876">relates to: <a data-rspec-id="S2876" class="rspec-auto-link">S2876</a></h3>

</div>
</div>
</div>