<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Using classes and methods that rely on the default system encoding can result in code that works fine in its "home" environment. But that code may break for customers who use different encodings in ways that are extremely difficult to diagnose and nearly, if not completely, impossible to reproduce when it&#8217;s time to fix them.</p>
</div>
<div class="paragraph">
<p>This rule detects uses of the following classes and methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>FileReader</code></p>
</li>
<li>
<p><code>FileWriter</code></p>
</li>
<li>
<p>String constructors with a <code>byte[]</code> argument but no <code>Charset</code> argument</p>
<div class="ulist">
<ul>
<li>
<p><code>String(byte[] bytes)</code></p>
</li>
<li>
<p><code>String(byte[] bytes, int offset, int length)</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>String.getBytes()</code></p>
</li>
<li>
<p><code>String.getBytes(int srcBegin, int srcEnd, byte[] dst, int dstBegin)</code></p>
</li>
<li>
<p><code>InputStreamReader(InputStream in)</code></p>
</li>
<li>
<p><code>OutputStreamWriter(OutputStream out)</code></p>
</li>
<li>
<p><code>ByteArrayOutputStream.toString()</code></p>
</li>
<li>
<p>Some <code>Formatter</code> constructors</p>
<div class="ulist">
<ul>
<li>
<p><code>Formatter(String fileName)</code></p>
</li>
<li>
<p><code>Formatter(File file)</code></p>
</li>
<li>
<p><code>Formatter(OutputStream os)</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Some <code>Scanner</code> constructors</p>
<div class="ulist">
<ul>
<li>
<p><code>Scanner(File source)</code></p>
</li>
<li>
<p><code>Scanner(Path source)</code></p>
</li>
<li>
<p><code>Scanner(InputStream source)</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Some <code>PrintStream</code> constructors</p>
<div class="ulist">
<ul>
<li>
<p><code>PrintStream(File file)</code></p>
</li>
<li>
<p><code>PrintStream(OutputStream out)</code></p>
</li>
<li>
<p><code>PrintStream(OutputStream out, boolean autoFlush)</code></p>
</li>
<li>
<p><code>PrintStream(String fileName)</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Some <code>PrintWriter</code> constructors</p>
<div class="ulist">
<ul>
<li>
<p><code>PrintWriter(File file)</code></p>
</li>
<li>
<p><code>PrintWriter(OutputStream out)</code></p>
</li>
<li>
<p><code>PrintWriter(OutputStream out, boolean autoFlush)</code></p>
</li>
<li>
<p><code>PrintWriter(String fileName)</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>methods from Apache commons-io library which accept an encoding argument when that argument is null, and overloads of those methods that omit the encoding argument</p>
<div class="ulist">
<ul>
<li>
<p><code>IOUtils.copy(InputStream, Writer)</code></p>
</li>
<li>
<p><code>IOUtils.copy(Reader, OutputStream)</code></p>
</li>
<li>
<p><code>IOUtils.readLines(InputStream)</code></p>
</li>
<li>
<p><code>IOUtils.toByteArray(Reader)</code></p>
</li>
<li>
<p><code>IOUtils.toByteArray(String)</code></p>
</li>
<li>
<p><code>IOUtils.toCharArray(InputStream)</code></p>
</li>
<li>
<p><code>IOUtils.toInputStream(TypeCriteria.subtypeOf(CharSequence))</code></p>
</li>
<li>
<p><code>IOUtils.toString(byte[])</code></p>
</li>
<li>
<p><code>IOUtils.toString(URI)</code></p>
</li>
<li>
<p><code>IOUtils.toString(URL)</code></p>
</li>
<li>
<p><code>IOUtils.write(char[], OutputStream)</code></p>
</li>
<li>
<p><code>IOUtils.write(CharSequence, OutputStream)</code></p>
</li>
<li>
<p><code>IOUtils.writeLines(Collection, String, OutputStream)</code></p>
</li>
<li>
<p><code>FileUtils.readFileToString(File)</code></p>
</li>
<li>
<p><code>FileUtils.readLines(File)</code></p>
</li>
<li>
<p><code>FileUtils.write(File, CharSequence)</code></p>
</li>
<li>
<p><code>FileUtils.write(File, CharSequence, boolean)</code></p>
</li>
<li>
<p><code>FileUtils.writeStringToFile(File, String)</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://wiki.sei.cmu.edu/confluence/x/pzdGBQ">CERT, STR04-J.</a> - Use compatible character encodings when communicating string data between JVMs</p>
</li>
<li>
<p><a href="https://wiki.sei.cmu.edu/confluence/x/ujZGBQ">CERT, STR50-J.</a> - Use the appropriate method for counting characters in a string</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Remove this use of "xxx"</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_25_aug_2014_064254_freddy_mallet_wrote">on 25 Aug 2014, 06:42:54 Freddy Mallet wrote:</h3>
<div class="paragraph">
<p>Hi @Ann, did you get the idea of this rule from CWE or Findbugs ?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_25_aug_2014_190112_ann_campbell_wrote">on 25 Aug 2014, 19:01:12 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>Neither, [~freddy.mallet]. I believe it was [~dinesh.bolkensteyn] who requested this rule.</p>
</div>
<div class="paragraph">
<p>I&#8217;ve just checked the CWE list, but I don&#8217;t see one that we could tie this rule to without a stretch.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_26_aug_2014_121408_freddy_mallet_wrote">on 26 Aug 2014, 12:14:08 Freddy Mallet wrote:</h3>
<div class="paragraph">
<p>My only fear is to have this rule generating too many false-positives [~ann.campbell.2].</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_26_aug_2014_135935_dinesh_bolkensteyn_wrote">on 26 Aug 2014, 13:59:35 Dinesh Bolkensteyn wrote:</h3>
<div class="paragraph">
<p>It&#8217;s going to work [~freddy.mallet].</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_30_apr_2015_132131_david_gageot_wrote">on 30 Apr 2015, 13:21:31 David Gageot wrote:</h3>
<div class="paragraph">
<p>Hi all! lot&#8217;s of defects will be raised but none will be false positive. Methods without charset/encoding should be deprecated altogether. They will fail. And they will wait production to do so!</p>
</div>
</div>
</div>
</div>