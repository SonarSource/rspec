<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Path Traversal Server-Side Request Forgery is a sub-class of
Server-Side Request Forgery (SSRF). In this type of attack, the attacker
manipulates the path of the URL in the server-side request, rather than
controlling the entire URL. This can lead to unauthorized access to endpoints
or data by altering the request path.</p>
</div>
<div class="paragraph">
<p>Path Traversal SSRF attacks are dangerous because they can exploit the
server-side application&#8217;s ability to send requests to internal resources that
are typically inaccessible to external attackers. By manipulating the path,
attackers can potentially gain access to sensitive information or
functionalities that should be protected.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>The impact of SSRF vulnerabilities can vary greatly depending on the context in
which the user input is used.</p>
</div>
<div class="sect3">
<h4 id="_api_traversal">API Traversal</h4>
<div class="paragraph">
<p>In a path traversal SSRF attack, the attacker can manipulate the path of the
server-side request to traverse through different endpoints of an API. This can
lead to several potential impacts:</p>
</div>
<div class="sect4">
<h5 id="_unauthorized_access_to_api_endpoints">Unauthorized access to API endpoints</h5>
<div class="paragraph">
<p>By manipulating the path of the server-side request, an attacker can potentially
access API endpoints that are not intended to be publicly accessible. This could
include endpoints that provide access to sensitive data or functionality.
Unauthorized access to these endpoints could lead to data breaches or
unauthorized actions being performed on the server.</p>
</div>
</div>
<div class="sect4">
<h5 id="_manipulation_of_api_responses">Manipulation of API responses</h5>
<div class="paragraph">
<p>If an attacker can manipulate the path of a server-side request to traverse to
different API endpoints, they could potentially influence the responses that the
server sends back. This could lead to incorrect or misleading data being
returned, which could have a variety of impacts depending on the nature of the
application and the data involved.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it_in_asp_net">How to fix it in ASP.NET</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="paragraph">
<p>The following code is vulnerable to SSRF as it performs an HTTP request to a
URL partially defined by untrusted data.</p>
</div>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-vbnet" data-lang="vbnet">Public Class ExampleController
    Inherits Controller

    &lt;HttpGet&gt;
    Public Function GetUser(Id As String) As IActionResult
        Dim Url As String = "http://example.com/api/user/" &amp; Id
        Dim Request As HttpWebRequest = CType(WebRequest.Create(Url), HttpWebRequest) ' Noncompliant

        Return Ok()
    End Function
End Class</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-vbnet" data-lang="vbnet">Public Class ExampleController
    Inherits Controller

    &lt;HttpGet&gt;
    Public Function GetUser(Id As String) As IActionResult
        Dim Url As String = "http://example.com/api/user/?id=" &amp; HttpUtility.UrlEncode(Id)
        Dim Request As HttpWebRequest = CType(WebRequest.Create(Url), HttpWebRequest)

        Return Ok()
    End Function
End Class</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_how_does_this_work">How does this work?</h3>
<div class="sect3">
<h4 id="_url_encoding">URL-encoding</h4>
<div class="paragraph">
<p>A common method to mitigate path traversal SSRF attacks involves URL-encoding
user input prior to its incorporation into a URL. URL-encoding, or
percent-encoding, is a technique used to encode certain information within a
Uniform Resource Identifier (URI). This is achieved by transforming potentially
malicious characters, such as <code>../</code>, into a safe encoded format that can be
safely included in a URL without modifying the intended path.</p>
</div>
<div class="paragraph">
<p>However, it is crucial to note that simply encoding the user input might not be
sufficient in all cases due to varying behaviors of different servers.
Therefore, it is recommended to move the dynamic, user-controlled input from the
actual path of the URL to the query string, if possible. This further reduces
the risk of path traversal, as the query string is less likely to be
misinterpreted by the server as a directory traversal command.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_standards">Standards</h3>
<div class="ulist">
<ul>
<li>
<p>OWASP - <a href="https://owasp.org/Top10/A10_2021-Server-Side_Request_Forgery_%28SSRF%29/">Top 10 2021 Category A10 - Server-Side Request Forgery (SSRF)</a></p>
</li>
<li>
<p>OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/918">CWE-918 - Server-Side Request Forgery (SSRF)</a></p>
</li>
<li>
<p>STIG Viewer - <a href="https://stigviewer.com/stigs/application_security_and_development/2024-12-06/finding/V-222609">Application Security and Development: V-222609</a> - The application must not be subject to input handling vulnerabilities.</p>
</li>
</ul>
</div>
</div>
</div>
</div>