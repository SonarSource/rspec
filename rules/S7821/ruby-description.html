<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This rule raises an issue when Rails controllers manually decode JSON from <code>request.body</code> instead of using the automatically parsed <code>params</code> hash.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Rails automatically parses JSON requests when the proper <code>Content-Type</code> header is set (typically <code>application/json</code>). This parsed data is made available through the <code>params</code> hash, which is the standard Rails way to access request parameters.</p>
</div>
<div class="paragraph">
<p>Manual JSON decoding using methods like <code>ActiveSupport::JSON.decode(request.body)</code> or <code>JSON.parse(request.body)</code> creates several problems:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Redundancy</strong>: You&#8217;re duplicating work that Rails already does automatically</p>
</li>
<li>
<p><strong>Error-prone</strong>: Manual parsing can fail if the request body is malformed or empty</p>
</li>
<li>
<p><strong>Security bypass</strong>: Rails' built-in parameter filtering and strong parameters are bypassed</p>
</li>
<li>
<p><strong>Inconsistency</strong>: Other parts of your application expect to use <code>params</code>, creating inconsistent patterns</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Rails' parameter parsing also handles edge cases like empty request bodies and provides consistent behavior across different request types (form data, JSON, XML).</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>Manual JSON decoding can lead to security vulnerabilities by bypassing Rails' parameter filtering mechanisms. It also makes code less maintainable and more prone to runtime errors when handling malformed JSON requests.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it_in_rails">How to fix it in Rails</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Replace manual JSON decoding with Rails' automatically parsed <code>params</code> hash. Ensure your client sends the proper <code>Content-Type: application/json</code> header.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">def create
  req = ActiveSupport::JSON.decode(request.body) # Noncompliant
  if user = User.authenticate(req["email"], req["password"])
    session[:user_id] = user.id
    render json: { success: true }
  else
    render json: { success: false }
  end
end</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">def create
  if user = User.authenticate(params["email"], params["password"])
    session[:user_id] = user.id
    render json: { success: true }
  else
    render json: { success: false }
  end
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>This also applies to other JSON parsing methods. Use <code>params</code> instead of manually parsing the request body.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_code_examples_2">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example_2">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">def update
  data = JSON.parse(request.body.read) # Noncompliant
  @user.update(data["user"])
  render json: @user
end</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution_2">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">def update
  @user.update(params["user"])
  render json: @user
end</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Rails Action Controller Parameters - <a href="https://guides.rubyonrails.org/action_controller_overview.html#parameters">Official Rails guide on how parameters work in controllers</a></p>
</li>
<li>
<p>Rails Strong Parameters - <a href="https://guides.rubyonrails.org/action_controller_overview.html#strong-parameters">Documentation on Rails' parameter filtering and security features</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_standards">Standards</h3>
<div class="ulist">
<ul>
<li>
<p>CWE-20: Improper Input Validation - <a href="https://cwe.mitre.org/data/definitions/20.html">Manual parsing can bypass input validation mechanisms</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>