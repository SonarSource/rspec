<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>While the properties of a <a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/readonly"><code>readonly</code></a> <a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/reference-types">reference type</a> field can still be changed after initialization, those of a <code>readonly</code> <a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/builtin-types/value-types">value type</a> field, such as a <a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/builtin-types/struct"><code>struct</code></a>, cannot.</p>
</div>
<div class="paragraph">
<p>If the member could be either a <code>class</code> or a <code>struct</code> then assignment to its properties could be unreliable, working sometimes but not others.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are two ways to fix this issue:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Restrict the type of the field to a <code>class</code></p>
</li>
<li>
<p>Remove the assignment entirely, if it is not possible to restrict the type of the field</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">interface IPoint
{
    int X { get; set; }
    int Y { get; set; }
}

class PointManager&lt;T1, T2&gt;
    where T1 : IPoint
    where T2 : IPoint
{
    readonly T1 point1;  // this could be a struct
    readonly T2 point2;  // this could be a struct

    public PointManager(T1 point1, T2 point2)
    {
        this.point1 = point1;
        this.point2 = point2;
    }

    public void MovePoints(int newX)
    {
        point1.X = newX; //Noncompliant: if point is a struct, then nothing happened
        point2.X = newX; //Noncompliant: if point is a struct, then nothing happened
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">interface IPoint
{
    int X { get; set; }
    int Y { get; set; }
}

class PointManager&lt;T1, T2&gt;
    where T1 : IPoint
    where T2 : class, IPoint
{
    readonly T1 point1;  // this could be a struct
    readonly T2 point2;  // this is a class

    public PointManager(T1 point1, T2 point2)
    {
        this.point1 = point1;
        this.point2 = point2;
    }

    public void MovePoints(int newX) // assignment to point1 has been removed
    {
        point2.X = newX; // Compliant: point2 is a class
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Microsoft Learn - <a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/readonly">readonly (C# Reference)</a></p>
</li>
<li>
<p>Microsoft Learn - <a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/reference-types">Reference types (C# reference)</a></p>
</li>
<li>
<p>Microsoft Learn - <a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/builtin-types/value-types">Value types (C# reference)</a></p>
</li>
<li>
<p>Microsoft Learn - <a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/builtin-types/struct">Structure types (C# reference)</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Restrict "x" to be a reference type or remove this assignment of "y"; it is useless if "x" is a value type.</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_13_may_2015_201312_ann_campbell_wrote">on 13 May 2015, 20:13:12 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~tamas.vajk]</p>
</div>
<div class="ulist">
<ul>
<li>
<p>I&#8217;ve got the name of the equivalent R# rule, but I&#8217;m not sure how to find its key&#8230;&#8203;</p>
</li>
<li>
<p>I suspect I may have missed some of the subtleties intended in this rule. Feel free to start an edit iteration</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_on_18_may_2015_091533_tamas_vajk_wrote">on 18 May 2015, 09:15:33 Tamas Vajk wrote:</h3>
<div class="paragraph">
<p>Updated the rule. Could you please check its language, and if it makes sense to you too?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_21_may_2015_143422_ann_campbell_wrote">on 21 May 2015, 14:34:22 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>see what you think [~tamas.vajk]</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_22_may_2015_112816_tamas_vajk_wrote">on 22 May 2015, 11:28:16 Tamas Vajk wrote:</h3>
<div class="paragraph">
<p>Looks good, I adjusted some wording in the first sentence of the description</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_22_may_2015_121014_ann_campbell_wrote">on 22 May 2015, 12:10:14 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>Thanks [~tamas.vajk]. Looks good</p>
</div>
</div>
</div>
</div>