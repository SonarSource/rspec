<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This rule raises an issue when an attribute ending with <code>_</code> is set in the <code>__init__</code> method of a class inheriting from
Scikit-Learn <code>BaseEstimator</code></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>On a Scikit-Learn estimator, attributes that have a trailing underscore represent attributes that are estimated.
These attributes have to be set in the fit method. Their presence is used to verify if an estimator has been fitted.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from sklearn.neighbors import KNeighborsClassifier

X = [[0], [1], [2], [3]]
y = [0, 0, 1, 1]
knn = KNeighborsClassifier(n_neighbors=1)
knn.fit(X, y)
knn.n_samples_fit_</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above the attributes of the <code>KNeighborsClassifier</code>, <code>n_samples_fit_</code>
is set only after the estimator&#8217;s <code>fit</code> method is called. Calling <code>n_samples_fit_</code> before the estimator is fitted
would raise an <code>AttributeError</code> exception.</p>
</div>
<div class="paragraph">
<p>When implementing a custom estimator by subclassing Scikit-Learn&#8217;s <code>BaseEstimator</code>,
it is important to follow the above convention and not set attributes with a trailing underscore inside the <code>__init__</code> method.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To fix this issue, move the attributes with a trailing underscore from the <code>__init__</code> method to the <code>fit</code> method.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from sklearn.base import BaseEstimator

class MyEstimator(BaseEstimator):
    def __init__(self):
        self.estimated_attribute_ = None # Noncompliant: an estimated attribute is set in the __init__ method.</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from sklearn.base import BaseEstimator

class MyEstimator(BaseEstimator):
    def fit(self, X, y):
        self.estimated_attribute_ = some_estimation(X) # Compliant</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Scikit-Learn documentation - <a href="https://scikit-learn.org/stable/developers/develop.html#parameters-and-init">Parameters and init</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Verify that subclasses of BaseEstimator do not have attributes with a trailing underscore in the <em>init</em> method.
Verify that inherited alongside BaseEstimator do not have attributes with a trailing underscore in the <em>init</em> method.</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Primary : Move this estimated attribute inside the <code>fit</code> method.</p>
</div>
<div class="paragraph">
<p>Secondary:  this attributes is used in this estimator (in the case of mixins)</p>
</div>
</div>
<div class="sect2">
<h3 id="_issue_location">Issue location</h3>
<div class="paragraph">
<p>Primary : name of the attribute</p>
</div>
<div class="paragraph">
<p>Secondary : the name of the estimator subclassing the mixin and the BaseEstimator</p>
</div>
</div>
<div class="sect2">
<h3 id="_quickfix">Quickfix</h3>
<div class="paragraph">
<p>Possible quickfix if the <code>fit</code> method does not exist. (Add the fit method with the estimated attribute) and delete the estimated attributes
from the <em>init</em> method. This is only possible in an estimator directly subclassing BaseEstimator.</p>
</div>
</div>
</div>
</div>