<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This rule raises an issue when a special method raises a <code>NotImplementedError</code> instead of returning <code>NotImplemented</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In Python, special methods corresponding to numeric operators and rich comparison operators should return <code>NotImplemented</code> when the operation is not supported.</p>
</div>
<div class="paragraph">
<p>For example <code>A + B</code> is equivalent to calling <code>A.__add__(B)</code>. If this binary operation is not supported by class A, <code>A.__add__(B)</code> should return <code>NotImplemented</code>. The interpreter will then try the reverse operation, i.e. <code>B.__radd__(A)</code>. If these special methods were to raise <code>NotImplementedError</code>, the callers would not catch the exception and the reverse operation would not be called.</p>
</div>
<div class="paragraph">
<p>Below is the list of special methods this rule applies to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>__lt__(self, other)</code></p>
</li>
<li>
<p><code>__le__(self, other)</code></p>
</li>
<li>
<p><code>__eq__(self, other)</code></p>
</li>
<li>
<p><code>__ne__(self, other)</code></p>
</li>
<li>
<p><code>__gt__(self, other)</code></p>
</li>
<li>
<p><code>__ge__(self, other)</code></p>
</li>
<li>
<p><code>__add__(self, other)</code></p>
</li>
<li>
<p><code>__sub__(self, other)</code></p>
</li>
<li>
<p><code>__mul__(self, other)</code></p>
</li>
<li>
<p><code>__matmul__(self, other)</code></p>
</li>
<li>
<p><code>__truediv__(self, other)</code></p>
</li>
<li>
<p><code>__floordiv__(self, other)</code></p>
</li>
<li>
<p><code>__mod__(self, other)</code></p>
</li>
<li>
<p><code>__divmod__(self, other)</code></p>
</li>
<li>
<p><code>__pow__(self, other[, modulo])</code></p>
</li>
<li>
<p><code>__lshift__(self, other)</code></p>
</li>
<li>
<p><code>__rshift__(self, other)</code></p>
</li>
<li>
<p><code>__and__(self, other)</code></p>
</li>
<li>
<p><code>__xor__(self, other)</code></p>
</li>
<li>
<p><code>__or__(self, other)</code></p>
</li>
<li>
<p><code>__radd__(self, other)</code></p>
</li>
<li>
<p><code>__rsub__(self, other)</code></p>
</li>
<li>
<p><code>__rmul__(self, other)</code></p>
</li>
<li>
<p><code>__rmatmul__(self, other)</code></p>
</li>
<li>
<p><code>__rtruediv__(self, other)</code></p>
</li>
<li>
<p><code>__rfloordiv__(self, other)</code></p>
</li>
<li>
<p><code>__rmod__(self, other)</code></p>
</li>
<li>
<p><code>__rdivmod__(self, other)</code></p>
</li>
<li>
<p><code>__rpow__(self, other[, modulo])</code></p>
</li>
<li>
<p><code>__rlshift__(self, other)</code></p>
</li>
<li>
<p><code>__rrshift__(self, other)</code></p>
</li>
<li>
<p><code>__rand__(self, other)</code></p>
</li>
<li>
<p><code>__rxor__(self, other)</code></p>
</li>
<li>
<p><code>__ror__(self, other)</code></p>
</li>
<li>
<p><code>__iadd__(self, other)</code></p>
</li>
<li>
<p><code>__isub__(self, other)</code></p>
</li>
<li>
<p><code>__imul__(self, other)</code></p>
</li>
<li>
<p><code>__imatmul__(self, other)</code></p>
</li>
<li>
<p><code>__itruediv__(self, other)</code></p>
</li>
<li>
<p><code>__ifloordiv__(self, other)</code></p>
</li>
<li>
<p><code>__imod__(self, other)</code></p>
</li>
<li>
<p><code>__ipow__(self, other[, modulo])</code></p>
</li>
<li>
<p><code>__ilshift__(self, other)</code></p>
</li>
<li>
<p><code>__irshift__(self, other)</code></p>
</li>
<li>
<p><code>__iand__(self, other)</code></p>
</li>
<li>
<p><code>__ixor__(self, other)</code></p>
</li>
<li>
<p><code>__ior__(self, other)</code></p>
</li>
<li>
<p><code>__length_hint__(self)</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Make sure special methods return <code>NotImplemented</code> instead of raising a <code>NotImplementedError</code>.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">class MyClass:
    def __add__(self, other):
        raise NotImplementedError()  # Noncompliant: the exception will be propagated
    def __radd__(self, other):
        raise NotImplementedError()  # Noncompliant: the exception will be propagated

class MyOtherClass:
    def __add__(self, other):
        return 42
    def __radd__(self, other):
        return 42

MyClass() + MyOtherClass()  # This will raise NotImplementedError</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">class MyClass:
    def __add__(self, other):
        return NotImplemented
    def __radd__(self, other):
        return NotImplemented

class MyOtherClass:
    def __add__(self, other):
        return 42
    def __radd__(self, other):
        return 42

MyClass() + MyOtherClass()  # This returns 42</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_pitfalls">Pitfalls</h3>
<div class="paragraph">
<p>The <code>__length_hint__</code> special method also requires to return a <code>NotImplemented</code>. Its behavior differs from the other methods, because when it returns <code>NotImplemented</code>, a default value will be returned instead. See <a href="https://peps.python.org/pep-0424/">PEP 424</a> for more information.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Python documentation - <a href="https://docs.python.org/3/library/constants.html#NotImplemented">Built-in Constants - NotImplemented</a></p>
</li>
<li>
<p>Python documentation - <a href="https://docs.python.org/3/library/numbers.html#implementing-the-arithmetic-operations">Implementing the arithmetic operations</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_standards">Standards</h3>
<div class="ulist">
<ul>
<li>
<p>PEP 424 - <a href="https://peps.python.org/pep-0424/">A method exposing <code>__length_hint__</code></a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Return "NotImplemented" instead of raising "NotImplementedError"</p>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="paragraph">
<p>The raise statement.</p>
</div>
</div>
</div>
</div>