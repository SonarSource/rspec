<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Composite format strings in C# are evaluated at runtime, which means they are not verified by the compiler. Introducing an ill-formed format item, or indexing mismatch can lead to unexpected behaviors or runtime errors. The purpose of this rule is to perform static validation on composite format strings used in various string formatting functions to ensure their correct usage.
This rule validates the proper behavior of composite formats when invoking the following methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>String.Format</code></p>
</li>
<li>
<p><code>StringBuilder.AppendFormat</code></p>
</li>
<li>
<p><code>Console.Write</code></p>
</li>
<li>
<p><code>Console.WriteLine</code></p>
</li>
<li>
<p><code>TextWriter.Write</code></p>
</li>
<li>
<p><code>TextWriter.WriteLine</code></p>
</li>
<li>
<p><code>Debug.WriteLine(String, Object[])</code></p>
</li>
<li>
<p><code>Trace.TraceError(String, Object[])</code></p>
</li>
<li>
<p><code>Trace.TraceInformation(String, Object[])</code></p>
</li>
<li>
<p><code>Trace.TraceWarning(String, Object[])</code></p>
</li>
<li>
<p><code>TraceSource.TraceInformation(String, Object[])</code></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_noncompliant_code_example">Noncompliant code example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">s = string.Format("[0}", arg0); // Noncompliant: square bracket '[' instead of curly bracket '{'
s = string.Format("{{0}", arg0); // Noncompliant: double starting curly brackets '{{'
s = string.Format("{0}}", arg0); // Noncompliant: double ending curly brackets '}}'
s = string.Format("{-1}", arg0); // Noncompliant: invalid index for the format item, must be &gt;= 0
s = string.Format("{0} {1}", arg0); // Noncompliant: two format items in the string but only one argument provided</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_compliant_solution">Compliant solution</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">s = string.Format("{0}", 42); // Compliant
s = string.Format("{0,10}", 42); // Compliant
s = string.Format("{0,-10}", 42); // Compliant
s = string.Format("{0:0000}", 42); // Compliant
s = string.Format("{2}-{0}-{1}", 1, 2, 3); // Compliant
s = string.Format("no format"); // Compliant</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_exceptions">Exceptions</h3>
<div class="paragraph">
<p>The rule does not perform any checks on the format specifier, if present (defined after the <code>:</code>).
Moreover, no issues are raised in the following cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the format string is not a <code>const</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">var pattern = "{0} {1} {2}";
var res = string.Format(pattern, 1, 2); // Compliant, non-constant string are not recognized</code></pre>
</div>
</div>
</li>
<li>
<p>the argument is not an inline creation array.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">var array = new int[] {};
var res = string.Format("{0} {1}", array); // Compliant the rule does not check the size of the array</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/standard/base-types/composite-formatting">Composite formatting</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.string.format">String.Format</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.text.stringbuilder.appendformat">StringBuilder.AppendFormat</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.console.write">Console.Write</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.console.writeline">Console.WriteLine</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.io.textwriter.write">TextWriter.Write</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.io.textwriter.writeline">TextWriter.WriteLine</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.diagnostics.debug.writeline">Debug.WriteLine</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.diagnostics.trace.traceerror">Trace.TraceError</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.diagnostics.trace.traceinformation">Trace.TraceInformation</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.diagnostics.trace.tracewarning">Trace.TraceWarning</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.diagnostics.tracesource.traceinformation">TraceSource.TraceInformation</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/standard/base-types/formatting-types">Standard format strings</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="ulist">
<ul>
<li>
<p>Invalid string format, the format cannot be null.</p>
</li>
<li>
<p>Invalid string format, unbalanced curly brace count.</p>
</li>
<li>
<p>Invalid string format, opening curly brace can only be followed by a digit or an opening curly brace.</p>
</li>
<li>
<p>Invalid string format, the highest string format item index should not be greater than the arguments count.</p>
</li>
<li>
<p>Invalid string format, format items should comply with the following pattern '{index[,alignment][:formatString]}'.</p>
</li>
<li>
<p>Invalid string format, all format item indexes should be a number.</p>
</li>
<li>
<p>Invalid string format, all format item alignments should be a number.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="paragraph">
<p>The format string.</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_31_aug_2015_123959_tamas_vajk_wrote">on 31 Aug 2015, 12:39:59 Tamas Vajk wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] Could you check the issue message? I can&#8217;t easily find out the number of placeholders in the format, that&#8217;s why I can&#8217;t use the same as in Python.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_31_aug_2015_130346_ann_campbell_wrote">on 31 Aug 2015, 13:03:46 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~tamas.vajk] the message is fine as far as it goes, but it doesn&#8217;t cover something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>var s1 = string.Format("{3}", 1);</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_on_18_jan_2016_110513_ann_campbell_wrote">on 18 Jan 2016, 11:05:13 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>This should eventually cover <code>Console.WriteLine</code> (and some others, I&#8217;m told) too.</p>
</div>
</div>
<div class="sect2">
<h3 id="_relates_to_s3457">relates to: <a data-rspec-id="S3457" class="rspec-auto-link">S3457</a></h3>

</div>
<div class="sect2">
<h3 id="_is_related_to_s3941">is related to: <a data-rspec-id="S3941" class="rspec-auto-link">S3941</a></h3>

</div>
<div class="sect2">
<h3 id="_on_2_feb_2015_204330_sébastien_gioria_wrote">on 2 Feb 2015, 20:43:30 Sébastien Gioria wrote:</h3>
<div class="paragraph">
<p>could fall in OWASP Top10 2013 A6</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_3_feb_2015_203229_ann_campbell_wrote">on 3 Feb 2015, 20:32:29 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>I don&#8217;t understand how [~sebastien.gioria]</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_14_jul_2016_180743_ann_campbell_wrote">on 14 Jul 2016, 18:07:43 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~nicolas.peru] I think https://github.com/google/error-prone/blob/master/docs/bugpattern/FormatString.md has cases not covered here&#8230;&#8203;?</p>
</div>
</div>
</div>
</div>