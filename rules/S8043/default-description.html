<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This rule raises an issue when DML operations (insert, update, delete, upsert) are performed directly within catch blocks.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Performing DML operations directly in catch blocks creates a dangerous situation where the original exception can be completely masked.</p>
</div>
<div class="paragraph">
<p>When your code encounters an exception, the catch block is meant to handle that error gracefully. However, if you perform a DML operation (like inserting an exception log record) within the catch block, that DML operation can itself fail for various reasons:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Missing required fields</p>
</li>
<li>
<p>Validation rule failures</p>
</li>
<li>
<p>Governor limit violations</p>
</li>
<li>
<p>Field-level security restrictions</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When the DML operation fails, it throws a new <code>DmlException</code> that replaces the original exception. This means you lose all information about what actually went wrong in your business logic. Instead of seeing "Account validation failed: Industry is required", you might only see "Exception logging failed: Missing required field Exception_Type__c".</p>
</div>
<div class="paragraph">
<p>This makes debugging extremely difficult and can hide critical issues in your application. The original problem remains unfixed while you chase secondary logging failures.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>The primary risk is loss of critical debugging information. When the original exception is masked, developers cannot identify and fix the root cause of failures.</p>
</div>
<div class="paragraph">
<p>This can lead to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Prolonged system issues that remain unresolved</p>
</li>
<li>
<p>Increased debugging time and development costs</p>
</li>
<li>
<p>Poor user experience due to unaddressed underlying problems</p>
</li>
<li>
<p>Potential data integrity issues if business logic failures go unnoticed</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Replace direct DML operations in catch blocks with Platform Events. Platform Events are published asynchronously and won&#8217;t fail the current transaction, ensuring your exception logging doesn&#8217;t mask the original error.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-apex" data-lang="apex">try {
    Account acc = new Account(Name = 'Test');
    insert acc;
} catch(Exception e) {
    Exception__c exc = new Exception__c();
    exc.Exception_Details__c = e.getMessage();
    insert exc; // Noncompliant - can fail and mask original exception
    throw e;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-apex" data-lang="apex">try {
    Account acc = new Account(Name = 'Test');
    insert acc;
} catch(Exception e) {
    Exception_Log__e logEvent = new Exception_Log__e();
    logEvent.Exception_Details__c = e.getMessage();
    EventBus.publish(logEvent); // Asynchronous, won't fail transaction
    throw e;
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Platform Events Developer Guide - <a href="https://developer.salesforce.com/docs/atlas.en-us.platform_events.meta/platform_events/">Official Salesforce documentation on Platform Events</a></p>
</li>
<li>
<p>Exception Handling Best Practices - <a href="https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/apex_exception_definition.htm">Salesforce documentation on exception handling in Apex</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_standards">Standards</h3>
<div class="ulist">
<ul>
<li>
<p>CWE-754: Improper Check for Unusual or Exceptional Conditions - <a href="https://cwe.mitre.org/data/definitions/754.html">Relates to improper handling of exceptional conditions that can mask underlying issues</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>