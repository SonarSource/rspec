<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This rule raises an issue when private methods or variables are made public solely to enable access from test classes, compromising proper encapsulation.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Making private members public just for testing breaks encapsulation, one of the fundamental principles of object-oriented programming. When you change a private method or variable to public, you expose internal implementation details that were intentionally hidden.</p>
</div>
<div class="paragraph">
<p>Encapsulation helps maintain code quality by:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Hiding internal implementation details from other classes</p>
</li>
<li>
<p>Preventing unintended access to sensitive logic or data</p>
</li>
<li>
<p>Making it easier to refactor internal code without affecting external dependencies</p>
</li>
<li>
<p>Clearly defining the public interface of a class</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When private members are made public for testing, they become part of the class&#8217;s public API, even though they weren&#8217;t designed for external use. This can lead to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Other developers accidentally using these "internal" methods in production code</p>
</li>
<li>
<p>Increased coupling between classes</p>
</li>
<li>
<p>Difficulty in refactoring, as changing these methods might break code that shouldn&#8217;t depend on them</p>
</li>
<li>
<p>Confusion about what constitutes the intended public interface</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Salesforce provides the <code>@TestVisible</code> annotation specifically to address this testing challenge. This annotation allows private members to be accessed from test classes while keeping them private in all other contexts. It&#8217;s a clean solution that maintains encapsulation while enabling comprehensive testing.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>Breaking encapsulation can lead to tightly coupled code that is harder to maintain and refactor. It may also result in unintended dependencies on internal implementation details, making the codebase more fragile and prone to bugs when internal logic changes.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Add the @TestVisible annotation to private methods that need to be accessed in test classes, instead of changing their visibility to public.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-apex" data-lang="apex">public class MyClass {
    public String helperMethod() { // Noncompliant
        // Made public only for testing
        return 'helper logic';
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-apex" data-lang="apex">public class MyClass {
    @TestVisible
    private String helperMethod() {
        // Accessible in tests but remains private
        return 'helper logic';
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Salesforce @TestVisible Annotation - <a href="https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/apex_classes_annotation_testvisible.htm">Official Salesforce documentation on using @TestVisible annotation</a></p>
</li>
<li>
<p>Apex Testing Best Practices - <a href="https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/apex_testing_best_practices.htm">Salesforce guide on best practices for Apex testing</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_standards">Standards</h3>
<div class="ulist">
<ul>
<li>
<p>OWASP ASVS 4.0: V14.2.1 - <a href="https://owasp.org/www-project-application-security-verification-standard/">Application Security Verification Standard on secure coding practices</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_related_rules">Related rules</h3>
<div class="ulist">
<ul>
<li>
<p><a data-rspec-id="S5803" class="rspec-auto-link">S5803</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>