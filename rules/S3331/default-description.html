<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A cookie&#8217;s domain specifies which websites should be able to read it. Left blank, browsers are supposed to only send the cookie to sites that exactly match the sending domain. For example, if a cookie was set by <em>lovely.dream.com</em>, it should only be readable by that domain, and not by <em>nightmare.com</em> or even <em>strange.dream.com</em>. If you want to allow sub-domain access for a cookie, you can specify it by adding a dot in front of the cookie&#8217;s domain, like so: <em>.dream.com</em>. But cookie domains should always use at least two levels.</p>
</div>
<div class="paragraph">
<p>Cookie domains can be set either programmatically or via configuration. This rule raises an issue when any cookie domain is set with a single level, as in <em>.com</em>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ask_yourself_whether">Ask Yourself Whether</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>the <code>domain</code> attribute has only one level as domain naming.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You are at risk if you answered yes to any of those questions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_recommended_secure_coding_practices">Recommended Secure Coding Practices</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>You should check the <code>domain</code> attribute has been set and its value has more than one level of domain nanimg, like: <em>sonarsource.com</em></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sensitive_code_example">Sensitive Code Example</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>Cookie myCookie = new Cookie("name", "val");
myCookie.setDomain(".com"); // Noncompliant
java.net.HttpCookie myOtherCookie = new java.net.HttpCookie("name", "val");
myOtherCookie.setDomain(".com"); // Noncompliant</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Cookie myCookie = new Cookie("name", "val"); // Compliant; by default, cookies are only returned to the server that sent them.

// or

Cookie myCookie = new Cookie("name", "val");
myCookie.setDomain(".myDomain.com"); // Compliant

java.net.HttpCookie myOtherCookie = new java.net.HttpCookie("name", "val");
myOtherCookie.setDomain(".myDomain.com"); // Compliant</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data Exposure</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Specify at least a second-level cookie domain.</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_15_sep_2015_211524_evgeny_mandrikov_wrote">on 15 Sep 2015, 21:15:24 Evgeny Mandrikov wrote:</h3>
<div class="paragraph">
<p>IMO from an implementation point of view this RSPEC is underspecified, so removing targeting for <code>C&#43;&#43;</code> for now.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_12_nov_2015_180043_linda_martin_wrote">on 12 Nov 2015, 18:00:43 Linda Martin wrote:</h3>
<div class="paragraph">
<p>\[~elena.vilchik] It seems that it would be hard to get real issue with this rule because the domain value for cookie is usually set through variables.</p>
</div>
<div class="paragraph">
<p>In JavaScript cookies are set through the document object, as the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>document.cookie="username=John Doe; expires=Thu, 18 Dec 2013 12:00:00 UTC; path=/; domain=.com";
// But might not be that straightforward
document.cookie="username=" + name + "; expires=" + date + "; domain=" + domains + ";";</pre>
</div>
</div>
<div class="paragraph">
<p>The return value of an implementation that will detect only the first case is sensitive; and the second case requires a CFG.</p>
</div>
<div class="paragraph">
<p>So I will let you decide wether or not it would be valuable.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_2_dec_2019_160833_pierre_loup_tristant_wrote">on 2 Dec 2019, 16:08:33 Pierre-Loup Tristant wrote:</h3>
<div class="paragraph">
<p>This rule has very little value as it only raise on "single level" cookie (ex: domain=.com). This type of cookie are called <a href="https://en.wikipedia.org/wiki/HTTP_cookie#Supercookie">supercookies</a> and they are denied by all modern web browser.</p>
</div>
<div class="paragraph">
<p>One option could be to make the rule raise on <a href="https://portswigger.net/kb/issues/00500300_cookie-scoped-to-parent-domain">cookie scoped to parent domain</a> (ex: domain=.sonarsource.com) but it would probably be very noisy as this setting is wildly used.</p>
</div>
<div class="paragraph">
<p>Deprecating this rule seams to be the right thing to do.</p>
</div>
</div>
</div>
</div>