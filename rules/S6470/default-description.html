<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When building a Docker image from a Dockerfile, a context directory is used and
sent to the Docker daemon before the actual build starts. This context
directory usually contains the Dockerfile itself, along with all the files that
will be necessary for the build to succeed. This generally includes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the source code of applications to set up in the container.</p>
</li>
<li>
<p>configuration files for other software components.</p>
</li>
<li>
<p>other necessary packages or components.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>COPY</code> and <code>ADD</code> directives in the Dockerfiles are then used to actually
copy content from the context directory to the image file system.</p>
</div>
<div class="paragraph">
<p>When <code>COPY</code> or <code>ADD</code> are used to recursively copy entire top-level directories
or multiple items whose names are determined at build-time, unexpected files
might get copied to the image filesystem. It could affect their
confidentiality.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ask_yourself_whether">Ask Yourself Whether</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>The copied files and directories might contain sensitive data that should be
kept confidential.</p>
</li>
<li>
<p>The context directory contains files and directories that have no functional
purpose for the final container image.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There is a risk if you answered yes to any of those questions.</p>
</div>
<div class="paragraph">
<p>Keep in mind that the content of the context directory might change depending
on the build environment and over time.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_recommended_secure_coding_practices">Recommended Secure Coding Practices</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Limit the usage of globbing in the <code>COPY</code> and <code>ADD</code> sources definition.</p>
</li>
<li>
<p>Avoid copying the entire context directory to the image filesystem.</p>
</li>
<li>
<p>Prefer providing an explicit list of files and directories that are required for the image to properly run.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sensitive_code_example">Sensitive Code Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Copying the complete context directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-docker" data-lang="docker">FROM ubuntu:22.04
# Sensitive
COPY . .
CMD /run.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>Copying multiple files and directories whose names are expanded at build time:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-docker" data-lang="docker">FROM ubuntu:22.04
# Sensitive
COPY ./example* /
COPY ./run.sh /
CMD /run.sh</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-docker" data-lang="docker">FROM ubuntu:22.04
COPY ./example1 /example1
COPY ./example2 /example2
COPY ./run.sh /
CMD /run.sh</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.docker.com/engine/reference/builder/#copy">Dockerfile reference</a> - COPY directive</p>
</li>
<li>
<p><a href="https://docs.docker.com/engine/reference/builder/#add">Dockerfile reference</a> - ADD directive</p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/668">CWE-668 - Exposure of Resource to Wrong Sphere</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/497">CWE-497 - Exposure of Sensitive System Information to an Unauthorized Control Sphere</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_message">Message</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When a dangerous wildcard is found:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>COPY: Copying using a glob pattern might inadvertently add sensitive data to the container. Make sure it is safe here.</p>
</li>
<li>
<p>ADD: Adding files using a glob pattern might inadvertently add sensitive data to the container. Make sure it is safe here.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In any other case:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>COPY: Copying recursively might inadvertently add sensitive data to the container. Make sure it is safe here.</p>
</li>
<li>
<p>ADD: Adding files recursively might inadvertently add sensitive data to the container. Make sure it is safe here.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_highlighting">Highlighting</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>COPY</code> or <code>ADD</code> dangerous source.</p>
</div>
<hr>
</div>
</div>