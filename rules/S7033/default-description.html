<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Since C&#43;&#43;20, a call to <code>std::is_constant_evaluated()</code> can be used to determine whether the call occurs within a constant-evaluated context.</p>
</div>
<div class="paragraph">
<p>Typically, this function is called in the condition of an <code>if</code> statement to optimize code:
It allows different actions to be performed depending on whether an expression is evaluated at compile-time or runtime.
However, writing <code>if (std::is_constant_evaluated())</code> comes with a few caveats.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>It can be error-prone:
One may be tempted to write <code>if constexpr</code> instead of <code>if</code> but doing this always results in the condition being <code>true</code>.
<a data-rspec-id="S6169" class="rspec-auto-link">S6169</a> explains this and other similar problems in greater depth.</p>
</li>
<li>
<p>Because it looks like any regular <code>if</code> statement with a function call, it does not stand out as something semantically different and important.</p>
</li>
<li>
<p>Immediate functions (see again <a data-rspec-id="S6169" class="rspec-auto-link">S6169</a>) cannot be invoked from such <code>if</code> statements, which is counterintuitive and overly restrictive.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For these reasons, C&#43;&#43;23 introduced the <code>if consteval</code> control-flow statement.
There is also a negated form: <code>if not consteval</code> (or <code>if ! consteval</code>).
These versions should be preferred since they are not error-prone, stand out with their different and concise syntax, and do not require including <code>&lt;type_traits&gt;</code>.</p>
</div>
<div class="paragraph">
<p>This rule raises an issue when <code>if (std::is_constant_evaluated())</code> or <code>if (!std::is_constant_evaluated())</code> are used.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Fixing the issue is fairly simple: the C&#43;&#43;23 syntax is an almost direct replacement of the older one.
The only caveat is that since <code>if consteval</code> does not have parentheses to separate the condition from the action, the braces <code>{ }</code> are not optional to delimit the body of the "then" and "else" branches.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">constexpr double power(double b, int x) {
  if (std::is_constant_evaluated()) { // Noncompliant
    // Compile-time implementation
  } else {
    // Runtime implementation
  }
}

constexpr void action(int parameter) {
  if (!std::is_constant_evaluated()) // Noncompliant
    std::cout &lt;&lt; "Run action at runtime for " &lt;&lt; parameter &lt;&lt; std::endl;

  // Some code...
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">constexpr double power(double b, int x) {
  if consteval {
    // Compile-time implementation
  } else {
    // Runtime implementation
  }
}

constexpr void action(int parameter) {
  if not consteval { // The {} are required here
    std::cout &lt;&lt; "Run action at runtime for " &lt;&lt; parameter &lt;&lt; std::endl;
  }

  // Some code...
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>C&#43;&#43; reference - <a href="https://en.cppreference.com/w/cpp/types/is_constant_evaluated"><code>std::is_constant_evaluated</code></a></p>
</li>
<li>
<p>C&#43;&#43; reference - <a href="https://en.cppreference.com/w/cpp/language/if"><code>if</code> statement</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_related_rules">Related rules</h3>
<div class="ulist">
<ul>
<li>
<p><a data-rspec-id="S6169" class="rspec-auto-link">S6169</a> - "std::is_constant_evaluated" and "if consteval" should only be used when necessary</p>
</li>
</ul>
</div>
</div>
</div>
</div>