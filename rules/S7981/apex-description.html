<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This rule raises an issue when a test method calls a future method without wrapping the call between <code>Test.startTest()</code> and <code>Test.stopTest()</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Future methods in Apex execute asynchronously, meaning they run in a separate thread when system resources are available. In test methods, this creates a timing problem: assertions may execute before the future method completes its work, leading to unreliable test results.</p>
</div>
<div class="paragraph">
<p>When you call a future method in a test without proper synchronization, the test continues executing immediately after the method call. Any assertions that depend on the future method&#8217;s side effects (like database changes) will likely fail because they run before the asynchronous operation finishes.</p>
</div>
<div class="paragraph">
<p>The <code>Test.startTest()</code> and <code>Test.stopTest()</code> methods provide a solution by creating a synchronization boundary. When <code>Test.stopTest()</code> is called, it waits for all queued asynchronous operations to complete before allowing the test to continue. This ensures that assertions run after the future method has finished its work.</p>
</div>
<div class="paragraph">
<p>Without this pattern, tests become flaky and unreliable, potentially passing or failing based on system load and timing rather than actual code correctness.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>Tests may produce inconsistent results, sometimes passing and sometimes failing based on system timing rather than code correctness. This leads to unreliable test suites that can miss real bugs or create false alarms during deployment processes.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Wrap the future method call between <code>Test.startTest()</code> and <code>Test.stopTest()</code> to ensure the asynchronous operation completes before assertions run.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-apex" data-lang="apex">@isTest
static void testFutureMethod() {
    Set&lt;Id&gt; ids = new Set&lt;Id&gt;{'001000000000001'};
    MyClass.futureMethod(ids); // Noncompliant
    // Assertions may run before future method completes
    System.assertEquals(1, [SELECT COUNT() FROM Account]);
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-apex" data-lang="apex">@isTest
static void testFutureMethod() {
    Set&lt;Id&gt; ids = new Set&lt;Id&gt;{'001000000000001'};
    Test.startTest();
    MyClass.futureMethod(ids);
    Test.stopTest(); // Waits for future method to complete
    // Assertions now run after future method finishes
    System.assertEquals(1, [SELECT COUNT() FROM Account]);
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Salesforce Test Class Best Practices - <a href="https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/apex_testing_best_practices.htm">Official Salesforce documentation on test class best practices including asynchronous testing</a></p>
</li>
<li>
<p>Testing Future Methods - <a href="https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/apex_testing_future_methods.htm">Salesforce documentation specifically about testing future methods</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>