<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>According to the documentation,</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>A program may produce unpredictable results if it attempts to distinguish two references to equal values of a value-based class, whether directly via reference equality or indirectly via an appeal to synchronization, identity hashing, serialization&#8230;&#8203;</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>For example (credit to Brian Goetz), imagine Foo is a value-based class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Foo[] arr = new Foo[2];
arr[0] = new Foo(0);
arr[1] = new Foo(0);</pre>
</div>
</div>
<div class="paragraph">
<p>Serialization promises that on deserialization of arr, elements 0 and 1 will not be aliased.  Similarly, in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Foo[] arr = new Foo[2];
arr[0] = new Foo(0);
arr[1] = arr[0];</pre>
</div>
</div>
<div class="paragraph">
<p>Serialization promises that on deserialization of <code>arr</code>, elements 0 and 1 <strong>will</strong> be aliased.</p>
</div>
<div class="paragraph">
<p>While these promises are coincidentally fulfilled in current implementations of Java, that is not guaranteed in the future, particularly when true value types are introduced in the language.</p>
</div>
<div class="paragraph">
<p>This rule raises an issue when a <code>Serializable</code> class defines a non-transient, non-static field field whose type is a known serializable value-based class. Known serializable value-based classes are: all the classes in the <code>java.time</code> package except <code>Clock</code>; the date classes for alternate calendars: <code>HijrahDate</code>, <code>JapaneseDate</code>, <code>MinguoDate</code>, <code>ThaiBuddhistDate</code>.</p>
</div>
<div class="sect2">
<h3 id="_noncompliant_code_example">Noncompliant code example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">class MyClass implements Serializable {
  private HijrahDate date;  // Noncompliant; mark this transient
  // ...
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_compliant_solution">Compliant solution</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">class MyClass implements Serializable {
  private transient HijrahDate date;
  // ...
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/doc-files/ValueBased.html">Value-based classes</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Make this value-based field transient so it is not included in the serialization of this class.</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_14_jul_2016_150654_yves_dubois_pèlerin_wrote">on 14 Jul 2016, 15:06:54 Yves Dubois-Pèlerin wrote:</h3>
<div class="paragraph">
<p>As discussed with Ann and confirmed by Michael, we remove the [de]serialization case from this RSPEC. If the user dives into the details [de]serializing, using ObjectOutput#writeObject or ObjectInput#readObject, we assume the user knows what they are doing.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_18_jul_2016_094559_michael_gumowski_wrote">on 18 Jul 2016, 09:45:59 Michael Gumowski wrote:</h3>
<div class="paragraph">
<p>The optional classes <code>Optional</code>, <code>OptionalDouble</code>, <code>OptionalLong</code>, <code>OptionalInt</code> are already handled by <a data-rspec-id="S1948" class="rspec-auto-link">RSPEC-1948</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_on_18_jul_2016_142351_yves_dubois_pèlerin_wrote">on 18 Jul 2016, 14:23:51 Yves Dubois-Pèlerin wrote:</h3>
<div class="paragraph">
<p>Hello Michael, please validate this implementation.</p>
</div>
<div class="paragraph">
<p>I apologize for not making a separate commit for the factorization of method hasSpecialHandlingSerializationMethods (and dependent method methodThrows) into class SerializableContract.</p>
</div>
</div>
</div>
</div>