<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.linq.enumerable.sum">Enumerable.Sum()</a> always executes addition in a <code>checked</code> context, so an <a href="https://learn.microsoft.com/en-us/dotnet/api/system.overflowexception">OverflowException</a> will be thrown if the value exceeds <code>MaxValue</code>, even if an <code>unchecked</code> context was specified. Therefore, using this method inside an <code>unchecked</code> context will only make the code more confusing, since the behavior will still be <code>checked</code>.</p>
</div>
<div class="paragraph">
<p>This rule raises an issue when an <code>unchecked</code> context is specified for a <code>Sum</code> on integer types.</p>
</div>
<div class="sect2">
<h3 id="_exceptions">Exceptions</h3>
<div class="paragraph">
<p>When the <code>Sum</code> call is inside a <a href="https://learn.microsoft.com/en-us/dotnet/csharp/fundamentals/exceptions/">try-catch block</a>, no issues are reported, since the exception is properly handled.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">void Add(List&lt;int&gt; list)
{
  unchecked
  {
    try
    {
      int total = list.Sum();
    }
    catch (System.OverflowException e)
    {
      // Exception handling
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Remove the <code>unchecked</code> operator/statement, and optionally add some exception handling for the <code>OverflowException</code>.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">void Add(List&lt;int&gt; list)
{
  int total1 = unchecked(list.Sum());  // Noncompliant

  unchecked
  {
    int total2 = list.Sum();  // Noncompliant
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">void Add(List&lt;int&gt; list)
{
  int total1 = list.Sum();

  try
  {
    int total2 = list.Sum();
  }
  catch (System.OverflowException e)
  {
    // Exception handling
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.linq.enumerable.sum"><code>Enumerable.Sum</code> Method</a></p>
</li>
<li>
<p><a href="https://github.com/microsoft/referencesource/blob/51cf7850defa8a17d815b4700b67116e3fa283c2/System.Core/System/Linq/Enumerable.cs#L1408-L1415"><code>Enumerable.Sum</code> implementation</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/statements/checked-and-unchecked"><code>checked</code> and <code>unchecked</code> statements</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/language-specification/expressions#12819-the-checked-and-unchecked-operators"><code>checked</code> and <code>unchecked</code> operators</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/csharp/fundamentals/exceptions/">Exceptions and Exception Handling</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.overflowexception"><code>OverflowException</code> Class</a></p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Integer_overflow">Integer overflow</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Refactor this code to handle "OverflowException".</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_13_apr_2015_104427_freddy_mallet_wrote">on 13 Apr 2015, 10:44:27 Freddy Mallet wrote:</h3>
<div class="paragraph">
<p>@Tamas, according to you, does this rule makes sense ? Thanks</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_29_jun_2015_145819_tamas_vajk_wrote">on 29 Jun 2015, 14:58:19 Tamas Vajk wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] I&#8217;ve modified the description to be more specific. Also, I&#8217;ve changed the examples to use <code>List&lt;int&gt;</code> because for <code>double`s it won&#8217;t throw the `OverflowException</code>.</p>
</div>
<div class="paragraph">
<p>\[~freddy.mallet] Yes, the rule makes sense.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_30_jun_2015_144528_ann_campbell_wrote">on 30 Jun 2015, 14:45:28 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>Double-check my edits please [~tamas.vajk]</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_6_jul_2015_093341_tamas_vajk_wrote">on 6 Jul 2015, 09:33:41 Tamas Vajk wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] Looks good.</p>
</div>
</div>
</div>
</div>