<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This rule raises an issue when a <code>return</code> statement is used inside a block (created with <code>{}</code> or <code>do&#8230;&#8203;end</code>).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In Ruby, blocks are closures that capture the lexical environment where they are defined. When you use <code>return</code> inside a block, it doesn&#8217;t return from the block itself - it returns from the method that lexically contains the block definition.</p>
</div>
<div class="paragraph">
<p>This behavior can lead to two main problems:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>LocalJumpError at runtime</strong>: If the block is called outside the context of its defining method, Ruby raises a <code>LocalJumpError</code> because there&#8217;s no method to return from.</p>
</li>
<li>
<p><strong>Unexpected early method returns</strong>: When the block is executed within its defining method, the <code>return</code> statement causes the entire method to exit immediately, potentially skipping important cleanup code or logic.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This confusion often arises because developers expect blocks to behave like methods, but blocks are actually more like anonymous functions that share the same scope as their surrounding method.</p>
</div>
<div class="paragraph">
<p>The distinction becomes clearer when you understand that Ruby has different types of callable objects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Blocks</strong>: Created with <code>{}</code> or <code>do&#8230;&#8203;end</code>, they share scope with the surrounding method</p>
</li>
<li>
<p><strong>Procs</strong>: Objects created from blocks, they retain the same return behavior as blocks</p>
</li>
<li>
<p><strong>Lambdas</strong>: Special procs that have their own scope and handle <code>return</code> statements locally</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>Using <code>return</code> in blocks can cause applications to crash with <code>LocalJumpError</code> exceptions at runtime, making the code unreliable. It can also lead to subtle bugs where methods exit unexpectedly, bypassing important logic, cleanup operations, or error handling code. This makes the application&#8217;s behavior unpredictable and difficult to debug.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Use implicit returns by making the last expression in the block the value you want to return. This is the most idiomatic Ruby approach.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">numbers = (1..5).collect { |n|
  if n.even?
    return n * 2  # Noncompliant
  else
    return n      # Noncompliant
  end
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">numbers = (1..5).collect { |n|
  if n.even?
    n * 2  # implicit return
  else
    n      # implicit return
  end
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Ruby Documentation - Blocks, Procs and Lambdas - <a href="https://ruby-doc.org/core/Proc.html">Official Ruby documentation explaining the differences between blocks, procs, and lambdas</a></p>
</li>
<li>
<p>Ruby Style Guide - Blocks - <a href="https://rubystyle.guide/#no-explicit-return">Community style guide recommendations for block usage and return statements</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>