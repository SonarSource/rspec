<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A <a href="https://learn.microsoft.com/en-us/dotnet/standard/base-types/composite-formatting">composite format string</a> is a string that contains placeholders, represented by indices inside curly braces "{0}", "{1}", etc. These placeholders are replaced by values when the string is printed or logged.</p>
</div>
<div class="paragraph">
<p>Because composite format strings are interpreted at runtime, rather than validated by the compiler, they can contain errors that lead to unexpected behaviors or runtime errors.</p>
</div>
<div class="paragraph">
<p>This rule validates the correspondence between arguments and composite formats when calling the
following methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.string.format"><code>String.Format</code></a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.text.stringbuilder.appendformat"><code>StringBuilder.AppendFormat</code></a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.console.write"><code>Console.Write</code></a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.console.writeline"><code>Console.WriteLine</code></a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.io.textwriter.write"><code>TextWriter.Write</code></a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.io.textwriter.writeline"><code>TextWriter.WriteLine</code></a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.diagnostics.debug.writeline"><code>Debug.WriteLine(String, Object[])</code></a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.diagnostics.trace.traceerror"><code>Trace.TraceError(String, Object[])</code></a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.diagnostics.trace.traceinformation"><code>Trace.TraceInformation(String, Object[])</code></a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.diagnostics.trace.tracewarning"><code>Trace.TraceWarning(String, Object[])</code></a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.diagnostics.tracesource.traceinformation"><code>TraceSource.TraceInformation(String, Object[])</code></a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_exceptions">Exceptions</h3>
<div class="ulist">
<ul>
<li>
<p>No issue is raised if the format string is not a string literal, but comes from a variable.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">var pattern = "{0} {1} {2}";
var res = string.Format(pattern, 1, 2); // Incorrect, but the analyzer doesn't raise any warnings here</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>No issue is raised if the argument is not an inline created array.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">var array = new int[] {};
var res = string.Format("{0} {1}", array); // Compliant; we don't know the size of the array</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>This rule doesn&#8217;t check whether the format specifier (defined after the <code>:</code>) is actually valid.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A composite format string contains placeholders, replaced by values when the string is printed or logged. Mismatch in the format specifiers and the arguments provided can lead to incorrect strings being created.</p>
</div>
<div class="paragraph">
<p>To avoid issues, a developer should ensure that the provided arguments match format specifiers.</p>
</div>
<div class="paragraph">
<p>Moreover, use <a href="https://learn.microsoft.com/en-us/dotnet/csharp/tutorials/string-interpolation">string interpolation</a> when possible.</p>
</div>
<div class="paragraph">
<p>Instead of</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">string str = string.Format("Hello {0} {1}!", firstName, lastName);</code></pre>
</div>
</div>
<div class="paragraph">
<p>use</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">string str = $"Hello {firstName} {lastName}!";</code></pre>
</div>
</div>
<div class="paragraph">
<p>With string interpolation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the arguments are validated at compilation time rather than runtime</p>
</li>
<li>
<p>modern code editors provide auto-completion when typing the interpolation expression</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">s = string.Format("{0}", arg0, arg1); // Noncompliant, arg1 is declared but not used.
s = string.Format("{0} {2}", arg0, arg1, arg2); // Noncompliant, the format item with index 1 is missing, so arg1 will not be used.
s = string.Format("foo"); // Noncompliant; there is no need to use "string.Format" here.</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">s = string.Format("{0}", arg0);
s = string.Format("{0} {1}", arg0, arg2);
s = "foo";</code></pre>
</div>
</div>
<hr>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_is_duplicated_by_s3941">is duplicated by: <a data-rspec-id="S3941" class="rspec-auto-link">S3941</a></h3>

</div>
<div class="sect2">
<h3 id="_is_related_to_s2275">is related to: <a data-rspec-id="S2275" class="rspec-auto-link">S2275</a></h3>

</div>
<div class="sect2">
<h3 id="_on_10_dec_2015_090759_tamas_vajk_wrote">on 10 Dec 2015, 09:07:59 Tamas Vajk wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] Removed the performance label, as the performance impact is insignificant.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_10_dec_2015_144405_ann_campbell_wrote">on 10 Dec 2015, 14:44:05 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>I&#8217;ve updated SQALE characteristic to match [~tamas.vajk]</p>
</div>
</div>
</div>
</div>