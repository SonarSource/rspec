<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This rule raises an issue when code uses <code>Time.now</code> in Rails applications, passes timestamp parameters directly to database operations without timezone conversion, or mixes different timezone handling approaches inconsistently.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Inconsistent timezone handling is a common source of subtle bugs in Ruby applications, especially those built with Rails. When working with timestamps, developers often mix different approaches without realizing the implications.</p>
</div>
<div class="paragraph">
<p>Using <code>Time.now</code> in Rails applications can be problematic because it returns the system time in the server&#8217;s timezone, which may not match the application&#8217;s configured timezone (<code>Time.zone</code>). This can lead to inconsistencies when the application timezone differs from the server timezone.</p>
</div>
<div class="paragraph">
<p>Passing timestamp parameters directly to database operations without explicit timezone conversion is another common issue. When user input contains timestamp data, it may come in various formats and timezones. Without explicit conversion, the ORM might make assumptions about the timezone, leading to incorrect data storage or retrieval.</p>
</div>
<div class="paragraph">
<p>Mixing different timezone handling approaches within the same application creates maintenance challenges and increases the likelihood of bugs. For example, using <code>Time.now</code> in some places and <code>Time.current</code> in others, or sometimes converting to UTC and sometimes not, makes the codebase inconsistent and harder to reason about.</p>
</div>
<div class="paragraph">
<p>These issues become particularly problematic in applications serving users across multiple timezones, where incorrect timestamp handling can result in scheduling conflicts, incorrect data filtering, or confusing user experiences.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>Inconsistent timezone handling can lead to several serious issues:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Data integrity problems</strong>: Timestamps may be stored with incorrect timezone offsets, corrupting historical data</p>
</li>
<li>
<p><strong>Incorrect business logic</strong>: Time-based queries and comparisons may return wrong results, affecting features like scheduling, reporting, or time-sensitive operations</p>
</li>
<li>
<p><strong>User experience issues</strong>: Users may see incorrect times, leading to confusion and loss of trust in the application</p>
</li>
<li>
<p><strong>Maintenance difficulties</strong>: Mixed timezone handling approaches make the codebase harder to understand and modify safely</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For non-Rails Ruby applications, be explicit about timezone handling by using timezone-aware time objects and consistent conversion patterns throughout your application.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby"># Bad: Inconsistent timezone handling
def process_timestamps(start_time, end_time)
  current = Time.now // Noncompliant
  # Mixed approaches without explicit timezone handling
  if start_time &gt; current // Noncompliant
    process_future_event(start_time)
  end
end</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby"># Good: Explicit timezone handling
def process_timestamps(start_time, end_time)
  current = Time.now.utc
  # Convert all times to UTC for consistent comparison
  start_utc = start_time.utc
  if start_utc &gt; current
    process_future_event(start_utc)
  end
end</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it_in_rails">How to fix it in Rails</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Use <code>Time.current</code> instead of <code>Time.now</code> in Rails applications to respect the application&#8217;s configured timezone. When working with user input, explicitly convert timestamps to the desired timezone before database operations.</p>
</div>
<div class="sect2">
<h3 id="_code_examples_2">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example_2">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">class AppointmentController
  def index
    # Bad: Using Time.now ignores application timezone
    current_time = Time.now // Noncompliant
    @appointments = Appointment.where("created_at &gt; ?", current_time)
  end

  def create
    # Bad: Using timestamp parameter without explicit conversion
    appointment_time = params[:time] // Noncompliant
    @appointment = Appointment.create(scheduled_at: appointment_time)
  end
end</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution_2">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">class AppointmentController
  def index
    # Good: Use Time.current and explicit timezone handling
    current_time = Time.current.in_time_zone(current_user.timezone)
    @appointments = Appointment.where("created_at &gt; ?", current_time.iso8601)
  end

  def create
    # Good: Explicitly convert to desired timezone
    appointment_time = params[:time].in_time_zone('UTC')
    @appointment = Appointment.create(scheduled_at: appointment_time)
  end
end</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Rails Time Zone Handling Guide - <a href="https://guides.rubyonrails.org/active_support_core_extensions.html#time-zones">Official Rails documentation on working with time zones and the Time.current method</a></p>
</li>
<li>
<p>Ruby Time Class Documentation - <a href="https://ruby-doc.org/core/Time.html">Official Ruby documentation for the Time class and timezone methods</a></p>
</li>
<li>
<p>Working with Time Zones in Rails - <a href="https://thoughtbot.com/blog/its-about-time-zones">Best practices guide for handling time zones in Rails applications</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>