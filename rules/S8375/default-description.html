<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This rule raises an issue when Flask&#8217;s <code>preprocess_request()</code> method is called without capturing or checking its return value.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Flask&#8217;s <code>preprocess_request()</code> method runs all registered before-request handlers and may return a response object when one of these handlers wants to short-circuit the normal request processing flow.</p>
</div>
<div class="paragraph">
<p>Before-request handlers commonly return responses for scenarios like:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Authentication failures that should redirect to a login page</p>
</li>
<li>
<p>Authorization checks that should return 403 Forbidden responses</p>
</li>
<li>
<p>Rate limiting that should return 429 Too Many Requests</p>
</li>
<li>
<p>Maintenance mode that should return 503 Service Unavailable</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When you ignore the return value of <code>preprocess_request()</code>, these important early responses are lost. The application continues with normal request processing instead of returning the intended response, leading to incorrect behavior.</p>
</div>
<div class="paragraph">
<p>For example, if a before-request handler detects an unauthenticated user and returns a redirect to the login page, ignoring this response means the user will see the protected content instead of being redirected to authenticate.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>Ignoring the return value can lead to security vulnerabilities where authentication and authorization checks are bypassed. It can also cause functional issues where important redirects, error responses, or maintenance messages are not delivered to users.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Capture the return value of <code>preprocess_request()</code> and check if it contains a response object. If it does, return that response immediately to respect the before-request handler&#8217;s decision.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">app.preprocess_request()  # Noncompliant
# Continue with normal request processing</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">response = app.preprocess_request()
if response is not None:
    return response
# Continue with normal request processing</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Flask preprocess_request documentation - <a href="https://flask.palletsprojects.com/en/stable/api/#flask.Flask.preprocess_request">Official documentation</a></p>
</li>
<li>
<p>Flask Request Hooks - <a href="https://flask.palletsprojects.com/en/stable/reqcontext/#request-hooks">Documentation about Flask&#8217;s before-request and after-request hooks</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_related_rules">Related rules</h3>
<div class="ulist">
<ul>
<li>
<p><a data-rspec-id="S899" class="rspec-auto-link">S899</a> - Return values from functions without side effects should not be ignored (Java)</p>
</li>
</ul>
</div>
</div>
</div>
</div>