<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The value of an expression of floating type shall not be implicitly converted to a different type if:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>it is not a conversion to a wider floating type, or</p>
</li>
<li>
<p>the expression is complex, or</p>
</li>
<li>
<p>the expression is a function argument, or</p>
</li>
<li>
<p>the expression is a return expression.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The intention when restricting implicit conversion of complex expressions is to require that in a sequence of arithmetic operations within an expression, all operations should be conducted in exactly the same</p>
</div>
<div class="paragraph">
<p>arithmetic type. Notice that this does not imply that all operands in an expression are of the same type. The expression f32a + f64b + f64c is compliant – both additions will notionally be performed in type F64.</p>
</div>
<div class="paragraph">
<p>The expression f32a + f32b + f64c is not compliant – the first addition is notionally performed in type f32 and the second in type f64. The word “notionally” is used because, in practice, the type in which arithmetic will be conducted will depend on the implemented size of a <code>float</code>. By observing the principle whereby all operations are performed in a consistent (underlying) type, it is possible to avoid programmer confusion and some of the dangers associated with integral promotion.</p>
</div>
<div class="sect2">
<h3 id="_noncompliant_code_example">Noncompliant code example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">extern void foo1(uint8_t x);

int16_t t1(void)
{
  ...
  foo1(u8a); // Compliant
  foo1(u8a + u8b); // Compliant
  foo1(s8a); // Noncompliant
  foo1(u16a); // Noncompliant
  foo1(2); // Noncompliant
  foo1(2U); // Compliant
  foo1((uint8_t)2); // Compliant
  ... s8a + u8a // Noncompliant
  ... s8a + (int8_t)u8a // Compliant
  s8b = u8a; // Noncompliant
  ... u8a + 5 // Noncompliant
  ... u8a + 5U // Compliant
  ... u8a + (uint8_t)5 // Compliant
  u8a = u16a; // Noncompliant
  u8a = (uint8_t)u16a; // Compliant
  u8a = 5UL; // Noncompliant
  ... u8a + 10UL // Compliant
  u8a = 5U; // Compliant
  ... u8a + 3 // Noncompliant
  ... u8a &gt;&gt; 3 // Compliant
  ... u8a &gt;&gt; 3U // Compliant
  pca = "P"; // Compliant
  ... s32a + 80000 // Compliant
  ... s32a + 80000L // Compliant
  f32a = f64a; // Noncompliant
  f32a = 2.5; // Noncompliant -
  u8a = u8b + u8c; // Compliant
  s16a = u8b + u8b; // Noncompliant
  s32a = u8b + u8c; // Noncompliant
  f32a = 2.5F; // Compliant
  u8a = f32a; // Noncompliant
  s32a = 1.0; // Noncompliant
  f32a = 1; // Noncompliant
  f32a = s16a; // Noncompliant
  ... f32a + 1 // Noncompliant
  ... f64a * s32a // Noncompliant
  ...
  return (s32a); // Noncompliant
  ...
  return (s16a); // Compliant
  ...
  return (20000); // Compliant
  ...
  return (20000L); // Noncompliant
  ...
  return (s8a); // Noncompliant
  ...
  return (u16a); // Noncompliant
}

int16_t foo2(void)
{
  ...
  ... (u16a + u16b) + u32a // Noncompliant
  ... s32a + s8a + s8b // Compliant
  ... s8a + s8b + s32a // Noncompliant
  f64a = f32a + f32b; // Noncompliant
  f64a = f64b + f32a; // Compliant
  f64a = s32a / s32b; // Noncompliant
  u32a = u16a + u16a; // Noncompliant
  s16a = s8a; // Compliant
  s16a = s16b + 20000; // Compliant
  s32a = s16a + 20000; // Noncompliant
  s32a = s16a + (int32_t)20000; // Compliant
  u16a = u16b + u8a; // Compliant
  foo1(u16a); // Noncompliant
  foo1(u8a + u8b); // Compliant
  ...
  return s16a; // Compliant
  ...
  return s8a; // Noncompliant
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>MISRA C:2004, 10.2</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_duplicates_s842">duplicates: <a data-rspec-id="S842" class="rspec-auto-link">S842</a></h3>

</div>
<div class="sect2">
<h3 id="_relates_to_s842">relates to: <a data-rspec-id="S842" class="rspec-auto-link">S842</a></h3>

</div>
<div class="sect2">
<h3 id="_relates_to_s846">relates to: <a data-rspec-id="S846" class="rspec-auto-link">S846</a></h3>

</div>
<div class="sect2">
<h3 id="_on_23_oct_2014_135821_samuel_mercier_wrote">on 23 Oct 2014, 13:58:21 Samuel Mercier wrote:</h3>
<div class="paragraph">
<p>We probably cannot make a distinction between the two misra rules, because implicit conversions from float to int exist.</p>
</div>
</div>
</div>
</div>