<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This rule raises an issue when an HTTP response body is not closed after use.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In Go, HTTP response bodies must be explicitly closed to prevent resource leaks. The Go documentation clearly states: "The caller must close the response body when finished with it." When response bodies are not closed, several problems can occur:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Connection pool exhaustion</strong>: The HTTP client maintains a pool of connections for reuse. If response bodies are not closed, these connections cannot be returned to the pool, eventually exhausting available connections.</p>
</li>
<li>
<p><strong>Memory leaks</strong>: Unclosed response bodies can hold references to network resources and buffers, preventing garbage collection.</p>
</li>
<li>
<p><strong>Resource starvation</strong>: Over time, accumulated unclosed connections can consume system resources like file descriptors and memory.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The issue is particularly problematic in high-throughput applications where many HTTP requests are made. Even if the response data is fully read, the body must still be explicitly closed to signal that the connection can be reused.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>Failing to close HTTP response bodies can lead to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Application crashes</strong> due to connection pool exhaustion</p>
</li>
<li>
<p><strong>Performance degradation</strong> as new connections must be created instead of reusing existing ones</p>
</li>
<li>
<p><strong>Resource exhaustion</strong> on the system level, affecting other applications</p>
</li>
<li>
<p><strong>Intermittent failures</strong> that are difficult to debug in production environments</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Always close the response body using defer immediately after checking for request errors. This ensures the body is closed even if subsequent operations fail.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">resp, err := http.Get("http://example.com/")
if err != nil {
    return err
}
body, err := io.ReadAll(resp.Body) // Noncompliant
// Missing resp.Body.Close()</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">resp, err := http.Get("http://example.com/")
if err != nil {
    return err
}
defer resp.Body.Close()
body, err := io.ReadAll(resp.Body)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Go net/http package documentation - <a href="https://pkg.go.dev/net/http">Official Go documentation for the net/http package, which explicitly states the requirement to close response bodies</a></p>
</li>
<li>
<p>Effective Go - Defer statements - <a href="https://go.dev/doc/effective_go#defer">Official Go documentation explaining the defer statement and its proper usage for resource cleanup</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_standards">Standards</h3>
<div class="ulist">
<ul>
<li>
<p>CWE-404: Improper Resource Shutdown or Release - <a href="https://cwe.mitre.org/data/definitions/404.html">Describes the security implications of not properly releasing resources</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>