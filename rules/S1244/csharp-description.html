<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Floating point numbers in C# (and in most other programming languages) are not precise. They are a binary approximation of the actual value. This means that even if two floating point numbers appear to be equal, they might not be due to the tiny differences in their binary representation.</p>
</div>
<div class="paragraph">
<p>Even simple floating point assignments are not simple:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">float f = 0.100000001f; // 0.1
double d = 0.10000000000000001; // 0.1</code></pre>
</div>
</div>
<div class="paragraph">
<p>(Note: Results may vary based on the compiler and its settings)</p>
</div>
<div class="paragraph">
<p>This issue is further compounded by the <a href="https://en.wikipedia.org/wiki/Associative_property">non-associative</a> nature of floating point arithmetic.
The order in which operations are performed can affect the outcome due to the rounding that occurs at each step. Consequently, the outcome of a series of mathematical operations can vary based on the order of operations.</p>
</div>
<div class="paragraph">
<p>As a result, using the equality (<code>==</code>) or inequality (<code>!=</code>) operators with <code>float</code> or <code>double</code> values is typically a mistake, as it can lead to unexpected behavior.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Consider using a small tolerance value to check if the numbers are "close enough" to be considered equal. This tolerance value, often called <code>epsilon</code>, should be chosen based on the specifics of your program.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">float myNumber = 3.146f;

if (myNumber == 3.146f) // Noncompliant: due to floating point imprecision, this will likely be false
{
  // ...
}

if (myNumber &lt; 4 || myNumber &gt; 4) // Noncompliant: indirect inequality test
{
  // ...
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">float myNumber = 3.146f;
float epsilon = 0.0001f; // or some other small value

if (Math.Abs(myNumber - 3.146f) &lt; epsilon)
{
  // ...
}

if (myNumber &lt;= 4 - epsilon || myNumber &gt;= 4 + epsilon)
{
  // ...
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.oracle.com/cd/E19957-01/806-3568/ncg_goldberg.html">Floating-Point Arithmetic Complexities</a> by David Goldberg</p>
</li>
<li>
<p>Microsoft Learn - <a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/builtin-types/floating-point-numeric-types#comparing-floating-point-numbers">Floating-point numeric types</a></p>
</li>
<li>
<p>Wikipedia - <a href="https://en.wikipedia.org/wiki/Associative_property">Associative property</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Do not check floating point [in]equality with exact values, use [a range | <code>FloatingPointTypeName.IsXXX()</code> | <code>IsXXX()</code>] instead.</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_is_duplicated_by_s884">is duplicated by: <a data-rspec-id="S884" class="rspec-auto-link">S884</a></h3>

</div>
<div class="sect2">
<h3 id="_on_22_apr_2014_213712_evgeny_mandrikov_wrote">on 22 Apr 2014, 21:37:12 Evgeny Mandrikov wrote:</h3>
<div class="paragraph">
<p>\[~freddy.mallet] [~ann.campbell.2] duplicates <a data-rspec-id="S884" class="rspec-auto-link">RSPEC-884</a> ?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_23_apr_2014_153008_ann_campbell_wrote">on 23 Apr 2014, 15:30:08 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>Closed the other since this is more fully specified</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_23_apr_2014_155451_evgeny_mandrikov_wrote">on 23 Apr 2014, 15:54:51 Evgeny Mandrikov wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] For rules coming from MISRA I prefer titles from MISRA instead of hand-crafted ones ;) Same probably for description - I expect it to be good in MISRA.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_17_sep_2014_100101_freddy_mallet_wrote">on 17 Sep 2014, 10:01:01 Freddy Mallet wrote:</h3>
<div class="paragraph">
<p>@Ann, for me the compliant solution is incorrect because if the developer really wants to check for equality, using the "&gt;=" operator is obviously not an option.</p>
</div>
<div class="paragraph">
<p>See MISRA description:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>The recommended method for achieving deterministic floating-point comparisons is to write a library</p>
</div>
<div class="paragraph">
<p>that implements the comparison operations. The library should take into account the floating-point</p>
</div>
<div class="paragraph">
<p>granularity (FLT_EPSILON) and the magnitude of the numbers being compared. See also Rule 13.4 and</p>
</div>
<div class="paragraph">
<p>Rule 20.3.</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="_on_30_sep_2014_085000_evgeny_mandrikov_wrote">on 30 Sep 2014, 08:50:00 Evgeny Mandrikov wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] I can&#8217;t finish implementation of this rule with unfinished description - see comment from [~freddy.mallet]</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_30_sep_2014_120034_ann_campbell_wrote">on 30 Sep 2014, 12:00:34 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~evgeny.mandrikov] see the C-Family sub-task</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_30_sep_2014_121412_evgeny_mandrikov_wrote">on 30 Sep 2014, 12:14:12 Evgeny Mandrikov wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] ok, thx</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_3_oct_2014_081625_nicolas_peru_wrote">on 3 Oct 2014, 08:16:25 Nicolas Peru wrote:</h3>
<div class="paragraph">
<p>I disagree with cases like :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>if(myNumber &lt;= 3.146 &amp;&amp; myNumber &gt;= 3.146)
if (myNumber &lt; 4 || myNumber &gt; 4)</pre>
</div>
</div>
<div class="paragraph">
<p>For me this is crappy code no matter if you are using floating point or not. I truly believe this case should not pollute this rule and be a rule on its own (applied to every numeric type) with the suggestion to refactor it using <code>=</code> or <code>!=</code></p>
</div>
</div>
<div class="sect2">
<h3 id="_on_3_oct_2014_140201_ann_campbell_wrote">on 3 Oct 2014, 14:02:01 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~nicolas.peru] what if the user activates this rule but not the other one?</p>
</div>
<div class="paragraph">
<p>Also, the "crappy" example is drawn almost exactly from MISRA. We can debate whether or not it belongs in the Java implementation (although it is an equality test), but it needs to remain in the main rule.</p>
</div>
</div>
</div>
</div>