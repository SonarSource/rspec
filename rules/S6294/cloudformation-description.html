<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In certain AWS services, implicit creation of <code>Log Groups</code> can lead to unintended consequences when using CloudFormation.
Failure to declare a <code>Log Group</code> within CloudFormation can result in unmanaged resources, impacting both cost and security.
To ensure effective resource management and adherence to best practices, it is crucial to declare the target <code>Log Group</code> within CloudFormation, aligning its name with AWS conventions.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>Implicit creation of <code>Log Groups</code> in certain AWS services poses a significant issue when working with CloudFormation.
When a Log Group is not explicitly declared within CloudFormation, it is automatically generated at runtime.
This leads to several potentially dangerous consequences.</p>
</div>
<div class="paragraph">
<p>Unmanaged Resources: The automatically created <code>Log Groups</code> are not managed by CloudFormation.
As a result, they won&#8217;t be removed when the associated Stack is deleted, leading to a clutter of unused resources over time.</p>
</div>
<div class="paragraph">
<p>Lack of Configuration Control: Without explicit declaration, essential attributes of the Log Group, such as retention policies, are not managed "as code" within CloudFormation.
This means that changes to these attributes can&#8217;t be tracked, versioned, or easily replicated.</p>
</div>
<div class="paragraph">
<p>Cost Implications: The perpetual existence of these auto-generated <code>Log Groups</code> can lead to unexpected and unnecessary costs.
Storing data indefinitely in these logs can inflate storage expenses over time.</p>
</div>
<div class="paragraph">
<p>Security Concerns: Prolonged retention of log data might conflict with company policies, industry regulations, or best practices for data security and privacy.
Data that is intended to be temporary might inadvertently persist due to the lack of proper management.</p>
</div>
<div class="paragraph">
<p>Regulatory Compliance: Depending on the domain, industry, or region, organizations might be required to adhere to specific data retention and disposal guidelines.
The uncontrolled retention of log data could lead to non-compliance issues.</p>
</div>
<div class="paragraph">
<p>This rule applies to the following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>AWS::Lambda::Function</code></p>
</li>
<li>
<p><code>AWS::Serverless::Function</code></p>
</li>
<li>
<p><code>AWS::ApiGatewayV2::Api</code></p>
</li>
<li>
<p><code>AWS::CodeBuild::Project</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ensure that you explicitly declare the <code>Log Group</code> resource.
Assign it a logical name that aligns with AWS naming conventions and your application&#8217;s requirements.</p>
</div>
<div class="paragraph">
<p>Depending on your application&#8217;s requirements, adjust additional properties of the <code>Log Group</code>, such as retention policies, access controls, and encryption settings.
These properties should be managed within your CloudFormation template to ensure consistency and versioned control.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">AWSTemplateFormatVersion: 2010-09-09
Resources:
  ExampleFunction:
    Type: AWS::Lambda::Function
    Properties:
      Runtime: nodejs12.x
      Description: Example of Lambda Function</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="paragraph">
<p>Example with a <code>!Ref</code> in <code>LogGroup</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">AWSTemplateFormatVersion: 2010-09-09
Resources:
  ExampleFunction:
    Type: AWS::Lambda::Function
    Properties:
      Runtime: nodejs12.x
      Description: Example of Lambda Function

  ExampleLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Join ['/', ['/aws/lambda', !Ref ExampleFunction]]
      RetentionInDays: 30</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example with a <code>!Ref</code> in <code>AWS::Lambda::Function</code> (it also works for <code>AWS::Serverless::Function</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">AWSTemplateFormatVersion: 2010-09-09
Resources:
  ExampleFunction:
    Type: AWS::Lambda::Function
    Properties:
      Runtime: nodejs12.x
      Description: Example of Lambda Function
      LoggingConfig:
        LogGroup: !Ref ExampleLogGroup

  ExampleLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: "/aws/lambda/exampleFunction"
      RetentionInDays: 30</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example with <code>!Sub</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">AWSTemplateFormatVersion: 2010-09-09
Resources:
  ExampleFunction:
    Type: AWS::Lambda::Function
    Properties:
      Runtime: nodejs12.x
      Description: Example of Lambda Function

  ExampleLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub '/aws/lambda/${ExampleFunction}'
      RetentionInDays: 30</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example with <code>CloudWatchLogs</code> (it only works for <code>AWS::CodeBuild::Project</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">AWSTemplateFormatVersion: 2010-09-09
Resources:
  CodeBuildProject:
    Type: AWS::CodeBuild::Project
    Properties:
      LogsConfig:
        CloudWatchLogs:
          Status: "ENABLED"
          GroupName: "aws/codeBuild/project"</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>AWS Documentation <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-logs-loggroup.html">AWS::Logs::LogGroup</a></p>
</li>
</ul>
</div>
</div>
</div>