<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is rarely useful to declare a function at block scope. Such a function will not get special access to any name in its enclosing scope, and therefore, it is equivalent but clearer to declare it instead in the enclosing namespace.</p>
</div>
<div class="paragraph">
<p>Additionally, when a function is declared at block scope, the intent is often not to declare a function but instead to declare and initialize a variable. This problem is nicknamed the <em>most vexing parse</em> and stems from the fact that some syntaxes can be ambiguous, and that in that case the language unintuitively favors function declaration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">void f() {
  int a;
  string b();
  short c(short (a));
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>b</code> could be interpreted as:</p>
<div class="ulist">
<ul>
<li>
<p>A variable of type <code>string</code> with empty initialization or</p>
</li>
<li>
<p>A function with no argument and returning a <code>string</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The second interpretation is selected.</p>
</div>
</li>
<li>
<p>Similarly, <code>c</code> could be interpreted as:</p>
<div class="ulist">
<ul>
<li>
<p>A variable of type <code>short</code> initialized with the value <code>a</code> converted to <code>short</code> or</p>
</li>
<li>
<p>A function that takes a parameter named <code>a</code> (with extra parentheses) of type <code>short</code> and returning a <code>short</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here again, the second interpretation is selected.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are several ways to write the code differently so that <code>b</code> and <code>c</code> can only be interpreted as variables. For instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">void f() {
  int a;
  string b {};
  auto c = short (a);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>By raising issues on local function declaration, this rule helps detect when a function is inadvertently declared.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_noncompliant_code_example">Noncompliant code example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">class A {
};

void fun() {
  void nestedFun();  // Noncompliant; declares a function in block scope

  A a();      // Noncompliant; declares a function at block scope, not an object
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_compliant_solution">Compliant solution</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">class A {
};

void nestedFun(); // Compliant, function declaration moved outside of fun

void fun() {
  A a;      // Compliant; declares an object
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_external_coding_guidelines">External coding guidelines</h3>
<div class="ulist">
<ul>
<li>
<p>MISRA C&#43;&#43;:2023, 6.0.1 - Block scope declarations shall not be visually ambiguous</p>
</li>
<li>
<p>MISRA C&#43;&#43;:2008, 3-1-2 - Functions shall not be declared at block scope</p>
</li>
<li>
<p>MISRA C:2004, 8.6 - Functions shall be declared at file scope</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Move this function declaration outside of this block scope.</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_28_aug_2013_130638_dinesh_bolkensteyn_wrote">on 28 Aug 2013, 13:06:38 Dinesh Bolkensteyn wrote:</h3>
<div class="listingblock">
<div class="content">
<pre>#include &lt;stdio.h&gt;

void foo() {
  printf("go go go \n");
}

int main(int argc, char* argv[]) {
  int foo = 42;

  printf("foo = %d\n", foo);

  {
    void foo(); // Enables the function to be found again, over the variable
    foo();
    printf("running!\n");
  }

  return 0;
}</pre>
</div>
</div>
</div>
</div>
</div>