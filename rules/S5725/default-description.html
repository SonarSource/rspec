<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Using remote artifacts without integrity checks can lead to
the unexpected execution of malicious code in the application.</p>
</div>
<div class="paragraph">
<p>On the client side, where front-end code is executed, malicious code could:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>impersonate users' identities and take advantage of their privileges on the application.</p>
</li>
<li>
<p>add quiet malware that monitors users' session and capture sensitive secrets.</p>
</li>
<li>
<p>gain access to sensitive clients' personal data.</p>
</li>
<li>
<p>deface, or otherwise affect the general availability of the application.</p>
</li>
<li>
<p>mine cryptocurrencies in the background.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Likewise, a compromised software piece that would be deployed on a server-side application could badly affect the application&#8217;s security. For example, server-side malware could:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>access and modify sensitive technical and business data.</p>
</li>
<li>
<p>elevate its privileges on the underlying operating system.</p>
</li>
<li>
<p>Use the compromised application as a pivot to attack the local network.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By ensuring that a remote artifact is exactly what it is supposed to be before
using it, the application is protected from unexpected changes applied to it before it is
downloaded.<br>
Especially, integrity checks will allow for identifying an artifact replaced by malware on the
publication website or that was legitimately changed by its author, in a more benign
scenario.</p>
</div>
<div class="paragraph">
<p>Important note: downloading an artifact over HTTPS only protects it while in
transit from one host to another. It provides authenticity and integrity checks
<strong>for the network stream</strong> only. It does not ensure the authenticity or security
of the artifact itself.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ask_yourself_whether">Ask Yourself Whether</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>The artifact is a file intended to execute code.</p>
</li>
<li>
<p>The artifact is a file that is intended to configure or affect running code in some way.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There is a risk if you answered yes to any of these questions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_recommended_secure_coding_practices">Recommended Secure Coding Practices</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To check the integrity of a remote artifact, hash verification is the most
reliable solution. It does ensure that the file has not been modified since the
fingerprint was computed.</p>
</div>
<div class="paragraph">
<p>In this case, the artifact&#8217;s hash must:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Be computed with a secure hash algorithm such as <code>SHA512</code>, <code>SHA384</code> or <code>SHA256</code>.</p>
</li>
<li>
<p>Be compared with a secure hash that was <strong>not</strong> downloaded from the same source.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To do so, the best option is to add the hash in the code explicitly,
by following <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Subresource_Integrity#tools_for_generating_sri_hashes">Mozilla&#8217;s official documentation on how to generate integrity strings</a>.</p>
</div>
<div class="paragraph">
<p><strong>Note: Use this fix together with version binding on the remote file. Avoid
downloading files named "latest" or similar, so that the front-end pages do not
break when the code of the latest remote artifact changes.</strong></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sensitive_code_example">Sensitive Code Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following code sample uses neither integrity checks nor version pinning:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">&lt;script
    src="https://cdn.example.com/latest/script.js"
&gt;&lt;/script&gt; &lt;!-- Sensitive --&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">&lt;script
    src="https://cdn.example.com/v5.3.6/script.js"
    integrity="sha384-oqVuAfXRKap7fdgcCY5uykM6+R9GqQ8K/uxy9rx7HNQlGYl1kPzQho1wx4JwY8wC"
&gt;&lt;/script&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>OWASP - <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/">Top 10 2021 Category A8 - Software and Data Integrity Failures</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/353">CWE-353 - Missing Support for Integrity Check</a></p>
</li>
<li>
<p>OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security Misconfiguration</a></p>
</li>
<li>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/Security/Subresource_Integrity">developer.mozilla.org</a> - Subresource Integrity</p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Watering_hole_attack">Wikipedia, Watering Hole Attacks</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Make sure using artifacts without integrity checks is safe here.</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_17_jul_2020_094423_alexandre_gigleux_wrote">on 17 Jul 2020, 09:44:23 Alexandre Gigleux wrote:</h3>
<div class="paragraph">
<p>From a PM point of view, it would make sense to deliver the rule for JS AND HTML at the same time since the HTML rule will mainly target loading of JS external resources.</p>
</div>
</div>
</div>
</div>