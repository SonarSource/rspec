This rule raises an issue when a FastAPI endpoint function uses regular `def` instead of `async def` while containing `await` statements.

== Why is this an issue?

FastAPI is built on top of Starlette and supports both synchronous and asynchronous request handlers. However, when your endpoint function contains `await` statements, it must be declared with `async def` instead of regular `def`.

Using `await` in a regular function causes a `SyntaxError` in Python because `await` can only be used inside async functions. This is a fundamental requirement of Python's asyncio system.

Beyond the syntax requirement, using `async def` for FastAPI endpoints provides performance benefits when dealing with I/O operations. FastAPI can handle asynchronous endpoints more efficiently, allowing the server to process other requests while waiting for I/O operations to complete.

When you declare an endpoint with `async def`, FastAPI will:

* Run the function in the async event loop
* Allow other requests to be processed while waiting for async operations
* Provide better overall throughput for I/O-bound applications

If you use regular `def` for endpoints that don't contain `await` statements, FastAPI will run them in a thread pool, which works but is less efficient than native async handling.

=== What is the potential impact?

Using `await` in a regular `def` function will cause a `SyntaxError` at runtime, preventing the application from starting. This results in immediate application failure.

Even when not using `await` statements, using regular `def` instead of `async def` for FastAPI endpoints can lead to reduced performance and scalability, especially under high load with I/O-intensive operations.

=== How to fix in FastAPI?

Change the function declaration from `def` to `async def` when using `await` statements in FastAPI endpoints.

==== Non-compliant code example

[source,python,diff-id=1,diff-type=noncompliant]
----
@app.get("/items/{item_id}")
def read_item(item_id: int):  # Noncompliant
    result = await some_async_operation()
    return result
----

==== Compliant code example

[source,python,diff-id=1,diff-type=compliant]
----
@app.get("/items/{item_id}")
async def read_item(item_id: int):
    result = await some_async_operation()
    return result
----

For better performance, consider using `async def` even for endpoints without `await` statements when dealing with I/O operations.

==== Non-compliant code example

[source,python,diff-id=2,diff-type=noncompliant]
----
@app.get("/data")
def get_data():  # Noncompliant
    # I/O operation that could benefit from async
    return {"data": "value"}
----

==== Compliant code example

[source,python,diff-id=2,diff-type=compliant]
----
@app.get("/data")
async def get_data():
    # Better performance for I/O operations
    return {"data": "value"}
----

=== Documentation

 * FastAPI Async/Await Documentation - https://fastapi.tiangolo.com/async/[Official FastAPI documentation explaining when and how to use async/await]
 * Python Asyncio Documentation - https://docs.python.org/3/library/asyncio.html[Python's official documentation for asynchronous programming with asyncio]
 * FastAPI Concurrency and Async/Await - https://fastapi.tiangolo.com/async/#concurrency-and-async-await[Detailed explanation of concurrency concepts in FastAPI]

