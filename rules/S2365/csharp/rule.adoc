== Why is this an issue?

Most developers expect https://learn.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/properties[property] access to be as efficient as https://learn.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/fields[field] access. However, if a property returns a copy of an array or https://learn.microsoft.com/en-us/dotnet/csharp/programming-guide/concepts/collections[collection], it will be much slower than simple field access, contrary to the caller's likely expectations. Therefore, such properties should be refactored into methods so that callers are not surprised by the unexpectedly slower performance.

This rule detects calls to the following methods:

* https://learn.microsoft.com/en-us/dotnet/api/system.linq.enumerable.tolist[Enumerable.ToList]
* https://learn.microsoft.com/en-us/dotnet/api/system.linq.enumerable.toarray[Enumerable.ToArray]
* https://learn.microsoft.com/en-us/dotnet/api/system.array.clone[Array.Clone]

== How to fix it

=== Code examples

==== Noncompliant code example

[source,csharp,diff-id=1,diff-type=noncompliant]
----
private List<string> _foo = new List<string> { "a", "b", "c" };
public IEnumerable<string> Foo  // Noncompliant: expensive ToList call
{ 
    get
    {
        return _foo.ToList(); 
    }
}

private string[] _bar = new string[] { "a", "b", "c" };
public IEnumerable<string> Bar // Noncompliant: expensive Clone call
{ 
    get
    {
        return (string[])_bar.Clone();
    } 
}
----

==== Compliant solution

[source,csharp,diff-id=1,diff-type=compliant]
----
private List<string> _foo = new List<string> { "a", "b", "c" };

public IEnumerable<string> GetFoo()
{ 
    return _foo.ToList();
}

private string[] _bar = new string[] { "a", "b", "c" };
public IEnumerable<string> GetBar()
{
    return (string[])_bar.Clone();
}
----

== Resources

=== Documentation

* https://learn.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/properties[Properties (C# Programming Guide)]
* https://learn.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/fields[Fields (C# Programming Guide)]
* https://learn.microsoft.com/en-us/dotnet/csharp/programming-guide/concepts/collections[Collections (C#)]
* https://learn.microsoft.com/en-us/dotnet/api/system.linq.enumerable.tolist[Enumerable.ToList]
* https://learn.microsoft.com/en-us/dotnet/api/system.linq.enumerable.toarray[Enumerable.ToArray]
* https://learn.microsoft.com/en-us/dotnet/api/system.array.clone[Array.Clone]

include::../rspecator-dotnet.adoc[]
