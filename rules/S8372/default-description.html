<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This rule raises an issue when the <code>random</code> module is used to generate values that appear to be security-sensitive, such as tokens, passwords, or API keys.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>random</code> module in Python is designed for modeling and simulation purposes. It uses a pseudorandom number generator that is deterministic and not cryptographically secure. This means that with enough observations or knowledge of the internal state, an attacker could predict future values.</p>
</div>
<div class="paragraph">
<p>When generating security-sensitive values like authentication tokens, session IDs, passwords, or API keys, predictable randomness creates serious security vulnerabilities. An attacker who can predict these values could:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Hijack user sessions by guessing session tokens</p>
</li>
<li>
<p>Gain unauthorized access by predicting API keys</p>
</li>
<li>
<p>Compromise accounts by guessing password reset tokens</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>secrets</code> module was introduced in Python 3.6 specifically to address this need. It provides access to the most secure source of randomness that the operating system provides, making it suitable for cryptographic use cases.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>Using predictable random values for security purposes can lead to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Session hijacking</strong>: Attackers can predict session tokens and impersonate users</p>
</li>
<li>
<p><strong>Unauthorized access</strong>: Predictable API keys or authentication tokens allow attackers to bypass security controls</p>
</li>
<li>
<p><strong>Account takeover</strong>: Guessable password reset tokens enable attackers to compromise user accounts</p>
</li>
<li>
<p><strong>Data breaches</strong>: Weak randomness in encryption keys or salts can compromise data protection</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Replace <code>random</code> module functions with their <code>secrets</code> module equivalents when generating security-sensitive values.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import random
import string

def generate_api_key():
    return ''.join(random.choice(string.ascii_letters + string.digits) for _ in range(32))  # Noncompliant

def generate_session_token():
    return random.randint(100000, 999999)  # Noncompliant</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import secrets
import string

def generate_api_key():
    return ''.join(secrets.choice(string.ascii_letters + string.digits) for _ in range(32))

def generate_session_token():
    return secrets.randbelow(900000) + 100000</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Python secrets module documentation - <a href="https://docs.python.org/3/library/secrets.html">Official documentation for Python&#8217;s secrets module</a></p>
</li>
<li>
<p>Python random module documentation - <a href="https://docs.python.org/3/library/random.html">Official documentation explaining that random module is not suitable for security purposes</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_standards">Standards</h3>
<div class="ulist">
<ul>
<li>
<p>CWE 338 - <a href="https://cwe.mitre.org/data/definitions/338.html">Use of Cryptographically Weak Pseudo-Random Number Generator (PRNG)</a></p>
</li>
<li>
<p>OWASP Top 10 2021 A2 - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Cryptographic Failures</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>