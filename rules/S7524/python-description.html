<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This rule raises an issue when a synchronous <code>for</code> loop is used with an iterator implementing the asynchronous iteration protocol.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When working inside an <code>async</code> function, you should use <code>async for</code> to iterate over asynchronous iterators. An asynchronous iterator is an object that provides <code>__aiter__</code> and <code>__anext__</code> methods and should be used instead of a synchronous <code>for</code> loop.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>Not following the proper async pattern can lead to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Incorrect Logic</strong>: It shows a misunderstanding of the asynchronous nature of the data source.</p>
</li>
<li>
<p><strong>Inconsistent async usage</strong>: Mixing synchronous and asynchronous iteration patterns makes code harder to read and maintain.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Use the <code>async for</code> statement to iterate over asynchronous iterators inside an <code>async</code> function.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">class MyIterator:
    def __init__(self):
        ...

    def __iter__(self):
        ...

    def __next__(self):
        ...

    def __aiter__(self):
        ...

    async def __anext__(self):
        ...

async def main():
    for _ in MyIterator(): # Noncompliant
        ...</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">class MyIterator:
    def __init__(self):
        ...

    def __iter__(self):
        ...

    def __next__(self):
        ...

    def __aiter__(self):
        ...

    async def __anext__(self):
        ...

async def main():
    async for _ in MyIterator(): # Compliant
        ...</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Use "async for" for asynchronous iterators</p>
</div>
<div class="paragraph">
<p>Consider implementing quickfix to replace the <code>for</code> keyword with <code>async for</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="ulist">
<ul>
<li>
<p>Primary location: The <code>for</code> keyword of the loop.</p>
</li>
<li>
<p>Secondary locations: The <code>async</code> keyword of the enclosing function</p>
</li>
<li>
<p>Secondary locations: The <code>__aiter__</code> and <code>__anext__</code> methods if we can get the location</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Python Documentation - <a href="https://docs.python.org/3/reference/compound_stmts.html#the-async-for-statement">The async for statement</a></p>
</li>
<li>
<p>Python Documentation - <a href="https://docs.python.org/3/reference/datamodel.html#the-iterator-protocol">The iterator protocol</a></p>
</li>
<li>
<p>Python Documentation - <a href="https://docs.python.org/3/reference/datamodel.html#asynchronous-iterators">Asynchronous Iterators</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>