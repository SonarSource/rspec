In JavaScript, a promise is a mechanism to perform tasks in an asynchronous way. To this end, the language provides the `Promise` object which represents the eventual completion or failure of an asynchronous operation and its resulting value. A promise can be created with the `Promise` constructor accepting an executor function as an argument, which has `resolve` and `reject` parameters that are invoked when the promises completes or fails.

== Why is this an issue?

The executor function of a promise can also be an async function. However, this usually denotes a mistake:

- If an async executor function throws an error, the error won't cause the created Promise to reject and will be lost therefore. This could make it difficult to debug and handle runtime errors.
- If a Promise executor function is using `await`, this means that it's not necessary to use the Promise constructor, or the scope of the Promise constructor can be reduced.

== How to fix it

Fixing the issue requires removing the `async` keyword from the Promise executor function and adapting the body of the executor accordingly.

=== Code examples

==== Noncompliant code example

[source,javascript]
----
const p = new Promise(async (resolve, reject) => {
  doSomething('Hey, there!', function(err, res) {
    if (err) {
      reject(err);
      return;
    }
    await saveResult(res)
    resolve(res);
  });
});

await p;
----

==== Compliant solution

[source,javascript]
----
const p = new Promise(async (resolve, reject) => {
  doSomething('Hey, there!', function(err, res) {
    if (err) {
      reject(err);
      return;
    }
    resolve(res);
  });
});

const res = await p;
await saveResult(res);
----

== Resources

=== Documentation

* https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise[MDN Promise]
* https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Using_promises[MDN Using promises]
* https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function[MDN Async function]
