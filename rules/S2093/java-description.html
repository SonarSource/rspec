<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Many resources in Java need be closed after they have been used.
If they are not, the garbage collector cannot reclaim the resources' memory, and they are still considered to be in use by the operating system.
Such resources are considered to be leaked, which can lead to performance issues.</p>
</div>
<div class="paragraph">
<p>Java 7 introduced the try-with-resources statement, which guarantees that the resource in question will be closed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">try (InputStream input = Files.newInputStream(path)) {
  // "input" will be closed after the execution of this block
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This syntax is safer than the traditional method using <code>try</code>, <code>catch</code>, and <code>finally</code> and hence should be preferred.</p>
</div>
<div class="paragraph">
<p>This rule raises an issue if a closeable resources is not opened using a try-with-resources statement.</p>
</div>
<div class="paragraph">
<p>This rule is automatically disabled when the project&#8217;s <code>sonar.java.source</code> is lower than <code>7</code> as the close-with-resources statement was unavailable prior to Java 7.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Use the try-with-resources syntax by moving the <code>Closable</code> variable declarations after the <code>try</code> keyword surrounded
by parentheses and separated by <code>;</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">try (/* resources declarations */) {
  // resources usage ...
}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">FileReader fr = null;
BufferedReader br = null;

try { // Noncompliant, the FileReader and BufferedReader are instantiated without try-with-resources
  fr = new FileReader(fileName);
  br = new BufferedReader(fr);
  return br.readLine();
} catch (...) {
  ...
} finally {

  if (br != null) { // br has to be closed manually
    try {
      br.close();
    } catch(IOException e){...}
  }

  if (fr != null ) { // fr has to be closed manually
    try {
      br.close();
    } catch(IOException e){...}
  }

}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">try ( // Compliant, all resources are instantiated within a try-with-resources statement and hence automatically closed after use
    FileReader fr = new FileReader(fileName);
    BufferedReader br = new BufferedReader(fr)
  ) {
  return br.readLine();
}
catch (...) {}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://wiki.sei.cmu.edu/confluence/x/6DZGBQ">CERT, ERR54-J.</a> - Use a try-with-resources statement to safely handle closeable resources</p>
</li>
<li>
<p><a href="https://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html">The Java&#8482; Tutorials - The try-with-resources Statement</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Change this "try" to a try-with-resources.</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_21_nov_2024_164800_alban_auzeill_wrote">on 21 Nov 2024, 16:48:00 Alban Auzeill wrote:</h3>
<div class="paragraph">
<p>[test-code-support-investigation-for-java] Decision for scope: Main &#8594; All. It&#8217;s important to close resources during tests.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_12_oct_2014_182626_freddy_mallet_wrote">on 12 Oct 2014, 18:26:26 Freddy Mallet wrote:</h3>
<div class="paragraph">
<p>Minor point @Ann but I would associate the tag 'bug' to this rule.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_12_oct_2014_221837_ann_campbell_wrote">on 12 Oct 2014, 22:18:37 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>I disagree [~freddy.mallet]. Properly written (and we have other rules to catch if it&#8217;s not) there&#8217;s no bug.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_17_oct_2014_101750_freddy_mallet_wrote">on 17 Oct 2014, 10:17:50 Freddy Mallet wrote:</h3>
<div class="paragraph">
<p>Ok [~ann.campbell.2]</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_6_jan_2016_101615_nicolas_peru_wrote">on 6 Jan 2016, 10:16:15 Nicolas Peru wrote:</h3>
<div class="paragraph">
<p>Adding to default profile as we can rely on detection of java version.</p>
</div>
</div>
</div>
</div>