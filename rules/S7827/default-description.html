<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This rule raises an issue when a <code>Date</code> object is converted to <code>DateTime</code> using <code>to_datetime</code> without proper timezone consideration, especially when followed by <code>in_time_zone</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Converting a <code>Date</code> to <code>DateTime</code> using the <code>to_datetime</code> method creates a UTC datetime at midnight (00:00:00 +0000). When you subsequently apply <code>in_time_zone</code> to convert this to your local timezone, the timezone offset calculation can shift the date to the previous day.</p>
</div>
<div class="paragraph">
<p>For example, if you&#8217;re in Pacific Daylight Time (PDT, UTC-7), converting August 19th using <code>Date.current.to_datetime.in_time_zone</code> results in August 18th at 17:00:00 PDT. This happens because the UTC midnight (00:00:00) gets shifted back 7 hours to account for the timezone difference.</p>
</div>
<div class="paragraph">
<p>This behavior can cause subtle bugs in applications where date boundaries are important, such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Financial calculations that depend on specific dates</p>
</li>
<li>
<p>Scheduling systems that need to preserve date integrity</p>
</li>
<li>
<p>Reporting features that group data by date</p>
</li>
<li>
<p>Any business logic that assumes the date remains unchanged during conversion</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The root cause is mixing naive datetime operations (creating UTC datetime) with timezone-aware operations (applying local timezone), which leads to unexpected timezone offset calculations.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>Date shifts can cause incorrect business logic execution, leading to wrong financial calculations, scheduling errors, or data being grouped under incorrect dates. This can result in user confusion, incorrect reports, and potential financial or operational losses.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Use timezone-aware conversion methods that preserve the intended date. The <code>in_time_zone</code> method on Date objects creates a proper timezone-aware datetime without shifting the date.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby"># Naive conversion that may shift dates due to timezone offsets
date = Date.current
datetime = date.to_datetime.in_time_zone  # Noncompliant

# Direct to_datetime without timezone consideration
datetime = date.to_datetime  # Noncompliant</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby"># Use timezone-aware conversion that preserves the date
date = Date.current
datetime = date.in_time_zone.to_datetime

# Or use Time.zone.parse for explicit timezone handling
datetime = Time.zone.parse(date.to_s).to_datetime

# Or use beginning_of_day for clarity
datetime = date.beginning_of_day.to_datetime</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Rails TimeZone Documentation - <a href="https://api.rubyonrails.org/classes/ActiveSupport/TimeZone.html">Official Rails documentation for timezone handling</a></p>
</li>
<li>
<p>Rails Date and Time Guide - <a href="https://guides.rubyonrails.org/active_support_core_extensions.html#time">Rails guide covering date and time extensions and best practices</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>