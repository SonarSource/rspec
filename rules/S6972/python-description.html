<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This rule raises an issue when an invalid nested estimator parameter is set on a Pipeline.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the sklearn library, when using the <code>Pipeline</code> class, it is possible to modify the parameters of the nested estimators.
This modification can be done by using the <code>Pipeline</code> method <code>set_params</code> and specifying the name of the estimator
and the parameter to update separated by a double underscore <code>__</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from sklearn.pipeline import Pipeline
from sklearn.svm import SVC

pipe = Pipeline(steps=[("clf", SVC())])
pipe.set_params(clf__C=10)</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above, the regularization parameter <code>C</code> is set to the value <code>10</code>
for the classifier called <code>clf</code>. Setting such parameters can be done as well
with the help of the <code>param_grid</code> parameter for example when using <code>GridSearchCV</code>.</p>
</div>
<div class="paragraph">
<p>Providing invalid parameters that do not exist on the estimator can lead to unexpected behavior or runtime errors.</p>
</div>
<div class="paragraph">
<p>This rule checks that the parameters provided to the <code>set_params</code> method of a
Pipeline instance or through the <code>param_grid</code> parameters of a <code>GridSearchCV</code>
are valid for the nested estimators.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To fix this issue provide valid parameters to the nested estimators.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from sklearn.pipeline import Pipeline
from sklearn.decomposition import PCA

pipe = Pipeline(steps=[('reduce_dim', PCA())])
pipe.set_params(reduce_dim__C=2) # Noncompliant: the parameter C does not exists for the PCA estimator</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from sklearn.pipeline import Pipeline
from sklearn.decomposition import PCA

pipe = Pipeline(steps=[('reduce_dim', PCA())])
pipe.set_params(reduce_dim__n_components=2) # Compliant</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Scikit-Learn documentation - <a href="https://scikit-learn.org/stable/modules/compose.html#access-to-nested-parameters">Access to nested parameters</a></p>
</li>
<li>
<p>Scikit-Learn documentation - <a href="https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.GridSearchCV.html#sklearn-model-selection-gridsearchcv">GridSearchCV reference</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Verify that the keys of the dict passed to the set_params method of the Pipeline or the keys of
the dict passed to the params_grid of a GridSearchCV, contain the name of the
estimator and a parameter that exists on the estimator. We should refer to the stubs, to verify if a parameter is valid.
The name of the estimator is set in the Pipeline constructor in both cases. The key should have
the following shape &lt;name_of_the_estimator&gt;__&lt;name_of_the_parameter&gt;.</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Provide valid parameters to the nested estimators.</p>
</div>
<div class="paragraph">
<p>Secondary location message: The invalid parameter is set here.</p>
</div>
</div>
<div class="sect2">
<h3 id="_issue_location">Issue location</h3>
<div class="paragraph">
<p>The parameter passed as param_grid or the parameter passed to set_params</p>
</div>
<div class="paragraph">
<p>Secondary location: The invalid parameter name (the key of the dictionary)</p>
</div>
</div>
</div>
</div>