<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/builtin-types/enum">Enumerations</a> are commonly used to identify distinct elements from a set of values.</p>
</div>
<div class="paragraph">
<p>However, they can also serve as <a href="https://en.wikipedia.org/wiki/Bit_field">bit flags</a>, enabling bitwise operations to combine multiple elements within a single value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">// Saturday = 0b00100000, Sunday = 0b01000000, weekend = 0b01100000
var weekend = Days.Saturday | Days.Sunday;  // Combining elements</code></pre>
</div>
</div>
<div class="paragraph">
<p>When enumerations are used as bit flags, it is considered <a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/builtin-types/enum#enumeration-types-as-bit-flags">good practice</a> to annotate  the enum type with the <a href="https://learn.microsoft.com/en-us/dotnet/api/system.flagsattribute">FlagsAttribute</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">enum Permissions
{
  None = 0,
  Read = 1,
  Write = 2,
  Execute = 4
}

// ...

var x = Permissions.Read | Permissions.Write;  // Noncompliant: enum is not annotated with [Flags]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>FlagsAttribute</code> explicitly marks an enumeration as bit flags, making it clear that it uses bit fields and is intended to be used as flags.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">[Flags]
enum Permissions
{
  None = 0,
  Read = 1,
  Write = 2,
  Execute = 4
}

// ...

var x = Permissions.Read | Permissions.Write;  // Compliant: enum is annotated with [Flags]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Additionally, adding the <code>FlagsAttribute</code> to the enumeration enable a <a href="https://learn.microsoft.com/en-us/dotnet/api/system.flagsattribute#examples">better string representation</a> when using the <a href="https://learn.microsoft.com/en-us/dotnet/api/system.enum.tostring">Enum.ToString</a> method.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/builtin-types/enum">Enumeration in C#</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/builtin-types/enum#enumeration-types-as-bit-flags">Enumeration types as bit flags</a></p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.flagsattribute">FlagsAttribute class</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.enum.tostring">Enum.ToString method</a></p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Bit_field">Bit field - Wikipedia</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="ulist">
<ul>
<li>
<p>Mark enum "XXX" with "Flags" attribute or remove this bitwise operation.</p>
</li>
<li>
<p>Remove this bitwise operation; the enum "XXX" is not marked with "Flags" attribute.</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_9_jul_2015_154600_ann_campbell_wrote">on 9 Jul 2015, 15:46:00 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~tamas.vajk] I know that as written this rule doesn&#8217;t cover <em>BitwiseOperatorOnEnumWithoutFlags</em> but IMO it obviates it. According to <a href="http://stackoverflow.com/a/8480/2662707">SO</a> the <code>[Flags]</code> doesn&#8217;t actually get you anything w/r/t bitwise usage. What&#8217;s important is the assigned values.</p>
</div>
<div class="paragraph">
<p>I propose a Minor followup rule to make sure that <code>[Flags]</code> is applied when the enum values are power-of-2.</p>
</div>
<div class="paragraph">
<p>WDYT?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_10_jul_2015_094150_tamas_vajk_wrote">on 10 Jul 2015, 09:41:50 Tamas Vajk wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] I&#8217;ve modified slightly the messages and the sample code. I think now it covers your proposed follow-up rule as well.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_10_jul_2015_111407_ann_campbell_wrote">on 10 Jul 2015, 11:14:07 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>Thanks [~tamas.vajk]</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_1_sep_2015_070218_dinesh_bolkensteyn_wrote">on 1 Sep 2015, 07:02:18 Dinesh Bolkensteyn wrote:</h3>
<div class="paragraph">
<p>IMO it should be another rule (a MINOR one) that suggests to mark power-of-two Enums with <code>Flags</code> - that knowledge cannot just sneak into this rule&#8217;s issue message [~ann.campbell.2].</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_1_sep_2015_142141_ann_campbell_wrote">on 1 Sep 2015, 14:21:41 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>That&#8217;s between you [~tamas.vajk], [~dinesh.bolkensteyn].</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_2_sep_2015_122036_tamas_vajk_wrote">on 2 Sep 2015, 12:20:36 Tamas Vajk wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] We discussed it with [~dinesh.bolkensteyn] and he convinced me that we should have a minor severity rule that proposes to use the <code>[Flags]</code> whenever an enum only contains power-of-two items. (We can&#8217;t merge that one into this issue, because of the different severity, but has a value, because it improves the understability of the code)</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_2_sep_2015_152259_tamas_vajk_wrote">on 2 Sep 2015, 15:22:59 Tamas Vajk wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] We realized during the implementation that this power-of-two enum value restriction can&#8217;t be enforced, because</p>
</div>
<div class="listingblock">
<div class="content">
<pre>enum Permission
{
  None = 0,
  Read = 1,
  Write = 2,
  ReadWrite = Read  | Write, //means 3
  Execute = 4
}</pre>
</div>
</div>
<div class="paragraph">
<p>is totally valid. So there is no need for the other RSPEC which we discussed above. I&#8217;ll change this one.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_2_sep_2015_152459_tamas_vajk_wrote">on 2 Sep 2015, 15:24:59 Tamas Vajk wrote:</h3>
<div class="paragraph">
<p>\[~dinesh.bolkensteyn] could you please review this rspec? Thanks</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_19_oct_2015_125544_tamas_vajk_wrote">on 19 Oct 2015, 12:55:44 Tamas Vajk wrote:</h3>
<div class="paragraph">
<p>This RSPEC is closed, as we realized during the implementation that this power-of-two enum value restriction can&#8217;t be enforced.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_3_dec_2015_093215_tamas_vajk_wrote">on 3 Dec 2015, 09:32:15 Tamas Vajk wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] I reopened this RSPEC. I&#8217;m going through the R# rules, and I think it would still make sense. Note that the rule was closed because we realized that flags enums can&#8217;t be forced to have only power of two values. So I removed that part, and only left the bitwise operation part in the rule. WDYT?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_4_dec_2015_184013_ann_campbell_wrote">on 4 Dec 2015, 18:40:13 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~tamas.vajk] I moved the Noncompliant marker in the Noncompliant Code Example.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_7_dec_2015_155908_tamas_vajk_wrote">on 7 Dec 2015, 15:59:08 Tamas Vajk wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] I see the point of marking the declaration noncompliant, but from a user perspective it would be better on the call:</p>
</div>
<div class="paragraph">
<p>Let&#8217;s say we mark the <code>enum</code> noncompliant, and say that it should not be used as flags, if it&#8217;s not marked with <code>[Flags]</code>. But the developer would need some verification that indeed it&#8217;s used somewhere in a binary or/and. So we would probably include a filename and line number in the issue message. And then the dev could go check it there, and then come back to the declaration and fix it.</p>
</div>
<div class="paragraph">
<p>While in the other case if the usage is marked, the dev would only need to go to the definition, which is just one shortcut away.</p>
</div>
<div class="paragraph">
<p>What do you think?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_7_dec_2015_161737_ann_campbell_wrote">on 7 Dec 2015, 16:17:37 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>If we&#8217;re going to do that [~tamas.vajk], then we need to flip the rule around: "Non-flags enums should not be used in bitwise operations" (note double-negative).</p>
</div>
</div>
</div>
</div>