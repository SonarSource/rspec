<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>ASP.NET 1.1+ comes with a feature called <em>Request Validation</em>, preventing the server to accept content containing un-encoded HTML. This feature comes as a first protection layer against Cross-Site Scripting (XSS) attacks and act as a simple Web Application Firewall (WAF) rejecting requests potentially containing malicious content.</p>
</div>
<div class="paragraph">
<p>While this feature is not a silver bullet to prevent all XSS attacks, it helps to catch basic ones. It will for example prevent <code>&lt;script type="text/javascript" src="https://malicious.domain/payload.js"&gt;</code> to reach your Controller.</p>
</div>
<div class="paragraph">
<p>Note: <em>Request Validation</em> feature being only available for ASP.NET, no Security Hotspot is raised on ASP.NET Core applications.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ask_yourself_whether">Ask Yourself Whether</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>the developer doesn&#8217;t know the impact to deactivate the Request Validation feature</p>
</li>
<li>
<p>the web application accepts user-supplied data</p>
</li>
<li>
<p>all user-supplied data are not validated</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There is a risk if you answered yes to any of those questions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_recommended_secure_coding_practices">Recommended Secure Coding Practices</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Activate the Request Validation feature for all HTTP requests</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sensitive_code_example">Sensitive Code Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>At Controller level:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[ValidateInput(false)]
public ActionResult Welcome(string name)
{
  ...
}</pre>
</div>
</div>
<div class="paragraph">
<p>At application level, configured in the Web.config file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;configuration&gt;
   &lt;system.web&gt;
      &lt;pages validateRequest="false" /&gt;
      ...
      &lt;httpRuntime requestValidationMode="0.0" /&gt;
   &lt;/system.web&gt;
&lt;/configuration&gt;</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>At Controller level:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">[ValidateInput(true)]
public ActionResult Welcome(string name)
{
  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">public ActionResult Welcome(string name)
{
  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>At application level, configured in the Web.config file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">&lt;configuration&gt;
   &lt;system.web&gt;
      &lt;pages validateRequest="true" /&gt;
      ...
      &lt;httpRuntime requestValidationMode="4.5" /&gt;
   &lt;/system.web&gt;
&lt;/configuration&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a></p>
</li>
<li>
<p><a href="https://docs.microsoft.com/en-us/dotnet/api/system.web.configuration.httpruntimesection.requestvalidationmode?view=netframework-4.8">HttpRuntimeSection.RequestValidationMode Property</a></p>
</li>
<li>
<p><a href="https://owasp.org/www-community/ASP-NET_Request_Validation">OWASP ASP.NET Request Validation</a></p>
</li>
<li>
<p><a href="https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html">OWASP Cheat Sheet</a> - XSS Prevention Cheat Sheet</p>
</li>
<li>
<p>OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS)">Top 10 2017 Category A7 - Cross-Site Scripting (XSS)</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/79">CWE-79 - Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Make sure disabling ASP.NET Request Validation feature is safe here.</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_deprecates_s4564">deprecates: <a data-rspec-id="S4564" class="rspec-auto-link">S4564</a></h3>

</div>
<div class="sect2">
<h3 id="_on_15_jan_2021_153916_andrei_epure_wrote">on 15 Jan 2021, 15:39:16 Andrei Epure wrote:</h3>
<div class="paragraph">
<p>\[~alexandre.gigleux] what about Web.Release.config transformations? See https://github.com/SonarSource/sonar-dotnet/issues/3948</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_15_jan_2021_183025_andrei_epure_wrote">on 15 Jan 2021, 18:30:25 Andrei Epure wrote:</h3>
<div class="paragraph">
<p>Removed the <code>web.config</code> part as we are having some technical difficulties in the integration with the scanner. To respect the timebox, we&#8217;re going to deliver the Controller part first.</p>
</div>
<div class="paragraph">
<p>Putting it here.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sensitive_code_example_2">Sensitive Code Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>At application level, configured in the Web.config file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;configuration&gt;
   &lt;system.web&gt;
      &lt;pages validateRequest="false" /&gt;
      ...
      &lt;httpRuntime requestValidationMode="0.0" /&gt;
   &lt;/system.web&gt;
&lt;/configuration&gt;</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution_2">Compliant Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>At application level, configured in the Web.config file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">&lt;configuration&gt;
   &lt;system.web&gt;
      &lt;pages validateRequest="true" /&gt;
      ...
      &lt;!-- see https://docs.microsoft.com/en-us/dotnet/api/system.web.configuration.httpruntimesection.requestvalidationmode?view=netframework-4.8 --&gt;
      &lt;httpRuntime requestValidationMode="4.5" /&gt;
   &lt;/system.web&gt;
&lt;/configuration&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>And the link to  * <a href="https://docs.microsoft.com/en-us/dotnet/api/system.web.configuration.httpruntimesection.requestvalidationmode?view=netframework-4.8">HttpRuntimeSection.RequestValidationMode Property</a></p>
</div>
</div>
</div>