<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When working with <a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/operators/lambda-expressions">anonymous functions</a>, it is important to keep in mind that each time you create one, it is a completely new instance.</p>
</div>
<div class="paragraph">
<p>In this example, even though the same lambda expression is used, the expressions are stored separately in the memory and are therefore not equal or the same.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">Func&lt;int, int&gt; lambda1 = x =&gt; x + 1;
Func&lt;int, int&gt; lambda2 = x =&gt; x + 1;

var result = lambda1 == lambda2; // result is false here</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is even more true when working with <a href="https://learn.microsoft.com/en-us/dotnet/csharp/programming-guide/events/">events</a> since they are <a href="https://learn.microsoft.com/en-us/dotnet/csharp/programming-guide/delegates/how-to-combine-delegates-multicast-delegates">multicast delegates</a> that offer ways of <a href="https://learn.microsoft.com/en-us/dotnet/csharp/programming-guide/events/how-to-subscribe-to-and-unsubscribe-from-events">subscribing and unsubscribing</a> to them. If an anonymous function is used to subscribe to an event, it is impossible to unsubscribe from it. This happens because to remove the entry from the subscription list, a reference to the original method is needed, but if the anonymous function has not been stored before subscribing, there is no way to find a reference to it.</p>
</div>
<div class="paragraph">
<p>Instead, store the callback to a variable or a named method and use the variable or method to subscribe and unsubscribe.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Store the callback to a variable or a named method and use the variable or method to subscribe and unsubscribe.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">event EventHandler myEvent;

void DoWork()
{
        myEvent += (s, e) =&gt; Console.WriteLine($"Event raised with sender {s} and arguments {e}!");
        // ...
        myEvent -= (s, e) =&gt; Console.WriteLine($"Event raised with sender {s} and arguments {e}!"); // Noncompliant: this callback was never subscribed
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">event EventHandler myEvent;
void LogEvent(object s, EventArgs e) =&gt; Console.WriteLine($"Event raised with sender {s} and arguments {e}!");

void DoWork()
{
        myEvent += LogEvent;
        // ...
        myEvent -= LogEvent; // Compliant: LogEvent points to the same callback used for subscribing
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Microsoft Learn - <a href="https://learn.microsoft.com/en-us/dotnet/csharp/programming-guide/events/">Events (C# Programming Guide)</a></p>
</li>
<li>
<p>Microsoft Learn - <a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/operators/lambda-expressions">Lambda expressions and anonymous functions</a></p>
</li>
<li>
<p>Microsoft Learn - <a href="https://learn.microsoft.com/en-us/dotnet/csharp/programming-guide/events/how-to-subscribe-to-and-unsubscribe-from-events">How to subscribe to and unsubscribe from events (C# Programming Guide)</a></p>
</li>
<li>
<p>Microsoft Learn - <a href="https://learn.microsoft.com/en-us/dotnet/csharp/programming-guide/delegates/how-to-combine-delegates-multicast-delegates">How to combine delegates (Multicast Delegates) (C# Programming Guide)</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Unsubscribe with the same delegate that was used for the subscription.</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_7_jul_2015_150846_ann_campbell_wrote">on 7 Jul 2015, 15:08:46 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~tamas.vajk], I flipped this around from the original proposition; the real problem is that you subscribed with an anonymous delegate. Hopefully that&#8217;s not too much harder in the implementation&#8230;&#8203;</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_8_jul_2015_091124_tamas_vajk_wrote">on 8 Jul 2015, 09:11:24 Tamas Vajk wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] We won&#8217;t be able to implement the rule this way. Finding  subscription and unsubscription pairs won&#8217;t be easy.</p>
</div>
<div class="paragraph">
<p>On the other hand, whenever you try to unsubscribe with an anonymous delegate that is an issue. So recognizing this is easy. I would go this way. (I&#8217;ve changed the location of the issue, but both the message and the title would need modification)</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_8_jul_2015_135601_ann_campbell_wrote">on 8 Jul 2015, 13:56:01 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>updated. See what you think [~tamas.vajk]</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_20_jul_2015_114456_tamas_vajk_wrote">on 20 Jul 2015, 11:44:56 Tamas Vajk wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] Looks good.</p>
</div>
</div>
</div>
</div>