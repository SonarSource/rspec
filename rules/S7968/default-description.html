<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This rule raises an issue when Apex classes implementing Agentforce Actions lack proper input validation, exception handling, or safe SOQL query practices.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Agentforce Actions are critical components that power AI-driven automation in Salesforce. When these actions lack proper validation and error handling, several problems can occur:</p>
</div>
<div class="paragraph">
<p>First, runtime exceptions can cause the entire action to fail unexpectedly. For example, a SOQL query that assumes a record exists might throw a <code>QueryException</code> when no records are found, causing the action to terminate abruptly.</p>
</div>
<div class="paragraph">
<p>Second, invalid or missing input parameters can lead to unpredictable behavior. Without proper validation, an action might attempt to process null values or empty strings, resulting in meaningless results or system errors.</p>
</div>
<div class="paragraph">
<p>Third, poor error handling makes troubleshooting difficult. When exceptions occur without proper logging or user-friendly error messages, developers and administrators struggle to identify and resolve issues quickly.</p>
</div>
<div class="paragraph">
<p>Finally, unreliable actions undermine user trust in AI-powered features. Users expect consistent, predictable behavior from automated systems. When actions fail silently or produce unexpected results, it damages confidence in the platform&#8217;s capabilities.</p>
</div>
<div class="paragraph">
<p>Proper validation and error handling ensure that Agentforce Actions are robust, reliable, and provide meaningful feedback when issues occur.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>Without proper validation and error handling, Agentforce Actions may fail unexpectedly, causing:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Runtime exceptions that terminate action execution</p>
</li>
<li>
<p>Poor user experience due to unclear error messages</p>
</li>
<li>
<p>Difficulty troubleshooting issues in production</p>
</li>
<li>
<p>Reduced reliability of AI-powered automation</p>
</li>
<li>
<p>Potential data inconsistencies when actions fail partially</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Implement comprehensive input validation, exception handling, and safe SOQL queries in your Agentforce Action methods. Always validate input parameters, use try-catch blocks to handle exceptions gracefully, and provide meaningful error messages to users.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-apex" data-lang="apex">@InvocableMethod(label='Process Customer Data')
public static List&lt;String&gt; processCustomerData(List&lt;CustomerRequest&gt; requests) {
    List&lt;String&gt; results = new List&lt;String&gt;();
    for (CustomerRequest req : requests) {
        Account acc = [SELECT Id, Name FROM Account WHERE Id = :req.customerId]; // Noncompliant
        String result = DataCloudService.getCustomerInsights(req.customerId);
        results.add(acc.Name + ': ' + result);
    }
    return results;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-apex" data-lang="apex">@InvocableMethod(label='Process Customer Data')
public static List&lt;String&gt; processCustomerData(List&lt;CustomerRequest&gt; requests) {
    List&lt;String&gt; results = new List&lt;String&gt;();
    try {
        for (CustomerRequest req : requests) {
            if (req.customerId == null || String.isBlank(req.customerId)) {
                results.add('Error: Invalid customer ID');
                continue;
            }
            List&lt;Account&gt; accounts = [SELECT Id, Name FROM Account WHERE Id = :req.customerId LIMIT 1];
            if (accounts.isEmpty()) {
                results.add('Error: Account not found');
                continue;
            }
            String result = DataCloudService.getCustomerInsights(req.customerId);
            results.add(accounts[0].Name + ': ' + result);
        }
    } catch (Exception e) {
        System.debug('Error in processCustomerData: ' + e.getMessage());
        results.add('Error processing request: ' + e.getMessage());
    }
    return results;
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Agentforce Actions Developer Guide - <a href="https://developer.salesforce.com/docs/atlas.en-us.agentforce.meta/agentforce/">Official documentation for building custom Agentforce Actions</a></p>
</li>
<li>
<p>Apex Exception Handling - <a href="https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/apex_exception_handling.htm">Best practices for exception handling in Apex</a></p>
</li>
<li>
<p>SOQL Best Practices - <a href="https://developer.salesforce.com/docs/atlas.en-us.soql_sosl.meta/soql_sosl/sforce_api_calls_soql_best_practices.htm">Guidelines for writing safe and efficient SOQL queries</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_standards">Standards</h3>
<div class="ulist">
<ul>
<li>
<p>CWE-754: Improper Check for Unusual or Exceptional Conditions - <a href="https://cwe.mitre.org/data/definitions/754.html">Addresses the importance of proper error handling and validation</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>