<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Secret leaks often occur when a sensitive piece of authentication data is
stored with the source code of an application. Considering the source code is
intended to be deployed across multiple assets, including source code
repositories or application hosting servers, the secrets might get exposed to an
unintended audience.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As described in the
<a href="https://learn.microsoft.com/en-us/azure/azure-functions/functions-bindings-http-webhook-trigger?tabs=python-v2%2Cisolated-process%2Cnodejs-v4%2Cfunctionsv2&amp;pivots=programming-language-csharp#authorization-keys">Azure Functions documentation</a>,
Azure Functions let you use keys to make it harder to access your HTTP function endpoints <strong>during development</strong>.</p>
</div>
<div class="paragraph">
<p>While keys provide a default security mechanism, distributing them in public
apps is a bad practice and can lead to security and maintainability issues.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>The impact of this access depends on what the Azure Function does and what
permissions the key has.</p>
</div>
<div class="paragraph">
<p>There are three types of keys that can be used to authenticate requests to an
Azure Function:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Function key</strong>: Provides access to a specific function.</p>
</li>
<li>
<p><strong>Host key</strong>: Provides access to all functions within a function app.</p>
</li>
<li>
<p><strong>System key</strong>: Provides access to all functions within a function app and allows for administrative actions.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Leaking these keys can result in unintended access to the functions and data they control.</p>
</div>
<div class="paragraph">
<p>Below are some real-world scenarios that illustrate some impacts of an attacker
exploiting the key.</p>
</div>
<div class="sect3">
<h4 id="_compromise_of_sensitive_data">Compromise of sensitive data</h4>
<div class="paragraph">
<p>If the affected service is used to store or process personally identifiable
information or other sensitive data, attackers knowing an authentication secret
could be able to access it. Depending on the type of data that is compromised,
it could lead to privacy violations, identity theft, financial loss, or other
negative outcomes.</p>
</div>
<div class="paragraph">
<p>In most cases, a company suffering a sensitive data compromise will face a
reputational loss when the security issue is publicly disclosed.</p>
</div>
</div>
<div class="sect3">
<h4 id="_modification_of_application_data">Modification of application data</h4>
<div class="paragraph">
<p>Applications may rely on data that cannot be distributed with the application
code. This may be due to the size of the data, or because the data is regularly
updated. This data is downloaded by the application as it is needed.</p>
</div>
<div class="paragraph">
<p>If an attacker can gain access to an authentication secret, they may be able to
alter or delete this application data. This may cause parts of the application
to misbehave or stop working. Maliciously altered data could also contain
undesirable content which results in reputational damage.</p>
</div>
</div>
<div class="sect3">
<h4 id="_financial_loss">Financial loss</h4>
<div class="paragraph">
<p>Financial losses can occur when a secret is used to access a paid
third-party-provided service and is disclosed as part of the source code of
client applications. Having the secret, each user of the application will be
able to use it without limit to use the third party service to their own need,
including in a way that was not expected.</p>
</div>
<div class="paragraph">
<p>This additional use of the secret will lead to added costs with the service
provider.</p>
</div>
<div class="paragraph">
<p>Moreover, when rate or volume limiting is set up on the provider side, this
additional use can prevent the regular operation of the affected application.
This might result in a partial denial of service for all the application&#8217;s
users.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_use_app_level_security">Use app-level security</h3>
<div class="paragraph">
<p>As described in the <a href="https://learn.microsoft.com/en-us/azure/azure-functions/functions-bindings-http-webhook-trigger?tabs=python-v2%2Cisolated-process%2Cnodejs-v4%2Cfunctionsv2&amp;pivots=programming-language-csharp#secure-an-http-endpoint-in-production">Azure Functions documentation</a>,
you can secure your HTTP function endpoints by using app-level security, and
remove the need to use hardcoded keys.</p>
</div>
<div class="paragraph">
<p>The first step is thus to set the HTTP-triggered function authorization level to
<code>anonymous</code>.</p>
</div>
<div class="paragraph">
<p>Then, examples of app-level security include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>authentication/authorization, either from the framework of your choice or <a href="https://learn.microsoft.com/en-us/azure/app-service/overview-authentication-authorization#why-use-the-built-in-authentication">Built-in Azure App Service Authentication/Authorization</a></p>
</li>
<li>
<p>Azure <a href="https://learn.microsoft.com/en-us/azure/api-management/api-management-policies#authentication-policies">API Management Authentication Policies</a></p>
</li>
<li>
<p>request authentication with the <a href="https://learn.microsoft.com/en-us/azure/app-service/environment/integrate-with-application-gateway">Azure App Service Environment</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">curl -G \
  'https://example.azurewebsites.net/api/example'  \
  -d code=2PLqsO9INfpK8sgTS2BCsZXS6Dgzgz3bydKcq5TBcY8WAzFuqGlKRw==' # Noncompliant</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_standards">Standards</h3>
<div class="ulist">
<ul>
<li>
<p>OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and Authentication Failures</a></p>
</li>
<li>
<p>OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data Exposure</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a></p>
</li>
<li>
<p>STIG Viewer - <a href="https://stigviewer.com/stigs/application_security_and_development/2024-12-06/finding/V-222642">Application Security and Development: V-222642</a> - The application must not contain embedded authentication data.</p>
</li>
</ul>
</div>
</div>
</div>
</div>