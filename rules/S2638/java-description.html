<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This rule raises an issue when an overriding method changes a contract defined in a superclass.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Because a subclass instance may be cast to and treated as an instance of the superclass, overriding methods should uphold the aspects of the superclass contract that relate to the Liskov Substitution Principle. Specifically, if the parameters or return type of the superclass method are marked with any of the following: <code>@Nullable</code>, <code>@CheckForNull</code>, <code>@NotNull</code>, <code>@NonNull</code>, and <code>@Nonnull</code>, then subclass parameters are not allowed to tighten the contract, and return values are not allowed to loosen it.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class Fruit {

  private Season ripe;
  private String color;

  public void setRipe(@Nullable Season ripe) {
    this.ripe = ripe;
  }

  public @NotNull Integer getProtein() {
    return 12;
  }
}

public class Raspberry extends Fruit {

  public void setRipe(@NotNull Season ripe) {  // Noncompliant: the ripe argument annotated as @Nullable in parent class
    this.ripe = ripe;
  }

  public @Nullable Integer getProtein() {  // Noncompliant: the return type annotated as @NotNull in parent class
    return null;
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class Fruit {

  private Season ripe;
  private String color;

  public void setRipe(@Nullable Season ripe) {
    this.ripe = ripe;
  }

  public @NotNull Integer getProtein() {
    return 12;
  }
}

public class Raspberry extends Fruit {

  public void setRipe(@Nullable Season ripe) {
    this.ripe = ripe;
  }

  public @NotNull Integer getProtein() {
    return 12;
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>SOLID - <a href="https://en.wikipedia.org/wiki/Liskov_substitution_principle">Wikipedia - Liskov substitution principle</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="ulist">
<ul>
<li>
<p>Remove this "xxx" annotation to honor the overridden method&#8217;s contract.</p>
</li>
<li>
<p>Equals method should accept null parameters and return false.</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_is_related_to_s4454">is related to: <a data-rspec-id="S4454" class="rspec-auto-link">S4454</a></h3>

</div>
<div class="sect2">
<h3 id="_on_4_mar_2016_120912_sytze_van_koningsveld_wrote">on 4 Mar 2016, 12:09:12 sytze van koningsveld wrote:</h3>
<div class="paragraph">
<p>This description is not correct; subclasses are allowed to loosen the contract on parameters, and tightened on return values; see also https://en.wikipedia.org/wiki/Liskov_substitution_principle. Example :</p>
</div>
<div class="paragraph">
<p>public class Raspberry extends Fruit {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>public void setRipe(Season ripe) {  //compliant</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>this.ripe = ripe;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public @Notnull Integer getProtein() throws MyException {  //compliant</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>return 12;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>}</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_4_mar_2016_134747_ann_campbell_wrote">on 4 Mar 2016, 13:47:47 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~sytzevk] it&#8217;s allowable - that&#8217;s why it compiles. But it may not be the best idea.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_4_mar_2016_151249_sytze_van_koningsveld_wrote">on 4 Mar 2016, 15:12:49 sytze van koningsveld wrote:</h3>
<div class="paragraph">
<p>so Liskov&#8217;s principle is a bad idea ? Can you elaborate a bit on why you think a fundamental property of object orientation is not the best idea ?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_7_mar_2016_103604_nicolas_peru_wrote">on 7 Mar 2016, 10:36:04 Nicolas Peru wrote:</h3>
<div class="paragraph">
<p>Hi [~sytzevk],</p>
</div>
<div class="paragraph">
<p>First a word about the formulation of your question :</p>
</div>
<div class="paragraph">
<p>While we love hearing (negative) feedback, please keep a polite voice and avoid passive agressive tone like in your last question. Being right and pointing out errors of others does not allow to be rude (on the contrary). Thanks.</p>
</div>
<div class="paragraph">
<p>Now for the content of your feedback:</p>
</div>
<div class="paragraph">
<p>If you think about this rule as a rule to detect LSP violations, then indeed, it does not work as it will detect cases that are not LSP violations when you loosen contract on parameters and tighten on return values (false positives).</p>
</div>
<div class="paragraph">
<p>As a first implementation we did not think about it like this, so I&#8217;ll update the description and create a ticket to fix this rule.</p>
</div>
<div class="paragraph">
<p>Thanks!</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_9_jan_2018_163930_amaury_levé_wrote">on 9 Jan 2018, 16:39:30 Amaury Levé wrote:</h3>
<div class="paragraph">
<p>This rule cannot be implemented in C#/VB.Net as these annotations do not exist.</p>
</div>
</div>
</div>
</div>