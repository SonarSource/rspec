<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Using JavaScript interfaces in WebViews to expose Java objects is unsafe. Doing so allows JavaScript
to invoke Java methods, potentially giving attackers access to data or sensitive app functionality.
WebViews might include untrusted sources such as third-party iframes, making this functionality
particularly risky. As JavaScript interfaces are passed to every frame in the WebView, those iframes
are also able to access the exposed Java object.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ask_yourself_whether">Ask Yourself Whether</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>The content in the WebView is fully trusted and secure.</p>
</li>
<li>
<p>Potentially untrusted iframes could be loaded in the WebView.</p>
</li>
<li>
<p>The JavaScript interface has to be exposed for the entire lifecycle of the WebView.</p>
</li>
<li>
<p>The exposed Java object might be called by untrusted sources.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There is a risk if you answered yes to any of these questions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_recommended_secure_coding_practices">Recommended Secure Coding Practices</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_disable_javascript">Disable JavaScript</h3>
<div class="paragraph">
<p>If it is possible to disable JavaScript in the WebView, this is the most secure option.</p>
</div>
<div class="paragraph">
<p>When using the <a href="https://pub.dev/packages/webview_flutter"><code>webview_flutter</code> package</a>, JavaScript is disabled by default. Therefore, <a href="https://pub.dev/documentation/webview_flutter/latest/webview_flutter/WebViewController/setJavaScriptMode.html"><code>setJavaScriptMode</code></a> does not need to be explicitly called with <a href="https://pub.dev/documentation/webview_flutter/latest/webview_flutter/JavaScriptMode.html"><code>JavaScriptMode.disabled</code></a> on <a href="https://pub.dev/documentation/webview_flutter/latest/webview_flutter/WebViewController-class.html"><code>WebViewController</code></a> (v4 and above) or <a href="https://pub.dev/documentation/webview_flutter/3.0.4/webview_flutter/WebView-class.html"><code>WebView</code></a> (v3 and below).</p>
</div>
<div class="paragraph">
<p>When using the <a href="https://pub.dev/packages/flutter_inappwebview"><code>flutter_inappwebview</code> package</a>, on the other hand,
the default behavior is to enable JavaScript. Therefore, it is necessary to set the <code>enableJavaScript</code> parameter
to <code>false</code> in instances of <a href="https://pub.dev/documentation/flutter_inappwebview/latest/flutter_inappwebview/InAppWebViewSettings-class.html">InAppWebViewSettings</a>
and <a href="https://pub.dev/documentation/flutter_inappwebview/latest/flutter_inappwebview/InAppWebViewOptions-class.html">InAppWebViewOptions</a>.</p>
</div>
<div class="paragraph">
<p>Of course, sometimes it is necessary to enable JavaScript, in which case the following
recommendations should be considered.</p>
</div>
</div>
<div class="sect2">
<h3 id="_remove_javascript_interface_when_loading_untrusted_content">Remove JavaScript interface when loading untrusted content</h3>
<div class="paragraph">
<p>JavaScript interfaces can be removed at a later point. It is recommended to remove the JavaScript
interface when it is no longer needed. If it is needed for a longer time, consider removing it before
loading untrusted content. This can be done by calling <code>webViewController.removeJavaScriptChannel('channelName')</code> for the <a href="https://pub.dev/packages/webview_flutter"><code>webview_flutter</code> package</a> or <code>webViewController.removeJavaScriptHandler('channelName')</code> for the <a href="https://pub.dev/packages/flutter_inappwebview"><code>flutter_inappwebview</code> package</a>.</p>
</div>
<div class="paragraph">
<p>A good place to do this in Flutter is inside navigation callbacks like <a href="https://pub.dev/documentation/webview_flutter/latest/webview_flutter/NavigationDelegate/onNavigationRequest.html"><code>NavigationDelegate.onNavigationRequest</code></a>
for the <a href="https://pub.dev/packages/webview_flutter"><code>webview_flutter</code> package</a> or <a href="https://pub.dev/documentation/flutter_inappwebview/latest/flutter_inappwebview/PlatformInAppBrowserEvents/shouldOverrideUrlLoading.html"><code>WebViewClient.shouldOverrideUrlLoading</code></a>
for the <a href="https://pub.dev/packages/flutter_inappwebview"><code>flutter_inappwebview</code> package</a> package, where you can check the URL being loaded and remove the JavaScript channel
if the content is untrusted.</p>
</div>
</div>
<div class="sect2">
<h3 id="_alternative_methods_to_implement_native_bridges">Alternative methods to implement native bridges</h3>
<div class="paragraph">
<p>If a native channel has to be added to the WebView or its controller, and it is impossible to remove it
at a later point, consider using an alternative method that offers more control over the communication flow.</p>
</div>
<div class="paragraph">
<p>For the <code>webview_flutter</code> package, there is currently no way to know the origin of an incoming JavaScript message. Therefore using JavaScript communication with <code>webview_flutter</code> is discouraged.</p>
</div>
<div class="paragraph">
<p>For the <code>flutter_inappwebview</code> package, use <a href="https://pub.dev/documentation/flutter_inappwebview/latest/flutter_inappwebview/WebMessageListener-class.html"><code>WebMessageListener</code></a> which allows you to restrict the origins that can send messages to your application.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sensitive_code_example">Sensitive Code Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://pub.dev/packages/webview_flutter"><code>webview_flutter</code></a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-dart" data-lang="dart">final _controller = WebViewController()
    ..setJavaScriptMode(JavaScriptMode.unrestricted)
    ..addJavaScriptChannel("channel", onMessageReceived: (m) {}); // Sensitive</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://pub.dev/packages/flutter_inappwebview"><code>flutter_inappwebview</code></a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-dart" data-lang="dart">InAppWebView(
  onWebViewCreated: (controller) {
    controller?.addJavaScriptHandler( // Sensitive
      handlerName: "channel",
      callback: (args) {}
    );
  },
);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The most secure option is to not enable, or disable, JavaScript entirely. <a data-rspec-id="S6362" class="rspec-auto-link">S6362</a> further explains why it should not
be enabled unless absolutely necessary.</p>
</div>
<div class="paragraph">
<p><a href="https://pub.dev/packages/webview_flutter"><code>webview_flutter</code></a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-dart" data-lang="dart">final _controller = WebViewController();</code></pre>
</div>
</div>
<div class="paragraph">
<p>If possible, remove the JavaScript channel after it is no longer needed, or before loading any untrusted content.</p>
</div>
<div class="paragraph">
<p><a href="https://pub.dev/packages/webview_flutter"><code>webview_flutter</code></a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-dart" data-lang="dart">_controller.removeJavaScriptChannel("channel");</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://pub.dev/packages/flutter_inappwebview"><code>flutter_inappwebview</code></a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-dart" data-lang="dart">_controller.removeJavaScriptHandler("channel");</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a JavaScript channel must be used, consider using <code>flutter_inappwebview</code> instead of <code>webview_flutter</code>. The Web Message API allows you to restrict the origins that can send messages to the JavaScript bridge.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-dart" data-lang="dart">InAppWebView(
  onWebViewCreated: (controller) async {
    await inAppController.addWebMessageListener(
      WebMessageListener(
        jsObjectName: "channel",
          allowedOriginRules: {
            "https://secure-origin",
          }, // Restrict to specific origin
          onPostMessage: (message, origin, isMainFrame, replyProxy) {},
        ),
      );
  },
);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Android Documentation - <a href="https://developer.android.com/privacy-and-security/risks/insecure-webview-native-bridges">Insecure WebView native bridges</a></p>
</li>
<li>
<p>Android Documentation - <a href="https://developer.android.com/reference/androidx/webkit/WebViewCompat">WebViewCompat API reference</a></p>
</li>
<li>
<p>OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a></p>
</li>
<li>
<p>OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2023-risks/m4-insufficient-input-output-validation.html">Mobile Top 10 2024 Category M4 - Insufficient Input/Output Validation</a></p>
</li>
<li>
<p>OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2023-risks/m8-security-misconfiguration.html">Mobile Top 10 2024 Category M8 - Security Misconfiguration</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/79">CWE-79 - Improper Neutralization of Input During Web Page Generation</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_related_rules">Related rules</h3>
<div class="ulist">
<ul>
<li>
<p><a data-rspec-id="S6362" class="rspec-auto-link">S6362</a> - Enabling JavaScript support for WebViews is security-sensitive</p>
</li>
</ul>
</div>
</div>
</div>
</div>