== Why is this an issue?

When https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/statements/selection-statements#the-switch-statement[switch] statements have large sets of `case` clauses, it is usually an attempt to map two sets of data.

When the `case` clauses of such `switch` statement contain multiple lines, the code becomes hard to read and maintain.

For example, the https://www.sonarsource.com/docs/CognitiveComplexity.pdf[Cognitive Complexity] is going to be particularly high. Another example is the introduction of local variables in some of the `case` clauses, which may require introducing local scopes with curly braces, to avoid name clashing.

In such scenarios, it's better to rethink the approach to data retrieval, possibly making use of a collection such as a https://learn.microsoft.com/en-us/dotnet/api/system.collections.generic.dictionary-2[Dictionary].

On the other hand, when all the `case` clauses of a `switch` statement are single-line, the readability of the code is not necessarily affected. At times, a `switch` can be easier to maintain than a collection, especially when data is not statically mapped, as it happens in a dictionary, but needs to be dynamically calculated, for example calling a method.
Moreover, `switch` statements with single-line `case` clauses can easily be converted into https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/operators/switch-expression[`switch` expressions], which are more concise for assignment and avoid the need for `break` statements.

=== Exceptions

This rule ignores:

* `switch` statements over `Enum` arguments
* fall-through cases

== How to fix it

Multiple approaches can be taken to fix this issue.

When data is statically mapped, a possible approach is to store all the cases apart from the `default` one in a dictionary and try to get the matching value by calling the https://learn.microsoft.com/en-us/dotnet/api/system.collections.generic.dictionary-2.trygetvalue[TryGetValue] method.

When data is dynamically calculated and cannot be easily stored in a collection, an alternative approach is to extract the logic of multi-line `case` clauses into separate methods.

=== Code examples

The examples below use the "Maximum number of case" property set to `4`.

Note that from C# 8, you can use `switch` expression.

==== Noncompliant code example

[source,csharp,diff-id=1,diff-type=noncompliant]
----
public int MapChar(char ch, int value)
{
    switch(ch) // Noncompliant
    {
        case 'a':
            return 1;
        case 'b':
            return 2;
        case 'c':
            return 3;
        // ...
        case '-':
            if (value > 10)
            {
                return 42;
            }
            else if (value < 5 && value > 1)
            {
                return 21;
            }
            return 99;
        default:
            return 1000;
    }
}
----

==== Compliant solution

[source,csharp,diff-id=1,diff-type=compliant]
----
public int MapChar(char ch, int value)
{
    switch(ch) // Noncompliant
    {
        case 'a':
            return 1;
        case 'b':
            return 2;
        case 'c':
            return 3;
        // ...
        case '-':
            return HandleDash(value);
        default:
            return 1000;
    }
}

private int HandleDash(int value)
{
    if (value > 10)
    {
        return 42;
    }
    else if (value < 5 && value > 1)
    {
        return 21;
    }
    return 99;
}
----

==== Noncompliant code example

[source,csharp,diff-id=2,diff-type=noncompliant]
----
public int MapChar(char ch, int value)
{
    switch(ch) // Noncompliant
    {
        case 'a':
            return 1;
        case 'b':
            return 2;
        case 'c':
            return 3;
        // ...
        case '-':
            if (value > 10)
            {
                return 42;
            }
            else if (value < 5 && value > 1)
            {
                return 21;
            }
            return 99;
        default:
            return 1000;
    }
}
----

==== Compliant solution

[source,csharp,diff-id=2,diff-type=compliant]
----
public int MapChar(char ch, int value) =>
    ch switch
    {
        'a' => 1,
        'b' => 2,
        'c' => 3,
        // ...
        '-' => HandleDash(value),
        _ => 1000,
    };

private int HandleDash(int value)
{
    if (value > 10)
    {
        return 42;
    }
    else if (value < 5 && value > 1)
    {
        return 21;
    }
    return 99;
}
----

include::../resources-dotnet.adoc[]

* https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/statements/selection-statements#the-switch-statement[The `switch` statement]

include::../rspecator-dotnet.adoc[]

