<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This rule raises an issue if the Scikit-learn <code>fit</code> or <code>partial_fit</code> methods are not called prior to a method yielding results.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When using the Scikit-learn library it is crucial to train the estimator or transformer before
attempting to get results. Failing to do so can lead to incorrect results or runtime errors.
The training is done with the help of the <code>fit</code> or <code>partial_fit</code> methods and retrieving results can be done for example with the <code>predict</code> method.</p>
</div>
<div class="paragraph">
<p>If the <code>predict</code> method is called without a prior call to the <code>fit</code> method, a <code>NotFittedError</code> exception will be raised.
In this case the error is unambiguous but in some other cases the error raised could be less explicit.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from sklearn.datasets import load_iris
from sklearn.neighbors import KNeighborsClassifier

iris = load_iris()
knn = KNeighborsClassifier(1)
knn.n_samples_fit_ # raises an AttributeError</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above, failing to train the model on the iris dataset with the
<code>fit</code> method results in a more cryptic error where <code>n_samples_fit_</code> is not an
attribute of <code>KNeighborsClassifier</code>, this is because this attribute is only set after the method <code>fit</code>
is called.</p>
</div>
<div class="paragraph">
<p>This rule will raise an issue when the following methods are called without a prior call to <code>fit</code> or <code>partial_fit</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>predict</code></p>
</li>
<li>
<p><code>predict_proba</code></p>
</li>
<li>
<p><code>predict_log_proba</code></p>
</li>
<li>
<p><code>score</code></p>
</li>
<li>
<p><code>score_samples</code></p>
</li>
<li>
<p><code>decision_function</code></p>
</li>
<li>
<p><code>transform</code></p>
</li>
<li>
<p><code>inverse_transform</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>as well as any attributes of an estimator ending with a single underscore (denoting that this attribute is set during <code>fit</code> or <code>partial_fit</code>).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To fix the issue, call the <code>fit</code> or <code>partial_fit</code> method before retrieving results.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from sklearn import datasets
from sklearn.cluster import KMeans

iris = datasets.load_iris()
X = iris.data

kmeans = KMeans(n_clusters=3, random_state=42)
kmeans.predict(X) # Noncompliant: raises a NotFittedError</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from sklearn import datasets
from sklearn.cluster import KMeans

iris = datasets.load_iris()
X = iris.data

kmeans = KMeans(n_clusters=3, random_state=42)
kmeans.fit(X)
kmeans.predict(X) # Compliant</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Scikit-learn Documentation - <a href="https://scikit-learn.org/stable/glossary.html#term-fit">Glossary fit reference</a></p>
</li>
<li>
<p>Scikit-learn Documentation - <a href="https://scikit-learn.org/stable/modules/generated/sklearn.exceptions.NotFittedError.html#sklearn.exceptions.NotFittedError">NotFittedError reference</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Implementation details:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>predict</p>
</li>
<li>
<p>predict_proba</p>
</li>
<li>
<p>predict_log_proba</p>
</li>
<li>
<p>score</p>
</li>
<li>
<p>score_samples</p>
</li>
<li>
<p>decision_function</p>
</li>
<li>
<p>transform</p>
</li>
<li>
<p>inverse_transform</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the list of methods above are called, we should check for the <code>fit</code> or <code>partial_fit</code> methods called on the same object.
Or if an argument of an estimator is called and the name of the argument ends with an underscore we should check for the fit or partial_fit methods call.</p>
</div>
<div class="paragraph">
<p>An estimator can be detected if the object inherits from <code>BaseEstimator</code>.</p>
</div>
<div class="paragraph">
<p>Issue location: the name of the method or attribute (from the list above)</p>
</div>
<div class="paragraph">
<p>Message: Call the fit method on this estimator before retrieving the results.</p>
</div>
<div class="paragraph">
<p>Quickfix: Not applicable (could be too tricky as the parameters of fit and predict could be different)</p>
</div>
</div>
</div>
</div>