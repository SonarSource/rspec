<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In C#, delegates can be added together to chain their execution, and subtracted to remove their execution from the chain.</p>
</div>
<div class="paragraph">
<p>Subtracting a chain of delegates from another one might yield unexpected results as shown hereunder - and is likely to be a bug.</p>
</div>
<div class="sect2">
<h3 id="_noncompliant_code_example">Noncompliant code example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">MyDelegate first, second, third, fourth;
first = () =&gt; Console.Write("1");
second = () =&gt; Console.Write("2");
third = () =&gt; Console.Write("3");
fourth = () =&gt; Console.Write("4");

MyDelegate chain1234 = first + second + third + fourth; // Compliant - chain sequence = "1234"
MyDelegate chain12 = chain1234 - third - fourth; // Compliant - chain sequence = "12"


MyDelegate chain14 = first + fourth; // creates a new MyDelegate instance which is a list under the covers
MyDelegate chain23 = chain1234 - chain14; // Noncompliant; (first + fourth) doesn't exist in chain1234


// The chain sequence of "chain23" will be "1234" instead of "23"!
// Indeed, the sequence "1234" does not contain the subsequence "14", so nothing is subtracted
// (but note that "1234" contains both the "1" and "4" subsequences)
chain23 = chain1234 - (first + fourth); // Noncompliant

chain23(); // will print "1234"!</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_compliant_solution">Compliant solution</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">MyDelegate chain23 = chain1234 - first - fourth; // Compliant - "1" is first removed, followed by "4"

chain23(); // will print "23"</code></pre>
</div>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Review this subtraction of a chain of delegates: it may not work as you expect.</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_30_jun_2015_161238_ann_campbell_wrote">on 30 Jun 2015, 16:12:38 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~tamas.vajk] I&#8217;ve used a mashup of code samples. Please double-check my work</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_1_jul_2015_072203_tamas_vajk_wrote">on 1 Jul 2015, 07:22:03 Tamas Vajk wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] Added a few more lines to the sample, but otherwise it looks good.</p>
</div>
<div class="paragraph">
<p>Note: delegate subtraction is not always a bug, so I&#8217;m not sure if we can apply the <em>bug</em> label.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_1_jul_2015_112815_ann_campbell_wrote">on 1 Jul 2015, 11:28:15 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>label updated [~tamas.vajk]</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_26_jul_2016_194847_ann_campbell_wrote">on 26 Jul 2016, 19:48:47 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~tamas.vajk] I think we need to work on this one.</p>
</div>
</div>
</div>
</div>