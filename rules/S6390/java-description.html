<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Most modern applications use threads to handle incoming requests or other
long-running tasks concurrently. In some cases, the number of concurrent threads
is limited to avoid system resource exhaustion due to too numerous actions
being run.</p>
</div>
<div class="paragraph">
<p>When an application uses user-controlled data as a parameter of a thread
suspension operation, a Denial of Service attack can be made possible.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>An attacker with the capability to insert an arbitrary duration into a thread
suspension operation could suspend the corresponding thread for a long time.
Depending on the application&#8217;s architecture and the thread handling logic, this
can lead to a complete Denial of Service of the application.</p>
</div>
<div class="paragraph">
<p>Indeed, if the number of threads, either created by the application or allocated
by a web server, is limited, the attacker will be able to suspend all of them at
the same time. Without any remaining thread to handle actions, the application
might badly answer, be slowed down, or become completely irresponsive.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it_in_java_lang_package">How to fix it in Java Lang Package</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="paragraph">
<p>This code is vulnerable to a Denial of Service because it sets a thread&#8217;s
suspension time from user input without prior validation or sanitation.</p>
</div>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">protected void doGet(HttpServletRequest req, HttpServletResponse resp) {
  Long time = Long.parseLong(req.getParameter("time"));
  try {
    Thread.sleep(time); // Noncompliant
  } catch (InterruptedException e) {
    resp.sendError(500);
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">protected void doGet(HttpServletRequest req, HttpServletResponse resp) {
  Long time = Long.parseLong(req.getParameter("time"));
  try {
    Thread.sleep(Math.min(time, 1000));
  } catch (InterruptedException e) {
    resp.sendError(500);
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_how_does_this_work">How does this work?</h3>
<div class="paragraph">
<p>In most cases, it is discouraged to define a thread suspension time from
user-input.</p>
</div>
<div class="paragraph">
<p>If really necessary, the application should ensure that the provided suspension
time is below a safe limit. Such a limit should be evaluated and set to the lowest
possible time that ensures the application&#8217;s operation and restricts denial of service
attacks.</p>
</div>
<div class="paragraph">
<p>The example compliant code uses the <code>Math.min</code> function to ensure the suspension
duration is below the limit of one second.</p>
</div>
<div class="paragraph">
<p>Note that even when the suspension time is limited, an attacker who submits
numerous requests at high speed can still manage always to consume all available
threads.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_standards">Standards</h3>
<div class="ulist">
<ul>
<li>
<p>OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a></p>
</li>
<li>
<p>OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/400">CWE-400 - Uncontrolled Resource Consumption</a></p>
</li>
<li>
<p>STIG Viewer - <a href="https://stigviewer.com/stigs/application_security_and_development/2024-12-06/finding/V-222667">Application Security and Development: V-222667</a> - Protections against DoS attacks must be implemented.</p>
</li>
<li>
<p>STIG Viewer - <a href="https://stigviewer.com/stigs/application_security_and_development/2024-12-06/finding/V-222609">Application Security and Development: V-222609</a> - The application must not be subject to input handling vulnerabilities.</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Change this code to prevent user-controlled data from being used as a thread suspension duration.</p>
</div>
</div>
</div>
</div>