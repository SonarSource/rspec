<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>java.util.Collection</code> type and its subtypes provide methods to access and modify collections such as <code>Collection.remove(Object o)</code> and <code>Collection.contains(Object o)</code>.
Some of these methods accept arguments of type <code>java.lang.Object</code> and will compare said argument with objects already in the collection.</p>
</div>
<div class="paragraph">
<p>If the actual type of the argument is unrelated to the type of object contained in the collection, these methods will always return <code>false</code>, <code>null</code>, or <code>-1</code>.
This behavior is most likely unintended and can be indicative of a design issue.</p>
</div>
<div class="paragraph">
<p>This rule raises an issue when the type of the argument provided to one of the following methods is unrelated to the type used for the collection declaration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Collection.remove(Object o)</code></p>
</li>
<li>
<p><code>Collection.removeAll(Collection&lt;?&gt;)</code></p>
</li>
<li>
<p><code>Collection.contains(Object o)</code></p>
</li>
<li>
<p><code>List.indexOf(Object o)</code></p>
</li>
<li>
<p><code>List.lastIndexOf(Object o)</code></p>
</li>
<li>
<p><code>Map.containsKey(Object key)</code></p>
</li>
<li>
<p><code>Map.containsValue(Object value)</code></p>
</li>
<li>
<p><code>Map.get(Object key)</code></p>
</li>
<li>
<p><code>Map.getOrDefault(Object key, V defaultValue)</code></p>
</li>
<li>
<p><code>Map.remove(Object key)</code></p>
</li>
<li>
<p><code>Map.remove(Object key, Object value)</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ask yourself what the purpose of this method call is.
Check whether the provided argument and collection are correct in this context and for the desired purpose.
Remove unnecessary calls and otherwise provide an argument of which the type is compatible with the list content&#8217;s type.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">void removeFromMap(Map&lt;Integer, Object&gt; map, String strKey) {
  map.remove(strKey); // Noncompliant, this call will remove nothing and always return 'null' because 'map' is handling only Integer keys and String cannot be cast to Integer.
}

void listContains(List&lt;String&gt; list, Integer integer) {
  if (list.contains(integer)) { // Noncompliant; always false as the list only contains Strings, not integers.
    // ...
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">void removeFromMap(Map&lt;Integer, Object&gt; map, String strKey) {
  map.remove(Integer.parseInt(strKey)); // Compliant, strKey is parsed into an Integer before trying to remove it from the map.
}

void listContains(List&lt;String&gt; list, Integer integer) {
  if (list.contains(integer.toString())) { // Compliant, 'integer' is converted to a String before checking if the list contains it.
    // ...
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://wiki.sei.cmu.edu/confluence/x/uDdGBQ">CERT, EXP04-J.</a> - Do not pass arguments to certain Java Collections Framework methods that are a different type than the collection parameter type</p>
</li>
<li>
<p><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Collection.html">Java SE 17 &amp; JDK 17</a> - Collection interface</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>A "[class]&lt;[type]&gt;" cannot contain a "[ytype]".</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_21_nov_2024_164800_erwan_serandour_wrote">on 21 Nov 2024, 16:48:00 Erwan Serandour wrote:</h3>
<div class="paragraph">
<p>[test-code-support-investigation-for-java] Good candidate to move to 'All'. Custom implementation of collections is not the common case, I was not able to reproduce the other FPs.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_21_nov_2024_164800_alban_auzeill_wrote">on 21 Nov 2024, 16:48:00 Alban Auzeill wrote:</h3>
<div class="paragraph">
<p>[test-code-support-investigation-for-java] Decision for scope: Keep 'Main'. FP on custom implementation of collections</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_5_feb_2015_174414_michael_gumowski_wrote">on 5 Feb 2015, 17:44:14 Michael Gumowski wrote:</h3>
<div class="paragraph">
<p>As I am currently encountering difficulties implementing the rule, I think that expressly mentioning the names of the variables in the issue message does not worth the effort.</p>
</div>
<div class="paragraph">
<p>Indeed, gathering the names of the variables to build a the proposed message imply several problems:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It is costly (and complex) in terms of operations to gather them, and does not provides a lot of information (the issue is already detected on the line, it should not be hard to locate the issue);</p>
</li>
<li>
<p>Variables are not always present in expressions manipulating these methods, implying that multiple messages are possible (increasing complexity of the rule as well). As shown in the following code:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>List&lt;String&gt; getList() {
  return new ArrayList&lt;String&gt;();
}

Integer getIntegerValue() {
  return Integer.valueOf(1);
}

void myMethod() {
  if (getList().contains(getIntegerValue())) {  // Noncompliant. Always false.  &lt;&lt;-- What would be the message
    getList().remove(getIntegerValue()); // Noncompliant. list.add(iger) doesn't compile, so this will always return false  &lt;&lt;-- Same problem
  }
}</pre>
</div>
</div>
<div class="paragraph">
<p>I would like to change the message to the following proposition, which I think is much simpler without loosing its pertinence:</p>
</div>
<div class="paragraph">
<p><em><em>_{code}"[class]&lt;[type]&gt;" will not contain any "[ytype]"{code}</em>_</em></p>
</div>
<div class="paragraph">
<p>For the previous examples we would then have the syme following message :</p>
</div>
<div class="paragraph">
<p><em><em>_"List&lt;String&gt;" will not contain any "Integer"</em>_</em></p>
</div>
</div>
<div class="sect2">
<h3 id="_on_5_feb_2015_184055_ann_campbell_wrote">on 5 Feb 2015, 18:40:55 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~michael.gumowski] how about</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A "[class]&lt;[type]&gt;" cannot contain a "[ytype]".</p>
</li>
<li>
<p>You cannot add a "[ytype]" to a "[class]&lt;[type]&gt;".</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_on_6_feb_2015_074326_michael_gumowski_wrote">on 6 Feb 2015, 07:43:26 Michael Gumowski wrote:</h3>
<div class="paragraph">
<p>I&#8217;ll take your first proposition if it&#8217;s ok for you!</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_16_nov_2018_200203_jens_bannmann_wrote">on 16 Nov 2018, 20:02:03 Jens Bannmann wrote:</h3>
<div class="paragraph">
<p>The first paragraph of the rule description ends in an incomplete sentence, and it is redundant with the second and third paragraphs. Is it a leftover from revising it, or is there some kind of rendering error here in Jira?</p>
</div>
<div class="paragraph">
<p>____A couple Collection methods can be called with arguments of an incorrect type, but doing so is pointless and likely the result of using the wrong argument. This rule will raise an issue</p>
</div>
<div class="paragraph">
<p>The java.util.Collection API is having methods accepting Object as parameter such as Collection.remove(Object o) or Collection.contains(Object o). When the effective type of the object provided to these methods is not consistent with the type declared on the Collection instantiation, those methods will always return false or null. This is most likely unintended and hide a design problem.</p>
</div>
<div class="paragraph">
<p>This rule raises an issue when the type of the argument of the following APIs is unrelated to the type used for the Collection declaration:</p>
</div>
<div class="paragraph">
<p>(&#8230;&#8203;)<em>__</em></p>
</div>
</div>
<div class="sect2">
<h3 id="_on_16_nov_2018_220959_alexandre_gigleux_wrote">on 16 Nov 2018, 22:09:59 Alexandre Gigleux wrote:</h3>
<div class="paragraph">
<p>\[~bannmann] Fixed</p>
</div>
</div>
</div>
</div>