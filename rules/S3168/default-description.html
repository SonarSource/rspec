<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>An <a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/async"><code>async</code></a> method with a <code>void</code> return type does not follow the <a href="https://learn.microsoft.com/en-us/dotnet/csharp/asynchronous-programming/task-asynchronous-programming-model">task asynchronous programming (TAP)</a> model since the return type should be <a href="https://learn.microsoft.com/en-us/dotnet/api/system.threading.tasks.task"><code>Task</code></a> or <a href="https://learn.microsoft.com/en-us/dotnet/api/system.threading.tasks.task-1"><code>Task&lt;TResult&gt;</code></a></p>
</div>
<div class="paragraph">
<p>Doing so prevents control over the <a href="https://learn.microsoft.com/en-us/dotnet/csharp/asynchronous-programming/async-scenarios">asynchronous execution</a>, such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>waiting for the execution to complete</p>
</li>
<li>
<p>catching any exception that might occur during execution</p>
</li>
<li>
<p>testing execution behavior</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_exceptions">Exceptions</h3>
<div class="ulist">
<ul>
<li>
<p>Methods implementing an interface</p>
</li>
<li>
<p>Methods overriding a base class method</p>
</li>
<li>
<p>Virtual methods</p>
</li>
<li>
<p>Methods with the <a href="https://learn.microsoft.com/en-us/dotnet/api/system.eventhandler"><code>EventHandler</code></a> delegate signature</p>
<div class="paragraph">
<p>Using <code>void</code> for <code>EventHandler</code> is compliant with the TAP model.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">public async void button1_Click(object sender, EventArgs e)
{
  await DoSomethingAsync();
}</code></pre>
</div>
</div>
</li>
<li>
<p>Methods name matching <code>On[A-Z]\w*</code> pattern</p>
<div class="paragraph">
<p>Some frameworks may not use the same <code>EventHandler</code> method signature.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">public async void OnClick(EventContext data)
{
  await DoSomethingAsync();
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Update the return type of the method from <code>void</code> to <code>Task</code>.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">private async void ThrowExceptionAsync() // Noncompliant: async method return type is 'void'
{
  throw new InvalidOperationException();
}

public void Method()
{
  try
  {
    ThrowExceptionAsync();
  }
  catch (Exception)
  {
    // The exception is never caught here
    throw;
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">private async Task ThrowExceptionAsync() // Compliant: async method return type is 'Task'
{
  throw new InvalidOperationException();
}

public async Task Method()
{
  try
  {
    await ThrowExceptionAsync();
  }
  catch (Exception)
  {
    // The exception is caught here
    throw;
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Microsoft Learn - <a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/async"><code>async</code> (C# Reference)</a></p>
</li>
<li>
<p>Microsoft Learn - <a href="https://learn.microsoft.com/en-us/dotnet/csharp/asynchronous-programming/async-scenarios">Asynchronous programming</a></p>
</li>
<li>
<p>Microsoft Learn - <a href="https://learn.microsoft.com/en-us/dotnet/csharp/asynchronous-programming/task-asynchronous-programming-model">Task asynchronous programming model</a></p>
</li>
<li>
<p>Microsoft Learn - <a href="https://learn.microsoft.com/en-us/dotnet/api/system.threading.tasks.task"><code>Task</code> Class</a></p>
</li>
<li>
<p>Microsoft Learn - <a href="https://learn.microsoft.com/en-us/dotnet/api/system.threading.tasks.task-1"><code>Task&lt;TResult&gt;</code> Class</a></p>
</li>
<li>
<p>Microsoft Learn - <a href="https://learn.microsoft.com/en-us/dotnet/api/system.eventhandler"><code>EventHandler</code> Delegate</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Return "Task" instead.</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_30_jun_2015_133613_ann_campbell_wrote">on 30 Jun 2015, 13:36:13 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~tamas.vajk] I don&#8217;t understand the code snippets. The <code>async Task</code> method doesn&#8217;t return anything.</p>
</div>
<div class="paragraph">
<p>Also, could you morph the Noncompliant Example into a Compliant Solution, please?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_1_jul_2015_071048_tamas_vajk_wrote">on 1 Jul 2015, 07:10:48 Tamas Vajk wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] I added the compliant solution.</p>
</div>
<div class="paragraph">
<p>A method with <code>async</code> keyword returning a <code>Task</code> is like a non <code>async</code> method with <code>void</code> return type. Similarly in an <code>async Task&lt;int&gt;</code> method we can return a simple <code>int</code>. (https://msdn.microsoft.com/en-us/library/hh524395.aspx)</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_1_jul_2015_113153_ann_campbell_wrote">on 1 Jul 2015, 11:31:53 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~tamas.vajk] that makes me wonder if we should generalize this rule to catch <em>any</em> <code>async</code> method that does not return a <code>Task</code>&#8230;&#8203;?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_1_jul_2015_114954_tamas_vajk_wrote">on 1 Jul 2015, 11:49:54 Tamas Vajk wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] That&#8217;s a compiler error (CS1983, <em>The return type of async must be void, Task or Task&lt;T&gt;</em>).</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_1_jul_2015_115939_ann_campbell_wrote">on 1 Jul 2015, 11:59:39 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>Okay, thanks [~tamas.vajk]</p>
</div>
</div>
</div>
</div>