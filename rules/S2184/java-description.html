<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When arithmetic is performed on integers, the result will always be an integer. You can assign that result to a <code>long</code>, <code>double</code>, or <code>float</code> with automatic type conversion, but having started as an <code>int</code> or <code>long</code>, the result will likely not be what you expect.</p>
</div>
<div class="paragraph">
<p>For instance, if the result of <code>int</code> division is assigned to a floating-point variable, precision will have been lost before the assignment. Likewise, if the result of multiplication is assigned to a <code>long</code>, it may have already overflowed before the assignment.</p>
</div>
<div class="paragraph">
<p>In either case, the result will not be what was expected. Instead, at least one operand should be cast or promoted to the final type before the operation takes place.</p>
</div>
<div class="sect2">
<h3 id="_noncompliant_code_example">Noncompliant code example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">float twoThirds = 2/3; // Noncompliant; int division. Yields 0.0
long millisInYear = 1_000*3_600*24*365; // Noncompliant; int multiplication. Yields 1471228928
long bigNum = Integer.MAX_VALUE + 2; // Noncompliant. Yields -2147483647
long bigNegNum =  Integer.MIN_VALUE-1; //Noncompliant, gives a positive result instead of a negative one.
Date myDate = new Date(seconds * 1_000); //Noncompliant, won't produce the expected result if seconds &gt; 2_147_483
...
public long compute(int factor){
  return factor * 10_000;  //Noncompliant, won't produce the expected result if factor &gt; 214_748
}

public float compute2(long factor){
  return factor / 123;  //Noncompliant, will be rounded to closest long integer
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_compliant_solution">Compliant solution</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">float twoThirds = 2f/3; // 2 promoted to float. Yields 0.6666667
long millisInYear = 1_000L*3_600*24*365; // 1000 promoted to long. Yields 31_536_000_000
long bigNum = Integer.MAX_VALUE + 2L; // 2 promoted to long. Yields 2_147_483_649
long bigNegNum =  Integer.MIN_VALUE-1L; // Yields -2_147_483_649
Date myDate = new Date(seconds * 1_000L);
...
public long compute(int factor){
  return factor * 10_000L;
}

public float compute2(long factor){
  return factor / 123f;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">float twoThirds = (float)2/3; // 2 cast to float
long millisInYear = (long)1_000*3_600*24*365; // 1_000 cast to long
long bigNum = (long)Integer.MAX_VALUE + 2;
long bigNegNum =  (long)Integer.MIN_VALUE-1;
Date myDate = new Date((long)seconds * 1_000);
...
public long compute(long factor){
  return factor * 10_000;
}

public float compute2(float factor){
  return factor / 123;
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_standards">Standards</h3>
<div class="ulist">
<ul>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/190">CWE-190 - Integer Overflow or Wraparound</a></p>
</li>
<li>
<p><a href="https://wiki.sei.cmu.edu/confluence/x/AjdGBQ">CERT, NUM50-J.</a> - Convert integers to floating point for floating-point operations</p>
</li>
<li>
<p><a href="https://wiki.sei.cmu.edu/confluence/x/I9cxBQ">CERT, INT18-C.</a> - Evaluate integer expressions in a larger size before comparing or assigning to that size</p>
</li>
<li>
<p>STIG Viewer - <a href="https://stigviewer.com/stigs/application_security_and_development/2024-12-06/finding/V-222612">Application Security and Development: V-222612</a> - The application must not be vulnerable to overflow attacks.</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Cast one of the operands of this (division|multiplication) operation to a "xxx".</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_21_nov_2024_164800_alban_auzeill_wrote">on 21 Nov 2024, 16:48:00 Alban Auzeill wrote:</h3>
<div class="paragraph">
<p>[test-code-support-investigation-for-java] Decision for scope: Keep 'Main'. FP because of assertEquals supporting (long,long) instead of (int,int).</p>
</div>
</div>
<div class="sect2">
<h3 id="_relates_to_s848">relates to: <a data-rspec-id="S848" class="rspec-auto-link">S848</a></h3>

</div>
<div class="sect2">
<h3 id="_on_22_oct_2014_185833_nicolas_peru_wrote">on 22 Oct 2014, 18:58:33 Nicolas Peru wrote:</h3>
<div class="paragraph">
<p>Seems to me that the first phrase and the first non compliant code example contradicts.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_22_oct_2014_190709_ann_campbell_wrote">on 22 Oct 2014, 19:07:09 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~nicolas.peru] twoThirds ends up with a value of 0.0, i.e. 0 cast to a float. How would you suggest I clarify?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_22_oct_2014_192842_nicolas_peru_wrote">on 22 Oct 2014, 19:28:42 Nicolas Peru wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2]I understand the 1st phrase as "Everything goes fine if you multiply /divide int and assign them to float/long" whereas you explain afterward that there are issues.</p>
</div>
<div class="paragraph">
<p>The 2nd phrase of the 1st ยง should be : You can assign this result to a long, double or float with automatic type conversion however if the result of int division is&#8230;&#8203;</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_22_oct_2014_193533_ann_campbell_wrote">on 22 Oct 2014, 19:35:33 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>I get it now, [~nicolas.peru]. See what you think.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_26_nov_2014_202038_freddy_mallet_wrote">on 26 Nov 2014, 20:20:38 Freddy Mallet wrote:</h3>
<div class="paragraph">
<p>Just to be sure [~ann.campbell.2] and [~nicolas.peru], Findbugs rule ICAST_INT_2_LONG_AS_INSTANT, also checks method calls. Ex:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>new Date(seconds * 1000)  //non compliant if seconds is an int value (because the Date constructor accepts a long value and so we might get an unexpected behavior</pre>
</div>
</div>
<div class="paragraph">
<p>Is it the case with the current implementation ?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_27_nov_2014_065109_nicolas_peru_wrote">on 27 Nov 2014, 06:51:09 Nicolas Peru wrote:</h3>
<div class="paragraph">
<p>No, current implementation only check for assignement and variable initializers. I reopen the ticket to cover those cases.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_27_nov_2014_075002_freddy_mallet_wrote">on 27 Nov 2014, 07:50:02 Freddy Mallet wrote:</h3>
<div class="paragraph">
<p>The return statement should also be covered. I&#8217;m going to update the code snippets.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_30_sep_2016_162215_jean_christophe_collet_wrote">on 30 Sep 2016, 16:22:15 Jean-Christophe Collet wrote:</h3>
<div class="paragraph">
<p>Right now, the way it is worded, this rule doesn&#8217;t address long integers. Assigning a <code>long</code> expression to a <code>float</code> or <code>double</code> has pretty much the same issues as <code>int</code>.</p>
</div>
<div class="paragraph">
<p>Current implementation of Java scanner doesn&#8217;t flag something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>float f = 4l / 3;</pre>
</div>
</div>
<div class="paragraph">
<p>I think we should cover this as well.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_11_dec_2016_175054_nicolai_ommer_wrote">on 11 Dec 2016, 17:50:54 Nicolai Ommer wrote:</h3>
<div class="paragraph">
<p>I recently found a statement where this rule should have triggered in my opinion, but hasn&#8217;t:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>double dt2 = (1 / 2) * dt * dt * sigma * sigma; // dt, sigma are double</pre>
</div>
</div>
<div class="paragraph">
<p>It turned out that as soon as there is double value in the statement, the rule is not triggered, i.e.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>double a = 1 / 2 * 5.0;</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_on_12_dec_2016_145800_ann_campbell_wrote">on 12 Dec 2016, 14:58:00 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>Hi Nicolai,</p>
</div>
<div class="paragraph">
<p>We greatly appreciate such feedback, but this isn&#8217;t the proper venue. Please raise this on the <a href="https://groups.google.com/forum/?pli=1#!forum/sonarqube">SonarQube Google Group</a>, which is monitored by the plugin developers. And when you do, make sure to mention which language you&#8217;re talking about.</p>
</div>
<div class="paragraph">
<p>Thx!</p>
</div>
</div>
</div>
</div>