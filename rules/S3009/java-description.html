<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It&#8217;s slightly more efficient to append single characters to <code>StringBuffer</code> and <code>StringBuilder</code> instances as <code>char</code>s, than as <code>String</code>s.</p>
</div>
<div class="sect2">
<h3 id="_noncompliant_code_example">Noncompliant code example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">String f(char c) {
  StringBuilder sb = new StringBuilder();
  sb.append(Character.toString(c)); // Noncompliant
  return sb.toString();
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_compliant_solution">Compliant solution</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">String f(char c) {
  StringBuilder sb = new StringBuilder();
  sb.append(c); // Compliant
  return sb.toString();
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_exceptions">Exceptions</h3>
<div class="paragraph">
<p>The rule doesn&#8217;t apply to constants, because the difference in performance between appending a constant <code>char</code> and a constant <code>String</code> is very small.</p>
</div>
</div>
<div class="sect2">
<h3 id="_benchmarks">Benchmarks</h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Runtime</th>
<th class="tableblock halign-left valign-top">Average time</th>
<th class="tableblock halign-left valign-top">Error margin</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">appendConstantChar</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Temurin 21</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">27.05 ns/op</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">±13.85 ns/op</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">appendConstantString</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Temurin 21</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">27.03 ns/op</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">±6.40 ns/op</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">appendVariableChar</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Temurin 21</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">33.81 ns/op</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">±9.64 ns/op</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">appendVariableString</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Temurin 21</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">51.08 ns/op</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">±11.40 ns/op</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Benchmarking code</strong></p>
</div>
<div class="paragraph">
<p>The results were generated by running the following snippet with <a href="https://github.com/openjdk/jmh">JMH</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@State(Scope.Thread)
@BenchmarkMode({Mode.AverageTime})
@OutputTimeUnit(TimeUnit.NANOSECONDS)
public class S3009 {
  StringBuilder builder;
  String stringVar;
  char charVar;
  Random random;

  @Setup(Level.Invocation)
  public  void setupInvocation() {
    charVar = (char) random.nextInt(Character.MAX_VALUE);
    stringVar = String.valueOf(charVar);
    builder = new StringBuilder();
  }

  @Setup(Level.Iteration)
  public void setup() {
    random = new Random();
  }

  @Benchmark
  public void appendConstantChar(Blackhole blackhole) {
    builder.append('a');
    builder.append('a');
    builder.append('a');
    builder.append('a');
    builder.append('a');
    blackhole.consume(builder);
  }

  @Benchmark
  public void appendConstantString(Blackhole blackhole) {
    builder.append("a");
    builder.append("a");
    builder.append("a");
    builder.append("a");
    builder.append("a");
    blackhole.consume(builder);
  }

  @Benchmark
  public void appendVariableString(Blackhole blackhole) {
    builder.append(stringVar);
    builder.append(stringVar);
    builder.append(stringVar);
    builder.append(stringVar);
    builder.append(stringVar);
    blackhole.consume(builder);
  }

  @Benchmark
  public void appendVariableChar(Blackhole blackhole) {
    builder.append(charVar);
    builder.append(charVar);
    builder.append(charVar);
    builder.append(charVar);
    builder.append(charVar);
    blackhole.consume(builder);
  }
}</code></pre>
</div>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Use single quotes around 'x'.</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_16_jun_2015_170328_nicolas_peru_wrote">on 16 Jun 2015, 17:03:28 Nicolas Peru wrote:</h3>
<div class="paragraph">
<p>I really doubt this one should be activated by default. This is really something that you should activate either, to be anal on your style or because you have a perf critical application that actually cares about this, so any way I would not include it in default profile.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_16_jun_2015_171631_ann_campbell_wrote">on 16 Jun 2015, 17:16:31 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>done [~nicolas.peru]</p>
</div>
</div>
</div>
</div>