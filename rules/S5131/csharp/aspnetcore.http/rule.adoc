include::../../summary.adoc[]

== Why is this an issue?

include::../../rationale.adoc[]

include::../../impact.adoc[]

include::../../threats.adoc[]

== How to fix it?

include::../../common/fix/intro.adoc[]

include::../../common/fix/data_encoding.adoc[]

To prevent Cross-Site Scripting from happening in this situation, 
use the HTML, JavaScript and URL encoders. +
They are accessible via the `System.Text.Encodings.Web` namespace.

[source,csharp]
----
var builder = WebApplication.CreateBuilder(args);
var app = builder.Build();

app.MapGet("/send/{thirdPartyData}", 
    (string thirdPartyData) => $"HTTP Response: {thirdPartyData}");         # Noncompliant

app.MapGet("/",
    (HttpContext context) => {
        var thirdPartyData = context.Request.QueryString["thirdPartyData"];
        context.Response.WriteAsync($"HTTP Response: {thirdPartyData}.");   # Noncompliant
    });

app.Run();
----

[source,csharp]
----
using System.Text.Encodings.Web;

var builder = WebApplication.CreateBuilder(args);
var app = builder.Build();
var encoder = HtmlEncoder.Default;

app.MapGet("/send/{thirdPartyData}", 
    (string thirdPartyData) => $"HTTP Response: {encoder.Encode(thirdPartyData)}");

app.MapGet("/",
    (HttpContext context) => {
        var thirdPartyData = context.Request.QueryString["thirdPartyData"];
        var thirdPartyData = encoder.Encode(thirdPartyData);
        context.Response.WriteAsync($"HTTP Response: {thirdPartyData}.");
    });

app.Run();
----

=== Pitfalls

include::../../common/pitfalls/deny-lists.adoc[]

If the application needs to handle rich content, the preferred option is to use
Markdown in conjunction with a parser that removes embedded HTML.

By removing embedded HTML and leaving the generation of HTML to internal
code, validation and sanitization help prevent third-party tampering.

=== Going the extra mile

include::../../common/extra-mile/csp.adoc[]

:blazor-csps: https://docs.microsoft.com/en-us/aspnet/core/blazor/security/content-security-policy?view=aspnetcore-6.0
:aspdotnet-core-middleware: https://docs.microsoft.com/en-us/aspnet/core/fundamentals/middleware/?view=aspnetcore-6.0
:csp-nonces-owin: https://vcsjones.dev/content-security-policy-nonces-in-asp-net-and-owin/

Implementing content security policies differs from one architecture to another.

When client-side code is processed by Blazor::
* {blazor-csps}[the library supports it by default].
When CSP requirements are low::
* {aspdotnet-core-middleware}[the ASP.Net Core Middleware provides header control].
When code requirements enforce optimal CSP, including content security policies nonces::
* The Open Web Interface for . NET (OWIN) {csp-nonces-owin}[can be used for a simple implementation].


include::../../common/resources/docs.adoc[]
* https://docs.microsoft.com/en-us/aspnet/core/security/cross-site-scripting?view=aspnetcore-6.0[Microsoft, Prevent Cross-Site Scripting (XSS) in ASP.NET Core]

include::../../common/resources/articles.adoc[]
* https://vcsjones.dev/content-security-policy-nonces-in-asp-net-and-owin/[vcsjones.dev, Content-Security-Policy Nonces in ASP.NET and OWIN]
* http://owin.org/[owin.org, OWIN - Open Web Interface for .NET]

include::../../common/resources/presentations.adoc[]

include::../../common/resources/standards.adoc[]

ifdef::env-github,rspecator-view[]

'''
== Implementation Specification
(visible only on this page)

include::../../message.adoc[]

include::../../highlighting.adoc[]

'''
== Comments And Links
(visible only on this page)

include::../../comments-and-links.adoc[]
endif::env-github,rspecator-view[]
