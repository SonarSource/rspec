include::../../summary.adoc[]

== Why is this an issue?

include::../../rationale.adoc[]

include::../../impact.adoc[]

include::../../threats.adoc[]

== How to fix it?

include::../../common/fix/intro.adoc[]

include::../../common/fix/data_encoding.adoc[]

==== In a Thymeleaf template

In Thymeleaf templates, contexts that are vulnerable to XSS are easy to find
thanks to the engine.

For HTML encoding, Javascript encoding, and CSS encoding, the documentation
allows the use of `unescaped text`, in only two different ways:

* with the attribute `th:utext`.
* with the inline expression `[(...)]`.

If you insert third party data into the pages, the regular attributes are
preferable:

* The attribute `th:text`.
* The inline expression `[[...]]`.

They ensure that the correct encoding is used, regardless of the context in
which the third-party data is inserted. Thus, it is not necessary to specify a
particular encoder.

[source,html]
----
<body>
    <p th:utext="|Hello, ${thirdPartyData}!|" /> <!-- Noncompliant -->
    <p>Hello, [(${thirdPartyData})]!</p>         <!-- Noncompliant -->
</body>
----

[source,html]
----
<body>
    <p th:text="|Hello, ${thirdPartyData}!|" />
    <p>Hello, [[${thirdPartyData}]]!</p>
</body>
----


=== Pitfalls

include::../../common/pitfalls/deny-lists.adoc[]

=== Going the extra mile

include::../../common/extra-mile/csp.adoc[]

:csp-baeldung: https://www.baeldung.com/thymeleaf-in-spring-mvc
:csp-blog:     https://techblog.bozho.net/content-security-policy-nonce-with-spring-security/

If the codebase uses Spring, the application can easily benefit from CSP thanks
to a {csp-baeldung}[WebSecurityConfigurerAdapter bean]. +
To take full advantage of CSP, cryptographic primitives (nonces) are likely to
be used. You can read more about this {csp-blog}[here].

include::../../common/resources/docs.adoc[]

include::../../common/resources/articles.adoc[]

* {csp-baeldung}[Baeldung.com, Prevent Cross-Site Scripting (XSS) in a Spring Application]
* {csp-blog}[techblog.bozho.net, Content-Security-Policy Nonce with Spring Security]

include::../../common/resources/presentations.adoc[]

include::../../common/resources/standards.adoc[]


ifdef::env-github,rspecator-view[]

'''
== Implementation Specification
(visible only on this page)

include::../../message.adoc[]

include::../../highlighting.adoc[]

'''
== Comments And Links
(visible only on this page)

include::../../comments-and-links.adoc[]
endif::env-github,rspecator-view[]

