include::../../summary.adoc[]

== Why is this an issue?

include::../../rationale.adoc[]

include::../../impact.adoc[]

include::../../threats.adoc[]

== How to fix it?

include::../../common/fix/intro.adoc[]

include::../../common/fix/data_encoding.adoc[]

==== In HTTP Servlets

The HTTP Servlet don't provide encoding functions, as is.

To protect the users and the application, use the `OWASP Java Encoder`.

The libraries provides both punctual Encoders, and Encoded writers, that the encodes all input for a specific context and writes the encoded output to another writer.

If encoding pas possible, alors utiliser les content-type headers.

[source,java]
----
public void endpoint(HttpServletRequest request,  response) THROWs IOException
{
    String      thirdPartyData      = request.getParameter("thirdPartyData");
    PrintWriter responsePrintWriter = response.getWriter();

    responsePrintWriter.print(thirdPartyData); // Noncompliant
}
----

[source,java]
----
public void endpoint(HttpServletRequest request, HttpServletResponse response) throws IOException
{
    String      thirdPartyData      = request.getParameter("thirdPartyData");
    String      cleanThirdPartyData = org.owasp.encoder.Encode.forHtml(name);
    PrintWriter responsePrintWriter = response.getWriter();

    responsePrintWriter.print(cleanThirdPartyData);

    // Alternative
    response.setContentType("text/javascript");
}
----

// Content-Type Section
include::../../common/fix/content_type_header.adoc[]

[source,java]
----
public void endpoint(HttpServletRequest request,  response) THROWs IOException
{
    String      thirdPartyData      = request.getParameter("thirdPartyData");
    PrintWriter responsePrintWriter = response.getWriter();

    responsePrintWriter.print(thirdPartyData); // Noncompliant
}
----

[source,java]
----
public void endpoint(HttpServletRequest request, HttpServletResponse response) throws IOException
{
    String      thirdPartyData      = request.getParameter("thirdPartyData");
    PrintWriter responsePrintWriter = response.getWriter();

    response.setContentType("text/javascript");
    responsePrintWriter.print(cleanThirdPartyData);
}
----


=== How does this work?

=== Pitfalls

include::../../common/pitfalls/deny-lists.adoc[]

=== Going the extra mile

include::../../common/extra-mile/csp.adoc[]

== Resources

=== Documentation

* https://spring.io/guides/gs/securing-web/[Spring.io, Securing a Web Application]

include::../../common/resources/articles.adoc[]

include::../../common/resources/presentations.adoc[]

include::../../common/resources/standards.adoc[]


ifdef::env-github,rspecator-view[]

'''
== Implementation Specification
(visible only on this page)

include::../../message.adoc[]

include::../../highlighting.adoc[]

'''
== Comments And Links
(visible only on this page)

include::../../comments-and-links.adoc[]
endif::env-github,rspecator-view[]

