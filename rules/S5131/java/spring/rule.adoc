include::../../summary.adoc[]

== Why is this an issue?

include::../../rationale.adoc[]

include::../../impact.adoc[]

include::../../threats.adoc[]

== How to fix it?

The following code is vulnerable to Cross-Site Scripting because it returns an HTML response that contains user input.

If you do not intend to send HTML code to the clients, the vulnerability can be resolved by telling them what data they are receiving. For example, you can use the `produces` property of the `GetMapping` annotation.

[cols="a,a"]
|===
|
[source,java]
----
@RestController
public class ApiController
{
    @GetMapping(value = "/endpoint")
    public String endpoint(@RequestParam("thirdPartyData") thirdPartyData)
    {
        return thirdPartyData; // Noncompliant
    }
}
----
|
[source,java]
----
@RestController
public class ApiController
{
    @GetMapping(value = "/endpoint", produces = "application/json")
    public String endpoint(@RequestParam("thirdPartyData") thirdPartyData)
    {
        return thirdPartyData;
    }
}
----
|===

=== How does this work?

In case the response consists of HTML code, it is highly recommended to use a template engine like https://www.thymeleaf.org/[Thymeleaf] to generate it.
A proper template engine does not only separate the view from the business logic and thus results in a more maintainable application.
It also automatically encodes variable output and thus drastically decreases the chance of introducing Cross-Site Scripting vulnerabilities.

If you do not intend to send HTML code to the clients, the vulnerability can be resolved by telling them what data they are receiving with the `content-type` HTTP header.
This tells the browser that the response does not contain HTML code and should not be parsed and interpreted as HTML.
Thus, the response is not vulnerable to reflected Cross-Site Scripting.

For example, setting the content-type to `text/plain` allows to safely reflect user input since browsers will not try to parse and execute the response.


=== Pitfalls

include::../../common/pitfalls/content-types.adoc[]

include::../../common/pitfalls/deny-lists.adoc[]

=== Going the extra mile

include::../../common/extra-mile/csp.adoc[]

:csp-baeldung: https://www.baeldung.com/thymeleaf-in-spring-mvc
:csp-blog:     https://techblog.bozho.net/content-security-policy-nonce-with-spring-security/

The application can easily benefit from CSP thanks to a
{csp-baeldung}[WebSecurityConfigurerAdapter bean]. +
To take full advantage of CSP, cryptographic primitives (nonces) are likely to
be used. You can read more about this {csp-blog}[here].

== Resources

include::../../common/resources/docs.adoc[]

include::../../common/resources/articles.adoc[]

* {csp-baeldung}[Baeldung.com, Prevent Cross-Site Scripting (XSS) in a Spring Application]
* {csp-blog}[techblog.bozho.net, Content-Security-Policy Nonce with Spring Security]
* https://www.baeldung.com/spring-security-csp

include::../../common/resources/presentations.adoc[]

include::../../common/resources/standards.adoc[]


ifdef::env-github,rspecator-view[]

'''
== Implementation Specification
(visible only on this page)

include::../../message.adoc[]

include::../../highlighting.adoc[]

'''
== Comments And Links
(visible only on this page)

include::../../comments-and-links.adoc[]
endif::env-github,rspecator-view[]

