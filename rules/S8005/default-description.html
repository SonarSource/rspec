<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This rule raises an issue when code processes responses from external systems without proper validation of status codes, response content, or expected data fields.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When integrating with external systems, responses can be unpredictable. Network issues, server errors, or changes in external APIs can result in unexpected response formats, missing data, or error conditions.</p>
</div>
<div class="paragraph">
<p>Processing unvalidated responses can lead to several problems:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Runtime exceptions</strong>: Attempting to deserialize malformed JSON or access missing fields throws exceptions that can crash your application</p>
</li>
<li>
<p><strong>Data corruption</strong>: Null or unexpected values might be stored in your system, leading to inconsistent data states</p>
</li>
<li>
<p><strong>Security vulnerabilities</strong>: Malicious or malformed responses could potentially exploit deserialization vulnerabilities</p>
</li>
<li>
<p><strong>Poor user experience</strong>: Unhandled errors result in cryptic error messages instead of meaningful feedback</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Proper validation acts as a defensive barrier, ensuring your code gracefully handles unexpected scenarios and maintains system stability.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>Without proper validation, applications become vulnerable to runtime exceptions, data corruption, and potential security exploits. Failed integrations can disrupt business processes and create poor user experiences with unclear error messages.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Always validate HTTP response status codes, check for response body content, and verify expected fields exist before accessing them. Use defensive programming techniques to handle edge cases gracefully.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-apex" data-lang="apex">HttpResponse response = http.send(request);
Map&lt;String, Object&gt; responseMap = (Map&lt;String, Object&gt;) JSON.deserializeUntyped(response.getBody()); // Noncompliant
String customerId = (String) responseMap.get('customerId'); // Noncompliant</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-apex" data-lang="apex">HttpResponse response = http.send(request);
if (response.getStatusCode() == 200 &amp;&amp; String.isNotBlank(response.getBody())) {
    Map&lt;String, Object&gt; responseMap = (Map&lt;String, Object&gt;) JSON.deserializeUntyped(response.getBody());
    if (responseMap.containsKey('customerId') &amp;&amp; responseMap.get('customerId') != null) {
        String customerId = (String) responseMap.get('customerId');
        // Process the validated data
    } else {
        // Handle missing customerId
    }
} else {
    // Handle error response
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Salesforce HTTP Classes - <a href="https://developer.salesforce.com/docs/atlas.en-us.apexref.meta/apexref/apex_classes_restful_http.htm">Official documentation for HTTP request and response handling in Apex</a></p>
</li>
<li>
<p>JSON Class Methods - <a href="https://developer.salesforce.com/docs/atlas.en-us.apexref.meta/apexref/apex_class_System_Json.htm">Documentation for JSON serialization and deserialization methods in Apex</a></p>
</li>
<li>
<p>Integration Best Practices - <a href="https://developer.salesforce.com/docs/atlas.en-us.integration_patterns_and_practices.meta/integration_patterns_and_practices/">Salesforce integration patterns and best practices guide</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_standards">Standards</h3>
<div class="ulist">
<ul>
<li>
<p>CWE-20: Improper Input Validation - <a href="https://cwe.mitre.org/data/definitions/20.html">Weakness related to insufficient validation of input data</a></p>
</li>
<li>
<p>CWE-754: Improper Check for Unusual or Exceptional Conditions - <a href="https://cwe.mitre.org/data/definitions/754.html">Weakness related to insufficient handling of exceptional conditions</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>