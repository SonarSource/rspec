<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This rule raises an issue when an SOSL query is used in a test method without calling <code>Test.setFixedSearchResults()</code> beforehand.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>SOSL (Salesforce Object Search Language) queries behave differently in test contexts compared to production environments. By default, any SOSL search executed within a test method returns empty results, regardless of the data that exists in the test database.</p>
</div>
<div class="paragraph">
<p>This behavior can lead to several problems:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Unpredictable test results</strong>: Tests may pass or fail inconsistently because they rely on empty search results rather than controlled test data.</p>
</li>
<li>
<p><strong>False test outcomes</strong>: A test might pass when it should fail, or fail when it should pass, because the SOSL query doesn&#8217;t return the expected data.</p>
</li>
<li>
<p><strong>Incomplete test coverage</strong>: The actual logic that processes SOSL results may not be properly tested if the queries always return empty results.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To ensure reliable and predictable test behavior, Salesforce provides the <code>Test.setFixedSearchResults()</code> method. This method allows you to specify exactly which record IDs should be returned by SOSL queries during test execution, giving you full control over the test scenario.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>Tests that rely on SOSL queries without proper setup may produce unreliable results, leading to false confidence in code quality. This can result in bugs being deployed to production that could have been caught with properly configured tests.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Call <code>Test.setFixedSearchResults()</code> before executing the SOSL query in your test method. Pass an array of record IDs that you want the SOSL query to return.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-apex" data-lang="apex">@isTest
static void testSOSLSearch() {
    List&lt;List&lt;SObject&gt;&gt; searchResults = [FIND 'test' IN ALL FIELDS RETURNING Account(Id, Name)]; // Noncompliant
    System.assertEquals(1, searchResults[0].size());
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-apex" data-lang="apex">@isTest
static void testSOSLSearch() {
    Account testAccount = new Account(Name = 'Test Account');
    insert testAccount;
    Test.setFixedSearchResults(new Id[]{testAccount.Id});
    List&lt;List&lt;SObject&gt;&gt; searchResults = [FIND 'test' IN ALL FIELDS RETURNING Account(Id, Name)];
    System.assertEquals(1, searchResults[0].size());
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Test.setFixedSearchResults Method - <a href="https://developer.salesforce.com/docs/atlas.en-us.apexref.meta/apexref/apex_methods_system_test.htm#apex_System_Test_setFixedSearchResults">Official Salesforce documentation for the Test.setFixedSearchResults method</a></p>
</li>
<li>
<p>Testing SOSL Queries - <a href="https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/apex_testing_SOSL.htm">Salesforce guide on testing SOSL queries in Apex</a></p>
</li>
<li>
<p>Apex Testing Best Practices - <a href="https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/apex_testing_best_practices.htm">Comprehensive guide to Apex testing best practices</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>