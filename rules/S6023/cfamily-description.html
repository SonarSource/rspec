<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>C&#43;&#43;17</code> introduces <code>std::optional&lt;T&gt;</code>, a template class that manages an optional contained value. By default, the container doesn&#8217;t contain any value. The contained value can be accessed through member functions like <code>value()</code>, <code>operator*()</code>, or <code>operator-&gt;()</code>. Before accessing the value, it is a good practice to check its presence using <code>has_value()</code> or <code>operator bool()</code>.</p>
</div>
<div class="paragraph">
<p><code>value_or(default_value)</code> member function returns the contained value if present or <code>default_value</code> otherwise. This rule flags patterns that could be simplified by a single call to <code>value_or(default_value)</code> instead of two steps logic:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>check presence, i.e., with <code>has_value</code></p>
</li>
<li>
<p>use <code>value()</code> if present, <code>default_value</code> otherwise</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_noncompliant_code_example">Noncompliant code example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">void fun(const std::optional&lt;std::string&gt; &amp;arg) {
  if (arg.has_value()) { // Noncompliant, the entire if statement can be simplified to a simpler statement using "value_or(default_value)"
    std::cout &lt;&lt; arg.value();
  } else {
    std::cout &lt;&lt; "magic";
  }

  // another way to check presence and access value
  std::cout &lt;&lt; (arg ? *arg : "magic"); // Noncompliant, replace the ternary operator by using "value_or(default_value)"
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">void moveFun(std::optional&lt;std::string&gt; arg) {
  if (arg.has_value()) { // Noncompliant, the entire if statement can be simplified to a simpler statement using "value_or(default_value)"
    sink(std::move(arg.value()));
  } else {
    sink("magic");
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_compliant_solution">Compliant solution</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">void fun(const std::optional&lt;std::string&gt; &amp;arg) {
  std::cout &lt;&lt; arg.value_or("magic"); // Compliant, neat and simple
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">void moveFun(std::optional&lt;std::string&gt; arg) {
  sink(std::move(arg).value_or("magic"));
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>C&#43;&#43; reference - <a href="https://en.cppreference.com/w/cpp/utility/optional/value_or">std::optional&lt;T&gt;::value_or</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Simplify this code by using "std::optional" member function "value_or".</p>
</div>
</div>
</div>
</div>