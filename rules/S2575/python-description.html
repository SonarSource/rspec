<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In cross-site scripting attacks, attackers insert attack scripts into your pages. Because no system is fool-proof, it may not be enough to screen the data that&#8217;s submitted to an application. You should also escape any previously-stored content sent to the user so that any malicious code that may have escaped your input screening is neutralized.</p>
</div>
<div class="paragraph">
<p>This rule checks values retrieved from a database or a parameter and passed to <code>HttpServletRequest.setAttribute()</code>, <code>HttpSession.setAttribute()</code>, <code>HttpServletResponse.sendError</code>, and to the <code>write</code> method of the <code>PrintWriter</code> returned from <code>HttpResponse.getWriter()</code>.</p>
</div>
<div class="sect2">
<h3 id="_noncompliant_code_example">Noncompliant code example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">public String getTaintedValue(Connection con, HttpServletRequest request) throws SQLException {

  PreparedStatement pstmt = null;
  String query = "select TAINTED_VALUE " +
                 "from TAINTED_VALUES where KEY=?"
  try {
    pstmt = con.prepareStatement(query);
    pstmt.setString(1, request.getParameter("key"));  // PreparedStatements escape their inputs, so this incoming value is okay
    ResultSet rs = pstmt.executeQuery();
    while (rs.next()) {
      request.setAttribute("taintedValue",rs.getString("TAINTED_VALUE"));  // Noncompliant; this value should be escaped before being sent back to the user.</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a></p>
</li>
<li>
<p>OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS)">Top 10 2017 Category A7 - Cross-Site Scripting (XSS)</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/79">CWE-79 - Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/80">CWE-80 - Improper Neutralization of Script-Related HTML Tags in a Web Page (Basic XSS)</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/352">CWE-352 - Cross-Site Request Forgery (CSRF)</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_5_feb_2015_200800_ann_campbell_wrote">on 5 Feb 2015, 20:08:00 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>In the WebGoat project, one of the exercises is to inject a script into a value that&#8217;s then stored in the database, and the point of the lesson is to escape outgoing values.</p>
</div>
<div class="paragraph">
<p>Also: https://www.owasp.org/index.php/XSS_%28Cross_Site_Scripting%29_Prevention_Cheat_Sheet#RULE_.231_-_HTML_Escape_Before_Inserting_Untrusted_Data_into_HTML_Element_Content</p>
</div>
<div class="paragraph">
<p>This rule may need a sort of whitelist parameter: i.e. ignore values that have been passed through x method.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_5_feb_2015_202209_ann_campbell_wrote">on 5 Feb 2015, 20:22:09 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>We may also need to narrow the scope of this some. Perhaps to values retrieved from external sources, e.g. file, database, etc&#8230;&#8203;?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_20_jul_2015_074030_ann_campbell_wrote">on 20 Jul 2015, 07:40:30 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>Tagged java-top by Ann</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_21_sep_2015_095721_ann_campbell_wrote">on 21 Sep 2015, 09:57:21 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~michael.gumowski] I&#8217;ve updated this rule mostly as discussed, but added another source of data to check: parameters</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_23_sep_2019_174318_alexandre_gigleux_wrote">on 23 Sep 2019, 17:43:18 Alexandre Gigleux wrote:</h3>
<div class="paragraph">
<p>This rule is corresponding to Stored XSS. I&#8217;m closing it for now as it will be covered by a more generic RSPEC similarly to what we did for Reflected XSS (<a data-rspec-id="S5131" class="rspec-auto-link">RSPEC-5131</a>).</p>
</div>
</div>
</div>
</div>