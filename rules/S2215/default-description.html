<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>sizeof</code> operator returns the size, in bytes, of its operand, which can be an expression or a type.</p>
</div>
<div class="paragraph">
<p>Function parameters with array types automatically decay to pointers, so it is hazardous to call the <code>sizeof</code> operator on such variables.</p>
</div>
<div class="paragraph">
<p>Moreover, calling the <code>sizeof</code> operator on a variable with pointer type is typically a mistake. Usually the intent was to get the size of the pointed-to value instead.</p>
</div>
<div class="sect2">
<h3 id="_noncompliant_code_example">Noncompliant code example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">void clear1(int array[]) {
  for (size_t i = 0; i &lt; sizeof(array) / sizeof(*array); i+=1) { // Noncompliant, type of array decays to int *, so sizeof(array) evaluates to sizeof(int *)
     array[i] = 0;
   }
}

void clear2(short *array, int count) {
  memset(array, sizeof(array) * count); // Noncompliant, sizeof(array) evaluates to the size of a pointer to short and not of a short
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/467">CWE-467 - Use of sizeof() on a Pointer Type</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_10_feb_2015_134804_samuel_mercier_wrote">on 10 Feb 2015, 13:48:04 Samuel Mercier wrote:</h3>
<div class="paragraph">
<p>\[~evgeny.mandrikov] I rewrote the rule to prevent usage of <code>sizeof</code> on a variable with pointer type</p>
</div>
<div class="paragraph">
<p>\[~ann.campbell.2] Could you verify?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_10_feb_2015_135558_ann_campbell_wrote">on 10 Feb 2015, 13:55:58 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>I&#8217;ve made some updates [~samuel.mercier] that you probably want to check. Since this is not a MISRA rule, then we should use the standard format for the title: "X should [not] y", rather than using "shall".</p>
</div>
<div class="paragraph">
<p>Also, I&#8217;m not wild about the message. I&#8217;d either go with "Remove this use of&#8230;&#8203;" or '"x" is a pointer'.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_13_feb_2015_084414_samuel_mercier_wrote">on 13 Feb 2015, 08:44:14 Samuel Mercier wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] ok for title. For the message, in past, we already had this discussion :) '"x" is a pointer' doesn&#8217;t say anything about neither the problem nor the resolution, so it should be avoided. I also don&#8217;t really like the "remove" form because there are really two cases covered by this rule:</p>
</div>
<div class="paragraph">
<p>1) sizeof is used on a function parameter with type array. in that case sizeof should effectively be removed and an additional size argument must be provided</p>
</div>
<div class="paragraph">
<p>2) sizeof is probably badly used on a pointer, so there is probably a missing * : sizeof(p) &#8594; sizeof(*p)</p>
</div>
<div class="paragraph">
<p>so among the three I would stick with the current one.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_13_feb_2015_122036_ann_campbell_wrote">on 13 Feb 2015, 12:20:36 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>Okay [~samuel.mercier]</p>
</div>
</div>
</div>
</div>