<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This rule raises an issue when <code>serializer:</code> is used with collections or <code>each_serializer:</code> is used with single objects in Rails JSON rendering.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Rails provides two different options for JSON serialization depending on the data type being rendered. The <code>serializer:</code> option is designed for single objects, while <code>each_serializer:</code> is intended for collections like arrays or ActiveRecord relations.</p>
</div>
<div class="paragraph">
<p>When you use <code>serializer:</code> with a collection, the serializer attempts to call methods like <code>read_attribute_for_serialization</code> or <code>id</code> directly on the collection object rather than on individual items within the collection. This causes a <code>NoMethodError</code> because collections don&#8217;t have these methods.</p>
</div>
<div class="paragraph">
<p>Similarly, using <code>each_serializer:</code> with a single object is unnecessary and can lead to confusion about the intended data structure.</p>
</div>
<div class="paragraph">
<p>The ActiveModel Serializer gem expects these options to be used correctly to properly iterate through collections and serialize individual objects.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>Using the wrong serializer option will cause runtime <code>NoMethodError</code> exceptions, breaking the JSON API endpoints. This leads to failed HTTP requests and poor user experience. The application may crash when trying to render JSON responses, making the affected endpoints completely unusable.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Use <code>each_serializer:</code> when rendering collections and <code>serializer:</code> when rendering single objects.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">def index
  @records = Record.where(artist_id: params[:artist_id])
  # Incorrect: using serializer for a collection will cause NoMethodError
  render json: @records, serializer: RecordSummarySerializer # Noncompliant
end

def show
  @record = Record.find(params[:id])
  # Incorrect: using each_serializer for single object is unnecessary
  render json: @record, each_serializer: RecordDetailSerializer # Noncompliant
end</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">def index
  @records = Record.where(artist_id: params[:artist_id])
  # Correct: use each_serializer for collections
  render json: @records, each_serializer: RecordSummarySerializer
end

def show
  @record = Record.find(params[:id])
  # Correct: use serializer for single objects
  render json: @record, serializer: RecordDetailSerializer
end</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>ActiveModel Serializers Documentation - <a href="https://github.com/rails-api/active_model_serializers">Official documentation for ActiveModel Serializers gem</a></p>
</li>
<li>
<p>Rails JSON Rendering Guide - <a href="https://guides.rubyonrails.org/layouts_and_rendering.html#rendering-json">Rails guide on rendering JSON responses</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>