<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This rule raises an issue when <code>botocore.exceptions.ClientError</code> can be thrown but is not explicitly caught and handled.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>AWS Lambda functions in Python use <code>boto3</code>, the AWS SDK, to communicate with other AWS services. <code>boto3</code> operations can fail due to service-specific reasons like:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A requested s3 object does not exist</p>
</li>
<li>
<p>Insufficient permissions</p>
</li>
<li>
<p>Service rate limit</p>
</li>
<li>
<p>Network glitches and other temporary service issues</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These errors are typically surfaced as <code>botocore.exceptions.ClientError</code>. Failing to handle these exceptions correctly by not catching them or using a broad <code>try/except</code> block can undermine the lambda function&#8217;s reliability and ease of debugging.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>Not catching and appropriately handling <code>botocore.exceptions.ClientError</code> in AWS Lambda functions can lead to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Opaque dead letter queue messages</p>
</li>
<li>
<p>Suppressed retries</p>
</li>
<li>
<p>Unclear root causes in log messages</p>
</li>
<li>
<p>Poor API responses</p>
</li>
<li>
<p>Silent failures when errors are caught and ignored</p>
</li>
<li>
<p>Wasted resources by retrying operations that fail and are not properly handled</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix">How to fix</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Lambda functions should explicitly catch <code>botocore.exceptions.ClientError</code> around <code>boto3</code> calls.
Inside the except block, <code>e.response[‘Error’][‘Code’]</code> should be inspected to determine the specific error and to be handled specifically.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import boto3

s3 = boto3.client("s3")

def lambda_handler(event, context):
    return s3.get_object(Bucket="my_bucket", Key="somefile.txt") # Noncompliant: No error handling, crash on missing file or permissions error</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import boto3
from botocore.exceptions import ClientError

s3 = boto3.client("s3")

def lambda_handler(event, context):
    try:
        response = s3.get_object(Bucket="my_bucket", Key="somefile.txt")
    except ClientError as e: # Compliant: explicitly catching ClientError
        error_code = e.response['Error']['Code']
        if error_code == 'NoSuchKey':
            return {"error":"File not found"}
        elif ...:
          ...</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>boto3 docs - <a href="https://boto3.amazonaws.com/v1/documentation/api/latest/guide/error-handling.html">Error handling</a></p>
</li>
<li>
<p>boto3 docs - <a href="https://boto3.amazonaws.com/v1/documentation/api/latest/guide/retries.html">Retries</a></p>
</li>
<li>
<p>boto3 docs - <a href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/lambda/client/invoke.html">Lambda invoke</a></p>
</li>
<li>
<p>Medium - <a href="https://medium.com/@python-javascript-php-html-css/automating-error-reporting-and-lambda-execution-in-aws-fab0aed3cbf0">Automating error reporting</a></p>
</li>
<li>
<p>Serverlessland - <a href="https://serverlessland.com/content/service/lambda/guides/aws-lambda-fundamentals/aws-lambda-logging">AWS Lambda logging</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Explicitly catch <code>botocore.exceptions.boto3</code> exceptions</p>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="ulist">
<ul>
<li>
<p>Primary location: the location where <code>botocore.exceptions.boto3</code> can be thrown</p>
</li>
<li>
<p>Secondary location: the generic try/except block if <code>botocore.exceptions.boto3</code> can be thrown inside the block, but is not specifically caught</p>
</li>
</ul>
</div>
</div>
</div>
</div>