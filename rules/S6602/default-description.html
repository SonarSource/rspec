<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Both the <code>List.Find</code> method and the <code>Enumerable.FirstOrDefault</code> method can be used to locate the first element that meets a specified condition within a collection. However, for <code>List</code> objects, <code>List.Find</code> may offer superior performance compared to <code>Enumerable.FirstOrDefault</code>. While the performance difference might be negligible for small collections, it can become significant for larger collections. This observation also holds true for <code>ImmutableList</code> and arrays.</p>
</div>
<div class="paragraph">
<p>It is important to enable this rule with caution, as performance outcomes can vary significantly across different runtimes. Notably, the <a href="https://devblogs.microsoft.com/dotnet/performance-improvements-in-net-9/#collections">performance improvements in .NET 9</a> have brought <code>FirstOrDefault</code> closer to the performance of collection-specific <code>Find</code> methods in most scenarios.</p>
</div>
<div class="paragraph">
<p><strong>Applies to</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.collections.generic.list-1.find">List</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.array.find">Array</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.collections.immutable.immutablelist-1.find">ImmutableList</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>We measured at least 2x improvement in the execution time. For more details see the <code>Benchmarks</code> section from the <code>More info</code> tab.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>Find</code> method is defined on the collection class, and it has the same signature as <code>FirstOrDefault</code> extension method. The function can be replaced in place.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">int GetValue(List&lt;int&gt; data) =&gt;
    data.FirstOrDefault(x =&gt; x % 2 == 0);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">int GetValue(int[] data) =&gt;
    data.FirstOrDefault(x =&gt; x % 2 == 0);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">int GetValue(List&lt;int&gt; data) =&gt;
    data.Find(x =&gt; x % 2 == 0);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">int GetValue(int[] data) =&gt;
    Array.Find(data, x =&gt; x % 2 == 0);</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.collections.generic.list-1.find">List&lt;T&gt;.Find(Predicate&lt;T&gt;)</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.array.find">Array.Find&lt;T&gt;(T[], Predicate&lt;T&gt;)</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.collections.immutable.immutablelist-1.find">ImmutableList&lt;T&gt;.Find(Predicate&lt;T&gt;)</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.linq.enumerable.firstordefault">Enumerable.FirstOrDefault(Predicate&lt;T&gt;)</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_benchmarks">Benchmarks</h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Runtime</th>
<th class="tableblock halign-left valign-top">Categories</th>
<th class="tableblock halign-left valign-top">Mean</th>
<th class="tableblock halign-left valign-top">Standard Deviation</th>
<th class="tableblock halign-left valign-top">Allocated</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ArrayFirstOrDefault</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET 8.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Array</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10.515 μs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.1410 μs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 B</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ArrayFind</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET 8.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Array</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.417 μs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.0729 μs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ArrayFirstOrDefault</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET 9.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Array</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.262 μs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.0135 μs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ArrayFind</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET 9.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Array</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.428 μs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.0206 μs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ArrayFirstOrDefault</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET Framework 4.8.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Array</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">45.074 μs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.7517 μs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 B</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ArrayFind</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET Framework 4.8.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Array</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">13.948 μs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.1496 μs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ImmutableListFirstOrDefault</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET 8.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ImmutableList&lt;T&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">83.796 μs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.3199 μs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">72 B</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ImmutableListFind</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET 8.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ImmutableList&lt;T&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">59.720 μs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.0723 μs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ImmutableListFirstOrDefault</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET 9.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ImmutableList&lt;T&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">81.984 μs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.0886 μs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">72 B</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ImmutableListFind</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET 9.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ImmutableList&lt;T&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">58.288 μs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.8079 μs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ImmutableListFirstOrDefault</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET Framework 4.8.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ImmutableList&lt;T&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">446.893 μs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9.8430 μs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">76 B</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ImmutableListFind</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET Framework 4.8.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ImmutableList&lt;T&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">427.476 μs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.3371 μs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ListFirstOrDefault</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET 8.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List&lt;T&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">14.808 μs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.1723 μs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">40 B</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ListFind</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET 8.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List&lt;T&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6.040 μs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.1104 μs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ListFirstOrDefault</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET 9.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List&lt;T&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.233 μs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.0154 μs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ListFind</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET 9.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List&lt;T&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.458 μs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.0745 μs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ListFirstOrDefault</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET Framework 4.8.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List&lt;T&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">57.290 μs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.0494 μs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">40 B</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ListFind</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET Framework 4.8.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List&lt;T&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">18.476 μs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.0504 μs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_glossary">Glossary</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://en.wikipedia.org/wiki/Arithmetic_mean">Mean</a></p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Standard_deviation">Standard Deviation</a></p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Memory_management">Allocated</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The results were generated by running the following snippet with <a href="https://github.com/dotnet/BenchmarkDotNet">BenchmarkDotNet</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">// Explicitly cache the delegates to avoid allocations inside the benchmark.
private readonly static Func&lt;int, bool&gt; ConditionFunc = static x =&gt; x == 1;
private readonly static Predicate&lt;int&gt; ConditionPredicate = static x =&gt; x == 1;
private List&lt;int&gt; list;
private ImmutableList&lt;int&gt; immutableList;
private int[] array;
public const int N = 10_000;

[GlobalSetup]
public void GlobalSetup()
{
    list = Enumerable.Range(0, N).Select(x =&gt; N - x).ToList();
    immutableList = ImmutableList.CreateRange(list);
    array = list.ToArray();
}

[BenchmarkCategory("List&lt;T&gt;"), Benchmark(Baseline = true)]
public int ListFirstOrDefault() =&gt;
    list.FirstOrDefault(ConditionFunc);

[BenchmarkCategory("List&lt;T&gt;"), Benchmark]
public int ListFind() =&gt;
    list.Find(ConditionPredicate);

[BenchmarkCategory("ImmutableList&lt;T&gt;"), Benchmark(Baseline = true)]
public int ImmutableListFirstOrDefault() =&gt;
    immutableList.FirstOrDefault(ConditionFunc);

[BenchmarkCategory("ImmutableList&lt;T&gt;"), Benchmark]
public int ImmutableListFind() =&gt;
    immutableList.Find(ConditionPredicate);

[BenchmarkCategory("Array"), Benchmark(Baseline = true)]
public int ArrayFirstOrDefault() =&gt;
    array.FirstOrDefault(ConditionFunc);

[BenchmarkCategory("Array"), Benchmark]
public int ArrayFind() =&gt;
    Array.Find(array, ConditionPredicate);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Hardware configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>BenchmarkDotNet v0.14.0, Windows 11 (10.0.22631.4317/23H2/2023Update/SunValley3)
11th Gen Intel Core i7-11850H 2.50GHz, 1 CPU, 16 logical and 8 physical cores
  [Host]               : .NET Framework 4.8.1 (4.8.9277.0), X64 RyuJIT VectorSize=256
  .NET 8.0             : .NET 8.0.10 (8.0.1024.46610), X64 RyuJIT AVX-512F+CD+BW+DQ+VL+VBMI
  .NET 9.0             : .NET 9.0.0 (9.0.24.47305), X64 RyuJIT AVX-512F+CD+BW+DQ+VL+VBMI
  .NET Framework 4.8.1 : .NET Framework 4.8.1 (4.8.9277.0), X64 RyuJIT VectorSize=256</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>