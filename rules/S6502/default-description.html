<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Disabling builder sandboxes can lead to unauthorized access of the host system
by malicious programs.</p>
</div>
<div class="paragraph">
<p>By default, programs executed by a <code>RUN</code> statement use only a subset of
<a href="https://man7.org/linux/man-pages/man7/capabilities.7.html">capabilities</a> which
are considered safe: this is called <code>sandbox</code> mode.</p>
</div>
<div class="paragraph">
<p>If you disable the sandbox with the <code>--security=insecure</code> option, the executed command
can use the full set of Linux capabilities.<br>
This can lead to a container escape. For example, an attacker with the
<code>SYS_ADMIN</code> capability is able to mount devices from the host system.</p>
</div>
<div class="paragraph">
<p>This vulnerability allows an attacker who controls the behavior of the ran command to access
the host system, break out of the container and penetrate the infrastructure.</p>
</div>
<div class="paragraph">
<p>After a successful intrusion, the underlying systems are exposed to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>theft of intellectual property and/or personal data</p>
</li>
<li>
<p>extortion</p>
</li>
<li>
<p>denial of service</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ask_yourself_whether">Ask Yourself Whether</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>The program is controlled by an external entity.</p>
</li>
<li>
<p>The program is part of a supply chain that could be a victim of a supply chain attack.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There is a risk if you answered yes to either of these questions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_recommended_secure_coding_practices">Recommended Secure Coding Practices</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Whenever possible, the sandbox should stay enabled to reduce unnecessary risk.</p>
</li>
<li>
<p>If elevated capabilities are absolutely necessary, make sure to verify the integrity of the program before executing it.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sensitive_code_example">Sensitive Code Example</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-docker" data-lang="docker"># syntax=docker/dockerfile:1-labs
FROM ubuntu:22.04
# Sensitive
RUN --security=insecure ./example.sh</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-docker" data-lang="docker"># syntax=docker/dockerfile:1-labs
FROM ubuntu:22.04
RUN ./example.sh
RUN --security=sandbox ./example.sh</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/250">CWE-250 - Execution with Unnecessary Privileges</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/284">CWE-284 - Improper Access Control</a></p>
</li>
<li>
<p><a href="https://docs.docker.com/engine/reference/builder/#run---security">Dockerfile reference</a> - RUN</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="ulist">
<ul>
<li>
<p>Make sure that disabling the builder sandbox is safe here.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="paragraph">
<p>Highlight the <code>security</code> parameter, i.e. <code>--security=insecure</code>.</p>
</div>
<hr>
</div>
</div>
</div>