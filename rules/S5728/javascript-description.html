<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Content security policy (CSP) (fetch directives) is a <a href="https://www.w3.org/TR/CSP3/">W3C standard </a> which is used by a server to specify, via a http header, the origins from where the browser is allowed to load resources. It can help to mitigate the risk of cross site scripting (XSS) attacks and reduce privileges used by an application. If the website doesn&#8217;t define CSP header the browser will apply <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy">same-origin policy</a> by default.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Content-Security-Policy: default-src 'self'; script-src ‘self ‘ http://www.example.com</pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, all resources are allowed from the website where this header is set and script resources fetched from example.com are also authorized:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;img src="selfhostedimage.png&gt;&lt;/script&gt; &lt;!-- will be loaded because default-src 'self'; directive is applied  --&gt;
&lt;img src="http://www.example.com/image.png&gt;&lt;/script&gt;  &lt;!-- will NOT be loaded because default-src 'self'; directive is applied  --&gt;
&lt;script src="http://www.example.com/library.js&gt;&lt;/script&gt; &lt;!-- will be loaded because script-src ‘self ‘ http://www.example.comdirective is applied  --&gt;
&lt;script src="selfhostedscript.js&gt;&lt;/script&gt; &lt;!-- will be loaded because script-src ‘self ‘ http://www.example.com directive is applied  --&gt;
&lt;script src="http://www.otherexample.com/library.js&gt;&lt;/script&gt; &lt;!-- will NOT be loaded because script-src ‘self ‘ http://www.example.comdirective is applied  --&gt;</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ask_yourself_whether">Ask Yourself Whether</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>The resources of the application are fetched from various untrusted locations.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There is a risk if you answered yes to this question.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_recommended_secure_coding_practices">Recommended Secure Coding Practices</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Implement content security policy fetch directives, in particular <em>default-src</em> directive and continue to properly sanitize and validate all inputs of the application, indeed CSP fetch directives is only a tool to reduce the impact of cross site scripting attacks.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sensitive_code_example">Sensitive Code Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In a Express.js application, the code is sensitive if the <a href="https://www.npmjs.com/package/helmet">helmet</a> contentSecurityPolicy middleware is disabled:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>const express = require('express');
const helmet = require('helmet');

let app = express();
app.use(
    helmet({
      contentSecurityPolicy: false, // sensitive
    })
);</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In a Express.js application, a standard way to implement CSP is the <a href="https://www.npmjs.com/package/helmet">helmet contentSecurityPolicy middleware</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const express = require('express');
const helmet = require('helmet');

let app = express();
app.use(helmet.contentSecurityPolicy()); // Compliant</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a></p>
</li>
<li>
<p><a href="https://www.w3.org/TR/CSP3/">w3.org</a> - Content Security Policy Level 3</p>
</li>
<li>
<p>OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security Misconfiguration</a></p>
</li>
<li>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP">developer.mozilla.org</a> - Content Security Policy (CSP)</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Make sure not enabling content security policy fetch directives is safe here.</p>
</div>
</div>
</div>
</div>