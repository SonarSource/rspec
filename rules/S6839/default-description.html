<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>HTTP Response Splitting is a type of web application vulnerability that occurs when an attacker manipulates the data input into HTTP headers. This manipulation can lead to the creation of additional, unauthorized HTTP responses. The vulnerability arises when user-supplied data is not properly validated and sanitized before being included in an HTTP response header. This can potentially allow an attacker to control the contents of the HTTP response received by other users, leading to a variety of consequences such as cross-site scripting (XSS), session hijacking, cache poisonning, or malware delivery.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Without proper validation or sanitation, an attacker with control over a header&#8217;s content could insert line return characters in it and inject arbitrary content in the HTTP response. This includes headers, their content, and the response body.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact</h3>
<div class="paragraph">
<p>HTTP Response Splitting is a significant security concern due to its potential to compromise the integrity and confidentiality of web applications and their users' data. Typical exploitation scenarios include Cross-Site Scripting (XSS), phishing attacks or cache poisonning.</p>
</div>
<div class="sect3">
<h4 id="_cross_site_scripting_xss">Cross-Site Scripting (XSS)</h4>
<div class="paragraph">
<p>When an attacker successfully exploits an HTTP Response Splitting vulnerability, they can inject malicious scripts into the HTTP response. These scripts can be executed in the user&#8217;s browser, leading to an XSS attack. This can result in unauthorized access to sensitive user data, such as login credentials or personal information.</p>
</div>
</div>
<div class="sect3">
<h4 id="_phishing_attacks">Phishing Attacks</h4>
<div class="paragraph">
<p>An attacker can use this vulnerability to redirect users to a malicious website that looks identical to the original one. Unaware users might provide sensitive information like usernames, passwords, or credit card details, thinking they are on a legitimate site.</p>
</div>
</div>
<div class="sect3">
<h4 id="_cache_poisonning">Cache poisonning</h4>
<div class="paragraph">
<p>By controlling the content and headers of the HTTP response, an attacker can force the application&#8217;s hosting infrastructure to store a maliciously crafted web page in a cache. Every user that will later try to access the page or resource which cached version has been poisoned will therefore be presented with malicious content.</p>
</div>
<div class="paragraph">
<p>Such an attack can make the impact of other mentioned exploitation scenario higher.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As a best practice, applications that construct response headers using user-provided data should always implement rigorous validation or sanitation of this data.</p>
</div>
<div class="paragraph">
<p>Also, note that most high-level and modern web development frameworks integrate a built-in protection measure and are thus immune to response splitting attacks. Using such a framework should be considered.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from http.server import BaseHTTPRequestHandler
from urllib.parse import urlparse, parse_qs

class ReqHandler(BaseHTTPRequestHandler):
    def do_GET(self):
        parsed = urlparse(self.path)
        params = parse_qs(parsed.query)
        self.send_response(200)
        self.send_header("Content-Type", params.get('accept')[0]) # Noncompliant
        self.end_headers()
        self.wfile.write(bytes("Hello World!", "utf-8"))</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from http.server import BaseHTTPRequestHandler
from urllib.parse import urlparse, parse_qs, quote

class ReqHandler(BaseHTTPRequestHandler):
    def do_GET(self):
        parsed = urlparse(self.path)
        params = parse_qs(parsed.query)
        self.send_response(200)
        self.send_header("Content-Type", quote(params.get('accept')[0])) # Compliant
        self.end_headers()
        self.wfile.write(bytes("Hello World!", "utf-8"))</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_how_does_this_work">How does this work?</h3>
<div class="paragraph">
<p>By applying a URL encoding to an untrusted header value, the application ensures that all special characters are properly escaped before they are added to the HTTP response. Especially <code>\r</code> (Carriage Return) and <code>\n</code> (Line Feed) characters will be encoded to <code>%0D</code> and <code>%OA</code> and won&#8217;t be able to alter the HTTP response&#8217;s semantics.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>OWASP - <a href="https://www.owasp.org/index.php/HTTP_Response_Splitting">HTTP Response Splitting</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_standards">Standards</h3>
<div class="ulist">
<ul>
<li>
<p>OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a></p>
</li>
<li>
<p>OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/113">CWE-113 - Improper Neutralization of CRLF Sequences in HTTP Headers ('HTTP Response Splitting')</a></p>
</li>
<li>
<p>STIG Viewer - <a href="https://stigviewer.com/stigs/application_security_and_development/2024-12-06/finding/V-222609">Application Security and Development: V-222609</a> - The application must not be subject to input handling vulnerabilities.</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Change this code to not set an HTTP response header based on a user-controlled
value.</p>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="paragraph">
<p>Highlight the tainted argument in the sink parameters.</p>
</div>
</div>
</div>
</div>