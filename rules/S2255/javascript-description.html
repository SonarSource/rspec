<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Using cookies is security-sensitive. It has led in the past to the following vulnerabilities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.cve.org/CVERecord?id=CVE-2018-11639">CVE-2018-11639</a></p>
</li>
<li>
<p><a href="https://www.cve.org/CVERecord?id=CVE-2016-6537">CVE-2016-6537</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Attackers can use widely-available tools to read cookies. Any sensitive information they may contain will be exposed.</p>
</div>
<div class="paragraph">
<p>This rule flags code that writes cookies.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ask_yourself_whether">Ask Yourself Whether</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>sensitive information is stored inside the cookie.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You are at risk if you answered yes to this question.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_recommended_secure_coding_practices">Recommended Secure Coding Practices</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Cookies should only be used to manage the user session. The best practice is to keep all user-related information server-side and link them to the user session, never sending them to the client. In a very few corner cases, cookies can be used for non-sensitive information that need to live longer than the user session.</p>
</div>
<div class="paragraph">
<p>Do not try to encode sensitive information in a non human-readable format before writing them in a cookie. The encoding can be reverted and the original information will be exposed.</p>
</div>
<div class="paragraph">
<p>Using cookies only for session IDs doesn&#8217;t make them secure. Follow <a href="https://cheatsheetseries.owasp.org/cheatsheets/Session_Management_Cheat_Sheet.html#cookies">OWASP best practices</a> when you configure your cookies.</p>
</div>
<div class="paragraph">
<p>As a side note, every information read from a cookie should be <a href="https://www.owasp.org/index.php/Input_Validation_Cheat_Sheet">Sanitized</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sensitive_code_example">Sensitive Code Example</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>// === Built-in NodeJS modules ===
const http = require('http');
const https = require('https');

http.createServer(function(req, res) {
  res.setHeader('Set-Cookie', ['type=ninja', 'lang=js']); // Sensitive
});
https.createServer(function(req, res) {
  res.setHeader('Set-Cookie', ['type=ninja', 'lang=js']); // Sensitive
});</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>// === ExpressJS ===
const express = require('express');
const app = express();
app.use(function(req, res, next) {
  res.cookie('name', 'John'); // Sensitive
});</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>// === In browser ===
// Set cookie
document.cookie = "name=John"; // Sensitive</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data Exposure</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/312">CWE-312 - Cleartext Storage of Sensitive Information</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/315">CWE-315 - Cleartext Storage of Sensitive Information in a Cookie</a></p>
</li>
<li>
<p>Derived from FindSecBugs rule <a href="https://find-sec-bugs.github.io/bugs.htm#COOKIE_USAGE">COOKIE_USAGE</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Make sure that this cookie is written safely.</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_9_dec_2018_224254_lars_svensson_wrote">on 9 Dec 2018, 22:42:54 Lars Svensson wrote:</h3>
<div class="paragraph">
<p><a href="https://nodejs.org/api/http.html" class="bare">https://nodejs.org/api/http.html</a></p>
</div>
<div class="paragraph">
<p><a href="https://nodejs.org/api/https.html" class="bare">https://nodejs.org/api/https.html</a></p>
</div>
<div class="paragraph">
<p><a href="https://expressjs.com/en/api.html" class="bare">https://expressjs.com/en/api.html</a></p>
</div>
<div class="paragraph">
<p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Document/cookie" class="bare">https://developer.mozilla.org/en-US/docs/Web/API/Document/cookie</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_on_3_dec_2014_145104_ann_campbell_wrote">on 3 Dec 2014, 14:51:04 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>The goal of this rule is to track the use of cookies. Security auditors can then decide which cookies need attention.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_12_dec_2014_204422_sébastien_gioria_wrote">on 12 Dec 2014, 20:44:22 Sébastien Gioria wrote:</h3>
<div class="paragraph">
<p>As a Security auditor, I must said : "you should never store any sensitive information in a cookie".</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_12_dec_2014_205216_ann_campbell_wrote">on 12 Dec 2014, 20:52:16 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~sebastien.gioria] if you&#8217;re talking about the title, the current version follows our standards:</p>
</div>
<div class="paragraph">
<p>X should [not] y</p>
</div>
<div class="paragraph">
<p>cc [~freddy.mallet]</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_12_dec_2014_210938_sébastien_gioria_wrote">on 12 Dec 2014, 21:09:38 Sébastien Gioria wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2]: I refer to the Message in the rule : "If the data stored in this cookie is sensitive, it should be encrypted or stored internally in the user session. "</p>
</div>
<div class="paragraph">
<p>Message should be : "If the data stored in this cookie is sensitive, it should be stored internally in the user session. "</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_15_dec_2014_103207_freddy_mallet_wrote">on 15 Dec 2014, 10:32:07 Freddy Mallet wrote:</h3>
<div class="paragraph">
<p>I agree with [~sebastien.gioria] [~ann.campbell.2], we should remove the "encrypted" option in the remediation action.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_15_dec_2014_145318_ann_campbell_wrote">on 15 Dec 2014, 14:53:18 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>Done [~sebastien.gioria]</p>
</div>
<div class="paragraph">
<p>cc [~freddy.mallet]</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_20_jul_2015_074410_ann_campbell_wrote">on 20 Jul 2015, 07:44:10 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>Tagged java-top by Ann</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_7_mar_2018_190141_ann_campbell_wrote">on 7 Mar 2018, 19:01:41 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~alexandre.gigleux] that "derived from" reference you omitted was there because of discussions and agreement with the FindSecBugs author. Granted, this was several years ago (the Geneva office was still on 5) but&#8230;&#8203;</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_9_mar_2018_205125_alexandre_gigleux_wrote">on 9 Mar 2018, 20:51:25 Alexandre Gigleux wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] Fixed</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_28_mar_2018_163500_alexandre_gigleux_wrote">on 28 Mar 2018, 16:35:00 Alexandre Gigleux wrote:</h3>
<div class="paragraph">
<p>This is a "Security Hotspot".</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_14_may_2018_085731_andrei_epure_wrote">on 14 May 2018, 08:57:31 Andrei Epure wrote:</h3>
<div class="paragraph">
<p>Having the <a href="https://find-sec-bugs.github.io/bugs.htm#COOKIE_USAGE">FindSecBugs rule COOKIE_USAGE</a> in the description is a bit misleading. The description of the rule is ok, but the actual find-sec-bugs implementation is inside <a href="https://github.com/find-sec-bugs/find-sec-bugs/blob/1d288ef15122a4d883343769dd221cbe7bbeecb1/plugin/src/main/java/com/h3xstream/findsecbugs/cookie/CookieReadDetector.java">CookieReadDetector.java</a> which merely detects if the cookie is read.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_15_nov_2018_143220_alexandre_gigleux_wrote">on 15 Nov 2018, 14:32:20 Alexandre Gigleux wrote:</h3>
<div class="paragraph">
<p>\[~andrei.epure] This rule was inspired by FindSecBugs one and we agreed years ago with the main contributor of FindSecBugs to keep a reference to his rule.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_21_may_2019_194942_ann_campbell_wrote">on 21 May 2019, 19:49:42 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>It&#8217;s not <em>writing</em> cookies that&#8217;s the (potential) problem but what you store in them, right?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_27_may_2020_165151_eric_therond_wrote">on 27 May 2020, 16:51:51 Eric Therond wrote:</h3>
<div class="paragraph">
<p>Deprecated because it overlaps with rules related to cookies (flags etc)</p>
</div>
<div class="paragraph">
<p>The content of a cookies is often sensitive (session id, tracking id), it&#8217;s their goal, there is nothing to fix when an issue is raised here.</p>
</div>
</div>
</div>
</div>