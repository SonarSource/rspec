<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>An HTTP method is safe when used to perform a read-only operation, such as retrieving information. In contrast, an unsafe HTTP method is used to change the state of an application, for instance to update a user&#8217;s profile on a web application.</p>
</div>
<div class="paragraph">
<p>Common safe HTTP methods are  GET, HEAD, or OPTIONS.</p>
</div>
<div class="paragraph">
<p>Common unsafe HTTP methods are  POST, PUT and DELETE.</p>
</div>
<div class="paragraph">
<p>Allowing both safe and unsafe HTTP methods to perform a specific operation on a web application could impact its security, for example CSRF protections are most of the time only protecting operations performed by unsafe HTTP methods.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ask_yourself_whether">Ask Yourself Whether</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>HTTP methods are not defined at all for a route/controller of the application.</p>
</li>
<li>
<p>Safe HTTP methods are defined and used for a route/controller that can change the state of an application.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There is a risk if you answered yes to any of those questions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_recommended_secure_coding_practices">Recommended Secure Coding Practices</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For all the routes/controllers of an application, the authorized HTTP methods should be explicitly defined and safe HTTP methods should only be used to perform read-only operations.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sensitive_code_example">Sensitive Code Example</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>@RequestMapping("/delete_user")  // Sensitive: by default all HTTP methods are allowed
public String delete1(String username) {
// state of the application will be changed here
}

@RequestMapping(path = "/delete_user", method = {RequestMethod.GET, RequestMethod.POST}) // Sensitive: both safe and unsafe methods are allowed
String delete2(@RequestParam("id") String id) {
// state of the application will be changed here
}</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@RequestMapping("/delete_user", method = RequestMethod.POST)  // Compliant
public String delete1(String username) {
// state of the application will be changed here
}

@RequestMapping(path = "/delete_user", method = RequestMethod.POST) // Compliant
String delete2(@RequestParam("id") String id) {
// state of the application will be changed here
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a></p>
</li>
<li>
<p>OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a></p>
</li>
<li>
<p>OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/352">CWE-352 - Cross-Site Request Forgery (CSRF)</a></p>
</li>
<li>
<p><a href="https://owasp.org/www-community/attacks/csrf">OWASP: Cross-Site Request Forgery</a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-security/site/docs/5.0.x/reference/html/csrf.html#csrf-use-proper-verbs">Spring Security Official Documentation: Use proper HTTP verbs (CSRF protection)</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Make sure allowing safe and unsafe HTTP methods is safe here.</p>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="paragraph">
<p><code>@RequestMapping...</code></p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_27_feb_2017_185851_ann_campbell_wrote">on 27 Feb 2017, 18:58:51 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_15_apr_2019_144119_dennis_devriendt_wrote">on 15 Apr 2019, 14:41:19 Dennis Devriendt wrote:</h3>
<div class="paragraph">
<p>I agree that not specifying a HTTP method should be a blocking issue but that shouldn&#8217;t be the case if you explicitly specify that both GET and POST are supported. For example the OpenID-Connect /userinfo endpoint should support both GET and POST requests according to the spec.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>@RequestMapping(value = "/oauth/userinfo", method = {GET, POST}, produces = APPLICATION_JSON_VALUE)</pre>
</div>
</div>
<div class="paragraph">
<p>This will trigger with the message: "Consider narrowing this list of methods to one"</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_15_apr_2019_144648_alexandre_gigleux_wrote">on 15 Apr 2019, 14:46:48 Alexandre Gigleux wrote:</h3>
<div class="paragraph">
<p>Thanks for the feedback. Could you raise  your concern on the <a href="https://community.sonarsource.com/c/bug/fp">Community Forum</a> instead of here, as it&#8217;s easier that using JIRA&#8217;s comments? Thx</p>
</div>
</div>
</div>
</div>