<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By giving AI agents access to code execution tools, it might be possible for an attacker&#8217;s code to be executed, through prompt injection, hallucination, or other means.
When this code is executed on the host system without any form of sandboxing, it might be possible for an attacker to gain access to the host system, leading to a data breach or other security issues.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ask_yourself_whether">Ask Yourself Whether</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>The AI agent takes in user input, which might be manipulated through prompt injection.</p>
</li>
<li>
<p>The AI agent has access to tool calls that use uncontrolled APIs or services, which may lead to indirect prompt injection.</p>
</li>
<li>
<p>The AI agent runs without any form of sandboxing.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There is a risk if you answer yes to any of the above questions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_recommended_secure_coding_practices">Recommended Secure Coding Practices</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Make sure that all code that originates from untrusted sources, including code that is generated by AI agents, is run in a sandboxed environment.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sensitive_code_example">Sensitive Code Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For Claude Code SDK:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from claude_code_sdk import ClaudeCodeOptions

client = ClaudeSDKClient(
    options=ClaudeCodeOptions(
        system_prompt=f"Solve an example problem for me.",
        max_turns=2,
        permission_mode="bypassPermissions",  # Sensitive
    )
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>For OpenInterpreter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from interpreter import interpreter

interpreter.auto_run = True  # Sensitive
interpreter.chat(f"Solve an example problem for me.")</code></pre>
</div>
</div>
<div class="paragraph">
<p>For Hugging Face <code>smolagents</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from smolagents import CodeAgent

agent = CodeAgent(executor_type="local")  # Sensitive</code></pre>
</div>
</div>
<div class="paragraph">
<p>For Microsoft AutoGen:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from autogen import AssistantAgent, UserProxyAgent

assistant = AssistantAgent("assistant", llm_config={"model": "gpt-4o-mini"})
user = UserProxyAgent(
    "user",
    human_input_mode="NEVER",
    code_execution_config={"work_dir": ".", "use_docker": False},  # Sensitive
)
user.initiate_chat(assistant, message="Solve an example problem for me.")</code></pre>
</div>
</div>
<div class="paragraph">
<p>For CrewAI:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from crewai import Agent, Task, Crew
from crewai_tools import CodeInterpreterTool
from langchain_openai import ChatOpenAI

coder = Agent(
    role="Coder",
    goal="Write and run Python",
    backstory="Executes code.",
    tools=[CodeInterpreterTool(unsafe_mode=True)],  # Sensitive
    llm=ChatOpenAI(model="gpt-4o-mini"),
    verbose=True,
)
task = Task(
    description="Solve an example problem for me.", agent=coder
)
Crew(agents=[coder], tasks=[task]).kickoff()</code></pre>
</div>
</div>
<div class="paragraph">
<p>For Langchain:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from langchain_openai import ChatOpenAI
from langchain_community.tools import PythonREPLTool
from langchain.agents import initialize_agent, AgentType

llm = ChatOpenAI(model="gpt-4o-mini", temperature=0)
agent = initialize_agent(
    [PythonREPLTool()],  # Sensitive
    llm,
    agent=AgentType.ZERO_SHOT_REACT_DESCRIPTION,
    verbose=True,
)
agent.run("Solve an example problem for me.")</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For Claude Code SDK:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from claude_code_sdk import ClaudeCodeOptions

client = ClaudeSDKClient(
    options=ClaudeCodeOptions(
        system_prompt=f"Solve an example problem for me.",
        max_turns=2,
    )
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>For OpenInterpreter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from interpreter import interpreter

interpreter.chat(f"Solve an example problem for me.")</code></pre>
</div>
</div>
<div class="paragraph">
<p>For Hugging Face <code>smolagents</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from smolagents import CodeAgent, InferenceClientModel

agent = CodeAgent(
    model=InferenceClientModel(), tools=[], executor_type="docker"
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>For Microsoft AutoGen:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from autogen import AssistantAgent, UserProxyAgent

assistant = AssistantAgent("assistant", llm_config={"model": "gpt-4o-mini"})
user = UserProxyAgent(
    "user",
    human_input_mode="NEVER",
    code_execution_config={"work_dir": "."},
)
user.initiate_chat(assistant, message="Solve an example problem for me.")</code></pre>
</div>
</div>
<div class="paragraph">
<p>For CrewAI:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from crewai import Agent, Task, Crew
from crewai_tools import CodeInterpreterTool
from langchain_openai import ChatOpenAI

coder = Agent(
    role="Coder",
    goal="Write and run Python",
    backstory="Executes code.",
    tools=[CodeInterpreterTool()],
    llm=ChatOpenAI(model="gpt-4o-mini"),
    verbose=True,
)
task = Task(
    description="Solve an example problem for me.", agent=coder
)
Crew(agents=[coder], tasks=[task]).kickoff()</code></pre>
</div>
</div>
<div class="paragraph">
<p>For Langchain, no built-in solution is available, so the user must take care of sandboxing the code themselves. This can for example be done by running the
agent in a Docker container (without access to the host system).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/94">CWE-94 - Improper Control of Generation of Code ('Code Injection')</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/250">CWE-250 - Execution with Unnecessary Privileges</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/1220">CWE-1220 - Insufficient Granularity of Access Control</a></p>
</li>
<li>
<p>OWASP GenAI - <a href="https://genai.owasp.org/llmrisk/llm01-prompt-injection/">Top 10 2025 Category LLM01:2025 - Prompt Injection</a></p>
</li>
<li>
<p>OWASP GenAI - <a href="https://genai.owasp.org/llmrisk/llm062025-excessive-agency/">Top 10 2025 Category LLM06:2025 - Excessive Agency</a></p>
</li>
</ul>
</div>
</div>
</div>