<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Transactional methods have a propagation type parameter in the @Transaction annotation that specifies the requirements about the transactional context in which the method can be called and how it creates, appends, or suspends an ongoing transaction.</p>
</div>
<div class="paragraph">
<p>When an instance that contains transactional methods is injected, Spring uses proxy objects to wrap these methods with the actual transaction code.</p>
</div>
<div class="paragraph">
<p>However, if a transactional method is called from another method in the same class, the <code>this</code> argument is used as the receiver instance instead of the injected proxy object, which bypasses the wrapper code.
This results in specific transitions from one transactional method to another, which are not allowed:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">From</th>
<th class="tableblock halign-center valign-top">To</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">non-<code>@Transactional</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MANDATORY, NESTED, REQUIRED, REQUIRES_NEW</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">MANDATORY</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">NESTED, NEVER, NOT_SUPPORTED, REQUIRES_NEW</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">NESTED</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">NESTED, NEVER, NOT_SUPPORTED, REQUIRES_NEW</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">NEVER</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MANDATORY, NESTED, REQUIRED, REQUIRES_NEW</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">NOT_SUPPORTED</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MANDATORY, NESTED, REQUIRED, REQUIRES_NEW</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">REQUIRED or <code>@Transactional</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">NESTED, NEVER, NOT_SUPPORTED, REQUIRES_NEW</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">REQUIRES_NEW</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">NESTED, NEVER, NOT_SUPPORTED, REQUIRES_NEW</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">SUPPORTS</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MANDATORY, NESTED, NEVER, NOT_SUPPORTED, REQUIRED, REQUIRES_NEW</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Change the corresponding functions into a compatible propagation type.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public void doTheThing() {
  // ...
  actuallyDoTheThing(); // Noncompliant, call from non-transactional to transactional
}

@Transactional
public void actuallyDoTheThing() {
  // ...
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Transactional
public void doTheThing() {
  // ...
  actuallyDoTheThing(); // Compliant
}

@Transactional
public void actuallyDoTheThing() {
  // ...
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_noncompliant_code_example_2">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Transactional
public void doTheThing() {
  // ...
  actuallyDoTheThing(); // Noncompliant, call from REQUIRED to REQUIRES_NEW
}

@Transactional(propagation = Propagation.REQUIRES_NEW)
public void actuallyDoTheThing() {
  // ...
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution_2">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Transactional
public void doTheThing() {
  // ...
  actuallyDoTheThing(); // Compliant, call from REQUIRED to MANDATORY
}

@Transactional(propagation = Propagation.MANDATORY)
public void actuallyDoTheThing() {
  // ...
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/transaction/annotation/Propagation.html">Spring Framework 6 API: Enum Class propagation</a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/transaction/annotation/Transactional.html">Spring Framework 6 API: Annotation Interface Transactional</a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-framework/reference/data-access/transaction/declarative/tx-propagation.html">Spring 6 Documentation: Transaction Propagation</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_articles_blog_posts">Articles &amp; blog posts</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.baeldung.com/spring-transactional-propagation-isolation">Baeldung: Transaction Propagation and Isolation in Spring @Transactional</a></p>
</li>
<li>
<p><a href="https://dzone.com/articles/spring-transaction-propagation">DZone: Spring Transaction Propagation in a Nutshell</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>"xxx&#8217;s" @Transactional requirement is incompatible with the one for this method.</p>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="ulist">
<ul>
<li>
<p>primary: method call</p>
</li>
<li>
<p>secondary:</p>
<div class="ulist">
<ul>
<li>
<p>calling method&#8217;s <code>@Transactional</code> annotation or, if none, calling method signature.</p>
</li>
<li>
<p>called method&#8217;s <code>@Transactional</code> annotation or signature</p>
</li>
<li>
<p>message: "Incompatible method definition."</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_21_nov_2014_122950_freddy_mallet_wrote">on 21 Nov 2014, 12:29:50 Freddy Mallet wrote:</h3>
<div class="paragraph">
<p>I would tag this rule with the label "spring"</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_20_jun_2018_143900_alban_auzeill_wrote">on 20 Jun 2018, 14:39:00 Alban Auzeill wrote:</h3>
<div class="paragraph">
<p>@Ann I don&#8217;t understand why there&#8217;s a difference between <code>@Transactional</code>  and <code>@Transactional(propagation = Propagation.REQUIRED)</code> (the default) ?</p>
</div>
<div class="paragraph">
<p>And I disagree with incompatible propagations list, this is my proposal:</p>
</div>
<div class="paragraph">
<p>||From||To||</p>
</div>
<div class="paragraph">
<p>| non-<code>@Transactional</code> | MANDATORY, REQUIRED, REQUIRES_NEW |</p>
</div>
<div class="paragraph">
<p>| MANDATORY | NESTED, NEVER, NOT_SUPPORTED, REQUIRES_NEW |</p>
</div>
<div class="paragraph">
<p>| NESTED | MANDATORY, NESTED, NEVER, NOT_SUPPORTED, REQUIRED, REQUIRES_NEW |</p>
</div>
<div class="paragraph">
<p>| NEVER | MANDATORY, REQUIRED, REQUIRES_NEW |</p>
</div>
<div class="paragraph">
<p>| NOT_SUPPORTED | MANDATORY, REQUIRED, REQUIRES_NEW |</p>
</div>
<div class="paragraph">
<p>| REQUIRED or <code>@Transactional</code> | NESTED, NEVER, NOT_SUPPORTED, REQUIRES_NEW |</p>
</div>
<div class="paragraph">
<p>| REQUIRES_NEW | NESTED, NEVER, NOT_SUPPORTED REQUIRES_NEW |</p>
</div>
<div class="paragraph">
<p>| SUPPORTS | MANDATORY, NESTED, NEVER, NOT_SUPPORTED, REQUIRED, REQUIRES_NEW |</p>
</div>
<div class="paragraph">
<p>javadoc <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/transaction/annotation/Propagation.html">org.springframework.transaction.annotation.Propagation</a></p>
</div>
<div class="paragraph">
<p>javadoc <a href="https://docs.oracle.com/javaee/7/api/javax/transaction/Transactional.html">javax.transaction.Transactional</a></p>
</div>
</div>
</div>
</div>