<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This rule raises an issue when BERT or other transformer model calls do not explicitly specify the <code>return_dict</code> parameter, which can lead to unexpected behavior changes between library versions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>BERT and other transformer models from the Hugging Face transformers library have a <code>return_dict</code> parameter that controls the format of the returned output. When this parameter is not explicitly specified, the code relies on the library&#8217;s default behavior.</p>
</div>
<div class="paragraph">
<p>The problem arises because the default value of <code>return_dict</code> has changed between different versions of the transformers library. In older versions, the default was <code>False</code>, meaning the model would return a tuple that could be unpacked like <code>last_hidden_state, pooler_output = model(&#8230;&#8203;)</code>. In newer versions, the default became <code>True</code>, meaning the model returns a dictionary-like object.</p>
</div>
<div class="paragraph">
<p>When code expects tuple unpacking but receives a dictionary object instead, it results in a <code>TypeError</code>. For example, if your code uses <code>_, cls_hs = self.bert(sent_id, attention_mask=mask)</code> and the model returns a dictionary, <code>cls_hs</code> will contain a string key instead of the expected tensor, causing subsequent operations to fail.</p>
</div>
<div class="paragraph">
<p>This creates a maintenance burden because code that works perfectly with one version of the library may suddenly break when the library is updated, even without any changes to your code.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>Code that relies on implicit <code>return_dict</code> behavior may break unexpectedly when the transformers library is updated. This can cause <code>TypeError</code> exceptions in production, making applications unreliable and difficult to maintain across different library versions.</p>
</div>
</div>
<div class="sect2">
<h3 id="_how_to_fix">How to fix?</h3>
<div class="paragraph">
<p>Explicitly specify <code>return_dict=False</code> when you need tuple unpacking. This ensures backward compatibility and makes your intent clear.</p>
</div>
<div class="sect3">
<h4 id="_non_compliant_code_example">Non-compliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">def forward(self, sent_id, mask):
    # Relies on default behavior which may change
    _, cls_hs = self.bert(sent_id, attention_mask=mask)  # Noncompliant
    return cls_hs</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_code_example">Compliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">def forward(self, sent_id, mask):
    # Explicitly specify return_dict=False for tuple unpacking
    _, cls_hs = self.bert(sent_id, attention_mask=mask, return_dict=False)
    return cls_hs</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Hugging Face Transformers Documentation - <a href="https://huggingface.co/docs/transformers/main_classes/output">Official documentation about model outputs and the return_dict parameter</a></p>
</li>
<li>
<p>BERT Model Documentation - <a href="https://huggingface.co/docs/transformers/model_doc/bert#transformers.BertModel.forward">Specific documentation for BERT model forward method parameters</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>