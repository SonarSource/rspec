<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Operating systems have global directories where any user has write access. Those folders are mostly used as temporary storage areas like <code>/tmp</code> in Linux based systems. An application  manipulating files from these folders is exposed to race conditions on filenames: a malicious user can try to create a file with a predictable name before the application does. A successful attack can result in other files being accessed, modified, corrupted or deleted. This risk is even higher if the application runs with elevated permissions.</p>
</div>
<div class="paragraph">
<p>In the past, it has led to the following vulnerabilities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://nvd.nist.gov/vuln/detail/CVE-2012-2451">CVE-2012-2451</a></p>
</li>
<li>
<p><a href="https://nvd.nist.gov/vuln/detail/CVE-2015-1838">CVE-2015-1838</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This rule raises an issue whenever it detects a hard-coded path to a publicly writable directory like <code>/tmp</code> (see examples below). It also detects access to environment variables that point to publicly writable directories, e.g., <code>TMP</code> and <code>TMPDIR</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/tmp</code></p>
</li>
<li>
<p><code>/var/tmp</code></p>
</li>
<li>
<p><code>/usr/tmp</code></p>
</li>
<li>
<p><code>/dev/shm</code></p>
</li>
<li>
<p><code>/dev/mqueue</code></p>
</li>
<li>
<p><code>/run/lock</code></p>
</li>
<li>
<p><code>/var/run/lock</code></p>
</li>
<li>
<p><code>/Library/Caches</code></p>
</li>
<li>
<p><code>/Users/Shared</code></p>
</li>
<li>
<p><code>/private/tmp</code></p>
</li>
<li>
<p><code>/private/var/tmp</code></p>
</li>
<li>
<p><code>\Windows\Temp</code></p>
</li>
<li>
<p><code>\Temp</code></p>
</li>
<li>
<p><code>\TMP</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ask_yourself_whether">Ask Yourself Whether</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Files are read from or written into a publicly writable folder</p>
</li>
<li>
<p>The application creates files with predictable names into a publicly writable folder</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There is a risk if you answered yes to any of those questions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_recommended_secure_coding_practices">Recommended Secure Coding Practices</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Use a dedicated sub-folder with tightly controlled permissions</p>
</li>
<li>
<p>Use secure-by-design APIs to create temporary files. Such API will make sure:</p>
<div class="ulist">
<ul>
<li>
<p>The generated filename is unpredictable</p>
</li>
<li>
<p>The file is readable and writable only by the creating user ID</p>
</li>
<li>
<p>The file descriptor is not inherited by child processes</p>
</li>
<li>
<p>The file will be destroyed as soon as it is closed</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sensitive_code_example">Sensitive Code Example</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">#include &lt;cstdio&gt;
// ...

void f() {
  FILE * fp = fopen("/tmp/temporary_file", "r"); // Sensitive
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">#include &lt;cstdio&gt;
#include &lt;cstdlib&gt;
#include &lt;sstream&gt;
// ...

void f() {
  std::stringstream ss;
  ss &lt;&lt; getenv("TMPDIR") &lt;&lt; "/temporary_file"; // Sensitive
  FILE * fp = fopen(ss.str().c_str(), "w");
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">#include &lt;cstdio&gt;
#include &lt;cstdlib&gt;
// ...

void f() {
  FILE * fp = tmpfile(); // Compliant
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a></p>
</li>
<li>
<p>OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a></p>
</li>
<li>
<p>OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data Exposure</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/377">CWE-377 - Insecure Temporary File</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/379">CWE-379 - Creation of Temporary File in Directory with Incorrect Permissions</a></p>
</li>
<li>
<p><a href="https://owasp.org/www-community/vulnerabilities/Insecure_Temporary_File">OWASP, Insecure Temporary File</a></p>
</li>
<li>
<p>STIG Viewer - <a href="https://stigviewer.com/stigs/application_security_and_development/2024-12-06/finding/V-222567">Application Security and Development: V-222567</a> - The application must not be vulnerable to race conditions.</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Make sure publicly writable directories are used safely here.</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_is_related_to_s5445">is related to: <a data-rspec-id="S5445" class="rspec-auto-link">S5445</a></h3>

</div>
</div>
</div>