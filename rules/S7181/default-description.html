<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This rule raises an issue when a PySpark <code>Window</code> function is used without defining a frame.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In PySpark, a window defines a set of rows related to the current row, enabling calculations like running totals or rankings across these rows. It is useful for performing complex data analysis tasks by allowing computations over partitions of data while preserving the context of each row.</p>
</div>
<div class="paragraph">
<p>Depending on the operation you&#8217;re willing to compute, you need to define a frame for the window. A frame defines the range of rows that are used in each computation. If you don&#8217;t define a frame, a default frame is used.</p>
</div>
<div class="paragraph">
<p>The default frame that will be used depends on whether ordering is defined. When ordering is not defined, an unbounded window frame <code>(rowFrame, unboundedPreceding, unboundedFollowing)</code> is used by default. When ordering is defined, a growing window frame <code>(rangeFrame, unboundedPreceding, currentRow)</code> is used by default.</p>
</div>
<div class="paragraph">
<p>This can lead to unexpected results if the default frame is not what you intended. It is recommended to always define a frame when using a window function to avoid confusion and ensure the expected results.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to fix this issue, make sure to explicitly define the frame when using a window function. For instance, you can use the <code>rowsBetween</code> or the <code>rangeBetween</code> methods to define the frame.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from pyspark.sql import SparkSession
from pyspark.sql.window import Window
from pyspark.sql.functions import sum

spark = SparkSession.builder.appName("Example").getOrCreate()

data = [(1, "A", 100), (2, "A", 200), (3, "B", 300)]
df = spark.createDataFrame(data, ["id", "category", "value"])

window_spec = Window.partitionBy("category").orderBy("id") # Noncompliant: No explicit frame specified


df.withColumn("cumulative_sum", sum("value").over(window_spec)).show()</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from pyspark.sql import SparkSession
from pyspark.sql.window import Window
from pyspark.sql.functions import col, sum

spark = SparkSession.builder.appName("Example").getOrCreate()

data = [(1, "A", 100), (2, "A", 200), (3, "B", 300)]
df = spark.createDataFrame(data, ["id", "category", "value"])

window_spec = Window.partitionBy("category").orderBy("id").rowsBetween(Window.unboundedPreceding, Window.unboundedFollowing) # Compliant: Explicit frame specified
df.withColumn("cumulative_sum", sum("value").over(window_spec)).show()</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>PySpark Documentation - <a href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.Window.html">PySpark Documentation</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Specify a frame for this PySpark Window function.</p>
</div>
</div>
</div>
</div>