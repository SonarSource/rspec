<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This rule raises an issue when an operator is used on incompatible types.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For a specific operator, two types are considered incompatible if no built-in operations between those types exist and none of the operands has implemented the operator&#8217;s corresponding special methods.
Performing such an operation on incompatible types will raise a <code>TypeError</code>.</p>
</div>
<div class="paragraph">
<p>Calling an operator in Python is equivalent to calling a special method (except for the identity operator <code>is</code>).
Python provides a set of built-in operations. For example, to add two integers: <code>1 + 2</code>, calling the built-in operator <code>+</code> is equivalent to calling the special method <code>__add__</code> on the type <code>int</code>.</p>
</div>
<div class="paragraph">
<p>Python allows developers to define how an operator will behave with a custom class by implementing the corresponding special method.
When defining such methods for symmetrical binary operators, developers need to define two methods so that the order of operands doesn&#8217;t matter, ex: <code>__add__</code> and <code>__radd__</code>.</p>
</div>
<div class="paragraph">
<p>For a complete list of operators and their methods see the Python documentation: <a href="https://docs.python.org/3/reference/datamodel.html?#emulating-numeric-types">arithmetic and bitwise operators</a>, <a href="https://docs.python.org/3/reference/datamodel.html?#object.__lt__">comparison operators</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Implementing the special methods for a specific operator will fix the issue.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">class Empty:
    pass

class Add:
    def __add__(self, other):
        return 42

Empty() + 1  # Noncompliant: no __add__ method is defined on the Empty class
Add() + 1
1 + Add()  # Noncompliant: no __radd__ method is defined on the Add class
Add() + Empty()
Empty() + Add()  # Noncompliant: no __radd__ method is defined on the Add class</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">class Empty:
    pass

class Add:
    def __add__(self, other):
        return 42

    def __radd__(self, other):
        return 42

Add() + 1
1 + Add()
Add() + Empty()
Empty() + Add()</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.python.org/3/reference/datamodel.html?#object.__lt__">Rich comparison methods</a></p>
</li>
<li>
<p><a href="https://docs.python.org/3/reference/datamodel.html?#emulating-numeric-types">Emulating numeric types</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="ulist">
<ul>
<li>
<p>Fix this invalid XXX operation between incompatible types.</p>
</li>
<li>
<p>Fix this invalid XXX operation on a type which doesn&#8217;t support it.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="paragraph">
<p>Primary location: the operator</p>
</div>
<div class="paragraph">
<p>Secondary locations: the operand(s)</p>
</div>
</div>
</div>
</div>