<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Using <code>TOP</code> in a <code>SELECT</code> without ordering the results from which the "top" results are chosen will return a seemingly random set of rows, and is surely a mistake.</p>
</div>
<div class="paragraph">
<p>The same random behavior also occurs when using <code>TOP</code> in a <code>DELETE</code>, <code>INSERT</code>, <code>UPDATE</code> and <code>MERGE</code>.</p>
</div>
<div class="sect2">
<h3 id="_noncompliant_code_example">Noncompliant code example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sql" data-lang="sql">SELECT TOP 10 -- Noncompliant selects 10 random rows
  fname, lname, city
  FROM people
  WHERE city IS NOT NULL;

DELETE TOP (10) -- Noncompliant deletes 10 random rows
  FROM PurchaseOrder
  WHERE DueDate &lt; '20020701';</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_compliant_solution">Compliant solution</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sql" data-lang="sql">SELECT TOP 10
  fname, lname, city
  FROM people
  WHERE city IS NOT NULL
  ORDER BY birthdate;

DELETE
  FROM PurchaseOrder
  WHERE OrderID IN (
    SELECT TOP 10
      OrderID
      FROM PurchaseOrder
      WHERE DueDate &lt; '20020701'
      ORDER BY DueDate ASC
  );</code></pre>
</div>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Add an "ORDER BY" clause; without it, "TOP" will return rows selected at random.</p>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="paragraph">
<p><code>TOP X</code></p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_26_jun_2017_142934_pierre_yves_nicolas_wrote">on 26 Jun 2017, 14:29:34 Pierre-Yves Nicolas wrote:</h3>
<div class="paragraph">
<p>"TOP" is specific to TSQL.</p>
</div>
<div class="paragraph">
<p>The DB2 equivalent syntax is probably <a href="https://www.ibm.com/support/knowledgecenter/en/SSEPEK_10.0.0/perf/src/tpc/db2z_fetchfirstnrows.html"><code>FETCH FIRST n ROWS ONLY</code></a>.</p>
</div>
<div class="paragraph">
<p>For PLSQL, selecting only a given number of rows is usually done with <code>ROWNUM</code>. However, <a href="http://www.oracle.com/technetwork/issue-archive/2006/06-sep/o56asktom-086197.html"><code>ROWNUM</code> is very different from <code>TOP</code></a>. We may think of a different rule for PLSQL where we detect that "where rownum &lt; x" and "order by" are used in the same query instead of "order by" being used in a subquery.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_26_jun_2017_231700_ann_campbell_wrote">on 26 Jun 2017, 23:17:00 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>Thanks [~pierre-yves.nicolas]. I thought I remembered using <code>top</code> with Oracle, but that was admittedly more than 10 years ago. I&#8217;ve updated the targeted languages.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_26_jun_2017_232120_ann_campbell_wrote">on 26 Jun 2017, 23:21:20 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>Re-targeting COBOL for this syntax: <code>FETCH FIRST n ROWS ONLY</code></p>
</div>
</div>
<div class="sect2">
<h3 id="_on_27_jun_2017_093819_pierre_yves_nicolas_wrote">on 27 Jun 2017, 09:38:19 Pierre-Yves Nicolas wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] Do you want to create another rule for PLSQL to catch the error mentioned on <a href="http://www.oracle.com/technetwork/issue-archive/2006/06-sep/o56asktom-086197.html">Oracle "Ask Tom"</a>?</p>
</div>
<div class="paragraph">
<p>____That is why a query in the following form is almost certainly an error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>select *
  from emp
 where ROWNUM &lt;= 5
 order by sal desc;</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_on_27_jun_2017_161240_ann_campbell_wrote">on 27 Jun 2017, 16:12:40 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>To close the thread: <a data-rspec-id="S4062" class="rspec-auto-link">RSPEC-4062</a></p>
</div>
</div>
</div>
</div>