<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This rule raises an issue when a SOQL query is executed inside a loop (for, while, or do-while), which can lead to governor limit violations and poor performance.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Executing SOQL queries inside loops is a critical performance anti-pattern in Apex development that can quickly exhaust Salesforce&#8217;s governor limits.</p>
</div>
<div class="paragraph">
<p>Salesforce enforces strict limits on the number of SOQL queries that can be executed in a single transaction: 100 queries in synchronous contexts and 200 in asynchronous contexts. When you place a SOQL query inside a loop, each iteration executes a separate query against the database.</p>
</div>
<div class="paragraph">
<p>For example, if you have a loop that processes 50 records and each iteration executes one SOQL query, you&#8217;ll consume 50 of your 100 available queries in a single operation. This approach doesn&#8217;t scale - processing 150 records would exceed the governor limit and cause a runtime exception.</p>
</div>
<div class="paragraph">
<p>Beyond governor limits, this pattern creates significant performance issues. Each SOQL query requires a round trip to the database, and multiple individual queries are much slower than a single bulk query that retrieves all needed data at once.</p>
</div>
<div class="paragraph">
<p>The solution is to use bulk processing patterns: collect all the criteria (like IDs) before the loop, execute a single SOQL query with an <code>IN</code> clause or similar bulk operator, and then process the retrieved records. This approach scales efficiently regardless of data volume and respects Salesforce&#8217;s platform constraints.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>This issue can cause runtime exceptions when governor limits are exceeded, leading to transaction failures and poor user experience. It also creates significant performance degradation, especially as data volume increases, making applications slow and unresponsive.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Move the SOQL query outside the loop and use bulk operators like <code>IN</code> to retrieve all needed records in a single query. Then iterate over the retrieved results.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-apex" data-lang="apex">for(Id accountId : accountIds) {
    Account acc = [SELECT Id, Name FROM Account WHERE Id = :accountId]; // Noncompliant
    processAccount(acc);
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-apex" data-lang="apex">List&lt;Account&gt; accounts = [SELECT Id, Name FROM Account WHERE Id IN :accountIds];
for(Account acc : accounts) {
    processAccount(acc);
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Apex Governor Limits - <a href="https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/apex_gov_limits.htm">Official Salesforce documentation on governor limits including SOQL query limits</a></p>
</li>
<li>
<p>Single vs. Bulk DML Operations - <a href="https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/langCon_apex_dml_examples.htm">Best practices for writing bulk-safe Apex code</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_standards">Standards</h3>
<div class="ulist">
<ul>
<li>
<p>CWE-400: Uncontrolled Resource Consumption - <a href="https://cwe.mitre.org/data/definitions/400.html">The software does not properly control the allocation and maintenance of a limited resource</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>