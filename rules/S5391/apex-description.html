<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to protect shared resources, Salesforce enforces a maximum number of SOQL queries which can be executed inside a single transaction. This is part of Governor limits.</p>
</div>
<div class="paragraph">
<p>Limiting the number of queries executed is necessary, and SOQL queries which have no chance of returning a result should be avoided. This is why SOQL Query of the form <code>SELECT ... FROM ... WHERE ... in :filterValues</code> should first check that the Set/Map (in this example named "filterValues") is not empty.</p>
</div>
<div class="paragraph">
<p>This rule raises an issue when such an SOQL query is not enclosed in one of</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>if (!filtervalues.isEmpty())</code></p>
</li>
<li>
<p><code>if (!filtervalues.size() != 0)</code></p>
</li>
<li>
<p><code>if (!filtervalues.size() &gt; 0)</code></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_noncompliant_code_example">Noncompliant code example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-apex" data-lang="apex">public class fooClass{
        Set&lt;Id&gt; setCasesId = new Set();

        //Noncompliant - SOQL Query executed without checking whether the Set is Empty
        for(Case c :[SELECT Id FROM Case WHERE Id IN :setCasesId]){
              //something
        }
}


public class fooClass{
        Map&lt;Id, String&gt; mapCasesId = new Map();

        //Noncompliant - SOQL Query executed without checking whether the Map is Empty
        for(Case c :[SELECT Id FROM Case WHERE Id IN :mapCasesId.keyset()]){
              // ...
        }
}

public class fooClass{
        Map&lt;Id, String&gt; mapCasesId = new Map();

        //Noncompliant - SOQL Query executed without checking whether the Map is Empty or Set is Empty
        for(Case c :[SELECT Id, Subject FROM Case WHERE Id IN :mapCasesId.keyset() OR  Id IN :setCasesId]){
              // ...
        }
}


public class fooClass{
        Map&lt;Id, String&gt; mapCasesId = new Map();

        //Noncompliant - SOQL Query executed without checking whether the Map is Empty and Set is Empty
        for(Case c :[SELECT Id, Subject FROM Case WHERE Id IN :mapCasesId.keyset() AND  Id IN :setCasesId]){
              // ...
        }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_compliant_solution">Compliant solution</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-apex" data-lang="apex">public class fooClass{
        Set&lt;Id&gt; setCasesId = new Set();
        if(!setCasesId.isEmpty()){
          for(Case c :[SELECT Id FROM Case WHERE Id IN :setCasesId]){
                //something
          }
       }
       // OR
       if(!setCasesId.size() &gt; 0){
          for(Case c :[SELECT Id FROM Case WHERE Id IN :setCasesId]){
                //something
          }
       }
       // OR
       if(!setCasesId.size() != 0){
          for(Case c :[SELECT Id FROM Case WHERE Id IN :setCasesId]){
                //something
          }
       }
}


public class fooClass{
        Set&lt;Id&gt; setCasesId = new Set();
        if(!mapCasesId.isEmpty()){
          for(Case c :[SELECT Id FROM Case WHERE Id IN :mapCasesId.keyset()]){
                //something
          }
       }
}


public class fooClass{
        Map&lt;Id, String&gt; mapCasesId = new Map();
        if((!setCasesId.isEmpty()) || (!mapCasesId.isEmpty())){
        for(Case c :[SELECT Id, Subject FROM Case WHERE Id IN :mapCasesId.keyset() OR  Id IN :setCasesId]){
              //something
        }
    }
}


public class fooClass{
        Map&lt;Id, String&gt; mapCasesId = new Map();
        //Recommended - SOQL Query executed after checking that the Map is Not Empty or Set is Not Empty
        if((!setCasesId.isEmpty()) &amp;&amp; (!mapCasesId.isEmpty())){
        for(Case c :[SELECT Id, Subject FROM Case WHERE Id IN :mapCasesId.keyset()  AND  Id IN :setCasesId]){
              //something
        }
    }
}</code></pre>
</div>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Check that the Set or Map is not empty before executing this query.</p>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="paragraph">
<p>The SOQL query</p>
</div>
</div>
</div>
</div>