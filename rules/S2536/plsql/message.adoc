Refactor this procedure to take parameters.