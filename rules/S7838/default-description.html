<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is an issue when using Rails numericality validations without explicitly specifying <code>allow_nil</code> or <code>allow_blank</code> options.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Rails numericality validations reject nil values by default, even when presence validation is not specified. This behavior can be surprising and lead to unexpected validation failures.</p>
</div>
<div class="paragraph">
<p>When a field with numericality validation is left empty (nil), Rails will raise a validation error saying the field "is not a number". This happens because the numericality validator tries to convert nil to a number and fails.</p>
</div>
<div class="paragraph">
<p>This implicit behavior creates several problems:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Unexpected validation failures</strong>: Fields that seem optional will cause validation errors when left empty</p>
</li>
<li>
<p><strong>Unclear code intent</strong>: Other developers cannot tell if nil values should be allowed or rejected</p>
</li>
<li>
<p><strong>Runtime errors</strong>: Applications may fail when processing forms with empty numeric fields</p>
</li>
<li>
<p><strong>Poor user experience</strong>: Users receive confusing error messages about fields they intentionally left blank</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The solution is to always be explicit about how numericality validations should handle nil and blank values. This makes the code&#8217;s intent clear and prevents unexpected behavior.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>Applications may experience unexpected validation failures when users leave numeric fields empty. This can lead to poor user experience, failed form submissions, and runtime errors in production. The implicit behavior also makes code harder to understand and maintain.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Add <code>allow_nil: true</code> to explicitly allow nil values, or <code>allow_blank: true</code> to allow both nil and empty strings. Choose based on whether you want to accept empty form fields.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">class Product &lt; ApplicationRecord
  validates :price, numericality: true # Noncompliant
  validates :rating, numericality: { greater_than: 0 } # Noncompliant
  validates_numericality_of :score # Noncompliant
end</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">class Product &lt; ApplicationRecord
  validates :price, numericality: true, allow_nil: true
  validates :rating, numericality: { greater_than: 0, allow_blank: true }
  validates :score, numericality: { allow_nil: true, greater_than_or_equal_to: 0 }
end</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Rails Validation Helpers - numericality - <a href="https://guides.rubyonrails.org/active_record_validations.html#numericality">Official Rails documentation on numericality validation options</a></p>
</li>
<li>
<p>Rails API - validates_numericality_of - <a href="https://api.rubyonrails.org/classes/ActiveModel/Validations/HelperMethods.html#method-i-validates_numericality_of">API documentation for numericality validation helper methods</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>