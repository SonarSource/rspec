<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Subtraction of iterators only gives well-defined results if the two iterators point into the same data structure in memory (same array, same object&#8230;&#8203;).</p>
</div>
<div class="paragraph">
<p>This rule also applies to the particular case of pointers.</p>
</div>
<div class="sect2">
<h3 id="_noncompliant_code_example">Noncompliant code example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">void f(std::vector&lt;int&gt; &amp;v1, std::vector&lt;int&gt; &amp;v2) {
  auto it = std::find(v1.begin(), v1.end(), 42);
  if (it != v1.end()) {
    auto index = it - v2.begin(); // Noncompliant, iterators from different containers
  }
}

void g(int val){
  int a[10];
  for (int &amp;i : a){
    if (val == i) {
        auto index = &amp;val - &amp;a[0]; // Noncompliant, &amp;val and &amp;a[0] don't point in the same object
    }
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_compliant_solution">Compliant solution</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">void f(std::vector&lt;int&gt; &amp;v1) {
  auto it = std::find(v1.begin(), v1.end(), 42);
  if (it != v1.end()) {
    auto index = it - v1.begin(); // Compliant
  }
}

void g(int val){
  int a[10];
  for (int &amp;i : a){
    if (val == i) {
        auto index = &amp;i - &amp;a[0]; // Compliant
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>MISRA C:2004, 17.2</p>
</li>
<li>
<p>MISRA C&#43;&#43;:2008, 5-0-17</p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/469">CWE-469 - Use of Pointer Subtraction to Determine Size</a></p>
</li>
<li>
<p><a href="https://wiki.sei.cmu.edu/confluence/x/1dYxBQ">CERT, ARR36-C.</a> - Do not subtract or compare two pointers that do not refer to the same array</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Remove this subtraction from two unrelated pointers.</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_relates_to_s941">relates to: <a data-rspec-id="S941" class="rspec-auto-link">S941</a></h3>

</div>
<div class="sect2">
<h3 id="_relates_to_s5658">relates to: <a data-rspec-id="S5658" class="rspec-auto-link">S5658</a></h3>

</div>
<div class="sect2">
<h3 id="_is_related_to_s942">is related to: <a data-rspec-id="S942" class="rspec-auto-link">S942</a></h3>

</div>
<div class="sect2">
<h3 id="_on_21_oct_2014_185747_ann_campbell_wrote">on 21 Oct 2014, 18:57:47 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~samuel.mercier] the message you&#8217;ve given assumes that the subtraction is being done in the context of arrays. That could be the case, but a context of unrelated pointers is equally likely.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_23_oct_2014_162526_samuel_mercier_wrote">on 23 Oct 2014, 16:25:26 Samuel Mercier wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] I updated the description. In c arrays are just unassignable pointers with an allocated memory region. So it is probably fine to use pointer when the type is actually an array.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_24_oct_2014_154841_ann_campbell_wrote">on 24 Oct 2014, 15:48:41 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~samuel.mercier] FYI, I shortened the message.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_14_mar_2019_185741_ann_campbell_wrote">on 14 Mar 2019, 18:57:41 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~amelie.renard] I suggest: Pointers or iterators subtracted from each other should apply to the same object</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_15_mar_2019_090021_amélie_renard_wrote">on 15 Mar 2019, 09:00:21 Amélie Renard wrote:</h3>
<div class="paragraph">
<p>Thanks [~ann.campbell.2]!</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_4_feb_2020_121953_loïc_joly_wrote">on 4 Feb 2020, 12:19:53 Loïc Joly wrote:</h3>
<div class="paragraph">
<p>Similar to <a data-rspec-id="S5658" class="rspec-auto-link">RSPEC-5658</a>, but in strict MISRA form</p>
</div>
</div>
</div>
</div>