<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This rule raises an issue when reading HTTP headers using dictionary-style syntax in Flask applications, e.g. <code>request.headers['key']</code>, which throws a KeyError if the header is missing.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>HTTP headers are optional by nature, and clients may not always send the headers your application expects. When you read from a header using dictionary-style access like <code>request.headers['Authorization']</code>, Flask raises a KeyError if the header is missing.</p>
</div>
<div class="paragraph">
<p>This can cause your application to crash unexpectedly, especially when dealing with optional headers like authentication tokens, custom headers, or headers that vary between different clients and browsers.</p>
</div>
<div class="paragraph">
<p>Even when the header presence appears to be validated by guards or preconditions, dictionary-style access introduces unnecessary risk due to potential refactoring.</p>
</div>
<div class="paragraph">
<p>The <code>.get()</code> method provides a safer alternative by returning <code>None</code> (or a default value) when a header is missing, allowing your code to handle the absence gracefully instead of crashing.
Using <code>.get()</code> consistently throughout your codebase establishes a robust pattern that prevents runtime errors, improves code maintainability, and makes the optional nature of headers explicit in the code.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>A missing header will cause a KeyError exception, potentially crashing the request handler and returning a 500 Internal Server Error to the client. This creates a poor user experience and can make your application appear unreliable.</p>
</div>
<div class="paragraph">
<p>In security-sensitive contexts, unexpected crashes might also expose error information that could be useful to attackers.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Always use the <code>.get()</code> method instead of dictionary-style header access. This returns <code>None</code> for missing headers instead of raising an exception, and should be used consistently even when guards appear to protect the access. This consistent approach:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Prevents KeyError exceptions from missing headers</p>
</li>
<li>
<p>Makes the optional nature of headers explicit in the code</p>
</li>
<li>
<p>Reduces the risk of runtime errors during code evolution and refactoring</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Add appropriate checks to handle missing headers gracefully after retrieving them with <code>.get()</code>.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from flask import request

@app.route('/api')
def api_endpoint():
    auth_header = request.headers['Authorization']  # Noncompliant
    user_agent = request.headers['User-Agent']     # Noncompliant
    return process_request(auth_header, user_agent)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from flask import request

@app.route('/api')
def api_endpoint():
    auth_header = request.headers.get('Authorization')
    user_agent = request.headers.get('User-Agent', 'Unknown')

    if not auth_header:
        return 'Authorization required', 401

    return process_request(auth_header, user_agent)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Flask Request Headers Documentation - <a href="https://flask.palletsprojects.com/en/2.3.x/api/#flask.Request.headers">Official Flask documentation for accessing request headers</a></p>
</li>
<li>
<p>Werkzeug Headers Documentation - <a href="https://werkzeug.palletsprojects.com/en/2.3.x/datastructures/#werkzeug.datastructures.Headers">Documentation for the Headers class used by Flask&#8217;s request.headers</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>