<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Constructing templates by dynamically inserting strings coming from third-party
sources is an anti-pattern which creates code that is brittle, difficult to
read, and challenging to debug.</p>
</div>
<div class="paragraph">
<p>Moreover, in the long run, this practice progressively increases the likelihood
of introducing <strong>Server-Side Template Injections (SSTI)</strong>, sometimes in complex
ways that are hard to detect.<br>
An SSTI is the insertion of third-party data (like user data) within templates,
which enables attackers to execute arbitrary commands on the underlying
operating system.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ask_yourself_whether">Ask Yourself Whether</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>The third-party strings are fully trusted and controlled by you.</p>
</li>
<li>
<p>You have a secure mechanism to validate or sanitize the strings inserted into templates.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There is a risk if you answered no to any of those questions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_recommended_secure_coding_practices">Recommended Secure Coding Practices</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is recommended to standardize on safe template-building practices.<br>
Separate logic from presentation by passing dynamic data to templates through
a secure context or data-binding mechanism, rather than building the template
string itself.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sensitive_code_example">Sensitive Code Example</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const pug = require('pug');

const pugTemplate = `
doctype html
html
  head
    title=${pageTitle}
  body
    ${userInput}
`;

const compiledFunction = pug.compile(pugTemplate); // Sensitive

compiledFunction();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const pug = require('pug');

const pugTemplate = `
doctype html
html
  head
    title= pageTitle
  body
    h1= mainHeading
    p.message= message
`;

const compiledFunction = pug.compile(pugTemplate);

const templateData = {
  pageTitle: 'Safe Template Example',
  mainHeading: 'Welcome!',
  message: 'This content is passed securely as data to the template.'
};
compiledFunction(templateData);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_standards">Standards</h3>
<div class="ulist">
<ul>
<li>
<p>OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a></p>
</li>
<li>
<p>OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Make sure executing a dynamically formatted template is safe here.</p>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="ulist">
<ul>
<li>
<p>Primary: on the template execution call</p>
</li>
<li>
<p>Secondary: on each assignment / format of the template string variable</p>
<div class="ulist">
<ul>
<li>
<p>message when formatting: "Template is dynamically formatted and assigned to {variable_name}"</p>
</li>
<li>
<p>message for an assignment: "Template is assigned to {variable_name}"</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>