Constructing templates by dynamically inserting strings coming from third-party
sources is an anti-pattern which creates code that is brittle, difficult to
read, and challenging to debug.

Moreover, in the long run, this practice progressively increases the likelihood
of introducing **Server-Side Template Injections (SSTI)**, sometimes in complex
ways that are hard to detect. +
An SSTI is the insertion of third-party data (like user data) within templates,
which enables attackers to execute arbitrary commands on the underlying
operating system.

== Ask Yourself Whether

* The third-party strings are fully trusted and controlled by you.
* You have a secure mechanism to validate or sanitize the strings inserted into templates.

There is a risk if you answered no to any of those questions.

== Recommended Secure Coding Practices

It is recommended to standardize on safe template-building practices. +
Separate logic from presentation by passing dynamic data to templates through
a secure context or data-binding mechanism, rather than building the template
string itself.

== Sensitive Code Example

[source,javascript,diff-id=1,diff-type=noncompliant]
----
const pug = require('pug');

const pugTemplate = `
doctype html
html
  head
    title=${pageTitle}
  body
    ${userInput} 
`;

const compiledFunction = pug.compile(pugTemplate); // Sensitive

compiledFunction();
----

== Compliant Solution

[source,javascript,diff-id=1,diff-type=compliant]
----
const pug = require('pug');

const pugTemplate = `
doctype html
html
  head
    title= pageTitle
  body
    h1= mainHeading
    p.message= message
`;

const compiledFunction = pug.compile(pugTemplate);

const templateData = {
  pageTitle: 'Safe Template Example',
  mainHeading: 'Welcome!',
  message: 'This content is passed securely as data to the template.'
};
compiledFunction(templateData);
----

== See

=== Standards

* OWASP - https://owasp.org/Top10/A03_2021-Injection/[Top 10 2021 Category A3 - Injection]
* OWASP - https://owasp.org/www-project-top-ten/2017/A1_2017-Injection[Top 10 2017 Category A1 - Injection]
* CWE - https://cwe.mitre.org/data/definitions/20[CWE-20 - Improper Input Validation]

ifdef::env-github,rspecator-view[]

'''
== Implementation Specification
(visible only on this page)

=== Message

Make sure executing a dynamically formatted template is safe here.

=== Highlighting

* Primary: on the template execution call
* Secondary: on each assignment / format of the template string variable
** message when formatting: "Template is dynamically formatted and assigned to \{variable_name}"
** message for an assignment: "Template is assigned to \{variable_name}"

'''

endif::env-github,rspecator-view[]
