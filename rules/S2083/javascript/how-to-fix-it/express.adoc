=== How to fix it in Express.Js

The following code is vulnerable to path injection as it is constructing a path
using untrusted data. +
This path is then used without validation to return a file.

Therefore, it can be leveraged by an attacker to delete arbitrary files.

==== Non-compliant code example

[source,javascript,diff-id=1,diff-type=noncompliant]
----
const fs = require('fs');

function (req, res) {
  const userFilename = __dirname + req.query.filename;

  res.sendFile(userFilename); // Noncompliant
}
----

==== Compliant solution

[source,javascript,diff-id=1,diff-type=compliant]
----
const fs = require('fs');

function (req, res) {
  const userFilename = __dirname + req.query.filename;

  const targetDirectory = process.cwd();
  res.sendFile(userFilename, { root: targetDirectory });
}
----

=== How does this work?

:auto_canonicalization_function: res.sendFile() (used with options.root)

include::../../common/fix/function-based-validation.adoc[]
