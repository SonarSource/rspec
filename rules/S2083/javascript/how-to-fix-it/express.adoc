=== How to fix it in Express.Js

The following code is vulnerable to path injection as it is constructing a path
using untrusted data. +
This path is then used without validation to return a file.

Therefore, it can be leveraged by an attacker to read arbitrary files.

==== Noncompliant code example

[source,javascript,diff-id=1,diff-type=noncompliant]
----
const path = require('path');

function (req, res) {
  const targetDirectory = "/data/app/resources/"
  const userFilename = path.join(targetDirectory, req.query.filename);

  res.sendFile(userFilename); // Noncompliant
}
----

==== Compliant solution

[source,javascript,diff-id=1,diff-type=compliant]
----
const path = require('path');

function (req, res) {
  const targetDirectory = "/data/app/resources/";
  const userFilename = req.query.filename;

  res.sendFile(userFilename, { root: targetDirectory });
}
----

=== How does this work?

:auto_canonicalization_function: res.sendFile() (used with options.root)

include::../../common/fix/function-based-validation.adoc[]

include::../../common/fix/self-validation.adoc[]
