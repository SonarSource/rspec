<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Disabling Managed Identities can reduce an organization&#8217;s ability to protect itself against configuration faults and credential leaks.</p>
</div>
<div class="paragraph">
<p>Authenticating via managed identities to an Azure resource solely relies on an API call with a non-secret token. The process is inner to Azure: secrets used by Azure are not even accessible to end-users.</p>
</div>
<div class="paragraph">
<p>In typical scenarios without managed identities, the use of credentials can lead to mistakenly leaving them in code bases. In addition, configuration faults may also happen when storing these values or assigning them permissions.</p>
</div>
<div class="paragraph">
<p>By transparently taking care of the Azure Active Directory authentication, Managed Identities allow getting rid of day-to-day credentials management.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ask_yourself_whether">Ask Yourself Whether</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The resource:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Needs to authenticate to Azure resources that support Azure Active Directory (AAD).</p>
</li>
<li>
<p>Uses a different Access Control system that doesn&#8217;t guarantee the same security controls as AAD, or no Access Control system at all.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There is a risk if you answered yes to all of those questions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_recommended_secure_coding_practices">Recommended Secure Coding Practices</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Enable the Managed Identities capabilities of this Azure resource. If supported, use a System-Assigned managed identity, as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It cannot be shared across resources.</p>
</li>
<li>
<p>Its life cycle is deeply tied to the life cycle of its Azure resource.</p>
</li>
<li>
<p>It provides a unique independent identity.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Alternatively, User-Assigned Managed Identities can also be used but don&#8217;t guarantee the properties listed above.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sensitive_code_example">Sensitive Code Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Using JSON templates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "resources": [
        {
            "type": "Microsoft.ApiManagement/service",
            "apiVersion": "2022-09-01-preview",
            "name": "apiManagementService"
        }
    ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using Bicep:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bicep" data-lang="bicep">resource sensitiveApiManagementService 'Microsoft.ApiManagement/service@2022-09-01-preview' = {
  name: 'apiManagementService'
  // Sensitive: no Managed Identity is defined
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Using JSON templates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "resources": [
        {
            "type": "Microsoft.ApiManagement/service",
            "apiVersion": "2022-09-01-preview",
            "name": "apiManagementService",
            "identity": {
                "type": "SystemAssigned"
            }
        }
    ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using Bicep:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bicep" data-lang="bicep">resource sensitiveApiManagementService 'Microsoft.ApiManagement/service@2022-09-01-preview' = {
  name: 'apiManagementService'
  identity: {
    type: 'SystemAssigned'
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/overview">Azure AD Documentation - Managed Identities Overview</a></p>
</li>
<li>
<p><a href="https://docs.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/managed-identity-best-practice-recommendations">Azure AD Documentation - Managed Identities Best Practices</a></p>
</li>
<li>
<p><a href="https://docs.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/services-support-managed-identities">Azure AD Documentation - Services that support managed identities</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="ulist">
<ul>
<li>
<p>Omitting the "identity" block disables Azure Managed Identities. Make sure it is safe here.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="paragraph">
<p>Highlight:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The property that is wrong if it exists.</p>
</li>
<li>
<p>The entire resource block if a property is missing.</p>
</li>
</ul>
</div>
</div>
</div>
</div>