<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This rule raises an issue when SOQL queries use non-selective filters, fetch unnecessary fields, or lack proper optimization techniques that could lead to performance degradation.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>SOQL queries are a critical component of Salesforce applications, but poorly optimized queries can severely impact performance and lead to governor limit violations.</p>
</div>
<div class="paragraph">
<p>Salesforce operates on a multi-tenant architecture where resources are shared across multiple customers. To maintain platform stability, Salesforce enforces strict governor limits, including a maximum of 100 SOQL queries per transaction. When queries are not optimized, they can consume excessive resources and cause applications to hit these limits.</p>
</div>
<div class="paragraph">
<p>Non-selective queries are particularly problematic because they force the database to perform full table scans instead of using indexes. This happens when queries use filters on non-indexed fields or use operations like <code>LIKE</code> with leading wildcards. Such queries become exponentially slower as data volume grows, potentially causing timeouts or performance degradation.</p>
</div>
<div class="paragraph">
<p>Indexed fields in Salesforce include standard fields like <code>Id</code>, <code>Name</code>, <code>RecordTypeId</code>, <code>CreatedDate</code>, and custom fields marked as External Id or Unique. Using these fields in WHERE clauses allows the query optimizer to use indexes, dramatically improving performance.</p>
</div>
<div class="paragraph">
<p>Additionally, fetching unnecessary fields wastes bandwidth and memory. When queries select all fields using <code>SELECT *</code> equivalent patterns or include fields that are not actually used, they transfer more data than needed, increasing heap size usage and potentially causing memory-related governor limit violations.</p>
</div>
<div class="paragraph">
<p>In large data volume (LDV) environments, these issues become even more critical. Organizations with millions of records can experience significant performance problems if queries are not properly optimized, affecting user experience and system reliability.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>Poor SOQL query optimization can lead to several serious consequences:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Performance degradation</strong>: Non-selective queries cause slow response times, especially as data volume grows, leading to poor user experience</p>
</li>
<li>
<p><strong>Governor limit violations</strong>: Inefficient queries can cause applications to exceed Salesforce&#8217;s resource limits, resulting in runtime exceptions and application failures</p>
</li>
<li>
<p><strong>System timeouts</strong>: Queries that take too long to execute may timeout, causing incomplete operations and data inconsistency</p>
</li>
<li>
<p><strong>Increased resource consumption</strong>: Unnecessary field selection and non-selective filters consume more CPU time, heap memory, and database resources</p>
</li>
<li>
<p><strong>Scalability issues</strong>: Applications may work fine with small datasets but fail catastrophically when data volume increases</p>
</li>
<li>
<p><strong>Reduced system reliability</strong>: Frequent limit violations and timeouts can make the application unreliable for business-critical operations</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Use selective filters with indexed fields and select only necessary fields. Replace non-selective operations with indexed field filters and add appropriate LIMIT clauses.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-apex" data-lang="apex">List&lt;Account&gt; accounts = [SELECT Id, Name, BillingAddress, ShippingAddress, Description, Industry, AnnualRevenue FROM Account WHERE Description LIKE '%test%']; // Noncompliant</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-apex" data-lang="apex">List&lt;Account&gt; accounts = [SELECT Id, Name FROM Account WHERE Industry = 'Technology' AND RecordTypeId = :recordTypeId LIMIT 100];</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>SOQL Best Practices - <a href="https://developer.salesforce.com/docs/atlas.en-us.soql_sosl.meta/soql_sosl/sforce_api_calls_soql_best_practices.htm">Official Salesforce documentation on SOQL query optimization and best practices</a></p>
</li>
<li>
<p>Large Data Volumes Best Practices - <a href="https://developer.salesforce.com/docs/atlas.en-us.salesforce_large_data_volumes_bp.meta/salesforce_large_data_volumes_bp/ldv_deployments_introduction.htm">Salesforce guide for handling large data volumes and query optimization</a></p>
</li>
<li>
<p>Query Plan Tool - <a href="https://developer.salesforce.com/docs/atlas.en-us.soql_sosl.meta/soql_sosl/sforce_api_calls_soql_query_plan.htm">Documentation on using the Query Plan Tool to analyze SOQL query performance</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_standards">Standards</h3>
<div class="ulist">
<ul>
<li>
<p>Salesforce Governor Limits - <a href="https://developer.salesforce.com/docs/atlas.en-us.salesforce_app_limits_cheatsheet.meta/salesforce_app_limits_cheatsheet/salesforce_app_limits_platform_apexgov.htm">Official documentation on Salesforce platform limits including SOQL query limits</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_related_rules">Related rules</h3>
<div class="ulist">
<ul>
<li>
<p><a data-rspec-id="S2259" class="rspec-auto-link">RSPEC-2259</a> - <a href="https://rules.sonarsource.com/apex/RSPEC-2259/">SOQL queries should not be vulnerable to injection attacks</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>