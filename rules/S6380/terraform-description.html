<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Allowing anonymous access can reduce an organization&#8217;s ability to protect itself against attacks on its Azure resources.</p>
</div>
<div class="paragraph">
<p>Security incidents may include disrupting critical functions, data theft, and additional Azure subscription costs due to resource overload.</p>
</div>
<div class="paragraph">
<p>Using authentication coupled with fine-grained authorizations helps bring defense-in-depth and bring traceability to investigators of security incidents.</p>
</div>
<div class="paragraph">
<p>Depending on the affected Azure resource, multiple authentication choices are possible: Active Directory Authentication, OpenID implementations (Google, Microsoft, etc.) or native Azure mechanisms.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ask_yourself_whether">Ask Yourself Whether</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>This Azure resource is essential for the information system infrastructure.</p>
</li>
<li>
<p>This Azure resource is essential for mission-critical functions.</p>
</li>
<li>
<p>This Azure resource stores or processes sensitive data.</p>
</li>
<li>
<p>Compliance policies require access to this resource to be authenticated.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There is a risk if you answered yes to any of these questions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_recommended_secure_coding_practices">Recommended Secure Coding Practices</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Enable authentication in this Azure resource, and disable anonymous access.</p>
</div>
<div class="paragraph">
<p>If only Basic Authentication is available, enable it.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sensitive_code_example">Sensitive Code Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For <a href="https://azure.microsoft.com/en-us/services/app-service/">App Services and equivalent</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terraform" data-lang="terraform">resource "azurerm_linux_function_app" "example" {
  name = "example"

  auth_settings {
    enabled = false # Sensitive
  }

  auth_settings {
    enabled = true
    unauthenticated_client_action = "AllowAnonymous" # Sensitive
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For <a href="https://azure.microsoft.com/en-us/services/api-management/">API Management</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terraform" data-lang="terraform">resource "azurerm_api_management_api" "example" { # Sensitive, the openid_authentication block is missing
  name = "example-api"
}

resource "azurerm_api_management" "example" {
  sign_in {
    enabled = false # Sensitive
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For <a href="https://azure.microsoft.com/en-us/services/data-factory/">Data Factory</a> Linked Services:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terraform" data-lang="terraform">resource "azurerm_data_factory_linked_service_sftp" "example" {
  authentication_type = "Anonymous"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For <a href="https://azure.microsoft.com/en-us/product-categories/storage/">Storage Accounts</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terraform" data-lang="terraform">resource "azurerm_storage_account" "example" {
  allow_blob_public_access = true # Sensitive
}

resource "azurerm_storage_container" "example" {
  container_access_type = "blob" # Sensitive
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For <a href="https://azure.microsoft.com/en-us/services/cache/">Redis Caches</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terraform" data-lang="terraform">resource "azurerm_redis_cache" "example" {
  name = "example-cache"

  redis_configuration {
    enable_authentication = false # Sensitive
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For <a href="https://azure.microsoft.com/en-us/services/app-service/">App Services and equivalent</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terraform" data-lang="terraform">resource "azurerm_linux_function_app" "example" {
  name = "example"

  auth_settings {
    enabled = true
    unauthenticated_client_action = "RedirectToLoginPage"
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For <a href="https://azure.microsoft.com/en-us/services/api-management/">API Management</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terraform" data-lang="terraform">resource "azurerm_api_management_api" "example" {
  name = "example-api"

  openid_authentication {
    openid_provider_name = azurerm_api_management_openid_connect_provider.example.name
  }
}

resource "azurerm_api_management" "example" {
  sign_in {
    enabled = true
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For <a href="https://azure.microsoft.com/en-us/services/data-factory/">Data Factory</a> Linked Services:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terraform" data-lang="terraform">resource "azurerm_data_factory_linked_service_sftp" "example" {
  authentication_type = "Basic"
  username            = local.creds.username
  password            = local.creds.password
}

resource "azurerm_data_factory_linked_service_odata" "example" {
  basic_authentication {
    username = local.creds.username
    password = local.creds.password
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For <a href="https://azure.microsoft.com/en-us/product-categories/storage/">Storage Accounts</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terraform" data-lang="terraform">resource "azurerm_storage_account" "example" {
  allow_blob_public_access = true
}

resource "azurerm_storage_container" "example" {
  container_access_type = "private"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For <a href="https://azure.microsoft.com/en-us/services/cache/">Redis Caches</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terraform" data-lang="terraform">resource "azurerm_redis_cache" "example" {
  name = "example-cache"

  redis_configuration {
    enable_authentication = true
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/668">CWE-668 - Exposure of Resource to Wrong Sphere</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="ulist">
<ul>
<li>
<p>For App Service and equivalent resources:</p>
<div class="ulist">
<ul>
<li>
<p>If <code>auth_settings</code> block is missing: Omitting <code>auth_settings</code> disables authentication. Make sure it is safe here.</p>
</li>
<li>
<p>if <code>auth_settings&#8594;enabled = false</code>: Make sure that disabling authentication is safe here.</p>
</li>
<li>
<p>if <code>auth_settings&#8594;unauthenticated_client_action = "AllowAnonymous"</code>: Make sure that authorizing anonymous access is safe here.</p>
</li>
</ul>
</div>
</li>
<li>
<p>For <code>api_management_api</code>: Omitting <code>openid_authentication</code> disables authentication. Make sure it is safe here.</p>
</li>
<li>
<p>For <code>api_management</code> resources:</p>
<div class="ulist">
<ul>
<li>
<p>If <code>sign_in</code> block is missing: Omitting <code>sign_in</code> authorizes anonymous access. Make sure it is safe here.</p>
</li>
<li>
<p>If <code>sign_in&#8594;enabled = false</code>: Make sure that giving anonymous access without enforcing sign-in is safe here.</p>
</li>
</ul>
</div>
</li>
<li>
<p>For <code>data_factory_linked_service_odata</code>: Omitting the <code>basic_authentication</code> block disables authentication. Make sure it is safe here.</p>
</li>
<li>
<p>For <code>data_factory_linked_service_sftp</code> and <code>data_factory_linked_service_web</code>: Make sure that authorizing anonymous access is safe here.</p>
</li>
<li>
<p>For <code>redis_cache</code>: Make sure that disabling authentication is safe here.</p>
</li>
<li>
<p>For <code>storage_account</code>: Make sure that authorizing potential anonymous access is safe here.</p>
</li>
<li>
<p>For <code>storage_container</code>: Make sure that authorizing potential anonymous access is safe here.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note: App Service and equivalents resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>app_service</code></p>
</li>
<li>
<p><code>app_service_slot</code></p>
</li>
<li>
<p><code>function_app</code></p>
</li>
<li>
<p><code>function_app_slot</code></p>
</li>
<li>
<p><code>linux_function_app</code></p>
</li>
<li>
<p><code>linux_function_app_slot</code></p>
</li>
<li>
<p><code>windows_function_app</code></p>
</li>
<li>
<p><code>windows_function_app_slot</code></p>
</li>
<li>
<p><code>linux_web_app</code></p>
</li>
<li>
<p><code>windows_web_app</code>
=== Highlighting</p>
</li>
<li>
<p>For App Service and equivalents:</p>
<div class="ulist">
<ul>
<li>
<p>Highlight the resource if the <code>auth_settings</code> block is missing</p>
</li>
<li>
<p>Highlight <code>auth_settings&#8594;enabled = false</code> regardless of <code>auth_settings&#8594;unauthenticated_client_action</code></p>
</li>
<li>
<p>Highlight <code>auth_settings&#8594;unauthenticated_client_action = "AllowAnonymous"</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>For <code>api_management_api</code>: Highlight the resource if the <code>openid_authentication</code> block is missing</p>
</li>
<li>
<p>For <code>api_management</code>:</p>
<div class="ulist">
<ul>
<li>
<p>Highlight the resource if the <code>sign_in</code> block is missing</p>
</li>
<li>
<p>Highlight <code>sign_in&#8594;enabled = false</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>For <code>data_factory_linked_service_odata</code>: Highlight the resource if the <code>basic_authentication</code> block is missing</p>
</li>
<li>
<p>For <code>data_factory_linked_service_sftp</code> and <code>data_factory_linked_service_web</code>: Highlight <code>authentication_type = "Anonymous"</code></p>
</li>
<li>
<p>For <code>redis_cache</code>: Highlight <code>redis_configuration&#8594;enable_authentication = false</code></p>
</li>
<li>
<p>For <code>storage_account</code>: Highlight <code>allow_blob_public_access = true</code></p>
</li>
<li>
<p>For <code>storage_container</code>: Highlight <code>container_access_type = "private"</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>