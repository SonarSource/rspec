<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This vulnerability allows the usage of external entities in XML.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>External Entity Processing allows for XML parsing with the involvement of
external entities. However, when this functionality is enabled without proper
precautions, it can lead to a vulnerability known as XML External Entity (XXE)
attack.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="sect3">
<h4 id="_exposing_sensitive_data">Exposing sensitive data</h4>
<div class="paragraph">
<p>One significant danger of XXE vulnerabilities is the potential for sensitive
data exposure. By crafting malicious XML payloads, attackers can reference
external entities that contain sensitive information, such as system files,
database credentials, or configuration files. When these entities are processed
during XML parsing, the attacker can extract the contents and gain unauthorized
access to sensitive data. This poses a severe threat to the confidentiality of
critical information.</p>
</div>
</div>
<div class="sect3">
<h4 id="_exhausting_system_resources">Exhausting system resources</h4>
<div class="paragraph">
<p>Another consequence of XXE vulnerabilities is the potential for
denial-of-service attacks. By exploiting the ability to include external
entities, attackers can construct XML payloads that cause resource exhaustion.
This can overwhelm the system&#8217;s memory, CPU, or other critical resources,
leading to system unresponsiveness or crashes. A successful DoS attack can
disrupt the availability of services and negatively impact the user experience.</p>
</div>
</div>
<div class="sect3">
<h4 id="_forging_requests">Forging requests</h4>
<div class="paragraph">
<p>XXE vulnerabilities can also enable Server-Side Request Forgery (SSRF) attacks.
By leveraging the ability to include external entities, an attacker can make the
vulnerable application send arbitrary requests to other internal or external
systems. This can result in unintended actions, such as retrieving data from
internal resources, scanning internal networks, or attacking other systems.
SSRF attacks can lead to severe consequences, including unauthorized data
access, system compromise, or even further exploitation within the network
infrastructure.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it_in_libxmljs">How to fix it in libxmljs</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="paragraph">
<p>The following code contains examples of XML parsers that have external entity
processing enabled. As a result, the parsers are vulnerable to XXE attacks if
an attacker can control the XML file that is processed.</p>
</div>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">var libxmljs = require('libxmljs');
var fs = require('fs');

var xml = fs.readFileSync('xxe.xml', 'utf8');
libxmljs.parseXmlString(xml, {
    noblanks: true,
    noent: true, // Noncompliant
    nocdata: true
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="paragraph">
<p><code>parseXmlString</code> is safe by default.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">var libxmljs = require('libxmljs');
var fs = require('fs');

var xml = fs.readFileSync('xxe.xml', 'utf8');
libxmljs.parseXmlString(xml);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_how_does_this_work">How does this work?</h3>
<div class="sect3">
<h4 id="_disable_external_entities">Disable external entities</h4>
<div class="paragraph">
<p>The most effective approach to prevent XXE vulnerabilities is to disable
external entity processing entirely, unless it is explicitly required for
specific use cases.
By default, XML parsers should be configured to reject the processing of
external entities. This can be achieved by setting the appropriate properties or
options in your XML parser library or framework.</p>
</div>
<div class="paragraph">
<p>If external entity processing is necessary for certain scenarios, adopt a
whitelisting approach to restrict the entities that can be resolved during XML
parsing. Create a list of trusted external entities and disallow all others.
This approach ensures that only known and safe entities are processed.<br>
You should rely on features provided by your XML parser to restrict the external
entities.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_standards">Standards</h3>
<div class="ulist">
<ul>
<li>
<p>OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a></p>
</li>
<li>
<p>OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A4_2017-XML_External_Entities_(XXE)">Top 10 2017 Category A4 - XML External Entities (XXE)</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/611">CWE-611 - Information Exposure Through XML External Entity Reference</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/827">CWE-827 - Improper Control of Document Type Definition</a></p>
</li>
<li>
<p>STIG Viewer - <a href="https://stigviewer.com/stigs/application_security_and_development/2024-12-06/finding/V-222608">Application Security and Development: V-222608</a> - The application must not be vulnerable to XML-oriented attacks.</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="ulist">
<ul>
<li>
<p>Primary: where the xml parsing is done / incorrect options are used</p>
</li>
<li>
<p>Secondary: where the xml option enable external entities</p>
<div class="ulist">
<ul>
<li>
<p>message: "This value enables external entities in XML parsing."</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Disable access to external entities in XML parsing.</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_deprecates_s4435">deprecates: <a data-rspec-id="S4435" class="rspec-auto-link">S4435</a></h3>

</div>
<div class="sect2">
<h3 id="_on_23_mar_2015_195642_ann_campbell_wrote">on 23 Mar 2015, 19:56:42 Ann Campbell wrote:</h3>
<div class="paragraph">
<p><a href="https://www.owasp.org/index.php/XML_External_Entity_%28XXE%29_Processing" class="bare">https://www.owasp.org/index.php/XML_External_Entity_%28XXE%29_Processing</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_on_20_jul_2015_073417_ann_campbell_wrote">on 20 Jul 2015, 07:34:17 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>Tagged java-top by Ann [~nicolas.peru]</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_25_jan_2022_103400_quentin_jaquier_wrote">on 25 Jan 2022, 10:34:00 Quentin Jaquier wrote:</h3>
<div class="paragraph">
<p>Quick fixes (for Java): even if it is technically possible to provide a fix that would result in compliant code, it does not sound wise to set properties blindly, as it can have side effects. Fixing the issue requires a careful and good understanding of the overall context of the code.</p>
</div>
</div>
</div>
</div>