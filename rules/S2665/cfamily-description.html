<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Although some compilers will allow it, the use of <code>sizeof</code> and <code>alignof</code> with arguments that have a <code>void</code> type is forbidden by both the C and C&#43;&#43; standards.</p>
</div>
<div class="sect2">
<h3 id="_noncompliant_code_example">Noncompliant code example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">void fun() {
  void* p;
  sizeof(*p);  // Noncompliant
  sizeof(void);  // Noncompliant
  alignof(*p);  // Noncompliant
  alignof(void);  // Noncompliant
}</code></pre>
</div>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Don&#8217;t use the "alignof" operator with an operand of a "void" type.</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_28_mar_2015_222724_evgeny_mandrikov_wrote">on 28 Mar 2015, 22:27:24 Evgeny Mandrikov wrote:</h3>
<div class="paragraph">
<p>\[~freddy.mallet] [~ann.campbell.2] Words "evaluate a 'void' type" doesn&#8217;t sound good/correct for me, might be better to change on "operand of a void type".</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_30_mar_2015_131123_ann_campbell_wrote">on 30 Mar 2015, 13:11:23 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~evgeny.mandrikov] how about 'should not be used on "void"' ?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_30_mar_2015_131951_evgeny_mandrikov_wrote">on 30 Mar 2015, 13:19:51 Evgeny Mandrikov wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] fine. But in any case I don&#8217;t see how second example connected with description, which relates to <a data-rspec-id="S2215" class="rspec-auto-link">RSPEC-2215</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_31_mar_2015_131415_evgeny_mandrikov_wrote">on 31 Mar 2015, 13:14:15 Evgeny Mandrikov wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] I suspect that [~freddy.mallet] misunderstood Cppcheck rule, so that correct example looks like:</p>
</div>
<div class="paragraph">
<p>{noformat}</p>
</div>
<div class="paragraph">
<p>void test() {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>void* p;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>sizeof(*p);</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="paragraph">
<p>{noformat}</p>
</div>
<div class="paragraph">
<p>and in this case there is indeed no intersection with <a data-rspec-id="S2215" class="rspec-auto-link">RSPEC-2215</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_31_mar_2015_143056_ann_campbell_wrote">on 31 Mar 2015, 14:30:56 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>updated</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_31_mar_2015_143720_evgeny_mandrikov_wrote">on 31 Mar 2015, 14:37:20 Evgeny Mandrikov wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] Title wasn&#8217;t changed, so I did change and now spec LGTM.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_31_mar_2015_160726_ann_campbell_wrote">on 31 Mar 2015, 16:07:26 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~evgeny.mandrikov] title was changed as I thought you&#8217;d agreed. But okay.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_31_mar_2015_162404_evgeny_mandrikov_wrote">on 31 Mar 2015, 16:24:04 Evgeny Mandrikov wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] I wasn&#8217;t agree with word "evaluate", which remained in "used to evaluate 'void'", but I was agree with "used on 'void'" :) and finally took a decision to go ahead with my own proposal :)</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_9_apr_2015_082507_evgeny_mandrikov_wrote">on 9 Apr 2015, 08:25:07 Evgeny Mandrikov wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] In fact I didn&#8217;t found that C standard forbids this, whereas C&#43;&#43; standard indeed forbids. Also GCC warns about this in C&#43;&#43; mode and still compiles, and doesn&#8217;t warn in C mode. This <strong>GNU extension</strong> is indeed most probably originated from GCC compiler, but exists in some others for compatibility reasons - for example behavior of ICC (Intel Compiler) is the same as GCC, whereas Clang rejects this in C&#43;&#43; mode, but accepts in C without any warnings. Also statement "gcc is not a conforming C compiler by default" sounds a bit strong and aggressive. Based on this I think that we should adjust description.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_9_apr_2015_091510_evgeny_mandrikov_wrote">on 9 Apr 2015, 09:15:10 Evgeny Mandrikov wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] however most probably I&#8217;m wrong about C standard, so taking ticket back to provide more details.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_9_apr_2015_132226_evgeny_mandrikov_wrote">on 9 Apr 2015, 13:22:26 Evgeny Mandrikov wrote:</h3>
<div class="paragraph">
<p>C11 6.5.3.4p1:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>The sizeof operator shall not be applied to an expression that has function type or an incomplete type, to the parenthesized name of such a type, or to an expression that designates a bit-field member. The _Alignof operator shall not be applied to a function type or an incomplete type.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>and C11 6.2.5p19:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>The void type comprises an empty set of values; it is an incomplete object type that cannot be completed.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>from where I conclude that indeed usage of "void" is not allowed by C11 standard.</p>
</div>
<div class="paragraph">
<p>And indeed - GCC 4.8.4 and Clang 3.6.0 would warn about this in "pedantic" C mode, but not ICC 15.0.2.</p>
</div>
<div class="paragraph">
<p>CPP11 5.3.3p1:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>The sizeof operator shall not be applied to an expression that has function or incomplete type, &#8230;&#8203;</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>CPP11 5.3.6p1:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>An alignof expression yields the alignment requirement of its operand type. The operand shall be a type-id representing a complete object type or an array thereof or a reference to a complete object type.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>CPP11 3.9.1p9:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>The void type is an incomplete type that cannot be completed.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>So that not allowed by CPP11 too.</p>
</div>
<div class="paragraph">
<p>As was stated before - Clang will reject with error, GCC and ICC will show warning.</p>
</div>
<div class="paragraph">
<p>I hope this is enough to clarify description.</p>
</div>
<div class="paragraph">
<p>Also scope can be extended to cover "alignof" for which compilers behave in the same way as for "sizeof".</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_13_apr_2015_202502_evgeny_mandrikov_wrote">on 13 Apr 2015, 20:25:02 Evgeny Mandrikov wrote:</h3>
<div class="paragraph">
<p>LGTM.</p>
</div>
</div>
</div>
</div>