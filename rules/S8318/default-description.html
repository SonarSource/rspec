<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This rule raises an issue when code directly references or uses <code>java.sql.Connection</code> instead of using Groovy&#8217;s <code>Sql</code> abstraction layer.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Direct use of <code>java.sql.Connection</code> in Groovy applications goes against idiomatic Groovy practices and creates unnecessary complexity.</p>
</div>
<div class="paragraph">
<p>Groovy provides the <code>Sql</code> class as a higher-level abstraction over JDBC that offers several advantages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Automatic resource management</strong>: The <code>Sql</code> class handles connection, statement, and result set cleanup automatically, reducing the risk of resource leaks.</p>
</li>
<li>
<p><strong>Concise syntax</strong>: Groovy&#8217;s <code>Sql</code> provides methods like <code>eachRow()</code>, <code>rows()</code>, and <code>execute()</code> that eliminate boilerplate code.</p>
</li>
<li>
<p><strong>Built-in error handling</strong>: The abstraction layer includes better exception handling and resource cleanup in error scenarios.</p>
</li>
<li>
<p><strong>Groovy-friendly result handling</strong>: Results are returned as <code>GroovyRowResult</code> objects that can be accessed using property syntax.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Using raw JDBC connections requires manual resource management, verbose try-catch-finally blocks, and explicit handling of statements and result sets. This approach is more error-prone and harder to maintain.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>Using direct JDBC connections can lead to resource leaks if connections, statements, or result sets are not properly closed. This can cause database connection pool exhaustion and application performance degradation. Additionally, the code becomes more verbose and harder to maintain compared to using Groovy&#8217;s idiomatic database access patterns.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Replace direct Connection usage with Groovy&#8217;s Sql class. Use the Sql constructor with a DataSource and leverage its convenient methods for database operations.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import java.sql.Connection
import java.sql.Statement
import java.sql.ResultSet

Connection conn = dataSource.getConnection() // Noncompliant
Statement stmt = conn.createStatement()
ResultSet rs = stmt.executeQuery('SELECT * FROM users')
while (rs.next()) {
    println rs.getString('name')
}
rs.close()
stmt.close()
conn.close()</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import groovy.sql.Sql

Sql sql = new Sql(dataSource)
sql.eachRow('SELECT * FROM users') { row -&gt;
    println row.name
}
sql.close()</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Groovy Sql Documentation - <a href="https://docs.groovy-lang.org/latest/html/api/groovy/sql/Sql.html">Official Groovy documentation for the Sql class and its methods</a></p>
</li>
<li>
<p>Groovy Database Programming - <a href="https://groovy-lang.org/databases.html">Groovy guide on database programming using the Sql abstraction</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_related_rules">Related rules</h3>
<div class="ulist">
<ul>
<li>
<p>CodeNarc-JdbcConnectionReference - <a href="https://codenarc.org/codenarc-rules-jdbc.html#jdbcconnectionreference-rule">CodeNarc rule that checks for direct use of java.sql.Connection</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>