<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>C&#43;&#43;20 has introduced an initializer construct in the range-based <code>for</code> loops. Similar to <code>if</code> with initializer and <code>switch</code> with initializer, the initializer of a range-based <code>for</code> loop enables you to declare and initialize a variable to make it visible only in the range condition and in the body of the loop.</p>
</div>
<div class="paragraph">
<p>Previously, variables were either declared before the statement, hence leaked into the ambient scope, or an explicit scope was used to keep the scope tight, especially when using RAII objects. This was inconvenient as it would lead to error-prone patterns.</p>
</div>
<div class="paragraph">
<p>This rule reports variables declared outside and used only inside of a range-based <code>for</code> loop.</p>
</div>
<div class="sect2">
<h3 id="_noncompliant_code_example">Noncompliant code example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">std::vector&lt;std::vector&lt;int&gt;&gt; getTable();
void printHeadersBad() {
  auto rows = getTable(); // Noncompliant: rows is accessible outside of the loop
  for (int x : rows[0]) {
    std::cout &lt;&lt;x &lt;&lt;' ';
  }
  // ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using a temporary to avoid leaking of the variable into the ambient scope creates a bigger problem: an undefined behavior. Even though the lifetime of a temporary returned by the range expression is extended, the life of a temporary within the range expression terminates before the loop begins to execute.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">std::vector&lt;std::vector&lt;int&gt;&gt; getTable();
void printHeadersWorse() {
  for (int x : getTable()[0]) { // Noncompliant: undefined behavior: return value of getTable() no longer exists in the loop body
    std::cout &lt;&lt;x &lt;&lt;' ';
  }
  // ...
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_compliant_solution">Compliant solution</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">std::vector&lt;std::vector&lt;int&gt;&gt; getTable();
void printHeadersGood() {
  for (auto rows = getTable(); int x : table[0]) { // Compliant: rows is accessible only inside the loop
    std::cout &lt;&lt;x &lt;&lt;' ';
  }
  // ...
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>The same rule for <code>if</code> and <code>switch</code> statements in C&#43;&#43;17: <a data-rspec-id="S6004" class="rspec-auto-link">S6004</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_24_mar_2021_203751_abbas_sabra_wrote">on 24 Mar 2021, 20:37:51 Abbas Sabra wrote:</h3>
<div class="paragraph">
<p>Note: To be deleted</p>
</div>
</div>
</div>
</div>