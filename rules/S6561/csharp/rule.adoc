== Why is this an issue?

include::../firstWhy.adoc[]

[source,csharp]
----
account1.updatedAt = DateTime.UtcNow; // First call, might be N ticks
account2.updatedAt = DateTime.UtcNow; // Second call, this one could be N + 1 ticks, but also N.
Console.WriteLine($"The accounts have been updated at {DateTime.UtcNow}"); // Third call, this can also be N, N + 1 or N + 2 ticks
----

include::../secondWhy.adoc[]

[source,csharp]
----
var start = DateTime.Now; // First call, on March 26th 2:59 am
MethodToBeBenchmarked();

var elapsed = (int)(DateTime.Now - start).TotalMilliseconds; // Second call happens 2 minutes later but `Now` is March 26th, 4:01 am as there's a shift to summer time
----

== How to fix it

include::../howToFix.adoc[]

=== Code examples

==== Noncompliant code example

[source,csharp,diff-id=1,diff-type=noncompliant]
----
account1.updatedAt = DateTime.UtcNow; // Noncompliant
account2.updatedAt = DateTime.UtcNow; // Secondary
Console.WriteLine($"The accounts have been updated at {DateTime.UtcNow}"); // Secondary
----

==== Compliant solution

[source,csharp,diff-id=1,diff-type=compliant]
----
var now = DateTime.UtcNow; // Compliant
account1.updatedAt = now;
account2.updatedAt = now;
Console.WriteLine($"The accounts have been updated at {now}");
----

==== Noncompliant code example

[source,csharp,diff-id=1,diff-type=noncompliant]
----
if ((DateTime.UtcNow - latest).TotalMillisecond > 100) // Noncompliant
{
    // Do stuff
    latest = DateTime.UtcNow; // Secondary
}
----

==== Compliant solution

[source,csharp,diff-id=1,diff-type=compliant]
----
var utcNow = DateTime.UtcNow;
if ((utcNow - latest).TotalMillisecond > 100) // Compliant
{
    // Do stuff
    latest = utcNow; // Secondary
}
----

or

[source,csharp,diff-id=1,diff-type=compliant]
----
var stopWatch = Stopwatch.StartNew();

if (stopWatch.ElapsedMilliseconds > 100) // Compliant
{
    // Do stuff
    stopWatch.Restart();
}
----

==== Noncompliant code example

[source,csharp,diff-id=1,diff-type=noncompliant]
----
var start = DateTime.Now; // Noncompliant
MethodToBeBenchmarked();

Console.WriteLine($"{(DateTime.Now - start).TotalMilliseconds} ms"); // Secondary
----

==== Compliant solution

[source,csharp,diff-id=1,diff-type=compliant]
----
var stopWatch = Stopwatch.StartNew(); // Compliant
MethodToBeBenchmarked();
stopWatch.Stop();

Console.WriteLine($"{stopWatch.ElapsedMilliseconds} ms");
----

include::../resources.adoc[]