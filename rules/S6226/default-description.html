<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In C&#43;&#43;, every independent object needs to have a unique address, which implies that its size cannot be null. Sub-objects of another object, however, do not have this constraint. Empty base class subobjects usually don&#8217;t take any space in the final object, but empty member variables, by default, take at least one byte. The impact on the object&#8217;s size may be even larger due to padding and alignment requirements.</p>
</div>
<div class="paragraph">
<p>C&#43;&#43;20 introduces the <code>[[no_unique_address]]</code> attribute. It indicates that preserving the uniqueness of the address guarantee is not important for the decorated member variable. If the variable type is empty, no storage needs to be reserved for it in the class.</p>
</div>
<div class="paragraph">
<p>If the type is not empty, this attribute is still valid and has no effect. This allows placing this attribute on dependent member variables in template classes and having the exact behavior depend on the template parameters.</p>
</div>
<div class="paragraph">
<p>This rule raises an issue on each member of a class that has an empty or potentially empty (in case of templates) type and does not have a <code>[[no_unique_address]]</code> attribute.</p>
</div>
<div class="paragraph">
<p>Note: This rule is disabled on Windows because <code>[[no_unique_address]]</code> <a href="https://devblogs.microsoft.com/cppblog/msvc-cpp20-and-the-std-cpp20-switch/#c20-no_unique_address">isn&#8217;t well supported by MSVC and Clang on this platform</a>.</p>
</div>
<div class="sect2">
<h3 id="_noncompliant_code_example">Noncompliant code example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">struct Empty {};
struct Wrapped {
  int* ptr;
  Empty e; // Noncompliant
}; // sizeof(Wrapped) is &gt; sizeof(int*)

template&lt;typename K, typename V, typename Hash, typename Equal&gt;
class HashMap {
  /* ... */
  Hash hash; // Noncompliant if HashMap is instantiated with an empty Hash
  Equal equal; // Noncompliant if HashMap is instantiated with an empty Equal
};</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_compliant_solution">Compliant solution</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">struct Empty {};
struct Wrapped {
  int* ptr;
  [[no_unique_address]] Empty e;
}; // sizeof(Wrapped) can be equal to sizeof(int*)

template&lt;typename K, typename V, typename Hash, typename Equal&gt;
class HashMap {
  /* ... */
  [[no_unique_address]] Hash hash;
  [[no_unique_address]] Equal equal;
};</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_exceptions">Exceptions</h3>
<div class="paragraph">
<p>This rule does not apply to fields whose class has a non-default alignment.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>C&#43;&#43; reference - <a href="https://en.cppreference.com/w/cpp/language/attributes/no_unique_address">C&#43;&#43; attribute: no_unique_address</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_is_related_to_s6227">is related to: <a data-rspec-id="S6227" class="rspec-auto-link">S6227</a></h3>

</div>
</div>
</div>