<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Defining a custom role at the <code>Subscription</code> or <code>Management group</code> scope that
allows all actions will give it the same capabilities as the built-in <code>Owner</code>
role.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In Azure, the <code>Owner</code> role of a <code>Subscription</code> or a <code>Management group</code> provides
entities it is assigned to with the maximum level of privileges. The <code>Owner</code>
role allows managing all resources and assigning any role to other entities.</p>
</div>
<div class="paragraph">
<p>Because it is a powerful entitlement, it should be granted to as few users as
possible.</p>
</div>
<div class="paragraph">
<p>When a custom role has the same level of permissions as the <code>Owner</code> one, there
are greater chances that high privileges are granted to too many users.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>Custom roles that provide the same level of permissions as <code>Owner</code> might
indicate a configuration issue. Any entity assigned with it can perform any
action on the <code>Subscription</code> or <code>Management group</code>, including changing roles and
permissions.</p>
</div>
<div class="paragraph">
<p>If the affected role is unexpectedly assigned to users, they can compromise the
affected scope. They can do so in the long term by assigning dangerous roles to
other users or entities.</p>
</div>
<div class="paragraph">
<p>Depending on the scope to which the role is assignable, the exact impact of a
successful exploitation may vary. It generally ranges from data compromise to
the takeover of the cloud infrastructure.</p>
</div>
<div class="sect3">
<h4 id="_infrastructure_takeover">Infrastructure takeover</h4>
<div class="paragraph">
<p>By obtaining the right role, an attacker can gain control over part or all of
the Azure infrastructure. They can modify DNS settings, redirect traffic, or
launch malicious instances that can be used for various nefarious activities,
including launching DDoS attacks, hosting phishing websites, or distributing
malware. Malicious instances may also be used for resource-intensive tasks such
as cryptocurrency mining.</p>
</div>
<div class="paragraph">
<p>This can result in legal liability, but also increased costs, degraded
performance, and potential service disruptions.</p>
</div>
<div class="paragraph">
<p>Furthermore, corporate Azure infrastructures are often connected to other
services and to the internal networks of the organization. Because of this,
cloud infrastructure is often used by attackers as a gateway to other assets.
Attackers can leverage this gateway to gain access to more services, to
compromise more business-critical data, and to cause more damage to the overall
infrastructure.</p>
</div>
</div>
<div class="sect3">
<h4 id="_compromise_of_sensitive_data">Compromise of sensitive data</h4>
<div class="paragraph">
<p>If the affected service is used to store or process personally identifiable
information or other sensitive data, attackers with the correct role could be
able to access it. Depending on the type of data that is compromised, it could
lead to privacy violations, identity theft, financial loss, or other negative
outcomes.</p>
</div>
<div class="paragraph">
<p>In most cases, a company suffering a sensitive data compromise will face a
reputational loss when the security issue is publicly disclosed.</p>
</div>
</div>
<div class="sect3">
<h4 id="_financial_loss">Financial loss</h4>
<div class="paragraph">
<p>Financial losses can occur when a malicious user is able to use a paid
third-party-provided service. Each users assigned with a bad role will be
able to use it without limit to use the third party service to their own need,
including in a way that was not expected.</p>
</div>
<div class="paragraph">
<p>This additional use will lead to added costs with the Azure service provider.</p>
</div>
<div class="paragraph">
<p>Moreover, when rate or volume limiting is set up on the provider side, this
additional use can prevent the regular operation of the affected environment.
This might result in a partial denial of service for all legitimate users.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To reduce the risk of intrusion of a compromised owner, it is recommended to limit the number of subscription owners.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terraform" data-lang="terraform">resource "azurerm_role_definition" "example" { # Sensitive
  name        = "example"
  scope       = data.azurerm_subscription.primary.id

  permissions {
    actions     = ["*"]
    not_actions = []
  }

  assignable_scopes = [
    data.azurerm_subscription.primary.id
  ]
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terraform" data-lang="terraform">resource "azurerm_role_definition" "example" {
  name        = "example"
  scope       = data.azurerm_subscription.primary.id

  permissions {
    actions     = ["Microsoft.Compute/*"]
    not_actions = []
  }

  assignable_scopes = [
    data.azurerm_subscription.primary.id
  ]
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_going_the_extra_mile">Going the extra mile</h3>
<div class="paragraph">
<p>Here is a list of recommendations that can be followed regarding good usage of
roles:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Apply the least privilege principle by creating a custom role with as few
permissions as possible.</p>
</li>
<li>
<p>As custom roles can be updated, gradually add atomic permissions when
required.</p>
</li>
<li>
<p>Limit the assignable scopes of the custom role to a set of Resources or
Resource Groups.</p>
</li>
<li>
<p>When necessary, use the built-in Owner role instead of a custom role granting
subscription owner capabilities.</p>
</li>
<li>
<p>Limit the assignments of Owner roles to less than three people or service
principals.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Azure Documentation - <a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/custom-roles">Azure custom roles</a></p>
</li>
<li>
<p>Azure Documentation - <a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/best-practices">Best practices for Azure RBAC</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_standards">Standards</h3>
<div class="ulist">
<ul>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/266">CWE-266 - Incorrect Privilege Assignment</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="ulist">
<ul>
<li>
<p>Primary location</p>
<div class="ulist">
<ul>
<li>
<p>Narrow the number of actions or the assignable scope of this custom role.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Secondary location</p>
<div class="ulist">
<ul>
<li>
<p>Allows all actions</p>
</li>
<li>
<p>High scope level.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="ulist">
<ul>
<li>
<p>Primary location</p>
<div class="ulist">
<ul>
<li>
<p>Highlight the resource of type <code>Microsoft.Authorization/roleDefinitions</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Secondary location</p>
<div class="ulist">
<ul>
<li>
<p>The <code>*</code> item in the <code>actions</code> list</p>
</li>
<li>
<p>Subscription or Management Group scopes in <code>assignable_scopes</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>