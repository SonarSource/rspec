Passing ``++NULL++`` to a C library function that requires non-null pointer arguments results in undefined behavior and may crash the application.

== Why is this an issue?

The standard C library includes a variety of functions for string and general memory manipulations.
These functions typically take pointers and respective lengths as parameters to specify the chunks of memory to be processed.
Many of these functions require valid parameters and when given values outside a function's domain, the behavior is undefined.
In that case, the application may crash or, even worse, silently lose data or produce incorrect results.
The C library functions listed in what follows require non-``++NULL++`` pointer parameters.
Failing to provide non-``++NULL++`` parameters introduces undefined behavior.

* ``++int aio_suspend(const struct aiocb* const aiocb_list[], int nitems, const struct timespec* timeout);++``
* ``++int bcmp(const void *s1, const void *s2, size_t n);++``
* ``++void bcopy(const void *src, void *dest, size_t n);++``
* ``++void* bsearch(const void* key, const void* base, size_t nmemb, size_t size, int (*compar)(const void *, const void *));++``
* ``++void bzero(void *s, size_t n);++``
* ``++size_t confstr(int name, char *buf, size_t len);++``
* ``++void encrypt(char block[64], int edflag);++``
* ``++double erand48(unsigned short xsubi[3]);++``
* ``++void explicit_bzero(void *s, size_t n);++``
* ``++explicit_memset++``
* ``++int fgetpwent_r(FILE* fp, struct passwd* pwbuf, char* buf, size_t buflen, struct passwd** pwbufp);++``
* ``++char* fgets(char* str, int size, FILE* stream);++``
* ``++wchar_t* fgetws(wchar_t* restrict ws, int n, FILE* restrict fp);++``
* ``++size_t fread(void *ptr, size_t size, size_t nmemb, FILE *stream);++``
* ``++size_t fwrite(const void *ptr, size_t size, size_t nmemb, FILE *stream);++``
* ``++ssize_t getdelim(char **lineptr, size_t *n, int delim, FILE *stream);++``
* ``++int getgrgid_r(gid_t gid, struct group *grp, char *buf, size_t buflen, struct group **result);++``
* ``++int getgrnam_r(const char *name, struct group *grp, char *buf, size_t buflen, struct group **result);++``
* ``++int gethostbyaddr_r(const void *addr, socklen_t len, int type, struct hostent *ret, char *buf, size_t buflen, struct hostent **result, int *h_errnop);++``
* ``++int gethostbyname2_r(const char *name, int af, struct hostent *ret, char *buf, size_t buflen, struct hostent **result, int *h_errnop);++``
* ``++int gethostbyname_r(const char *name, struct hostent *ret, char *buf, size_t buflen, struct hostent **result, int *h_errnop);++``
* ``++int gethostent_r(struct hostent *ret, char *buf, size_t buflen, struct hostent **result, int *h_errnop);++``
* ``++int gethostname(char *name, size_t len);++``
* ``++ssize_t getline(char **lineptr, size_t *n, FILE *stream);++``
* ``++int getlogin_r(char *buf, size_t bufsize);++``
* ``++int getnetbyaddr_r(uint32_t net, int type, struct netent *result_buf, char *buf, size_t buflen, struct netent **result, int *h_errnop);++``
* ``++int getnetbyname_r(const char *name, struct netent *result_buf, char *buf, size_t buflen, struct netent **result, int *h_errnop);++``
* ``++int getnetent_r(struct netent *result_buf, char *buf, size_t buflen, struct netent **result, int *h_errnop);++``
* ``++int getnetgrent_r(char **host, char **user, char **domain, char *buf, size_t buflen);++``
* ``++int getopt(int argc, char * const argv[], const char *optstring);++``
* ``++int getopt_long(int argc, char * const argv[], const char *optstring, const struct option *longopts, int *longindex);++``
* ``++int getopt_long_only(int argc, char * const argv[], const char *optstring, const struct option *longopts, int *longindex);++``
* ``++int getprotobyname_r(const char *name, struct protoent *result_buf, char *buf, size_t buflen, struct protoent **result);++``
* ``++int getprotobynumber_r(int proto, struct protoent *result_buf, char *buf, size_t buflen, struct protoent **result);++``
* ``++int getprotoent_r(struct protoent *result_buf, char *buf, size_t buflen, struct protoent **result);++``
* ``++int getpwent_r(struct passwd *pwbuf, char *buf, size_t buflen, struct passwd **pwbufp);++``
* ``++int getpwnam_r(const char *name, struct passwd *pwd, char *buf, size_t buflen, struct passwd **result);++``
* ``++int getpwuid_r(uid_t uid, struct passwd *pwd, char *buf, size_t buflen, struct passwd **result);++``
* ``++int getservbyname_r(const char *name, const char *proto, struct servent *result_buf, char *buf, size_t buflen, struct servent **result);++``
* ``++int getservbyport_r(int port, const char *proto, struct servent *result_buf, char *buf, size_t buflen, struct servent **result);++``
* ``++int getservent_r(struct servent *result_buf, char *buf, size_t buflen, struct servent **result);++``
* ``++size_t iconv(iconv_t cd, char **inbuf, size_t *inbytesleft, char **outbuf, size_t *outbytesleft);++``
* ``++char *initstate(unsigned seed, char *state, size_t n);++``
* ``++long jrand48(unsigned short xsubi[3]);++``
* ``++void lcong48(unsigned short param[7]);++``
* ``++void *lfind(const void *key, const void *base, size_t *nmemb, size_t size, int(*compar)(const void *, const void *));++``
* ``++int lio_listio(int mode, struct aiocb *const aiocb_list[], int nitems, struct sigevent *sevp);++``
* ``++void *lsearch(const void *key, void *base, size_t *nmemb, size_t size, int(*compar)(const void *, const void *));++``
* ``++int mblen(const char *s, size_t n);++``
* ``++size_t mbrlen(const char *s, size_t n, mbstate_t *ps);++``
* ``++size_t mbrtowc(wchar_t *pwc, const char *s, size_t n, mbstate_t *ps);++``
* ``++size_t mbsnrtowcs(wchar_t *dest, const char **src, size_t nms, size_t len, mbstate_t *ps);++``
* ``++size_t mbsrtowcs(wchar_t *dest, const char **src, size_t len, mbstate_t *ps);++``
* ``++size_t mbstowcs(wchar_t *dest, const char *src, size_t n);++``
* ``++int mbtowc(wchar_t *pwc, const char *s, size_t n);++``
* ``++void *memccpy(void *dest, const void *src, int c, size_t n);++``
* ``++void *memchr(const void *s, int c, size_t n);++``
* ``++int memcmp(const void *s1, const void *s2, size_t n);++``
* ``++void *memcpy(void *dest, const void *src, size_t n);++``
* ``++void *memmove(void *dest, const void *src, size_t n);++``
* ``++void *mempcpy(void *dest, const void *src, size_t n);++``
* ``++void *memset(void *s, int c, size_t n);++``
* ``++ssize_t mq_receive(mqd_t mqdes, char *msg_ptr, size_t msg_len, unsigned int *msg_prio);++``
* ``++int mq_send(mqd_t mqdes, const char *msg_ptr, size_t msg_len, unsigned int msg_prio);++``
* ``++ssize_t mq_timedreceive(mqd_t mqdes, char *msg_ptr, size_t msg_len, unsigned int *msg_prio, const struct timespec *abs_timeout);++``
* ``++int mq_timedsend(mqd_t mqdes, const char *msg_ptr, size_t msg_len, unsigned int msg_prio, const struct timespec *abs_timeout);++``
* ``++long nrand48(unsigned short xsubi[3]);++``
* ``++void posix_trace_event(trace_event_id_t event_id, const void *restrictdata_ptr, size_t data_len);++``
* ``++int posix_trace_trygetnext_event(trace_id_t trid, struct posix_trace_event_info *restrict event, void *restrict data, size_t num_bytes, size_t *restrict data_len, int *restrict unavailable);++``
* ``++ssize_t pread(int fd, void *buf, size_t count, off_t offset);++``
* ``++ssize_t preadv(int fd, const struct iovec *iov, int iovcnt, off_t offset);++``
* ``++ssize_t preadv2(int fd, const struct iovec *iov, int iovcnt, off_t offset, int flags);++``
* ``++int pthread_attr_setstack(pthread_attr_t *attr, void *stackaddr, size_t stacksize);++``
* ``++ssize_t pwrite(int fd, const void *buf, size_t count, off_t offset);++``
* ``++ssize_t pwritev(int fd, const struct iovec *iov, int iovcnt, off_t offset);++``
* ``++ssize_t pwritev2(int fd, const struct iovec *iov, int iovcnt, off_t offset, int flags);++``
* ``++void qsort(void *base, size_t nmemb, size_t size, int (*compar)(const void *, const void *));++``
* ``++void qsort_r(void *base, size_t nmemb, size_t size, int (*compar)(const void *, const void *, void *), void *arg);++``
* ``++ssize_t read(int fd, void *buf, size_t count);++``
* ``++ssize_t readlink(const char *restrict pathname, char *restrict buf, size_t bufsiz);++``
* ``++ssize_t readlinkat(int dirfd, const char *pathname, char *buf, size_t bufsiz);++``
* ``++ssize_t readv(int fd, const struct iovec *iov, int iovcnt);++``
* ``++char *realpath(const char *path, char *resolved_path);++``
* ``++ssize_t recv(int sockfd, void *buf, size_t len, int flags);++``
* ``++ssize_t recvfrom(int sockfd, void *buf, size_t len, int flags, struct sockaddr *src_addr, socklen_t *addrlen);++``
* ``++size_t regerror(int errcode, const regex_t *preg, char *errbuf, size_t errbuf_size);++``
* ``++int regexec(const regex_t *preg, const char *string, size_t nmatch, regmatch_t pmatch[], int eflags);++``
* ``++unsigned short *seed48(unsigned short seed16v[3]);++``
* ``++int semop(int semid, struct sembuf *sops, size_t nsops);++``
* ``++int semtimedop(int semid, struct sembuf *sops, size_t nsops, const struct timespec *timeout);++``
* ``++ssize_t send(int sockfd, const void *buf, size_t len, int flags);++``
* ``++ssize_t sendto(int sockfd, const void *buf, size_t len, int flags, const struct sockaddr *dest_addr, socklen_t addrlen);++``
* ``++void setbuf(FILE *stream, char *buf);++``
* ``++void setbuffer(FILE *stream, char *buf, size_t size);++``
* ``++int setvbuf(FILE *stream, char *buf, int mode, size_t size);++``
* ``++int snprintf(char *str, size_t size, const char *format, ...);++``
* ``++int socketpair(int domain, int type, int protocol, int sv[2]);++``
* ``++std::copy++`` for C++
* ``++std::copy_backward++`` for C++
* ``++char *stpcpy(char *dest, const char *src);++``
* ``++int strcasecmp(const char *s1, const char *s2);++``
* ``++char *strcat(char *dest, const char *src);++``
* ``++int strcmp(const char *s1, const char *s2);++``
* ``++char *strcpy(char *dest, const char *src);++``
* ``++ssize_t strfmon(char *s, size_t max, const char *format, ...);++``
* ``++ssize_t strfmon_l(char *s, size_t max, locale_t locale, const char *format, ...);++``
* ``++size_t strftime(char *s, size_t max, const char *format, const struct tm *tm);++``
* ``++size_t strftime_l(char *restrict buf, size_t maxsize, const char * restrict format, const struct tm *restrict timeptr, locale_t loc);++``
* ``++size_t strlcat(char *dst, const char *src, size_t size);++``
* ``++size_t strlcpy(char *dst, const char *src, size_t size);++``
* ``++size_t strlen(const char *s);++``
* ``++int strncasecmp(const char *s1, const char *s2, size_t n);++``
* ``++char *strncat(char *dest, const char *src, size_t n);++``
* ``++int strncmp(const char *s1, const char *s2, size_t n);++``
* ``++char *strncpy(char *dest, const char *src, size_t n);++``
* ``++size_t strnlen(const char *s, size_t maxlen);++``
* ``++char *strsep(char **stringp, const char *delim);++``
* ``++void swab(const void *from, void *to, ssize_t n);++``
* ``++int swprintf(wchar_t *wcs, size_t maxlen, const wchar_t *format, ...);++``
* ``++int ttyname_r(int fd, char *buf, size_t buflen);++``
* ``++int utimes(const char *filename, const struct timeval times[2]);++``
* ``++int vsnprintf(char *str, size_t size, const char *format, va_list ap);++``
* ``++int vswprintf(wchar_t * ws, size_t len, const wchar_t * format, va_list arg);++``
* ``++wchar_t *wcpncpy(wchar_t *dest, const wchar_t *src, size_t n);++``
* ``++size_t wcsftime(wchar_t *wdest, size_t maxsize, const wchar_t *format, const struct tm *timeptr);++``
* ``++size_t wcslen(const wchar_t *string);++``
* ``++int wcsncasecmp(const wchar_t *s1, const wchar_t *s2, size_t n);++``
* ``++int wcsncasecmp_l(const wchar_t *ws1, const wchar_t *ws2, size_t n, locale_t locale);++``
* ``++int wcsncmp(const wchar_t *string1, const wchar_t *string2, size_t count);++``
* ``++wchar_t *wcsncpy(wchar_t *string1, const wchar_t *string2, size_t count);++``
* ``++size_t wcsnlen(const wchar_t *s, size_t maxlen);++``
* ``++size_t wcsnrtombs(char *dest, const wchar_t **src, size_t nwc, size_t len, mbstate_t *ps);++``
* ``++size_t wcsrtombs(char *mbstr, const wchar_t **wcstr, sizeof count, mbstate_t *mbstate);++``
* ``++size_t wcstombs(char *mbstr, const wchar_t *wcstr, size_t count);++``
* ``++int wcswidth(const wchar_t *s, size_t n);++``
* ``++size_t wcsxfrm(wchar_t *dst, const wchar_t *src, size_t n);++``
* ``++size_t wcsxfrm_l(wchar_t *dst, const wchar_t *src, size_t n, locale_t locale);++``
* ``++wchar_t *wmemchr(const wchar_t *s, wchar_t c, size_t n);++``
* ``++int wmemcmp(const wchar_t *s1, const wchar_t *s2, size_t n);++``
* ``++wchar_t *wmemcpy(wchar_t *dest, const wchar_t *src, size_t n);++``
* ``++wchar_t *wmemmove(wchar_t *dest, const wchar_t *src, size_t n);++``
* ``++wchar_t *wmemcpy(wchar_t *dest, const wchar_t *src, size_t n);++``
* ``++wchar_t *wmemset(wchar_t *wcs, wchar_t wc, size_t n);++``
* ``++ssize_t write(int fd, const void *buf, size_t count);++``
* ``++ssize_t writev(int fd, const struct iovec *iov, int iovcnt);++``


== What is the potential impact?

If an argument to one of the C library functions mentioned by this rule is a ``++NULL++`` pointer, the behavior of the application is undefined.

When a program comprises undefined behavior, the compiler no longer needs to adhere to the language standard, and the program has no meaning assigned to it.


== How to fix it

Ensure that any pointer passed to any of the C library functions mentioned by this rule _is not_ ``++NULL++``.


=== Code examples

==== Noncompliant code example

[source,c,diff-id=1,diff-type=noncompliant]
----
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

void string_copy() {
  char buffer[] = "Hello, World!";
  char *str = (char *)malloc(sizeof(buffer));
  if (!str) {
    printf("Memory allocation failed!\n");
  }
  // Noncompliant: 1st parameter in the subsequent call to `memcpy()` might be
  // NULL due to insufficient handling of a potentially failed memory
  // allocation.
  memcpy(str, buffer, sizeof(buffer));
  // Process dynamically alloacted `str` variable.
  // ...
  // Free memory, if it is no longer in use.
  free(str);
}
----

==== Compliant solution

[source,c,diff-id=1,diff-type=compliant]
----
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

void string_copy() {
  char buffer[] = "Hello, World!";
  char *str = (char *)malloc(sizeof(buffer));
  if (!str) {
    perror("malloc() failed");
    exit(1);
  }
  // Ok, 1st parameter will always denote a non-null pointer.
  memcpy(str, buffer, sizeof(buffer));
  // Process dynamically alloacted `str` variable.
  // ...
  // Free memory, if it is no longer in use.
  free(str);
}
----


== Resources

=== Documentation

* https://cwe.mitre.org/data/definitions/476[MITRE, CWE-476] - NULL Pointer Dereference

=== External coding guidelines

* https://wiki.sei.cmu.edu/confluence/x/aDdGBQ[CERT, EXP01-J.] - Do not use a null in a case where an object is required



ifdef::env-github,rspecator-view[]

'''
== Implementation Specification
(visible only on this page)

=== Message

Change this parameter to not be {null/zero}.


=== Highlighting

parameter


endif::env-github,rspecator-view[]
