Passing ``++NULL++`` to a C library function that requires non-null pointer arguments results in undefined behavior and may crash the application.

== Why is this an issue?

The standard C library includes a variety of functions for string and general memory manipulations.
These functions typically take pointers and respective lengths as parameters to specify the chunks of memory to be processed.
Many of these functions require valid parameters and when given values outside a function's domain, the behavior is undefined.
In that case, the application may crash or, even worse, silently lose data or produce incorrect results.
The C library functions listed in what follows require non-``++NULL++`` pointer parameters.
Failing to provide non-``++NULL++`` parameters introduces undefined behavior.

[source,text]
----
aio_suspend, bcmp, bcopy, bsearch, bzero, confstr, encrypt, erand48,
explicit_bzero, explicit_memset, fgetpwent_r, fgets, fgetws, fread, fwrite,
getdelim, getgrgid_r, getgrnam_r, gethostbyaddr_r, gethostbyname2_r,
gethostbyname_r, gethostent_r, gethostname, getline, getlogin_r,
getnetbyaddr_r, getnetbyname_r, getnetent_r, getnetgrent_r, getopt,
getopt_long, getopt_long_only, getprotobyname_r, getprotobynumber_r,
getprotoent_r, getpwent_r, getpwnam_r, getpwuid_r, getservbyname_r,
getservbyport_r, getservent_r, iconv, initstate, jrand48, lcong48, lfind,
lio_listio, lsearch, mblen, mbrlen, mbrtowc, mbsnrtowcs, mbsrtowcs,
mbstowcs, mbtowc, memccpy, memchr, memcmp, memcpy, memmove, mempcpy,
memset, mq_receive, mq_send, mq_timedreceive, mq_timedsend, nrand48,
posix_trace_event, posix_trace_trygetnext_event, pread, preadv, preadv2,
pthread_attr_setstack, pwrite, pwritev, pwritev2, qsort, qsort_r, read,
readlink, readlinkat, readv, realpath, recv, recvfrom, regerror, regexec,
seed48, semop, semtimedop, send, sendto, setbuf, setbuffer, setvbuf,
snprintf, socketpair, std::copy (for C++), std::copy_backward (for C++),
stpcpy, strcasecmp, strcat, strcmp, strcpy, strfmon, strfmon_l, strftime,
strftime_l, strlcat, strlcpy, strlen, strncasecmp, strncat, strncmp, strncpy,
strnlen, strsep, swab, swprintf, ttyname_r, utimes, vsnprintf, vswprintf,
wcpncpy, wcsftime, wcslen, wcsncasecmp, wcsncasecmp_l, wcsncmp, wcsncpy,
wcsnlen, wcsnrtombs, wcsrtombs, wcstombs, wcswidth, wcsxfrm, wcsxfrm_l,
wmemchr, wmemcmp, wmemcpy, wmemmove, wmemcpy, wmemset, write, writev
----


== What is the potential impact?

If an argument to one of the C library functions mentioned by this rule is a ``++NULL++`` pointer, the behavior of the application is undefined.

When a program comprises undefined behavior, the compiler no longer needs to adhere to the language standard, and the program has no meaning assigned to it.


== How to fix it

Ensure that any pointer passed to any of the C library functions mentioned by this rule _is not_ ``++NULL++``.


=== Code examples

==== Noncompliant code example

[source,c,diff-id=1,diff-type=noncompliant]
----
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

void string_copy() {
  char buffer[] = "Hello, World!";
  char *str = (char *)malloc(sizeof(buffer));
  if (!str) {
    printf("Memory allocation failed!\n");
  }
  // Noncompliant: 1st parameter in the subsequent call to `memcpy()` might be
  // NULL due to insufficient handling of a potentially failed memory
  // allocation.
  memcpy(str, buffer, sizeof(buffer));
  // Process dynamically alloacted `str` variable.
  // ...
  // Free memory, if it is no longer in use.
  free(str);
}
----

==== Compliant solution

[source,c,diff-id=1,diff-type=compliant]
----
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

void string_copy() {
  char buffer[] = "Hello, World!";
  char *str = (char *)malloc(sizeof(buffer));
  if (!str) {
    perror("malloc() failed");
    exit(1);
  }
  // Ok, 1st parameter will always denote a non-null pointer.
  memcpy(str, buffer, sizeof(buffer));
  // Process dynamically alloacted `str` variable.
  // ...
  // Free memory, if it is no longer in use.
  free(str);
}
----


== Resources

=== Documentation

* https://cwe.mitre.org/data/definitions/476[MITRE, CWE-476] - NULL Pointer Dereference

=== External coding guidelines

* https://wiki.sei.cmu.edu/confluence/x/aDdGBQ[CERT, EXP01-J.] - Do not use a null in a case where an object is required



ifdef::env-github,rspecator-view[]

'''
== Implementation Specification
(visible only on this page)

=== Message

Change this parameter to not be {null/zero}.


=== Highlighting

parameter


endif::env-github,rspecator-view[]
