<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>string.ToLower()</code>, <code>ToUpper</code>, <code>IndexOf</code>, <code>LastIndexOf</code>, and <code>Compare</code> are all culture-dependent, as are some (floating point number and <code>DateTime</code>-related) calls to <code>ToString</code>. Fortunately, all have variants which accept an argument specifying the culture or formatter to use. Leave that argument off and the call will use the system default culture, possibly creating problems with international characters.</p>
</div>
<div class="paragraph">
<p><code>string.CompareTo()</code> is also culture specific, but has no overload that takes a culture information, so instead it&#8217;s better to use <code>CompareOrdinal</code>, or <code>Compare</code> with culture.</p>
</div>
<div class="paragraph">
<p>Calls without a culture may work fine in the system&#8217;s "home" environment, but break in ways that are extremely difficult to diagnose for customers who use different encodings. Such bugs can be nearly, if not completely, impossible to reproduce when it&#8217;s time to fix them.</p>
</div>
<div class="sect2">
<h3 id="_noncompliant_code_example">Noncompliant code example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">var lowered = someString.ToLower(); //Noncompliant</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_compliant_solution">Compliant solution</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">var lowered = someString.ToLower(CultureInfo.InvariantCulture);</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">var lowered = someString.ToLowerInvariant();</code></pre>
</div>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="ulist">
<ul>
<li>
<p>Define the locale to be used in this string operation.</p>
</li>
<li>
<p>Use "CompareOrdinal" or "Compare" with the locale specified instead of "CompareTo".</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_2_jul_2015_071627_tamas_vajk_wrote">on 2 Jul 2015, 07:16:27 Tamas Vajk wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] LGTM</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_6_jul_2015_144732_ann_campbell_wrote">on 6 Jul 2015, 14:47:32 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~tamas.vajk] I&#8217;ve just mapped this parent task to SpecifyACultureInStringConversionExplicitly for SONARCSANA-178. I&#8217;m wondering if this rule&#8217;s other cases cover any other R# rules.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_8_jul_2015_092300_tamas_vajk_wrote">on 8 Jul 2015, 09:23:00 Tamas Vajk wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] Looks good. I added a few more R# IDs to the parent RSPEC.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_9_jul_2015_134014_ann_campbell_wrote">on 9 Jul 2015, 13:40:14 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>Updated to include SONARCSANA-221</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_26_nov_2015_153815_tamas_vajk_wrote">on 26 Nov 2015, 15:38:15 Tamas Vajk wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] I modified the scope of this rule. Only operations specified on <code>String</code> are left here, <code>IEnumerable&lt;String&gt;</code> operations have been removed. The main reason is that we we can&#8217;t force users to define an <code>IComparer</code> for these operations, as it&#8217;s unreasonably long (in contrary to the <code>IFormatProvider</code>, which can be added as a <code>CultureInfo</code>). Here is how it&#8217;s done in .NET4.5: <code>new string[] { }.OrderBy(s =&gt; s, Comparer&lt;string&gt;.Create((x, y) =&gt; x.CompareTo(y)))</code>, but for prior versions you would need to declare a new class and instantiate that.</p>
</div>
<div class="paragraph">
<p>Another thing that has been removed is the <code>==</code>, which is culture specific, but I don&#8217;t think that we want to force .NET devs to use <code>Equals</code> instead.</p>
</div>
<div class="paragraph">
<p>cc [~dinesh.bolkensteyn] (you were assigned to this ticket for reviewing)</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_2_dec_2015_163542_ann_campbell_wrote">on 2 Dec 2015, 16:35:42 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>Okay. Thanks [~tamas.vajk]</p>
</div>
</div>
<div class="sect2">
<h3 id="_is_duplicated_by_s2132">is duplicated by: <a data-rspec-id="S2132" class="rspec-auto-link">S2132</a></h3>

</div>
<div class="sect2">
<h3 id="_on_31_oct_2013_181852_freddy_mallet_wrote">on 31 Oct 2013, 18:18:52 Freddy Mallet wrote:</h3>
<div class="paragraph">
<p>Is implemented by http://jira.codehaus.org/browse/SONARJAVA-371</p>
</div>
</div>
</div>
</div>