=== How to fix it in Java SE

The following non-compliant code is vulnerable to LDAP injections because untrusted data is
concatenated to an LDAP query without prior sanitization or validation.

[cols="a"]
|===
h| Non-compliant code example
|
[source,java]
----
public boolean authenticate(HttpServletRequest req, DirContext ctx) throws NamingException { 

  String user = request.getParameter("user"); 
  String pass = request.getParameter("pass"); 

  String filter = "(&(uid=" + user + ")(userPassword=" + pass + "))";

  NamingEnumeration<SearchResult> results = ctx.search("ou=system", filter, new SearchControls()); // Noncompliant
  return results.hasMore();
}
----
h| Compliant solution
|
[source,java]
----
public boolean authenticate(HttpServletRequest req, DirContext ctx) throws NamingException { 
  String user = request.getParameter("user"); 
  String pass = request.getParameter("pass"); 

  String filter = "(&(uid={0})(userPassword={1}))";

  NamingEnumeration<SearchResult> results = ctx.search("ou=system", filter, new String[]{user, pass}, new SearchControls());
  return results.hasMore();
}
----
|===

=== How does this work?

include::../../common/fix/validation.adoc[]

In the example, the `search` function allows to safely parameterize the query.
