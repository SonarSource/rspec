<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Deserialization is the process of converting serialized data (such as objects or data structures) back into their original form. Types allowed to be unserialized should be strictly controlled.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>During the deserialization process, the state of an object will be reconstructed from the serialized data stream. By allowing unrestricted deserialization of types, the application makes it possible for attackers to use types with dangerous or otherwise sensitive behavior during the deserialization process.</p>
</div>
<div class="paragraph">
<p>When an application deserializes untrusted data without proper restrictions, an attacker can craft malicious serialized objects. Depending on the affected objects and properties, the consequences can vary.</p>
</div>
<div class="paragraph">
<p>When the codebase contains objects that perform actions at deserialization time, they can be leveraged by attackers to perform the given actions in order to modify the application business logic, leak sensitive information or compromise data integrity.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_how_to_fix_it_in_foundation">How to fix it in Foundation</h3>
<div class="paragraph">
<p><code>NSSecureCoding</code> is a Swift protocol that allows for secure object deserialization. It prevents arbitrary object instantiation by restricting the types of objects that can be created to a predefined set of allowed classes. This protocol inherits from the older, less secure <code>NSCoding</code> protocol, which was not designed for this purpose.
Implementing <code>NSSecureCoding</code> will always guarantee safe deserialization, however.</p>
</div>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="paragraph">
<p>The <code>NSCoder.decodeObject(forKey:)</code> method doesn&#8217;t enforce the allow-list restrictions of the <code>NSSecureCoding</code> protocol, even when the object being deserialized conforms to it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-swift" data-lang="swift">import Foundation

class Example: NSObject, NSSecureCoding {
    var child: Example

    static var supportsSecureCoding: Bool {
        return true
    }

    required init?(coder: NSCoder) {
        guard let child = coder.decodeObject(forKey: "child") as? Example else { // Noncompliant
            return nil
        }

        self.child = child
        super.init()
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-swift" data-lang="swift">import Foundation

class Example: NSObject, NSSecureCoding {
    var child: Example

    static var supportsSecureCoding: Bool {
        return true
    }

    required init?(coder: NSCoder) {
        guard let child = coder.decodeObject(of:[Example.self], forKey: "child") as? Example else {
            return nil
        }

        self.child = child
        super.init()
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Apple Developer Documentation - <a href="https://developer.apple.com/documentation/foundation/nssecurecoding">NSSecureCoding</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_standards">Standards</h3>
<div class="ulist">
<ul>
<li>
<p>OWASP - <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/">Top 10 2021 Category A8 - Software and Data Integrity Failures</a></p>
</li>
<li>
<p>OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A8_2017-Insecure_Deserialization">Top 10 2017 Category A8 - Insecure Deserialization</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/502">CWE-502 - Deserialization of Untrusted Data</a></p>
</li>
<li>
<p>OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2023-risks/m4-insufficient-input-output-validation">Mobile Top 10 2024 Category M4 - Insufficient Input/Output Validation</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>