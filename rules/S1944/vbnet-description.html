<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A cast is an <a href="https://learn.microsoft.com/en-us/dotnet/visual-basic/programming-guide/language-features/data-types/implicit-and-explicit-conversions">explicit conversion</a>, which is a way to tell the compiler the intent to convert from one type to another.</p>
</div>
<div class="paragraph">
<p>In Visual Basic, there are two explicit conversion operators:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-vbnet" data-lang="vbnet">Public Sub Method(Value As Object)
    Dim i As Integer
    i = DirectCast(Value, Integer)  ' Direct casting from object holding an integer type to Integer
    i = CType(Value, Integer)       ' Conversion from the underlying type to Integer
End Sub</code></pre>
</div>
</div>
<div class="paragraph">
<p>In most cases, the compiler will be able to catch invalid casts between incompatible value types or reference types.</p>
</div>
<div class="paragraph">
<p>However, the compiler will not be able to detect invalid casts to <a href="https://learn.microsoft.com/en-us/dotnet/visual-basic/programming-guide/language-features/interfaces/">interfaces</a>.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>Invalid casts will lead to unexpected behaviors or runtime errors such as <a href="https://learn.microsoft.com/en-us/dotnet/api/system.invalidcastexception">InvalidCastException</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_exceptions">Exceptions</h3>
<div class="paragraph">
<p>No issue is reported if the interface has no implementing class in the assembly.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To prevent an <code>InvalidCastException</code> from raising during an explicit conversion, it is recommended to use the <a href="https://learn.microsoft.com/en-us/dotnet/visual-basic/language-reference/operators/trycast-operator"><code>TryCast</code> operator</a>.
When the conversion is not possible, the <code>TryCast</code> operator returns <code>Nothing</code> and will never raise an exception.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-vbnet" data-lang="vbnet">Public Interface IMyInterface
End Interface

Public Class Implementer
    Implements IMyInterface
End Class

Public Class AnotherClass
End Class

Module Program
    Sub Main()
        Dim Another As New AnotherClass
        Dim x As IMyInterface = DirectCast(Another, IMyInterface)   ' Noncompliant: InvalidCastException is being thrown
    End Sub
End Module</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-vbnet" data-lang="vbnet">Public Interface IMyInterface
End Interface

Public Class Implementer
    Implements IMyInterface
End Class

Public Class AnotherClass
End Class

Module Program
    Sub Main()
        Dim Another As New AnotherClass
        Dim x = TryCast(Another, IMyInterface)                      ' Compliant: but will always be Nothing
    End Sub
End Module</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/visual-basic/programming-guide/language-features/data-types/type-conversions">Type Conversions in Visual Basic</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/visual-basic/programming-guide/language-features/data-types/implicit-and-explicit-conversions">Implicit and Explicit Conversions in Visual Basic</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/visual-basic/programming-guide/language-features/data-types/how-to-convert-an-object-to-another-type">How to: Convert an Object to Another Type in Visual Basic</a></p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/visual-basic/language-reference/operators/directcast-operator"><code>DirectCast</code> operator</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/visual-basic/language-reference/functions/ctype-function"><code>CType</code> function</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/visual-basic/language-reference/operators/trycast-operator"><code>TryCast</code> operator</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/588">CWE-588 - Attempt to Access Child of a Non-structure Pointer</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/704">CWE-704 - Incorrect Type Conversion or Cast</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="ulist">
<ul>
<li>
<p>Review this cast; in this project there&#8217;s no type that implements both "{0}" and "{1}".</p>
</li>
<li>
<p>Review this cast; in this project there&#8217;s no type that extends "{0}" and implements "{1}".</p>
</li>
<li>
<p>Nullable is known to be empty, this cast throws an exception.</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_is_duplicated_by_s1243">is duplicated by: <a data-rspec-id="S1243" class="rspec-auto-link">S1243</a></h3>

</div>
<div class="sect2">
<h3 id="_is_related_to_s2192">is related to: <a data-rspec-id="S2192" class="rspec-auto-link">S2192</a></h3>

</div>
<div class="sect2">
<h3 id="_is_related_to_s855">is related to: <a data-rspec-id="S855" class="rspec-auto-link">S855</a></h3>

</div>
<div class="sect2">
<h3 id="_is_related_to_s856">is related to: <a data-rspec-id="S856" class="rspec-auto-link">S856</a></h3>

</div>
<div class="sect2">
<h3 id="_is_related_to_s859">is related to: <a data-rspec-id="S859" class="rspec-auto-link">S859</a></h3>

</div>
<div class="sect2">
<h3 id="_replaces_s858">replaces: <a data-rspec-id="S858" class="rspec-auto-link">S858</a></h3>

</div>
<div class="sect2">
<h3 id="_replaces_s870">replaces: <a data-rspec-id="S870" class="rspec-auto-link">S870</a></h3>

</div>
<div class="sect2">
<h3 id="_replaces_s1256">replaces: <a data-rspec-id="S1256" class="rspec-auto-link">S1256</a></h3>

</div>
<div class="sect2">
<h3 id="_on_8_aug_2014_211740_ann_campbell_wrote">on 8 Aug 2014, 21:17:40 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>2 items of note:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>spec-ed for C because of pointer casting</p>
</li>
<li>
<p>tagged to CWE-588 because the mitigations section lists making sure your casts are appropriate. Don&#8217;t know if this is too tenuous a link or not.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_on_8_sep_2014_144440_ann_campbell_wrote">on 8 Sep 2014, 14:44:40 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>CERT lists these as relevant:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>MISRA C:2004, 11.4</p>
</li>
<li>
<p>MISRA C&#43;&#43; 5-2-2</p>
</li>
<li>
<p>MISRA C&#43;&#43; 5-2-3</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additionally, these seem relevant to me:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>MISRA C:2004, 10.3, 10.4, 11.1, 11.2, 11.3, 11.4, 11.5</p>
</li>
<li>
<p>MISRA C&#43;&#43;:2008, 5-2-5, 5-2-6, 5-2-7, 5-2-8, 5-2-9</p>
</li>
<li>
<p>MISRA C:2012, 10.3, 10.5, 11.1, 11.2, 11.3, 11.4, 11.5, 11.6, 11.7, 11.8</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>But is that "cast"-ing too broad a net?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_1_oct_2014_081925_nicolas_peru_wrote">on 1 Oct 2014, 08:19:25 Nicolas Peru wrote:</h3>
<div class="paragraph">
<p>No issue for java for the scope regarding casting to unrelated type.</p>
</div>
<div class="paragraph">
<p>But for me it is out of scope of this rule to detect untested ("untested" has to be define) down cast. This would require another rule I think.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_1_oct_2014_115524_ann_campbell_wrote">on 1 Oct 2014, 11:55:24 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~nicolas.peru], you couldn&#8217;t look for the downcast to be inside an <code>instanceof</code> condition?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_1_oct_2014_135620_nicolas_peru_wrote">on 1 Oct 2014, 13:56:20 Nicolas Peru wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] If I take the example of the java syntax tree here is how we downcast :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>if(tree.is(Tree.Kind.TYPE_CAST)) {
  TypeCastTree typeCastTree = (TypeCastTree) tree;
}</pre>
</div>
</div>
<div class="paragraph">
<p>and we even have some usages that are based on safe assumptions (SubscriptionVisitor) for instance.</p>
</div>
<div class="paragraph">
<p>So I tend to think that this usecase will trigger way too many false positive (at least in our codebase) to be useful.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_1_oct_2014_142253_ann_campbell_wrote">on 1 Oct 2014, 14:22:53 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~nicolas.peru] I would really like to see that case covered. A different rule? A parameter?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_2_oct_2014_082913_nicolas_peru_wrote">on 2 Oct 2014, 08:29:13 Nicolas Peru wrote:</h3>
<div class="paragraph">
<p>In fact problem is the same as for the first case, see my comment in http://jira.codehaus.org/browse/SONARJAVA-723 :  problem is to detect how the type has been tested.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_11_dec_2015_085850_tamas_vajk_wrote">on 11 Dec 2015, 08:58:50 Tamas Vajk wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] applied some changes to the description</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_11_dec_2015_135758_ann_campbell_wrote">on 11 Dec 2015, 13:57:58 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>looks good</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_23_may_2016_190551_ann_campbell_wrote">on 23 May 2016, 19:05:51 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>Relevant for C? http://programmers.stackexchange.com/a/319261/206730</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_21_jul_2016_143903_ann_campbell_wrote">on 21 Jul 2016, 14:39:03 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~tamas.vajk] I&#8217;ve tweaked the wording of your addition. Please double-check me.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_21_jul_2016_152429_tamas_vajk_wrote">on 21 Jul 2016, 15:24:29 Tamas Vajk wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] "known-empty" is strange for me, I would probably go with simply "empty" if the original variant was not good.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_21_jul_2016_153842_ann_campbell_wrote">on 21 Jul 2016, 15:38:42 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>Second attempt made [~tamas.vajk]</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_21_jul_2016_154108_tamas_vajk_wrote">on 21 Jul 2016, 15:41:08 Tamas Vajk wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] perfect, thanks.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_1_nov_2018_171242_inna_nill_wrote">on 1 Nov 2018, 17:12:42 Inna Nill wrote:</h3>
<div class="paragraph">
<p>Is there a plan to implement this, for Java?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_1_nov_2018_172703_ann_campbell_wrote">on 1 Nov 2018, 17:27:03 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~innanill] if you&#8217;d like to start a discussion, please go to the <a href="https://community.sonarsource.com">SonarSource Community</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_08_jun_2023_164500_sébastien_marichal_wrote">on 08 Jun 2023, 16:45:00 Sébastien Marichal wrote:</h3>
<div class="paragraph">
<p>During a LaYC sprint, I removed dummy implementations for the following language:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>abap</p>
</li>
<li>
<p>flex</p>
</li>
<li>
<p>javascript</p>
</li>
<li>
<p>python</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is not implemented in the corresponding analyzer and there currently are no tickets open in order to do so.</p>
</div>
</div>
</div>
</div>