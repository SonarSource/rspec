<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This rule raises an issue when a shell script uses <code>set -e</code> to enable automatic error detection and script termination on command failures.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>set -e</code> option was designed to add "automatic error detection" to shell scripts by causing them to abort when any command returns a non-zero exit status. However, this approach has significant problems that make it unreliable for robust error handling.</p>
</div>
<div class="paragraph">
<p>The behavior of <code>set -e</code> is governed by complex and inconsistent rules. For example, commands in conditional statements like <code>if</code> tests are immune to <code>set -e</code>, as are commands in pipelines except for the last one. These rules are difficult to understand and remember, and they change between different Bash versions as the shell attempts to track the evolving POSIX definition.</p>
</div>
<div class="paragraph">
<p>The situation becomes even more problematic when subshells are involved, where the behavior varies depending on whether Bash is running in POSIX mode. These inconsistencies mean that scripts relying on <code>set -e</code> may behave differently across different environments and Bash versions.</p>
</div>
<div class="paragraph">
<p>Moreover, <code>set -e</code> fails to catch many simple error cases that proper explicit error handling would detect. It creates a false sense of security while actually providing unreliable error detection.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>Using <code>set -e</code> can lead to unreliable error handling in shell scripts. Scripts may fail to detect errors in some contexts while unexpectedly terminating in others. This inconsistent behavior can cause:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Silent failures where errors go undetected</p>
</li>
<li>
<p>Unexpected script termination in cases where the error should be handled gracefully</p>
</li>
<li>
<p>Different behavior across different systems or Bash versions</p>
</li>
<li>
<p>Difficulty in debugging when the script behaves differently than expected</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These issues can result in data loss, incomplete operations, or system instability, particularly in production environments where reliable error handling is critical.</p>
</div>
</div>
<div class="sect2">
<h3 id="_how_to_fix">How to fix?</h3>
<div class="paragraph">
<p>Replace <code>set -e</code> with explicit error checking using conditional statements. Check the exit status of each critical command and handle errors appropriately.</p>
</div>
<div class="sect3">
<h4 id="_non_compliant_code_example">Non-compliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">#!/bin/bash
set -e  # Noncompliant

command1
command2
command3</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_code_example">Compliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">#!/bin/bash

command1 || { echo "command1 failed" &gt;&amp;2; exit 1; }
command2 || { echo "command2 failed" &gt;&amp;2; exit 1; }
command3 || { echo "command3 failed" &gt;&amp;2; exit 1; }</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Bash FAQ #105: Why doesn&#8217;t set -e do what I expected? - <a href="https://mywiki.wooledge.org/BashFAQ/105">Comprehensive explanation of why set -e is problematic and unreliable</a></p>
</li>
<li>
<p>LinuxCommand.org Bash Coding Standards - <a href="https://linuxcommand.org/lc3_adv_standards.php">Professional shell scripting standards that recommend against using set -e</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_standards">Standards</h3>
<div class="ulist">
<ul>
<li>
<p>CWE-754: Improper Check for Unusual or Exceptional Conditions - <a href="https://cwe.mitre.org/data/definitions/754.html">Relates to inadequate error handling that can lead to unexpected program behavior</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>