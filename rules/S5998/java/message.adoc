Refactor this repetition that can lead to a stack overflow for large inputs.