<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sensitive APIs such as <code>ipcRenderer</code> should not be directly exposed to the renderer process. Doing so can allow attackers to bypass Electron&#8217;s context isolation and execute unwanted actions in the main process.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In Electron, there is a clear separation between the main process and the renderer process. The main process is responsible for managing system-level resources and interacting with the operating system, while the renderer process is responsible for rendering the user interface and executing JavaScript code in the context of a web page. Electron provides a mechanism called context isolation to enforce this separation and prevent the renderer process from directly accessing sensitive APIs in the main process.</p>
</div>
<div class="paragraph">
<p>Passing sensitive APIs directly to the renderer process in Electron, such as through a <code>contextBridge.exposeInMainWorld</code> call, can be dangerous because it potentially exposes powerful system-level capabilities to untrusted content. This means that any JavaScript running in the renderer, including potentially malicious scripts from web content, could use this method to send arbitrary IPC messages to the main process. The main process typically has elevated privileges and access to system resources, so allowing unrestricted communication from the renderer to the main process can lead to security vulnerabilities.</p>
</div>
<div class="paragraph">
<p>When <code>nodeIntegration</code> is enabled, it is even possible to access Node.js APIs from the renderer process, which can further increase the attack surface and expose additional system-level capabilities to untrusted content. This can lead to a variety of security issues, including remote code execution, privilege escalation, and data exfiltration. Therefore, extreme caution should always be taken when using Node.js APIs from the main process to the renderer process in Electron applications.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it_in_electron">How to fix it in Electron</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="paragraph">
<p>The example below is a preload script that directly exposes <code>ipcRenderer.send</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { contextBridge, ipcRenderer } from 'electron';

contextBridge.exposeInMainWorld('example', {
  send: ipcRenderer.send, // Noncompliant
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example is only relevant when <code>nodeIntegration</code> is set to <code>true</code> (it is disabled by default).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { contextBridge } from 'electron';
import fs from 'node:fs';

contextBridge.exposeInMainWorld('example', {
  readFile: fs.readFileSync, // Noncompliant
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { contextBridge, ipcRenderer } from 'electron';

contextBridge.exposeInMainWorld('example', {
  sendMessage: (message) =&gt; {
    ipcRenderer.send("my-specific-channel", message);
  },
});</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { contextBridge } from 'electron';
import fs from 'node:fs';

const ALLOWED_FILES = ['file1.txt', 'file2.txt'];

contextBridge.exposeInMainWorld('example', {
  readFile: (file) =&gt; {
    if (!ALLOWED_FILES.includes(file)) {
      throw new Error('File not allowed');
    }
    return fs.readFileSync(file);
  },
});</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_how_does_this_work">How does this work?</h3>
<div class="paragraph">
<p>In the first example, unwanted behavior is prevented by specifying a specific channel for communication between the renderer and the main process. This way, even if the renderer process is compromised, it can only send messages to the main process on the specified channel, which limits the potential impact of an attack.</p>
</div>
<div class="paragraph">
<p>In the second example, the <code>readFile</code> method is restricted to only read files that are explicitly allowed. This prevents the renderer process from reading arbitrary files on the system and limits the potential for unauthorized access to sensitive data.</p>
</div>
<div class="paragraph">
<p>In both examples, the code is designed to minimize the attack surface and prevent untrusted content from directly accessing sensitive APIs or system resources.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Electron - <a href="https://www.electronjs.org/docs/tutorial/context-isolation">Context Isolation</a></p>
</li>
<li>
<p>Electron - <a href="https://www.electronjs.org/docs/latest/api/context-bridge">contextBridge</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_articles_blog_posts">Articles &amp; blog posts</h3>
<div class="ulist">
<ul>
<li>
<p>Doyensec - <a href="https://blog.doyensec.com/2019/04/03/subverting-electron-apps-via-insecure-preload.html">Subverting Electron Apps via Insecure Preload</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>If the sensitive API is an Electron API (currently only <code>ipcRenderer</code> methods):
* Change this code to not expose a sensitive Electron API.</p>
</div>
<div class="paragraph">
<p>Otherwise:
* Change this code to not expose a sensitive Node.js API.</p>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="paragraph">
<p>Within the <code>exposeInMainWorld</code> call, the key:value pair that is noncompliant should be highlighted.</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
</div>
</div>