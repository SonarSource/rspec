<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A <a href="https://dart.dev/language/built-in-types">literal</a> used as an argument to a constructor of an <a href="https://api.flutter.dev/flutter/meta/immutable-constant.html"><code>@immutable</code></a> class should be marked as <a href="https://dart.dev/language/variables#final-and-const"><code>const</code></a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>meta.dart</code> package defines an <code>@immutable</code> annotation that can be used to mark classes that are <a href="https://en.wikipedia.org/wiki/Immutable_object">immutable</a>, meaning that all their instance variables, directly defined or inherited, have to be <a href="https://dart.dev/language/variables#final-and-const"><code>final</code></a>, that is, once the instance is created, it cannot be modified.</p>
</div>
<div class="paragraph">
<p>However, like any other annotation, the <code>@immutable</code> annotation only provides information to the developer using the class and to developer tools such as the analyzer package, and it does not enforce any constraint.</p>
</div>
<div class="paragraph">
<p>Therefore, there is nothing that prevents a developer from</p>
</div>
<div class="ulist">
<ul>
<li>
<p>defining a non-<code>const</code> constructor of an <code>@immutable</code> class (named or unnamed)</p>
</li>
<li>
<p>passing non-<code>const</code> literals to such a constructor</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An example is shown in the code below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-dart" data-lang="dart">import 'package:meta/meta.dart';

@immutable
class MultiDimensionalPoint {
  final List&lt;int&gt; coordinates;
  MultiDimensionalPoint(this.coordinates); // Non-const constructor
}

void main() {
  var p = MultiDimensionalPoint([1, 2, 3]);
  p.coordinates[0] = 4; // This is allowed, and won't raise any error
  print(p.coordinates); // Will print [4, 2, 3]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This scenario can lead to confusion and bugs, since a developer might not realized the class is designed with immutability in mind, and may modify the instance after creation, as in the example above.</p>
</div>
<div class="paragraph">
<p>Even when the immutability design constraint is respected, failing to specify the <code>const</code> constraint on a literal used as an argument to a constructor of an <code>@immutable</code> class will lead to subpar performance, as the Dart compiler will not create compile-time constants in a non-constant context.</p>
</div>
<div class="sect2">
<h3 id="_exceptions">Exceptions</h3>
<div class="paragraph">
<p>Notice that the <code>const</code> constraint is not required when the literal is used in a <strong>const context</strong>, as the Dart compiler is already building a compile-time constant for a larger expression including the object, and a compile-time constant can only be built of other compile-time constants. See rule <a data-rspec-id="S7112" class="rspec-auto-link">S7112</a> for further details about why it&#8217;s important to call <code>const</code> constructors with the <code>const</code> keyword or in a <code>const</code> context.</p>
</div>
<div class="paragraph">
<p>Rule <a data-rspec-id="S7113" class="rspec-auto-link">S7113</a> helps in this regard, by enforcing the <code>const</code> constraint on the constructor itself, which in turns will oblige all constructor parameters to be <code>const</code>, whether they are literals or not.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-dart" data-lang="dart">import 'package:meta/meta.dart';

@immutable
class MultiDimensionalPoint {
  final List&lt;int&gt; coordinates;
  const MultiDimensionalPoint(this.coordinates); // Const constructor
}

void main() {
  const p1 = MultiDimensionalPoint([1, 2, 3]); // [1, 2, 3] will be const since it's used in a const context
  var p2 = const MultiDimensionalPoint([1, 2, 3]); // [1, 2, 3] will be const since it's used in a const context
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Make sure that each literal of a constructor invocation of an <code>@immutable</code> class is</p>
</div>
<div class="ulist">
<ul>
<li>
<p>either marked as <code>const</code></p>
</li>
<li>
<p>or used in a <code>const</code> context</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-dart" data-lang="dart">import 'package:meta/meta.dart';

@immutable
class MultiDimensionalPoint {
  final List&lt;int&gt; coordinates;
  MultiDimensionalPoint(this.coordinates);
}

void main() {
  final p1 = MultiDimensionalPoint([1, 2, 3]); // Non compliant
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-dart" data-lang="dart">import 'package:meta/meta.dart';

@immutable
class MultiDimensionalPoint {
  final List&lt;int&gt; coordinates;
  MultiDimensionalPoint(this.coordinates);
}

void main() {
  final p1 = MultiDimensionalPoint(const [1, 2, 3]);
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_noncompliant_code_example_2">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-dart" data-lang="dart">import 'package:meta/meta.dart';

@immutable
class MultiDimensionalPoint {
  final List&lt;int&gt; coordinates;
  const MultiDimensionalPoint(this.coordinates);
}

void main() {
  final p1 = MultiDimensionalPoint([1, 2, 3]); // Non compliant
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution_2">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-dart" data-lang="dart">import 'package:meta/meta.dart';

@immutable
class MultiDimensionalPoint {
  final List&lt;int&gt; coordinates;
  const MultiDimensionalPoint(this.coordinates);
}

void main() {
  const p1 = MultiDimensionalPoint([1, 2, 3]);
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Dart Docs - <a href="https://dart.dev/tools/linter-rules/prefer_const_literals_to_create_immutables">Dart Linter rule - prefer_const_literals_to_create_immutables</a></p>
</li>
<li>
<p>Dart Docs - <a href="https://dart.dev/language/variables#final-and-const">Language - Final and const</a></p>
</li>
<li>
<p>Dart Docs - <a href="https://dart.dev/language/constructors#constant-constructors">Language - Constant constructors</a></p>
</li>
<li>
<p>Flutter API Reference - <a href="https://api.flutter.dev/flutter/meta/immutable-constant.html">meta.dart - immutable top-level constant</a></p>
</li>
<li>
<p>Wikipedia - <a href="https://en.wikipedia.org/wiki/Immutable_object">Immutable object</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_related_rules">Related rules</h3>
<div class="ulist">
<ul>
<li>
<p><a data-rspec-id="S7112" class="rspec-auto-link">S7112</a> - Const constructors should be invoked with const</p>
</li>
<li>
<p><a data-rspec-id="S7113" class="rspec-auto-link">S7113</a> - @immutable classes should only have const constructors</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Use 'const' literals as arguments to constructors of '@immutable' classes.</p>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="paragraph">
<p>Each non-<code>const</code> literal used as argument: e.g. <code>[1, 2, 3]</code> in <code>ImmutableNonConst.withParams(42, [1, 2, 3], { [1, 2, 3], [4, 5, 6] });</code>.</p>
</div>
<div class="paragraph">
<p>If the literal is prepended by a type annotation, the type annotation is included in the highlighting: e.g. <code>List&lt;int&gt;</code> and <code>Set&lt;List&lt;int&gt;&gt;</code> in <code>ImmutableNonConst.withParams(42, List&lt;int&gt; [1, 2, 3], Set&lt;List&lt;int&gt;&gt; { [1, 2, 3], [4, 5, 6] });</code>.</p>
</div>
</div>
</div>
</div>