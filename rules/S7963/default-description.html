<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This rule raises an issue when Apex code performs database operations (Create, Read, Update, Delete) without first checking if the current user has the necessary permissions using Schema methods.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Apex code runs in system mode by default, which means it bypasses the user&#8217;s profile and permission set restrictions. This can lead to serious security vulnerabilities where users can access, modify, or delete data they shouldn&#8217;t have access to.</p>
</div>
<div class="paragraph">
<p>When Apex classes are called from different contexts, such as Flows, the permission enforcement behavior can vary. Flows may execute with elevated privileges, but the underlying Apex code should still respect the current user&#8217;s actual permissions to maintain proper security boundaries.</p>
</div>
<div class="paragraph">
<p>Without explicit permission checks, your application becomes vulnerable to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Unauthorized data access</strong>: Users might read sensitive information they don&#8217;t have permission to view</p>
</li>
<li>
<p><strong>Privilege escalation</strong>: Users could perform actions beyond their authorized scope</p>
</li>
<li>
<p><strong>Data integrity issues</strong>: Unauthorized modifications could compromise data quality and business processes</p>
</li>
<li>
<p><strong>Compliance violations</strong>: Many regulatory frameworks require proper access controls</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Salesforce provides Schema methods specifically for this purpose, allowing developers to programmatically verify object-level permissions before executing database operations. These methods check the current user&#8217;s actual permissions, ensuring that security policies are consistently enforced regardless of the execution context.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>Without proper permission checks, users may gain unauthorized access to sensitive data or perform operations beyond their intended privileges. This can lead to data breaches, compliance violations, and compromise of business-critical information. The impact is particularly severe when Apex classes are invoked from Flows or other contexts where permission enforcement may be inconsistent.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Use Schema methods to check object-level permissions before performing database operations. Always verify that the current user has the necessary CRUD permissions for the specific operation you&#8217;re about to perform.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-apex" data-lang="apex">public class AccountProcessor {
    public static void deleteAccount(Id accountId) {
        delete [SELECT Id FROM Account WHERE Id = :accountId]; // Noncompliant
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-apex" data-lang="apex">public class AccountProcessor {
    public static void deleteAccount(Id accountId) {
        if (!Schema.sObjectType.Account.isDeletable()) {
            throw new SecurityException('User lacks delete permission for Account');
        }
        delete [SELECT Id FROM Account WHERE Id = :accountId];
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Apex Security and Sharing - <a href="https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/apex_security.htm">Official Salesforce documentation on Apex security best practices and sharing rules</a></p>
</li>
<li>
<p>Schema Class Methods - <a href="https://developer.salesforce.com/docs/atlas.en-us.apexref.meta/apexref/apex_methods_system_schema.htm">Reference documentation for Schema class methods used to check permissions</a></p>
</li>
<li>
<p>Enforcing CRUD and FLS - <a href="https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/apex_classes_perms_enforcing.htm">Guide on enforcing Create, Read, Update, Delete and Field Level Security in Apex</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_standards">Standards</h3>
<div class="ulist">
<ul>
<li>
<p>CWE-862: Missing Authorization - <a href="https://cwe.mitre.org/data/definitions/862.html">The software does not perform an authorization check when an actor attempts to access a resource or perform an action</a></p>
</li>
<li>
<p>OWASP Top 10:2021-A01-Broken Access Control - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Failures related to access control are common and can lead to unauthorized information disclosure, modification, or destruction</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>