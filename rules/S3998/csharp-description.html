<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Objects that can be accessed across <a href="https://learn.microsoft.com/en-us/dotnet/framework/app-domains/application-domains">application domain</a> boundaries are said to have weak identity. This means that these objects can be considered shared resources outside of the domain, which can be lead to them being accessed or modified by multiple threads or concurrent parts of a program, outside of the domain.</p>
</div>
<div class="paragraph">
<p>A <a href="https://en.wikipedia.org/wiki/Thread_(computing)">thread</a> acquiring a <a href="https://en.wikipedia.org/wiki/Lock_(computer_science)">lock</a> on such an object runs the risk of being blocked by another thread in a different application domain, leading to poor performance and potentially <a href="https://stackoverflow.com/questions/1162587/what-is-starvation">thread starvation</a> and <a href="https://en.wikipedia.org/wiki/Deadlock">deadlocks</a>.</p>
</div>
<div class="paragraph">
<p>Types with weak identity are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.marshalbyrefobject">MarshalByRefObject</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.executionengineexception">ExecutionEngineException</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.outofmemoryexception">OutOfMemoryException</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.stackoverflowexception">StackOverflowException</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.string">String</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.reflection.memberinfo">MemberInfo</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.reflection.parameterinfo">ParameterInfo</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.threading.thread">Thread</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">public class Sample
{
    private readonly StackOverflowException myLock = new();

    public void Go()
    {
        lock (myLock) // Noncompliant
        {
            // ...
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">public class Sample
{
    private readonly object myLock = new();

    public void Go()
    {
        lock (myLock)
        {
            // ...
        }
    }
}</code></pre>
</div>
</div>
<hr>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Replace this with a lock against an object with strong-identity.</p>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="paragraph">
<p>the lock call</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_8_may_2017_130557_valeri_hristov_wrote">on 8 May 2017, 13:05:57 Valeri Hristov wrote:</h3>
<div class="paragraph">
<p>Changed the text a bit because we automatically generate description for sonarlint.org from the first paragraph of the RSPEC and the old one was too short. Please, review.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://en.wikipedia.org/wiki/Thread_(computing)">Thread</a></p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Lock_(computer_science)">Locking</a></p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Deadlock">Deadlock</a></p>
</li>
<li>
<p><a href="https://docs.microsoft.com/en-us/dotnet/standard/threading/managed-threading-best-practices">Managed Threading Best Practices</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/framework/app-domains/application-domains">Application domains</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_articles_blog_posts">Articles &amp; blog posts</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://stackoverflow.com/questions/1162587/what-is-starvation">What is (thread) starvation?</a></p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Readers%E2%80%93writers_problem">Readers-writers problem</a></p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Dining_philosophers_problem">Dining philosophers problem</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>