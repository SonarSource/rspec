== Why is this an issue?

Non-trivial constant literals should not be used in expressions directly,
but should be replaced with variables with constant values.

=== What is the potential impact?

==== Readability and Understanding

With context, it is easier for readers to understand the meaning of non-trivial constants in expressions.
Descriptive variable names provide that context so that readers get information on the purpose and function of the constant.

==== Wrong code

If a non-trivial constant literal is used multiple times in the source code, it is code duplication and bears the risk
of a wrong value being used in one of the duplicates.

==== Flexibility of the design

Changing the value of the constant can be done by changing the variable's constant value
nstead of changing the constant literal in every expression that uses it.

== How to fix it

Assign the constant literal to a `val`, `const val` or a local variable (depending on the situation)
and replace appearances of the literal in expressions with the variable name.

=== Code examples

==== Noncompliant code example

[source,kotlin,diff-id=1,diff-type=noncompliant]
----
fun setBit6To17(wordValue: Int, fieldValue: Int): Int {
    return (wordValue and 0x3ffc0) or (fieldValue and 0xc003f) // Noncompliant, 0x3ffc0 and 0xc003f are non-trivial
}
----

==== Compliant solution

[source,kotlin,diff-id=1,diff-type=compliant]
----
const val bitMask6To17 = 0x3ffc0
const val bitMask6To17Inverted = bitMask6To17.inv()

fun setBit6To17(wordValue: Int, fieldValue: Int): Int {
    return (wordValue and bitMask6To17) or (fieldValue and bitMask6To17Inverted) // Compliant
}
----

==== Noncompliant code example

[source,kotlin,diff-id=2,diff-type=noncompliant]
----
fun multiplySine45(value: Long):Long {
    return (value * 46341L) shr 16 // Noncompliant, semantic of 46341L is unknown to the reader
}
----

==== Compliant solution

[source,kotlin,diff-id=2,diff-type=compliant]
----
val reciprocalSqrt2FixedPoint16 = 46341L

fun multiplySine45(value: Long): Long {
    return (value * reciprocalSqrt2FixedPoint16) shr 16 // Compliant
}
----

== Resources

=== Articles & blog posts

* https://en.wikipedia.org/wiki/Magic_number_(programming)[Wikipedia, Magic number (programming)]
