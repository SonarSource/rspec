This is an issue when pipeline parameters use environment variables (env.*) in their default values, as these variables are not available during parameter definition.

== Why is this an issue?

Pipeline parameters are defined before the pipeline starts executing, but environment variables only become available after a node is allocated and the pipeline begins running. This creates a timing problem where the environment variables will be null or undefined when the parameter defaults are evaluated.

This can lead to several problems:

* Parameters may receive null or empty values instead of the intended defaults
* Runtime errors when the pipeline tries to use these undefined values
* Unpredictable behavior that's difficult to debug
* Inconsistent pipeline behavior across different environments

The fundamental issue is a chicken-and-egg problem: you need environment variables to set parameter defaults, but you need to define parameters before the environment is available.

=== What is the potential impact?

Using environment variables in parameter defaults can cause pipeline failures, unpredictable behavior, and make debugging difficult. Parameters may receive unexpected null values, leading to runtime errors or incorrect pipeline execution paths.

== How to fix it

Replace environment variable references with static values or computed variables that are available during parameter definition. Use context like BRANCH_NAME that's available early in the pipeline lifecycle.

=== Code examples

==== Noncompliant code example

[source,groovy,diff-id=1,diff-type=noncompliant]
----
pipeline {
  parameters {
    string(name: 'BUILD_ARCH', defaultValue: "${env.BUILD_ARCHS}", description: 'Architecture to build') // Noncompliant
    booleanParam(name: 'DEPLOY', defaultValue: env.AUTO_DEPLOY == 'true', description: 'Deploy after build') // Noncompliant
  }
  stages {
    // pipeline stages
  }
}
----

==== Compliant solution

[source,groovy,diff-id=1,diff-type=compliant]
----
def defaultArch = 'linux-x86_64'
def defaultDeploy = BRANCH_NAME != 'production'

pipeline {
  parameters {
    string(name: 'BUILD_ARCH', defaultValue: defaultArch, description: 'Architecture to build')
    booleanParam(name: 'DEPLOY', defaultValue: defaultDeploy, description: 'Deploy after build')
  }
  stages {
    // pipeline stages
  }
}
----

== Resources

=== Documentation

 * Jenkins Pipeline Parameters - https://www.jenkins.io/doc/book/pipeline/syntax/#parameters[Official Jenkins documentation on pipeline parameters and their usage]

 * Jenkins Environment Variables - https://www.jenkins.io/doc/book/pipeline/jenkinsfile/#using-environment-variables[Documentation on when and how environment variables are available in Jenkins pipelines]
