<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Storing data locally is a common task for mobile applications. Such data includes files among other things. One convenient way to store files is to use the external file storage which usually offers a larger amount of disc space compared to internal storage.</p>
</div>
<div class="paragraph">
<p>Files created on the external storage are globally readable and writable. Therefore, a malicious application having the permissions <code>WRITE_EXTERNAL_STORAGE</code> or <code>READ_EXTERNAL_STORAGE</code> could try to read sensitive information from the files that other applications have stored on the external storage.</p>
</div>
<div class="paragraph">
<p>External storage can also be removed by the user (e.g. when based on SD card) making the files unavailable to the application.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ask_yourself_whether">Ask Yourself Whether</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Your application uses external storage to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>store files that contain sensitive data.</p>
</li>
<li>
<p>store files that are not meant to be shared with other application.</p>
</li>
<li>
<p>store files that are critical for the application to work.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There is a risk if you answered yes to any of those questions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_recommended_secure_coding_practices">Recommended Secure Coding Practices</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Use internal storage whenever possible as the system prevents other apps from accessing this location.</p>
</li>
<li>
<p>Only use external storage if you need to share non-sensitive files with other applications.</p>
</li>
<li>
<p>If your application has to use the external storage to store sensitive data, make sure it encrypts the files using <a href="https://developer.android.com/reference/androidx/security/crypto/EncryptedFile">EncryptedFile</a>.</p>
</li>
<li>
<p>Data coming from external storage should always be considered untrusted and should be validated.</p>
</li>
<li>
<p>As some external storage can be removed, make sure to never store files on it that are critical for the usability of your application.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sensitive_code_example">Sensitive Code Example</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import android.content.Context

class AccessExternalFiles {

    fun accessFiles(Context context) {
        context.getExternalFilesDir(null) // Sensitive
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import android.content.Context
import android.os.Environment

class AccessExternalFiles {

    fun accessFiles(Context context) {
        context.getFilesDir()
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a></p>
</li>
<li>
<p><a href="https://developer.android.com/privacy-and-security/security-tips#ExternalStorage">Android Security tips on external file storage</a></p>
</li>
<li>
<p>OWASP - <a href="https://mas.owasp.org/checklists/MASVS-STORAGE/">Mobile AppSec Verification Standard - Data Storage and Privacy Requirements</a></p>
</li>
<li>
<p>OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m2-insecure-data-storage">Mobile Top 10 2016 Category M2 - Insecure Data Storage</a></p>
</li>
<li>
<p>OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2023-risks/m9-insecure-data-storage">Mobile Top 10 2024 Category M9 - Insecure Data Storage</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/312">CWE-312 - Cleartext Storage of Sensitive Information</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Make sure that external files are accessed safely here</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_15_may_2019_163114_tibor_blenessy_wrote">on 15 May 2019, 16:31:14 Tibor Blenessy wrote:</h3>
<div class="paragraph">
<p>Looking at the documentation, it seems to me that it would make sense to add also following APIs</p>
</div>
<div class="ulist">
<ul>
<li>
<p>https://developer.android.com/reference/android/content/Context#getExternalMediaDirs()</p>
</li>
<li>
<p>https://developer.android.com/reference/android/content/Context#getExternalFilesDirs(java.lang.String)</p>
</li>
<li>
<p>https://developer.android.com/reference/android/content/Context#getExternalCacheDir()</p>
</li>
<li>
<p>https://developer.android.com/reference/android/content/Context#getExternalCacheDirs()</p>
</li>
<li>
<p>https://developer.android.com/reference/android/os/Environment#getExternalStorageDirectory()</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>wdyt [~nicolas.harraudeau]?</p>
</div>
</div>
</div>
</div>