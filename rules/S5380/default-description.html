<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to protect shared resources, Salesforce enforces a maximum number of SOQL queries which can be executed inside a single <a href="https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/apex_transaction.htm">transaction</a>. This is part of <a href="https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/apex_gov_limits.htm">Governor limits</a>. If an SOQL query is nested inside a loop&#8217;s body (For/While/Do-While) it might be executed more times than the Governor limit allows, making the code fail.</p>
</div>
<div class="paragraph">
<p>Thus it is a best practice to not have SOQL queries nested in the body of loops and instead retrieve all relevant data in a single query.</p>
</div>
<div class="paragraph">
<p>This rule raises an issue when it detects SOQL queries inside loops. This includes static SOQL queries (i.e. <code>[SELECT ...]</code>) and calls to <code>Database.countQuery</code>, <code>Database.getQueryLocator</code> and <code>Database.query</code> methods.</p>
</div>
<div class="sect2">
<h3 id="_noncompliant_code_example">Noncompliant code example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-apex" data-lang="apex">// Query in a for loop
public class MyClass {
    public static void myFunction() {
        for (Integer i = 0; i &lt; 1000; i++) {
            string firstName = 'Bob' + i;
            Contact[] contacts = [ Select LastName From Contact Where FirstName = :firstName];  // Noncompliant
        }
    }
}

// Query in a while loop
public class MyClass {
    public static void myFunction() {
        Integer i = 0;
        while ( i &lt; 1000) {
            string firstName = 'Bob' + i;
            Contact[] contacts = [ Select LastName From Contact Where FirstName = :firstName];  // Noncompliant
            i = i+1;
        }
    }
}

// Query in a do-while loop
public class MyClass {
    public static void myFunction() {
        Integer i = 0;
        do {
            string firstName = 'Bob' + i;
            Contact[] contacts = [ Select LastName From Contact Where FirstName = :firstName];  // Noncompliant
            i++;
        } while (i &lt; 1000);
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_compliant_solution">Compliant solution</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-apex" data-lang="apex">public class MySOQLLoop {
    public static void myFunction() {
        List&lt;string&gt; names = new List&lt;string&gt;();
        for (Integer i = 0; i &lt; 10; i++) {
            names.add('Bob' + i);
        }
        for (Contact contact: [Select LastName From Contact Where FirstName in :names]) {
            // ...
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_exceptions">Exceptions</h3>
<div class="paragraph">
<p>No issue will be raised onÂ SOQL querying <a href="https://help.salesforce.com/articleView?id=custommetadatatypes_overview.htm&amp;type=5">custom metadata types</a> (i.e: type names ending with "__mdt")as <a href="https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/apex_gov_limits.htm">Governor limits do not apply to them</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-apex" data-lang="apex">public class MyClass {
    public static void myFunction() {
        for (Integer i = 0; i &lt; 1000; i++) {
            Contact[] contacts = [ Select myfield From MyCustomMetadataType__mdt];  // Ok
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://developer.salesforce.com/wiki/apex_code_best_practices">Apex Design Best Practices</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Move this SOQL query out of this loop.</p>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="paragraph">
<p>SOQL query</p>
</div>
</div>
</div>
</div>