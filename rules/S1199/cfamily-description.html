<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Nested code blocks create new scopes where variables declared within are inaccessible from the outside, and their lifespan ends with the block.</p>
</div>
<div class="paragraph">
<p>Although this may appear beneficial, their usage within a function often suggests that the function is overloaded.
Thus, it may violate the Single Responsibility Principle, and the function needs to be broken down into smaller functions.</p>
</div>
<div class="paragraph">
<p>The presence of nested blocks that don&#8217;t affect the control flow might suggest possible mistakes in the code.</p>
</div>
<div class="paragraph">
<p>However, nested code blocks are acceptable when they encapsulate all statements within a <code>switch</code> (a <code>case xxx:</code> or a <code>default:</code>)
to prevent variable declarations from interfering with other <code>cases</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The nested code blocks should be extracted into separate methods.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">void f(Cache &amp;c, int data) {
  int value;
  { // Noncompliant
    std::scoped_lock l(c.getMutex());
    if (c.hasKey(data)) {
      value = c.get(data);
    } else {
      value = compute(data);
      c.set(data, value);
    }
  } // Releases the mutex

  switch(value) {
    case 1:
    { // Noncompliant, some statements are outside of the block
       int result = compute(value);
       save(result);
    }
    log();
    break;
    case 2:
    // ...
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">int getValue(Cache &amp;c, int data) {
  std::scoped_lock l(c.getMutex());
  if (c.hasKey(data)) {
    return c.get(data);
  } else {
    value = compute(data);
    c.set(data, value);
    return value;
  }
}

void f(Cache &amp;c, int data) {
  int value = getValue(c, data);

  switch(value) {
    case 1:
    { // Compliant, limits the scope of "result"
       int result = compute(value);
       save(result);
       log();
    }
    break;
    case 2:
    // ...
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Wikipedia - <a href="https://en.wikipedia.org/wiki/Single-responsibility_principle">Single Responsibility Principle</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Extract this nested code block into a separate method.</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_20_aug_2013_081440_freddy_mallet_wrote">on 20 Aug 2013, 08:14:40 Freddy Mallet wrote:</h3>
<div class="paragraph">
<p>Is implemented by http://jira.codehaus.org/browse/SONARJAVA-298</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_24_aug_2013_185909_ann_campbell_wrote">on 24 Aug 2013, 18:59:09 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>This is a classic C trick. Should the rule be added there as well?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_25_aug_2013_184057_freddy_mallet_wrote">on 25 Aug 2013, 18:40:57 Freddy Mallet wrote:</h3>
<div class="paragraph">
<p>I&#8217;ve added C&#43;&#43; as targeted language</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_22_apr_2014_214041_evgeny_mandrikov_wrote">on 22 Apr 2014, 21:40:41 Evgeny Mandrikov wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] [~freddy.mallet] IMO title is a little bit misleading, because for some other rules we use "nested code blocks" to refer to compound-statement within if-statement.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_23_apr_2014_151812_ann_campbell_wrote">on 23 Apr 2014, 15:18:12 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~evgeny.mandrikov] what would you suggest?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_12_sep_2017_141330_pierre_yves_nicolas_wrote">on 12 Sep 2017, 14:13:30 Pierre-Yves Nicolas wrote:</h3>
<div class="paragraph">
<p>PHP supports such blocks but that does not impact the scope of variables.</p>
</div>
</div>
</div>
</div>