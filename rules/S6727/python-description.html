<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This rule raises an issue when <code>math.isclose</code> is used to compare values against 0 without providing the <code>abs_tol</code> parameter.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Comparing float values for equality directly is not reliable and should be avoided, due to the inherent imprecision in the binary representation of floating point numbers. Such comparison is reported by <a data-rspec-id="S1244" class="rspec-auto-link">S1244</a>.</p>
</div>
<div class="paragraph">
<p>One common solution to this problem is to use the <code>math.isclose</code> function to perform the comparison. Behind the scenes, the <code>math.isclose</code> function uses a tolerance value (also called epsilon) to define an acceptable range of difference between two floats. A tolerance value may be relative (based on the magnitude of the numbers being compared) or absolute.</p>
</div>
<div class="paragraph">
<p>Using a relative tolerance would be equivalent to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">def isclose_relative(a, b, rel_tol=1e-09):
    diff = abs(a - b)
    max_diff = rel_tol * max(abs(a), abs(b))
    return diff &lt;= max_diff</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using an absolute tolerance is equivalent to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">def isclose_absolute(a, b, abs_tol=1e-09):
    diff = abs(a - b)
    return diff &lt;= abs_tol</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>math.isclose</code> method uses both relative and absolute tolerances and can be approximated as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">def is_close(a, b, rel_tol=1e-09, abs_tol=0.0):
    diff = abs(a - b)
    max_diff = max(rel_tol * max(abs(a), abs(b)), abs_tol)
    return diff &lt;= max_diff</code></pre>
</div>
</div>
<div class="paragraph">
<p>Whenever comparing values that are close to 0, the value of the relative tolerance may be too small to overcome the imprecision introduced by floating-point arithmetic. It is therefore important to rely on an absolute tolerance in this case.</p>
</div>
<div class="paragraph">
<p>When using <code>math.isclose</code>, the absolute tolerance is defined through the parameter <code>abs_tol</code>. By default, the value of this parameter is <code>0.0</code>. Therefore, using <code>math.isclose</code> to compare values against zero without providing this parameter is equivalent to a strict equality check, which is likely not intended.</p>
</div>
<div class="sect2">
<h3 id="_exceptions">Exceptions</h3>
<div class="paragraph">
<p>Note that similar methods from different libraries may behave differently. Notably, <code>numpy.isclose</code> has a default absolute tolerance of <code>1e-08</code>. No issue will be reported in this case. However, to ensure consistency and intentionality, it is recommended to always set the tolerance values.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To fix this issue, make sure to provide the <code>abs_tol</code> argument to the <code>math.isclose</code> function whenever comparing values against zero. If a strict equality check is intended, consider using the equality operator or providing <code>0</code> as the <code>abs_tol</code> parameter to make the intention clear.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import math
def foo(a):
    return math.isclose(a, 0)  # Noncompliant: the default absolute tolerance is 0.0</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import math
def foo(a):
    return math.isclose(a, 0, abs_tol=1e-09)  # Compliant</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Python Documentation - <a href="https://docs.python.org/3/tutorial/floatingpoint.html#floating-point-arithmetic-issues-and-limitations">Floating Point Arithmetic: Issues and Limitations</a></p>
</li>
<li>
<p>Python Documentation - <a href="https://docs.python.org/3/library/decimal.html#module-decimal">Decimal fixed point and floating point arithmetic</a></p>
</li>
<li>
<p>NumPy Documentation - <a href="https://numpy.org/doc/stable/reference/generated/numpy.isclose.html">numpy.isclose</a></p>
</li>
<li>
<p>PyTorch Documentation - <a href="https://pytorch.org/docs/stable/generated/torch.isclose.html">torch.isclose</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_related_rules">Related rules</h3>
<div class="ulist">
<ul>
<li>
<p><a data-rspec-id="S1244" class="rspec-auto-link">S1244</a>: Floating point numbers should not be tested for equality</p>
</li>
</ul>
</div>
</div>
</div>
</div>