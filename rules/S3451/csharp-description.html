<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.componentmodel.defaultvalueattribute">DefaultValue</a> does not make the compiler set the default value, as its name may suggest. What you probably wanted to use is <a href="https://learn.microsoft.com/en-us/dotnet/api/system.runtime.interopservices.defaultparametervalueattribute">DefaultParameterValue</a>.</p>
</div>
<div class="paragraph">
<p>The <a href="https://learn.microsoft.com/en-us/dotnet/api/system.componentmodel.defaultvalueattribute">DefaultValue</a> attribute from the <code>System.ComponentModel</code> namespace, is sometimes used to declare a member&#8217;s default value. This can be used, for instance, by the reset feature of a visual designer or by a code generator.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">public void DoStuff([DefaultValue(4)] int i)
{
    // i is not automatically assigned 4
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <a href="https://learn.microsoft.com/en-us/dotnet/api/system.runtime.interopservices.optionalattribute">Optional</a> attribute from the <code>System.Runtime.InteropServices</code> namespace is sometimes used to indicate that a parameter is optional, as an alternative to the language-specific construct.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">public void DoStuff([Optional] int i)
{
    // i would be assigned default(int) = 0
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The use of <code>[DefaultValue]</code> with <code>[Optional]</code> has no more effect than <code>[Optional]</code> alone. That&#8217;s because <code>[DefaultValue]</code> doesn&#8217;t actually do anything; it merely indicates the intent for the value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">class MyClass
{
    public void DoStuff([Optional][DefaultValue(4)] int i, int j = 5)  // Noncompliant
    {
        Console.WriteLine(i);
    }

    public static void Main()
    {
        new MyClass().DoStuff(); // prints 0, since [DefaultValue] doesn't actually set the default, and default(int) is used instead
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>More than likely, <code>[DefaultValue]</code> was used in confusion instead of <code>[DefaultParameterValue]</code>, the language-agnostic version of the default parameter initialization mechanism provided by C#.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">class MyClass
{
    public void DoStuff([Optional][DefaultParameterValue(4)] int i, int j = 5)
    {
        Console.WriteLine(i);
    }

    public static void Main()
    {
        new MyClass().DoStuff(); // prints 4
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that you can&#8217;t use both <code>[DefaultParameterValue]</code> and default parameter initialization on the same parameter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">void DoStuff([Optional][DefaultParameterValue(4)] int i = 5) // Error CS1745 Cannot specify default parameter value in conjunction with DefaultParameterAttribute or OptionalAttribute</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.runtime.interopservices.optionalattribute">OptionalAttribute Class</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.componentmodel.defaultvalueattribute">DefaultValueAttribute Class</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.runtime.interopservices.defaultparametervalueattribute">DefaultParameterValueAttribute Class</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/named-and-optional-arguments#optional-arguments">Optional arguments (C# Programming Guide)</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_articles_blog_posts">Articles &amp; blog posts</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://stackoverflow.com/questions/40171095/use-optional-defaultparametervalue-attribute-or-not">Stack Overflow - Use "Optional, DefaultParameterValue" attribute, or not?</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Use "[DefaultParameterValue]" instead.</p>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="paragraph">
<p><code>[DefaultValue]</code></p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_8_dec_2015_095538_tamas_vajk_wrote">on 8 Dec 2015, 09:55:38 Tamas Vajk wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] LGTM, but I&#8217;m not 100% happy with the title. <code>[DefaultValue]</code> can be used with <code>[Optional]</code>, you might build your own tooling around it, and read the value specified in <code>[DefaultValue]</code>. So we should probably not say that you shouldn&#8217;t use it. But I have no better ideas than the current one.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_8_dec_2015_150514_ann_campbell_wrote">on 8 Dec 2015, 15:05:14 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~tamas.vajk] I struggled with this title myself, and I recognize that <code>[DefaultValue]</code> + <code>[Optional]</code> is a valid usage. But the best alternate title gets into intent, which I don&#8217;t want to do: '[DefaultValue]" should not be used with "[Optional]" when "[DefaultParamterValue]" was intended'</p>
</div>
<div class="paragraph">
<p>And if you&#8217;re building tooling around <code>[DefaultValue]</code> then you&#8217;ll turn this rule off.</p>
</div>
</div>
</div>
</div>