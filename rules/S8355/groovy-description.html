<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This rule raises an issue when variables are declared in the <code>environment</code> block and assigned values from functions that return complex objects like Maps or Lists.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In Jenkins declarative pipelines, the <code>environment</code> block automatically converts all variables to strings, regardless of their original data type. This string conversion breaks the structure and functionality of complex objects returned by utility functions like <code>readYaml</code>, <code>readJSON</code>, or <code>readProperties</code>.</p>
</div>
<div class="paragraph">
<p>When a Map or List is converted to a string, you lose the ability to access its properties, iterate over its elements, or use any of its methods. This leads to runtime errors when your pipeline tries to use these objects as intended.</p>
</div>
<div class="paragraph">
<p>For example, if <code>readYaml</code> returns a Map with nested properties, converting it to a string means you can no longer access those properties using dot notation or bracket syntax. The pipeline will fail with errors like "No such field found" because the string representation doesn&#8217;t have the expected structure.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>This issue causes runtime failures in Jenkins pipelines when attempting to access properties or methods of complex objects. The pipeline will crash with <code>RejectedAccessException</code> or similar errors, preventing successful builds and deployments. This can block development workflows and cause confusion for developers who expect the objects to maintain their original structure.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Move the variable declaration from the <code>environment</code> block to a <code>script</code> block within a stage. This preserves the original data type and structure of complex objects.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">pipeline {
  agent any
  environment {
    valuesYaml = readYaml(file: 'values.yaml') // Noncompliant
  }
  stages {
    stage('Process') {
      steps {
        script {
          // This will fail because valuesYaml is a string
          echo valuesYaml.appName
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">pipeline {
  agent any
  stages {
    stage('Process') {
      steps {
        script {
          def valuesYaml = readYaml(file: 'values.yaml')
          // This works because valuesYaml preserves its Map structure
          echo valuesYaml.appName
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Jenkins Pipeline Utility Steps - readYaml - <a href="https://jenkins.io/doc/pipeline/steps/pipeline-utility-steps/#readyaml-read-yaml-from-files-in-the-workspace-or-text">Official documentation for the readYaml pipeline utility step</a></p>
</li>
<li>
<p>Jenkins Declarative Pipeline - Environment Directive - <a href="https://www.jenkins.io/doc/book/pipeline/syntax/#environment">Documentation explaining how the environment directive works in declarative pipelines</a></p>
</li>
<li>
<p>Jenkins Pipeline Utility Steps Plugin - <a href="https://plugins.jenkins.io/pipeline-utility-steps/">Plugin providing utility steps for reading and writing common file formats</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>