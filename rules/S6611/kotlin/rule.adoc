

== Why is this an issue?

When accessing `Map` elements by key, you should handle the `null` value properly in case the value does not exist. It's not always clear whether a variable is guaranteed to be non-null or not so it's easy to misuse the non-null operator. 

In Kotlin if you pass a null when a null value is not expected, you will get a NullPointerException. However, if you have a Java interop then passing an expected null value can result in unexpected behavior. 

== How to fix it

You should avoid using the non-null assertion operator when accessing `Map` elements. 

Instead, you can:

* return an instance of a nullable type.
* use getValue. This will throw NoSuchElementException when an element is not present.
* use either `getOrElse` or `getOrDefault` functions and explicitly specify the behavior in case of a null value.
* use an elvis operator `?:` to specify the behavior in case of a null value.

=== Code examples

==== Noncompliant code example

This example will throw a NullPointerException at the `!!` operator because `map` doesn't have a key `123` and the result of `get(123)` will be null. 

[source,kotlin]
----
val l = mapOf(1 to "one", 2 to "two", 3 to "five")
l.get(123)!! // Noncompliant
l[123]!! // Noncompliant
----

==== Compliant solution

By removing the non-null assertion operator the result of the `get(123)` call will return an instance of a nullable type, and the user can handle the potential `null` value properly.

[source,kotlin]
----
val l = mapOf(1 to "one", 2 to "two", 3 to "five")
l.get(123) // Compliant, returns nullable
l[123] // Compliant, returns nullable
l.getValue(123) // Compliant, throws NoSuchElementException
l.getOrElse(123 ) { "empty" } // Compliant, has default
l.getOrDefault(123, "empty") // Compliant, has default
l[123] ?: "empty" // Compliant, has default
----

== Resources

=== Documentation

* https://kotlinlang.org/docs/null-safety.html[Kotlin Documentation - Null safety]
* https://kotlinlang.org/docs/map-operations.html[Kotlin Documentation - Map-specific operations]
* https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/get-or-else.html[Kotlin Documentation - getOrElse]
* https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/get-or-default.html[Kotlin Documentation - getOrDefault]

=== Articles & blog posts

* https://medium.com/@igorwojda/kotlin-combating-non-null-assertions-5282d7b97205[Kotlin â€” combating non-null assertions (!!)]
