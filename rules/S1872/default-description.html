<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There is no requirement that class names be unique, only that they be unique within a package. Therefore trying to determine an object&#8217;s type based on its class name is an exercise fraught with danger. One of those dangers is that a malicious user will send objects of the same name as the trusted class and thereby gain trusted access.</p>
</div>
<div class="paragraph">
<p>Instead, the <code>instanceof</code> operator or the <code>Class.isAssignableFrom()</code> method should be used to check the object&#8217;s underlying type.</p>
</div>
<div class="sect2">
<h3 id="_noncompliant_code_example">Noncompliant code example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package computer;
class Pear extends Laptop { ... }

package food;
class Pear extends Fruit { ... }

class Store {

  public boolean hasSellByDate(Object item) {
    if ("Pear".equals(item.getClass().getSimpleName())) {  // Noncompliant
      return true;  // Results in throwing away week-old computers
    }
    return false;
  }

  public boolean isList(Class&lt;T&gt; valueClass) {
    if (List.class.getName().equals(valueClass.getName())) {  // Noncompliant
      return true;
    }
    return false;
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_compliant_solution">Compliant solution</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">class Store {

  public boolean hasSellByDate(Object item) {
    if (item instanceof food.Pear) {
      return true;
    }
    return false;
  }

  public boolean isList(Class&lt;T&gt; valueClass) {
    if (valueClass.isAssignableFrom(List.class)) {
      return true;
    }
    return false;
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/486">CWE-486 - Comparison of Classes by Name</a></p>
</li>
<li>
<p><a href="https://wiki.sei.cmu.edu/confluence/x/eDdGBQ">CERT, OBJ09-J.</a> - Compare classes and not class names</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Use an ["instanceof"|"isAssignableFrom()"] comparison instead.</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_21_nov_2024_164800_alban_auzeill_wrote">on 21 Nov 2024, 16:48:00 Alban Auzeill wrote:</h3>
<div class="paragraph">
<p>[test-code-support-investigation-for-java] Decision for scope: Main &#8594; All. May have users that want to test only the name.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_30_jul_2014_211424_freddy_mallet_wrote">on 30 Jul 2014, 21:14:24 Freddy Mallet wrote:</h3>
<div class="paragraph">
<p>My feedback @Ann:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>I would have limited the scope of this rule to Java and Groovy because on my side I would not be able to say if this rule is relevant or not in C&#43;&#43;, C#, VB.Net, &#8230;&#8203;</p>
</li>
<li>
<p>In the provided example in Java, I would have used the Class.getName() method and not Class.getSimpleName() which is not so widely used.</p>
</li>
<li>
<p>The following extended description provided in the CWE page is for me really relevant to understand why this might be a security issue:</p>
</li>
</ul>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>If the decision to trust the methods and data of an object is based on the name of a class, it is possible for malicious users to send objects of the same name as trusted classes and thereby gain the trust afforded to known classes and types.</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="_on_31_jul_2014_184853_ann_campbell_wrote">on 31 Jul 2014, 18:48:53 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~freddy.mallet]</p>
</div>
<div class="ulist">
<ul>
<li>
<p>I did some research at the time (&amp; just ran through it again). All of those languages have classes and some equivalent of instanceof</p>
</li>
<li>
<p>The example doesn&#8217;t work with Class.getName() :-)</p>
</li>
<li>
<p>I&#8217;ve beefed up the description.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_on_13_feb_2015_173716_freddy_mallet_wrote">on 13 Feb 2015, 17:37:16 Freddy Mallet wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] what should be the security category associated with this rule ?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_16_feb_2015_124140_ann_campbell_wrote">on 16 Feb 2015, 12:41:40 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~freddy.mallet] are you talking about a security-related sub-tag, or are you talking about switching the SQALE mapping to Security? Or both?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_5_apr_2015_233527_evgeny_mandrikov_wrote">on 5 Apr 2015, 23:35:27 Evgeny Mandrikov wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] I believe that this is not applicable for C&#43;&#43; and Objective-C.</p>
</div>
</div>
</div>
</div>