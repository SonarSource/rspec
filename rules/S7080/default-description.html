<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Content Security Policy (CSP) is a computer security standard that serves as
an additional layer of protection against various types of attacks.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Content Security Policy (CSP) helps protect against various types of attacks,
including Cross-Site Scripting (XSS) and clickjacking. It provides a set of standard
procedures for loading resources by user agents, which can help to mitigate the
risk of content injection vulnerabilities.</p>
</div>
<div class="paragraph">
<p>However, it is important to note that CSP is not a primary line of defense, but
rather a safety net that catches attempts to exploit vulnerabilities that exist
in the application despite other protective measures. An insecure CSP does not
automatically imply that the website is vulnerable, but it does mean that this
additional layer of protection is weakened.</p>
</div>
<div class="paragraph">
<p>A CSP can be considered insecure if it allows potentially harmful practices,
such as inline scripts or loading resources from arbitrary domains. These
practices can increase the risk of content injection attacks.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>An insecure Content Security Policy (CSP) can increase the potential severity of
other vulnerabilities in the application. For instance, if an attacker manages to
exploit a Cross-Site Scripting (XSS) vulnerability, an insecure CSP might not
provide the intended additional protection.</p>
</div>
<div class="sect3">
<h4 id="_code_execution">Code Execution</h4>
<div class="paragraph">
<p>XSS can be used to perform actions on behalf of the user without their
consent, such as changing their email address or password, or making
transactions. This can lead to unauthorized access and potential loss of control
over user accounts.</p>
</div>
</div>
<div class="sect3">
<h4 id="_phishing_attacks">Phishing Attacks</h4>
<div class="paragraph">
<p>Attackers can create convincing phishing pages within the application.
These pages can trick users into providing sensitive information, believing
they are interacting with a legitimate part of the application.</p>
</div>
</div>
<div class="sect3">
<h4 id="_data_leakage">Data leakage</h4>
<div class="paragraph">
<p>XSS allows an attacker to inject malicious scripts into webviews. These scripts can
then be used to steal sensitive information like session cookies, personal data,
or credit card details, leading to identity theft or financial fraud.</p>
</div>
<div class="paragraph">
<p>In addition, an insecure CSP that allows loading resources from arbitrary
domains could potentially expose sensitive user data to untrusted sources. This
could lead to data breaches, which can have serious legal and reputational
consequences.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it_in_electron">How to fix it in Electron</h2>
<div class="sectionbody">
<div class="paragraph">
<p>CSP&#8217;s preferred delivery mechanism is an HTTP header. However, if is not possible
(like when loading a resource using the <code>file://</code> protocol), it is possible to set
a policy of a page directly in the markup using a <code>&lt;meta&gt;</code> tag.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">app.whenReady().then(() =&gt; {
  createWindow()
})</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
  &lt;head&gt;
    &lt;meta charset="UTF-8" /&gt;
    &lt;title&gt;An example&lt;/title&gt;
  &lt;/head&gt; &lt;!-- Noncompliant --&gt;
  &lt;body&gt;
    ...
  &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">app.whenReady().then(() =&gt; {
  session.defaultSession.webRequest.onHeadersReceived((details, callback) =&gt; {
    callback({responseHeaders: {
      ...details.responseHeaders,
      'Content-Security-Policy': ['default-src \'self\'; script-src \'self\' https://demo.demo1.org']
    }})
  })
  createWindow()
})</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
  &lt;head&gt;
    &lt;meta charset="UTF-8" /&gt;
    &lt;meta
        http-equiv="Content-Security-Policy"
        content="default-src 'self'; script-src 'self' https://demo.demo1.org"
    /&gt;
    &lt;title&gt;An example&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    ...
  &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_how_does_this_work">How does this work?</h3>
<div class="paragraph">
<p>Content Security Policy (CSP) can either be enabled in HTML code with a <code>&lt;meta&gt;</code>
tag or in the Javascript code of the Electron application by declaring a <code>onHeadersReceived()</code>
handler. When loading a resource using the <code>file://</code> protocol, the CSP has to be
set using a <code>&lt;meta&gt;</code> tag.</p>
</div>
<div class="paragraph">
<p>CSP should adhere to the  principle of least privilege. This principle states
that an application should be given
the minimum levels of access necessary to complete its tasks. In the context
of CSP, this means restricting the sources from which content can be loaded to
the minimum necessary.</p>
</div>
<div class="paragraph">
<p>Here are some steps to secure your CSP:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Avoid 'unsafe-inline' and 'unsafe-eval': These settings allow inline scripts
and script evaluation, which can open the door for executing malicious scripts.
Instead, use script hashes, nonces, or strict dynamic scripting if scripts must
be used.</p>
</li>
<li>
<p>Specify exact sources: Rather than using a wildcard (*) which allows any domain,
specify the exact domains from which resources can be loaded. This reduces the
risk of loading resources from potentially malicious sources.</p>
</li>
<li>
<p>Use 'self' cautiously: While 'self' is safer than a wildcard, it can still lead
to vulnerabilities if your own site has been compromised or hosts user-uploaded
content. Be sure to validate and sanitize all user content.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Electron Documentation - <a href="https://www.electronjs.org/docs/latest/tutorial/security#7-define-a-content-security-policy">Security - Define a Content Security Policy</a></p>
</li>
<li>
<p>MDN web docs - <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP">Content Security Policy (CSP)</a></p>
</li>
<li>
<p>CSP docs - <a href="https://content-security-policy.com/hash/">Using a hash with CSP</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_standards">Standards</h3>
<div class="ulist">
<ul>
<li>
<p>OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a></p>
</li>
<li>
<p>OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html">Top 10 2017 Category A6 - Security Misconfiguration</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/693">CWE-693 - Protection Mechanism Failure</a></p>
</li>
<li>
<p>STIG Viewer - <a href="https://stigviewer.com/stigs/application_security_and_development/2024-12-06/finding/V-222602">Application Security and Development: V-222602</a> - The application must protect from Cross-Site Scripting (XSS) vulnerabilities.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_external_coding_guidelines">External coding guidelines</h3>
<div class="ulist">
<ul>
<li>
<p>Google - <a href="https://csp-evaluator.withgoogle.com/">CSP Evaluator</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="ulist">
<ul>
<li>
<p>Add a Content Security Policy (CSP).</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="paragraph">
<p>Highlight the <code>&lt;/header&gt;</code> closing tag in web pages.</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
</div>
</div>