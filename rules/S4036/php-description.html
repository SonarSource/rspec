<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When you run an OS command, it is always important to protect yourself against
the risk of accidental or malicious replacement of the executables in the
production system.</p>
</div>
<div class="paragraph">
<p>To do so, it is important to point to the specific executable that should be used.</p>
</div>
<div class="paragraph">
<p>For example, if you call <code>git</code> (without specifying a path), the operating
system will search for the executable in the directories specified in the
<code>PATH</code> environment variable.<br>
An attacker could have added, in a permissive directory covered by <code>PATH</code>
, another executable called <code>git</code>, but with a completely different
behavior, for example exfiltrating data or exploiting a vulnerability in your
own code.</p>
</div>
<div class="paragraph">
<p>However, by calling <code>/usr/bin/git</code> or <code>../git</code> (relative path)
directly, the operating system will always use the intended executable.<br>
Note that you still need to make sure that the executable is not world-writeable
and potentially overwritten. This is not the scope of this rule.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ask_yourself_whether">Ask Yourself Whether</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>The PATH environment variable only contains fixed, trusted directories.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There is a risk if you answered no to this question.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_recommended_secure_coding_practices">Recommended Secure Coding Practices</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you wish to rely on the <code>PATH</code> environment variable to locate the OS
command, make sure that each of its listed directories is fixed, not susceptible
to change, and not writable by unprivileged users.</p>
</div>
<div class="paragraph">
<p>If you determine that these folders cannot be altered, and that you are sure
that the program you intended to use will be used, then you can determine
that these risks are under your control.</p>
</div>
<div class="paragraph">
<p>A good practice you can use is to also hardcode the <code>PATH</code> variable you
want to use, if you can do so in the framework you use.</p>
</div>
<div class="paragraph">
<p>If the previous recommendations cannot be followed due to their complexity
or other requirements, then consider using the absolute
path of the command instead.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ whereis git
git: /usr/bin/git /usr/share/man/man1/git.1.gz
$ ls -l /usr/bin/git
-rwxr-xr-x 1 root root 3376112 Jan 28 10:13 /usr/bin/git</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sensitive_code_example">Sensitive Code Example</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">$output = shell_exec("file"); // Sensitive</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">$output = shell_exec("/usr/bin/file");</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>OWASP - <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/">Top 10 2021 Category A8 - Software and Data Integrity Failures</a></p>
</li>
<li>
<p>OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/426">CWE-426 - Untrusted Search Path</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/427">CWE-427 - Uncontrolled Search Path Element</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Make sure the "PATH" variable only contains fixed, unwriteable directories.</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_9_jan_2018_160042_amaury_levé_wrote">on 9 Jan 2018, 16:00:42 Amaury Levé wrote:</h3>
<div class="paragraph">
<p>The only equivalent is the WinExec function that is obsolete and there only for compatibility with 16bits apps. https://msdn.microsoft.com/en-us/library/windows/desktop/ms687393%28v=vs.85%29.aspx?f=255&amp;MSPPError=-2147217396</p>
</div>
</div>
</div>
</div>