<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hardcoding IP addresses is security-sensitive. It has led in the past to the following vulnerabilities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.cve.org/CVERecord?id=CVE-2006-5901">CVE-2006-5901</a></p>
</li>
<li>
<p><a href="https://www.cve.org/CVERecord?id=CVE-2005-3725">CVE-2005-3725</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Today&#8217;s services have an ever-changing architecture due to their scaling and redundancy needs. It is a mistake to think that a service will always have the same IP address. When it does change, the hardcoded IP will have to be modified too. This will have an impact on the product development, delivery, and deployment:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The developers will have to do a rapid fix every time this happens, instead of having an operation team change a configuration file.</p>
</li>
<li>
<p>It misleads to use the same address in every environment (dev, sys, qa, prod).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Last but not least it has an effect on application security. Attackers might be able to decompile the code and thereby discover a potentially sensitive address. They can perform a Denial of Service attack on the service, try to get access to the system, or try to spoof the IP address to bypass security checks. Such attacks can always be possible, but in the case of a hardcoded IP address solving the issue will take more time, which will increase an attack&#8217;s impact.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ask_yourself_whether">Ask Yourself Whether</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The disclosed IP address is sensitive, e.g.:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Can give information to an attacker about the network topology.</p>
</li>
<li>
<p>It&#8217;s a personal (assigned to an identifiable person) IP address.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There is a risk if you answered yes to any of these questions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_recommended_secure_coding_practices">Recommended Secure Coding Practices</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Don&#8217;t hard-code the IP address in the source code, instead make it configurable with environment variables, configuration files, or a similar approach. Alternatively, if confidentially is not required a domain name can be used since it allows to change the destination quickly without having to rebuild the software.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sensitive_code_example">Sensitive Code Example</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>String ip = '192.168.12.42'; // Sensitive
String clientIp = ApexPages.currentPage().getHeaders().get(‘True-Client-IP’);
Boolean isKnown = ip.equals(clientIp);</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-apex" data-lang="apex">StaticResource sr= [SELECT ip_address FROM StaticResource WHERE Name = 'configuration' LIMIT 1]; // Compliant
String ip_address = sr.body.toString();
String clientIp = ApexPages.currentPage().getHeaders().get(‘True-Client-IP’);
Boolean isKnown = ip_address.equals(clientIp);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exceptions">Exceptions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Loopback addresses 127.0.0.0/8 in CIDR notation (from 127.0.0.0 to 127.255.255.255)</p>
</li>
<li>
<p>Broadcast address 255.255.255.255</p>
</li>
<li>
<p>Non-routable address 0.0.0.0</p>
</li>
<li>
<p>Strings of the form <code>2.5.&lt;number&gt;.&lt;number&gt;</code> as they <a href="https://en.wikipedia.org/wiki/Object_identifier">often match Object Identifiers</a> (OID)</p>
</li>
<li>
<p>Addresses in the ranges 192.0.2.0/24, 198.51.100.0/24, 203.0.113.0/24, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc5737">RFC 5737</a></p>
</li>
<li>
<p>Addresses in the range 2001:db8::/32, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc3849">RFC 3849</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a></p>
</li>
<li>
<p>OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data Exposure</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Make sure using a hardcoded IP address is safe here.</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_9_oct_2013_160040_freddy_mallet_wrote">on 9 Oct 2013, 16:00:40 Freddy Mallet wrote:</h3>
<div class="paragraph">
<p>Is implemented by http://jira.codehaus.org/browse/SONARJAVA-343</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_12_dec_2014_214155_sébastien_gioria_wrote">on 12 Dec 2014, 21:41:55 Sébastien Gioria wrote:</h3>
<div class="paragraph">
<p>Could this be an extension to http://jira.sonarsource.com/browse/RSPEC-2068</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_15_dec_2014_101745_freddy_mallet_wrote">on 15 Dec 2014, 10:17:45 Freddy Mallet wrote:</h3>
<div class="paragraph">
<p>I think it&#8217;s better to have to distinct rules [~sebastien.gioria].</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_2_feb_2015_201243_sébastien_gioria_wrote">on 2 Feb 2015, 20:12:43 Sébastien Gioria wrote:</h3>
<div class="paragraph">
<p>Could be Tag : CERT Secure coding MSC03-J</p>
</div>
<div class="paragraph">
<p>And sometime : OWASP top10 A2 or OWASP Top10 A5</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_3_feb_2015_200237_ann_campbell_wrote">on 3 Feb 2015, 20:02:37 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~sebastien.gioria] I&#8217;ve added the CERT link, but I don&#8217;t quite understand how this ties to the top 10. Can you point me in the right direction, please?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_4_jun_2018_102010_patrik_lundin_wrote">on 4 Jun 2018, 10:20:10 Patrik Lundin wrote:</h3>
<div class="paragraph">
<p>I had some code flagged because I use "127.0.0.1" as the default value when no other address had been supplied in a configuration file. Does it make sense to have this check treat the use of hard coded loopback addresses like 127.0.0.1 or ::1 a special case? From a information disclosure perspective I don&#8217;t think those addresses provide much information to anyone, and the ability to be able to use them as a sane default for networked services without a config file makes sense to me.</p>
</div>
<div class="paragraph">
<p>Here is how I think this idea stands up to the effects this check hopes to have as defined in this ticket:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a recompile is required if the address changes
This assumes that the value is not a default that can be overriden by a config file. Requiring a user to write a configuration file when listening on loopback for networked processes seems cumbersome to me (I would assume that a "default" config file example would use a loopback address such as 127.0.0.1 anyway).</p>
</li>
<li>
<p>it forces the same address to be used in every environment (dev, sys, qa, prod)
See above.</p>
</li>
<li>
<p>it places the responsibility of setting the value to use in production on the shoulders of the developer
See above.</p>
</li>
<li>
<p>it allows attackers to decompile the code and thereby discover a potentially sensitive address
I do not think loopback addresses should be counted as sensitive information since there is no way to utilize them unless you already have local access to a machine of interest. The linked CERT page even uses the hostname "localhost" in the compliant solution regarding hard coded names and passwords (and the example regarding hard coded IP addresses uses a non-loopback address).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>With this said I think using something like https://docs.oracle.com/javase/10/docs/api/java/net/InetAddress.html#isLoopbackAddress() and skipping the warning if it comes out true is reasonable.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_7_jun_2018_164311_alexandre_gigleux_wrote">on 7 Jun 2018, 16:43:11 Alexandre Gigleux wrote:</h3>
<div class="paragraph">
<p>Rule removed from "Sonar Way" as this is more a Security Hotspot than a real Vulnerability.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_20_jul_2018_092205_tibor_blenessy_wrote">on 20 Jul 2018, 09:22:05 Tibor Blenessy wrote:</h3>
<div class="paragraph">
<p>I removed the compliant section because this is now security hotspot</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_16_aug_2018_150907_ann_campbell_wrote">on 16 Aug 2018, 15:09:07 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~nicolas.harraudeau] it would be nice to give a little context/background for the Object Identifiers link, since the linked page offers none itself.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_16_aug_2018_161727_nicolas_harraudeau_wrote">on 16 Aug 2018, 16:17:27 Nicolas Harraudeau wrote:</h3>
<div class="paragraph">
<p>Thanks [~ann.campbell.2]. I didn&#8217;t see that there was no link to the parent page. I updated the link and it now points to the OID description.</p>
</div>
</div>
</div>
</div>