<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This rule raises an issue when ActiveSupport duration methods (like <code>days.from_now</code>, <code>hours.from_now</code>) are mixed with second-based arithmetic operations.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Mixing ActiveSupport&#8217;s time duration methods with second-based arithmetic can produce incorrect results during daylight saving time (DST) transitions.</p>
</div>
<div class="paragraph">
<p>ActiveSupport duration methods like <code>2.days.from_now</code> automatically compensate for DST changes. When clocks "spring forward" or "fall back", these methods ensure that "2 days from now" means the same time of day two calendar days later, regardless of whether those days contain 23, 24, or 25 hours.</p>
</div>
<div class="paragraph">
<p>However, second-based arithmetic assumes every day has exactly 86400 seconds (24 × 60 × 60). During DST transitions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When clocks spring forward (lose an hour), a day has only 82800 seconds (23 hours)</p>
</li>
<li>
<p>When clocks fall back (gain an hour), a day has 90000 seconds (25 hours)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When you mix these approaches, the ActiveSupport method accounts for DST while your arithmetic doesn&#8217;t, creating a mismatch. For example, <code>2.days.from_now</code> might represent a time that&#8217;s 25 hours away, but dividing the time difference by 86400 will give you 1.04 days instead of 2.</p>
</div>
<div class="paragraph">
<p>This inconsistency becomes particularly problematic in applications that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Calculate trial periods or subscription durations</p>
</li>
<li>
<p>Display "days remaining" counters</p>
</li>
<li>
<p>Schedule recurring tasks</p>
</li>
<li>
<p>Generate time-based reports</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>Incorrect time calculations can lead to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Users losing access to services earlier or later than expected</p>
</li>
<li>
<p>Billing discrepancies in subscription-based applications</p>
</li>
<li>
<p>Scheduled tasks running at wrong times</p>
</li>
<li>
<p>Confusing user interfaces showing incorrect "days remaining" values</p>
</li>
<li>
<p>Data integrity issues in time-sensitive business logic</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Use Date arithmetic for day-based calculations to avoid DST complications entirely.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby"># Mixing ActiveSupport duration with second arithmetic
user.trial_expires = 14.days.from_now
days_remaining = (user.trial_expires - Time.now) / 86400 # Noncompliant</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby"># Use Date arithmetic for day calculations
user.trial_expires = 14.days.from_now
days_remaining = (user.trial_expires.to_date - Date.current).to_i</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>ActiveSupport Time Extensions - <a href="https://guides.rubyonrails.org/active_support_core_extensions.html#time">Official Rails guide on ActiveSupport time and date extensions</a></p>
</li>
<li>
<p>Ruby Time and Date Classes - <a href="https://ruby-doc.org/core/Time.html">Ruby documentation for Time class and time arithmetic</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_standards">Standards</h3>
<div class="ulist">
<ul>
<li>
<p>ISO 8601 - <a href="https://en.wikipedia.org/wiki/ISO_8601">International standard for date and time representation</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>