<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This rule raises an issue when JSON data is deserialized and used without validating its structure or required fields.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When working with JSON data in Apex, especially from external sources or user input, the structure and content cannot be guaranteed. Directly accessing fields from deserialized JSON without validation can lead to several problems.</p>
</div>
<div class="paragraph">
<p>First, runtime exceptions occur when expected fields are missing or have unexpected types. For example, attempting to cast a null value or wrong data type will throw a <code>TypeException</code> or <code>NullPointerException</code>.</p>
</div>
<div class="paragraph">
<p>Second, security vulnerabilities can arise when malicious or malformed JSON is processed without validation. Attackers might exploit missing validation to cause application errors or inject unexpected data.</p>
</div>
<div class="paragraph">
<p>Third, data integrity issues emerge when business logic operates on incomplete or invalid data, leading to incorrect calculations or corrupted application state.</p>
</div>
<div class="paragraph">
<p>Proper JSON validation ensures that the data structure matches expectations before processing, making applications more robust and secure.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>Without proper JSON validation, applications face multiple risks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Runtime failures</strong>: Unexpected <code>TypeException</code> or <code>NullPointerException</code> errors that crash functionality</p>
</li>
<li>
<p><strong>Security vulnerabilities</strong>: Potential for injection attacks or data manipulation through malformed JSON</p>
</li>
<li>
<p><strong>Data corruption</strong>: Business logic operating on invalid data can produce incorrect results</p>
</li>
<li>
<p><strong>Poor user experience</strong>: Cryptic error messages instead of meaningful validation feedback</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Always validate JSON structure and required fields before processing. Check for null values, required keys, and expected data types.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-apex" data-lang="apex">public class TaxCalculator {
    public static void processIncome(String jsonInput) {
        Map&lt;String, Object&gt; data = (Map&lt;String, Object&gt;) JSON.deserializeUntyped(jsonInput);
        Decimal income = (Decimal) data.get('totalIncome'); // Noncompliant
        calculateTax(income);
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-apex" data-lang="apex">public class TaxCalculator {
    public static void processIncome(String jsonInput) {
        Map&lt;String, Object&gt; data = (Map&lt;String, Object&gt;) JSON.deserializeUntyped(jsonInput);
        if (data == null || !data.containsKey('totalIncome')) {
            throw new IllegalArgumentException('Invalid input: totalIncome is required');
        }
        Object incomeObj = data.get('totalIncome');
        if (!(incomeObj instanceof Decimal)) {
            throw new IllegalArgumentException('Invalid input: totalIncome must be a number');
        }
        Decimal income = (Decimal) incomeObj;
        calculateTax(income);
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Apex JSON Support - <a href="https://developer.salesforce.com/docs/atlas.en-us.apexref.meta/apexref/apex_class_System_Json.htm">Official Salesforce documentation for JSON handling in Apex</a></p>
</li>
<li>
<p>Apex Exception Handling - <a href="https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/apex_exception_definition.htm">Guide to handling exceptions in Apex, including validation scenarios</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_standards">Standards</h3>
<div class="ulist">
<ul>
<li>
<p>CWE-20: Improper Input Validation - <a href="https://cwe.mitre.org/data/definitions/20.html">Covers the security implications of insufficient input validation</a></p>
</li>
<li>
<p>OWASP Top 10:2021-A03-Injection - <a href="https://owasp.org/Top10/A03_2021-Injection/">Addresses injection vulnerabilities that can result from improper data validation</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>