<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This rule raises an issue when environment variables are accessed directly using <code>ENV["KEY"]</code> without validation or default values, particularly in configuration contexts.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Environment variables are external dependencies that may not be set in all environments. When you access an environment variable using <code>ENV["KEY"]</code>, Ruby returns <code>nil</code> if the variable is not defined.</p>
</div>
<div class="paragraph">
<p>This can lead to several problems:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Application startup failures</strong>: If critical configuration values are missing, your application may fail to start or behave unexpectedly.</p>
</li>
<li>
<p><strong>Runtime errors</strong>: Methods that expect strings or other specific types may crash when receiving <code>nil</code> values.</p>
</li>
<li>
<p><strong>Silent failures</strong>: Some APIs accept <code>nil</code> values but behave differently, leading to hard-to-debug issues.</p>
</li>
<li>
<p><strong>Security vulnerabilities</strong>: Missing security-related configuration (like API keys or secrets) might cause authentication to fail silently or use insecure defaults.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is especially problematic in production environments where environment variables are the primary way to configure applications securely. A missing environment variable can cause immediate outages or security issues.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>Missing environment variables can cause application startup failures, runtime crashes, or security vulnerabilities. In production, this can lead to service outages or compromised authentication systems.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Use the <code>||</code> operator to provide default values for non-critical environment variables.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby"># Direct access without validation
api_timeout = ENV["API_TIMEOUT"] # Noncompliant
SomeService.configure(timeout: api_timeout)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby"># Provide a sensible default value
api_timeout = ENV["API_TIMEOUT"] || "30"
SomeService.configure(timeout: api_timeout.to_i)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Ruby ENV Documentation - <a href="https://ruby-doc.org/core/ENV.html">Official Ruby documentation for the ENV class and its methods</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_standards">Standards</h3>
<div class="ulist">
<ul>
<li>
<p>CWE-665: Improper Initialization - <a href="https://cwe.mitre.org/data/definitions/665.html">Weakness related to improper initialization of resources</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>