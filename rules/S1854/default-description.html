<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Unused assignments should be removed.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Computing or retrieving a value only to then immediately overwrite it or throw it away indicates a serious logic error in the code.</p>
</div>
<div class="paragraph">
<p>Assigning a value to a local variable that is not read by any subsequent instruction is called a <em>dead store</em>.
The following code snippet depicts a few dead stores.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">int foo() {
  int x = 0; // Noncompliant: dead store, next line overwrites x
  x = 100; // Noncompliant: dead store, next line overwrites x
  x = 200;
  int y = 0;
  y += 9001; // Noncompliant: dead store, y is never used
  int z = 300; // Noncompliant: dead store, next line overwrites z
  z = 400;
  return x + z * 2;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Even if the unnecessary operations do not do any harm in terms of the program&#8217;s correctness, they are&#8212;&#8203;at best&#8212;&#8203;a waste of computing resources.
In most cases, these operations have their intended use but it is not expressed correctly in the code.
Therefore, unused values and superfluous code should be removed to prevent logic errors.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>Not only do unused values and superfluous code make the program unnecessary complex, but also indicate significant logic errors.
And even in the absence of logic errors, they waste computing resources in case the compiler is not able to optimize them away.</p>
</div>
<div class="paragraph">
<p>Unused values typically showcase a discrepancy between what a developer intended and what is specified in the code and should be removed to uncover and eventually prevent logic errors.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Remove unused values and superfluous code.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">int foo(int y) {
  int x = 0;
  x = 100; // Noncompliant: dead store
  x = 200;
  return x + y;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">int foo(int y) {
  int x = 200; // Compliant: no unnecessary assignment
  return x + y;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_noncompliant_code_example_2">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">int bar();
int buz();

int foo(bool b) {
  int x = 0;
  if (b) {
    x = bar();
    return x;
  }
  if (x != 0) {
    int y = buz();
    y += 9001; // Noncompliant: dead store
  }
  return x;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution_2">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">int bar();
int buz();

int foo(bool b) {
  int x = 0;
  if (b) {
    x = bar();
    return x;
  }
  // Compliant: no more dead stores and superfluous code
  // Assuming call to buz() had no important side effects
  return x;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_pitfalls">Pitfalls</h3>
<div class="paragraph">
<p>When removing unused values and superfluous code, make sure that the right-hand side of a given assignment has no side effects.</p>
</div>
<div class="paragraph">
<p>While it is safe to remove the call to <code>square</code> in the following code since it has no side effects, removing the call to <code>fwrite</code> changes the program&#8217;s behavior.
Still, values that are never read such as <code>n</code> indicate code smells that should be mitigated.
In this code example, the return value of <code>fwrite</code> should be checked and any potential error should be handled appropriately.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">#include &lt;stdio.h&gt;
#include &lt;string.h&gt;

int square(int n) {
  return n * n;
}

int foo(int i) {
  int sq = square(i); // Noncompliant: dead store, assignment can be removed
  const char* const str = "Hello, World!\n";
  // Although `n` is never read, the call to `fwrite` cannot be removed due to side effects
  size_t n = fwrite(str, sizeof(char), strlen(str), stdout); // Noncompliant: `n` is never read
  return i + 9001;
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_going_the_extra_mile">Going the extra mile</h3>
<div class="paragraph">
<p>In C&#43;&#43;17, the <code>nodiscard</code> attribute has been introduced which can be used to annotate functions, enumerations and classes.</p>
</div>
<div class="paragraph">
<p>The attribute serves as a hint to the compiler and to other developers that a function&#8217;s return value should not be ignored.
A function that is marked <code>nodiscard</code> whose return value is ignored encourages the compiler to issue a warning.
Example usages of the <code>nodiscard</code> attribute are shown in the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">[[nodiscard]] int foo() { return 100; }
int bar() { return 200; }
[[nodiscard("An explanation on why not to discard the return value")]] int buz() { return 300; }

enum class [[nodiscard]] important_error_info { OK, WARN, CRITICAL };
important_error_info compute() {
  // More code ...
  // In case of a critical error, return corresponding error info:
  return important_error_info::CRITICAL;
}

void caller() {
  foo(); // compiler warns on discarding a nodiscard value
  bar(); // compiler will issue no warning
  buz(); // compiler warns on discarding a nodiscard value
  compute(); // compiler warns on discarding a nodiscard value
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In case, the return value of a function marked as <code>nodiscard</code> should be (exceptionally) ignored, a cast to <code>void</code> can be used to silence the compiler warning as shown in the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">[[nodiscard]] int foo() { return 100; }

void caller() {
  foo(); // compiler warns on discarding a nodiscard value
  (void)foo(); // compiler will issue no warning
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_standards">Standards</h3>
<div class="ulist">
<ul>
<li>
<p>CERT - <a href="https://wiki.sei.cmu.edu/confluence/x/39UxBQ">MSC13-C. Detect and remove unused values</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/563">CWE-563 - Assignment to Variable without Use ('Unused Variable')</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_related_rules">Related rules</h3>
<div class="ulist">
<ul>
<li>
<p><a data-rspec-id="S1763" class="rspec-auto-link">S1763</a> - All code should be reachable</p>
</li>
<li>
<p><a data-rspec-id="S2583" class="rspec-auto-link">S2583</a> - Conditionally executed code should be reachable</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Remove this assignment to local variable “xxx”; the value is never used.</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_deprecates_s2128">deprecates: <a data-rspec-id="S2128" class="rspec-auto-link">S2128</a></h3>

</div>
<div class="sect2">
<h3 id="_is_duplicated_by_s1981">is duplicated by: <a data-rspec-id="S1981" class="rspec-auto-link">S1981</a></h3>

</div>
<div class="sect2">
<h3 id="_is_related_to_s898">is related to: <a data-rspec-id="S898" class="rspec-auto-link">S898</a></h3>

</div>
<div class="sect2">
<h3 id="_is_related_to_s1763">is related to: <a data-rspec-id="S1763" class="rspec-auto-link">S1763</a></h3>

</div>
<div class="sect2">
<h3 id="_is_related_to_s4487">is related to: <a data-rspec-id="S4487" class="rspec-auto-link">S4487</a></h3>

</div>
<div class="sect2">
<h3 id="_relates_to_s1481">relates to: <a data-rspec-id="S1481" class="rspec-auto-link">S1481</a></h3>

</div>
<div class="sect2">
<h3 id="_is_related_to_s901">is related to: <a data-rspec-id="S901" class="rspec-auto-link">S901</a></h3>

</div>
</div>
</div>