<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default, browsers enforce the Same-Origin Policy (SOP) and restrict how
one service can interact with another. From the perspective of the browser,
a service is defined by its "origin", a tuple <code>(scheme, domain, port)</code>.<br>
Effectively, it blocks attempts to retrieve the data of a <code>Server A</code> from
a <code>Server B</code> if its origin is not the exact same tuple.</p>
</div>
<div class="paragraph">
<p>Cross-Origin Resource Sharing (CORS) is a mechanism that <code>Server A</code> can use to
relax the SOP and allow <code>Server B</code> of a different origin, to access data of
<code>Server A</code>.<br>
This trust is set setup via the <code>Access-Control-Allow-Origin</code> header, and can be
configured alongside other headers, such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Access-Control-Allow-Methods</p>
</li>
<li>
<p>Access-Control-Allow-Headers</p>
</li>
<li>
<p>Access-Control-Allow-Credentials</p>
</li>
<li>
<p>Access-Control-Max-Age</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>CORS injection occurs when an application unsafely retrieves data from an
incoming request and reflects it into the Cross-Origin Resource Sharing (CORS)
headers of the response without sanitization.</p>
</div>
<div class="paragraph">
<p>Enabling third-party manipulation of the <code>Access-Control-Allow-Origin</code> header
exposes the application to a varity of different attacks, namely XSS or TLS
hijacking.<br>
The situation is worsened if the <code>Access-Control-Allow-Credentials</code> is set to
<code>true</code> or injectable.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Generally, do not use third-party data to set up CORS boundaries. Instead,
create a strict allow-list of origins.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const express = require('express');
const app = express();

app.use((req, res, next) =&gt; {
  const origin = req.headers.origin;

  if (origin) {
    res.setHeader('Access-Control-Allow-Origin', origin); // Noncompliant
  }

  next();
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const express = require('express');
const app = express();

const ACAO = "https://example.com https://another.example.com";

app.use((req, res, next) =&gt; {
  res.setHeader('Access-Control-Allow-Origin', ACAO);

  next();
});</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_standards">Standards</h3>
<div class="ulist">
<ul>
<li>
<p>OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a></p>
</li>
<li>
<p>OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and Authentication Failures</a></p>
</li>
<li>
<p>OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security Misconfiguration</a></p>
</li>
<li>
<p>Mozilla - <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">Cross-Origin Resource Sharing</a></p>
</li>
<li>
<p>Mozilla - <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy">Same-Origin Policy</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/346">CWE-346 - Origin Validation Error</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/942">CWE-942 - Overly Permissive Cross-domain Whitelist</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>