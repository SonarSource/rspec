include::../description.adoc[]

== Noncompliant Code Example

`escapeshellcmd` doesn't prevent additional arguments to be injected:

----
exec(escapeshellcmd("/usr/bin/cat ".$_GET["arg"])); // Noncompliant
----

`escapeshellcmd` cancels any prior sanitization with `escapeshellarg`:

----
exec(escapeshellcmd("/usr/bin/cat ".escapeshellarg($_GET["arg"])); // Noncompliant
----

fifth argument of the `mail` function accepts arguments that are added to the command line:

----
mail($to, $subject, $message, $params, $_GET["arg"]); // Noncompliant

// by default php sanitizes the fifth argument with escapeshellcmd thus escapeshellarg has no effect:
mail($to, $subject, $message, $params, escapeshellarg($_GET["arg"])); // Noncompliant
----

== Compliant Solution

`escapeshellarg` should be used to sanitize a specific argument:

----
exec("/usr/bin/cat ".escapeshellarg($_GET["arg"]));
----

fifth argument of the `mail` function can be secured with the use of an allowlist:

----
$arg = $_GET["arg"];
if($arg === "something1" || $arg === "something2") {
  mail($to, $subject, $message, $params, $arg);
}
----

include::./see.adoc[]