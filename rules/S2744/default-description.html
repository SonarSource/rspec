<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Once you modify a closure, any use of it could provide unexpected results.</p>
</div>
<div class="sect2">
<h3 id="_noncompliant_code_example">Noncompliant code example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">var x = 0;
Func&lt;int&gt; f1 = () =&gt; x;  // Noncompliant
x = 1;
Console.WriteLine(f1());

var input = new[] { 1, 2, 3 };
var fs = new List&lt;Func&lt;int&gt;&gt;();
for (var i = 0; i &lt; input.Length; i++) {
  Func&lt;int&gt; f = () =&gt; input[i];  // Noncompliant
  fs.Add(f);
}
Console.WriteLine(fs[0]()); //Access to modified closure yields Exception</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_compliant_solution">Compliant solution</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">var x = 0;
var xx = x;
Func&lt;int&gt; f = () =&gt; xx;
x = 1;
Console.WriteLine(f());

var input = new[] { 1, 2, 3 };
var fs = new List&lt;Func&lt;int&gt;&gt;();
for (var i = 0; i &lt; input.Length; i++) {
  var ii = i;
  Func&lt;int&gt; f = () =&gt; input[ii];
  fs.Add(f);
}
Console.WriteLine(fs[0]());</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">var input = new[] { 1, 2, 3 };
var fs = input.Select(t =&gt; (Func&lt;int&gt;) (() =&gt; t)).ToList();
Console.WriteLine(fs[0]());</code></pre>
</div>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Remove the access to the modified closure.</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_20_mar_2015_160806_ann_campbell_wrote">on 20 Mar 2015, 16:08:06 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~tamas.vajk] is the problem really in accessing the modified closure, or is the problem that the closure was modified at all?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_23_mar_2015_072858_tamas_vajk_wrote">on 23 Mar 2015, 07:28:58 Tamas Vajk wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] the problem is that the closure was modified, and then it was used.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_8_jun_2015_114437_tamas_vajk_wrote">on 8 Jun 2015, 11:44:37 Tamas Vajk wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] this RSPEC doesn&#8217;t seem to be finished, it is missing a lot of metadata (sqale, severity, &#8230;&#8203;)</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_8_jun_2015_122722_ann_campbell_wrote">on 8 Jun 2015, 12:27:22 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>Sorry about that [~tamas.vajk]. Take a look now.</p>
</div>
<div class="paragraph">
<p>Also, I&#8217;ve set this rule to Blocker. Do you think that&#8217;s too severe?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_9_jun_2015_065316_tamas_vajk_wrote">on 9 Jun 2015, 06:53:16 Tamas Vajk wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] Thanks, it looks good. The blocker severity seems okay, the rule detects bugs.</p>
</div>
</div>
</div>
</div>