<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It may seem tidy to add your new declarations to the <code>std</code> or <code>posix</code> namespaces, but doing so results in undefined behavior. The C&#43;&#43;14 Standard, [namespace.std] (ISO/IEC 14882-2014 §17.6.4.2.1), paragraphs 1 and 2 states:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The behavior of a C&#43;&#43; program is undefined if it adds declarations or definitions to namespace std or to a namespace within namespace std unless otherwise specified. A program may add a template specialization for any standard library template to namespace std only if the declaration depends on a user-defined type and the specialization meets the standard library requirements for the original template and is not explicitly prohibited.</p>
</li>
<li>
<p>The behavior of a C&#43;&#43; program is undefined if it declares:</p>
<div class="ulist">
<ul>
<li>
<p>an explicit specialization of any member function of a standard library class template, or</p>
</li>
<li>
<p>an explicit specialization of any member function template of a standard library class or class template, or</p>
</li>
<li>
<p>an explicit or partial specialization of any member class template of a standard library class or class template.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>In addition to restricting extensions to the <code>std</code> namespace, the C&#43;&#43;14 Standard goes on in §17.6.4.2.2 to say:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The behavior of a C&#43;&#43; program is undefined if it adds declarations or definitions to namespace posix or to a namespace within namespace posix unless otherwise specified. The namespace posix is reserved for use by ISO/IEC 9945 and other POSIX standards.</p>
</li>
</ol>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>However, the standard allows specializing standard class templates in namespace <code>std</code>. In that case, the specialization must respect the requirement of the original template and has to be for a "program-defined type" (a type that is specific to the program, by opposition to a type from the standard).</p>
</div>
<div class="paragraph">
<p>You may therefore think that it&#8217;s legitimate to reopen <code>std</code> to define a version of extension points (<code>std::swap</code>, <code>std::hash</code>&#8230;&#8203;) that work with your types, but it&#8217;s not necessary:  If you call these extension points according to the correct pattern, the user-defined version will be found too.</p>
</div>
<div class="paragraph">
<p>The only extension points for which the specialization is the recommended approach are <code>std::out_ptr</code> and <code>std::inout_ptr</code>.</p>
</div>
<div class="paragraph">
<p>This rule raises an issue for any modification of the standard <code>std</code> and <code>posix</code> namespaces that is not a template specialization.</p>
</div>
<div class="sect2">
<h3 id="_noncompliant_code_example">Noncompliant code example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">namespace MyNamespace {
  class MyType {/*...*/};
}
namespace std { // Noncompliant
  int x;
  void swap(MyNamespace::MyType &amp;m1, MyNamespace::MyType &amp;m2);
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_compliant_solution">Compliant solution</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">namespace expanded_std {
  int x;
}
namespace MyNamespace {
  class MyType {/*...*/};
  void swap(MyType &amp;m1, MyType &amp;m2);
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://wiki.sei.cmu.edu/confluence/x/Xnw-BQ">CERT, DCL58-CPP.</a> - Do not modify the standard namespaces</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Choose a different namespace for this declaration.</p>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="paragraph">
<p>offending namespace</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_is_related_to_s5963">is related to: <a data-rspec-id="S5963" class="rspec-auto-link">S5963</a></h3>

</div>
<div class="sect2">
<h3 id="_on_19_feb_2016_225607_evgeny_mandrikov_wrote">on 19 Feb 2016, 22:56:07 Evgeny Mandrikov wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] I&#8217;m wondering why this is not marked as implemented - see https://dory.sonarsource.com/coding_rules#rule_key=cpp%3AS3470 ?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_22_feb_2016_163134_ann_campbell_wrote">on 22 Feb 2016, 16:31:34 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>Because that check runs against nemo [~evgeny.mandrikov]</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_22_feb_2016_170748_evgeny_mandrikov_wrote">on 22 Feb 2016, 17:07:48 Evgeny Mandrikov wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] sorry for the wrong link, but we deploy on Nemo at the same time as on Dory - https://nemo.sonarqube.org/coding_rules#rule_key=cpp%3AS3470</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_22_feb_2016_173030_ann_campbell_wrote">on 22 Feb 2016, 17:30:30 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>Okay [~evgeny.mandrikov], this one will have the same explanation as the other one. And the same fix.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_27_aug_2020_145138_ann_campbell_wrote">on 27 Aug 2020, 14:51:38 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>Picking on you [~amelie.renard] since you were the last one to modify this. Properly formatted, this wouldn&#8217;t have additional description <em>after</em> the code samples. All that should come before the Noncompliant example</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_27_aug_2020_145545_amélie_renard_wrote">on 27 Aug 2020, 14:55:45 Amélie Renard wrote:</h3>
<div class="paragraph">
<p>Thanks [~ann.campbell.2], I&#8217;ll change that</p>
</div>
</div>
</div>
</div>