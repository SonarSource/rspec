Size argument that describes the size of the destination should be used to prevent buffer overflows.

== Why is this an issue?

Size argument of ``++strncat++``, ``++strlcat++`` and ``++strlcpy++`` should define the size of the destination to prevent buffer overflow.

Moreover, ``++strncat++`` always adds a terminating null character at the end of the appended characters so the size argument should be smaller than the size of the destination to let enough space for it.

[source,cpp]
----
#include <stdio.h>
#include <string.h>

void foo(const char *src) {
  char dst[10] = {0};
  strlcpy(dst, src, strlen(src)); // Noncompliant: size of destination should be used.
  printf("%s", dst);
}
----


== What is the potential impact?

== How to fix it


=== Code examples

=== Noncompliant code example

[source,cpp,diff-id=1,diff-type=noncompliant]
----
#include <stdio.h>
#include <string.h>

void foo(const char *src) {
  char dst[10] = {0};
  strlcpy(dst, src, strlen(src)); // Noncompliant: size of `dst` should be used.
  printf("%s", dst);
}
----

=== Compliant solution

[source,cpp,diff-id=1,diff-type=compliant]
----
#include <stdio.h>
#include <string.h>

void foo(const char *src) {
  char dst[10] = {0};
  strlcpy(dst, src, sizeof(dst) - 1); // Compliant: using `dst`'s size avoid prevents buffer overflows.
  printf("%s", dst);
}
----

=== Noncompliant code example

[source,cpp,diff-id=2,diff-type=noncompliant]
----
#include <stdio.h>
#include <string.h>

void bar(const char *src) {
  char dst[256] = "Hello, ";
  strncat(dst, src, sizeof(src)); // Noncompliant: incorrect size used. 
  printf("%s\n", dst);
}
----

=== Compliant solution

[source,cpp,diff-id=2,diff-type=compliant]
----
#include <stdio.h>
#include <string.h>

void bar(const char *src) {
  char dst[256] = "Hello, ";
  strncat(dst, src, sizeof(dst) - strlen(dst) - 1); // Compliant: uses only `dst` to compute size.
  printf("%s\n", dst);
}
----

== Resources

===

* TODO



ifdef::env-github,rspecator-view[]

'''
== Implementation Specification
(visible only on this page)

=== Message

the value of the size argument to "XXX" is wrong


endif::env-github,rspecator-view[]
