<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Size argument should be based on the size of the destination buffer to to prevent buffer overflows.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The string manipulation functions <code>strncat</code>, <code>strlcat</code> and <code>strlcpy</code> require a size argument that describes how many bytes from the source buffer are used at most.
In many situations the size of the source buffer is unknown, which is why the size argument for these functions should be based on the size of the destination buffer.
This helps to prevent buffer overflows.</p>
</div>
<div class="paragraph">
<p>Note that <code>strncat</code> always adds a terminating null character at the end of the appended characters; therefore, the size argument should be smaller than the size of the destination to leave enough space for the null character.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">#include &lt;stdio.h&gt;
#include &lt;string.h&gt;

void foo(const char *src) {
  char dst[10] = {0};
  strlcpy(dst, src, sizeof(src)); // Noncompliant: size of destination should be used.
  printf("%s", dst);
}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>By using the source buffer&#8217;s size to determine the size argument for <code>strncat</code>, <code>strlcat</code> or <code>strlcpy</code>, the program becomes vulnerable to buffer overflows which pose a security risk.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To prevent potential buffer overflows, use the size of the destination buffer to determine the correct size argument for <code>strncat</code>, <code>strlcat</code> and <code>strlcpy</code>.</p>
</div>
<div class="sect2">
<h3 id="_going_the_extra_mile">Going the extra mile</h3>
<div class="paragraph">
<p>Buffer overflows occur when a program writes data beyond the boundaries of a buffer and can lead to memory corruption and potential security vulnerabilities.
Attackers can use buffer overflows to overwrite critical data, execute arbitrary code, or gain unauthorized access to a system.
To mitigate this risk, developers must carefully manage buffer sizes (, use secure coding practices, and employ techniques like input validation and bounds checking).</p>
</div>
<div class="paragraph">
<p>In C&#43;&#43;, manual string, i.e., buffer manipulations are considered a code smell.
Instead, the <code>std::string</code> type should be used to manage buffers, which guarantees safe buffer manipulations.</p>
</div>
<div class="paragraph">
<p>Instead of manually concatenating two buffers using <code>strncat</code>, for instance, <code>std::string</code> allows this operation to be performed in a much more convenient manner as shown in the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">#include &lt;iostream&gt;
#include &lt;string&gt;

void buz(std::string const &amp;s) {
  std::string t = "Hello, " + s;
  std::cout &lt;&lt; t &lt;&lt; '\n';
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition, the <code>std::format</code> function allows one to format strings according to a user-specified format and returns the result as a string as shown in what follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">#include &lt;format&gt;
#include &lt;iostream&gt;
#include &lt;string&gt;

void tar(std::string const &amp;s) {
  std::string t = std::format("Hello, World! Greetings {}\n", s);
  std::cout &lt;&lt; t &lt;&lt; '\n';
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">#include &lt;stdio.h&gt;
#include &lt;string.h&gt;

void foo(const char *src) {
  char dst[10] = {0};
  strlcpy(dst, src, sizeof(src)); // Noncompliant: size of `dst` should be used.
  printf("%s", dst);
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">#include &lt;stdio.h&gt;
#include &lt;string.h&gt;

void foo(const char *src) {
  char dst[10] = {0};
  // `strlcpy` copies up to size - 1 characters from the NUL-terminated string
  // src to dst, NUL-terminating the result.
  strlcpy(dst, src, sizeof(dst)); // Compliant: using `dst`'s size avoid prevents buffer overflows.
  printf("%s", dst);
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_noncompliant_code_example_2">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">#include &lt;stdio.h&gt;
#include &lt;string.h&gt;

void bar(const char *src) {
  char dst[256] = "Hello, ";
  strncat(dst, src, sizeof(src)); // Noncompliant: incorrect size used.
  printf("%s\n", dst);
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution_2">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">#include &lt;stdio.h&gt;
#include &lt;string.h&gt;

void bar(const char *src) {
  char dst[256] = "Hello, ";
  // `strncat` always adds a terminating null character at the end of the appended
  // characters, which is the reason for the `- 1`.
  strncat(dst, src, sizeof(dst) - strlen(dst) - 1); // Compliant: uses only `dst` to compute size.
  printf("%s\n", dst);
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_conference_presentations">Conference presentations</h3>
<div class="ulist">
<ul>
<li>
<p>CppCon 2018 - <a href="https://www.youtube.com/watch?v=0S0QgQd75Sw&amp;ab_channel=CppCon">Software Vulnerabilities in C and C&#43;&#43;</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_standards">Standards</h3>
<div class="ulist">
<ul>
<li>
<p>CERT - <a href="https://wiki.sei.cmu.edu/confluence/display/c/STR31-C.+Guarantee+that+storage+for+strings+has+sufficient+space+for+character+data+and+the+null+terminator">STR31-C. Guarantee that storage for strings has sufficient space for character data and the null terminator</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/121">CWE-121 Stack-based Buffer Overflow</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/122">CWE-122 Heap-based Buffer Overflow</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/676">CWE-676 Use of Potentially Dangerous Function</a></p>
</li>
<li>
<p>STIG Viewer - <a href="https://stigviewer.com/stigs/application_security_and_development/2024-12-06/finding/V-222612">Application Security and Development: V-222612</a> - The application must not be vulnerable to overflow attacks.</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>the value of the size argument to "XXX" is wrong</p>
</div>
</div>
</div>
</div>