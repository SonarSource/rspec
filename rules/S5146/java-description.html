<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Open redirection occurs when an application uses user-controllable data to redirect users to a URL.</p>
</div>
<div class="paragraph">
<p>An attacker with malicious intent could manipulate a user to browse into a specially crafted URL, such as <code>https://trusted.example.com?url=evil.example.com</code>, to redirect the victim to his evil domain.</p>
</div>
<div class="paragraph">
<p>Tricking users into sending the malicious HTTP request is usually the main task of exploiting an open redirection. Often, it requires an attacker to build a credible pretext to prevent suspicions from the victim.<br></p>
</div>
<div class="paragraph">
<p>Attackers commonly use open redirect exploits in mass phishing campaigns.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>If an attacker tricks a user into opening a link of his choice, the user is
redirected to a domain controlled by the attacker.</p>
</div>
<div class="paragraph">
<p>From then on, the attacker can perform various malicious actions, some more
impactful than others.</p>
</div>
<div class="paragraph">
<p>Below are some real-world scenarios that illustrate some impacts of an attacker
exploiting the vulnerability.</p>
</div>
<div class="sect3">
<h4 id="_domain_mirroring">Domain Mirroring</h4>
<div class="paragraph">
<p>A malicious link redirects to an attacker&#8217;s controlled website mirroring the
interface of a web application trusted by the user. Due to the similarity in
the application appearance and the apparently trustable clicked hyperlink, the
user struggles to identify that they are browsing on a malicious domain.<br></p>
</div>
<div class="paragraph">
<p>Depending on the attacker&#8217;s purpose, the malicious website can leak
credentials, bypass Multi-Factor Authentication (MFA), and reach any
authenticated data or action.</p>
</div>
</div>
<div class="sect3">
<h4 id="_malware_distribution">Malware Distribution</h4>
<div class="paragraph">
<p>A malicious link redirects to an attacker&#8217;s controlled website that serves
malware. On the same basis as the domain mirroring exploitation, the attacker
develops a spearphishing or phishing campaign with a carefully crafted pretext
that would result in the download and potential execution of a hosted malicious
file.<br>
The worst-case scenario could result in complete system compromise.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it_in_a_servlet">How to fix it in a Servlet</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="paragraph">
<p>The following noncompliant code example is vulnerable to open redirection as it constructs a URL with user-controllable data. This URL is then used to redirect the user without being first validated. An attacker can leverage this to manipulate users into performing unwanted redirects.</p>
</div>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws IOException {
  String location = req.getParameter("url");
  resp.sendRedirect(location);
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws IOException {
  String location = req.getParameter("url");

  List&lt;String&gt; allowedHosts = new ArrayList&lt;String&gt;();
  allowedHosts.add("https://trusted1.example.com/");
  allowedHosts.add("https://trusted2.example.com/");

  if (allowedHosts.contains(location))
    resp.sendRedirect(location);
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_how_does_this_work">How does this work?</h3>
<div class="paragraph">
<p>Built-in framework methods should be preferred as, more often than not, these
provide additional security mechanisms. Usually, these built-in methods are
engineered for internal page redirections. Thus, they might not be the solution
for the reader&#8217;s use case.</p>
</div>
<div class="paragraph">
<p>In case the application strictly requires external redirections based on
user-controllable data, this could be done using the following alternatives:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Validating the <code>authority</code> part of the URL against a statically defined value
(see Pitfalls).</p>
</li>
<li>
<p>Using an allow-list approach in case the destination URLs are multiple but
limited.</p>
</li>
<li>
<p>Adding a customized page to which users are redirected, warning about the
imminent action and requiring manual authorization to proceed.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_pitfalls">Pitfalls</h3>
<div class="sect3">
<h4 id="_the_trap_of_startswith_and_equivalents">The trap of 'startsWith' and equivalents</h4>
<div class="paragraph">
<p>When validating untrusted URLs by checking if they start with a trusted scheme
and authority pair <code>scheme://authority</code>, <strong>ensure that the validation string
contains a path separator <code>/</code> as the last character</strong>.<br></p>
</div>
<div class="paragraph">
<p>If the validation string does not contain a terminating path separator, the
Open Redirect vulnerability remains; only the exploitation technique
changes.</p>
</div>
<div class="paragraph">
<p>Thus, a validation like <code>startsWith("https://example.com")</code> or an equivalent
with the regex <code>^https://example\.com.*</code> can be exploited with the following
URL <code>https://example.com.malicious.example.org</code>. The practice of taking over domains
that maliciously look like existing domains is widespread and is called
<a href="https://en.wikipedia.org/wiki/Cybersquatting">Cybersquatting</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_standards">Standards</h3>
<div class="ulist">
<ul>
<li>
<p>OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a></p>
</li>
<li>
<p>OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/601">CWE-601 - URL Redirection to Untrusted Site ('Open Redirect')</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Change this code to not perform redirects based on user-controlled data.</p>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="paragraph">
<p>"[varname]" is tainted (assignments and parameters)</p>
</div>
<div class="paragraph">
<p>this argument is tainted (method invocations)</p>
</div>
<div class="paragraph">
<p>the returned value is tainted (returns &amp; method invocations results)</p>
</div>
<hr>
</div>
</div>
</div>