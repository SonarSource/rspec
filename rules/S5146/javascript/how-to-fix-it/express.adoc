=== How to fix it in Express.js

include::../../common/fix/code-rationale.adoc[]

==== Non-compliant code example

[source,javascript,diff-id=1,diff-type=noncompliant]
----
server.get('/redirect', (request, response) => {
   
   response.redirect(request.query.url);
});
----

==== Compliant solution

[source,javascript,diff-id=1,diff-type=compliant]
----
server.get('/redirect', (request, response) => {

   if (request.query.url.startsWith("https://www.example.com/")) { 
	   response.redirect(request.query.url);
   }
});
----
The compliant solution adopts a string validation approach, where the untrusted data is compared to a statically defined URL. See also `Pitfalls` for further details on this approach.

include::../../common/fix/how-does-this-work.adoc[]

=== Pitfalls

include::../../common/pitfalls/starts-with.adoc[]