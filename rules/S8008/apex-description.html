<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This rule raises an issue when string literals are used as encryption keys in Apex code, particularly with the Crypto class methods.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hardcoding encryption keys directly in source code creates serious security vulnerabilities. When encryption keys are embedded as string literals in Apex classes, they become visible to anyone with access to the codebase, including developers, administrators, and potentially attackers who gain unauthorized access.</p>
</div>
<div class="paragraph">
<p>Encryption keys are sensitive secrets that protect confidential data. If these keys are compromised, attackers can decrypt sensitive information, potentially leading to data breaches and compliance violations. Hardcoded keys are particularly problematic because they:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Remain static and cannot be easily rotated without code changes</p>
</li>
<li>
<p>Are visible in version control systems and code repositories</p>
</li>
<li>
<p>Can be accidentally exposed in logs, error messages, or debugging output</p>
</li>
<li>
<p>Violate the principle of separation of concerns between code and configuration</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In Salesforce environments, this risk is amplified because Apex code can be accessed by users with appropriate permissions, and metadata can be retrieved through various APIs and tools.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>Exposure of hardcoded encryption keys can lead to unauthorized decryption of sensitive data, resulting in data breaches, compliance violations, and loss of customer trust. Attackers who obtain these keys can decrypt confidential information, potentially accessing personal data, financial records, or other protected information.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it_in_salesforce">How to fix it in Salesforce</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Store encryption keys in Custom Settings to keep them separate from code and allow secure configuration management.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-apex" data-lang="apex">public class DataEncryption {
    private static final String ENCRYPTION_KEY = 'myEncryptionKey123456'; // Noncompliant

    public String encryptData(String data) {
        Blob key = Blob.valueOf(ENCRYPTION_KEY);
        return EncodingUtil.base64Encode(Crypto.encrypt('AES128', key, Blob.valueOf(data)));
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-apex" data-lang="apex">public class DataEncryption {
    private static final String ENCRYPTION_KEY = Encryption_Settings__c.getInstance().Key__c;

    public String encryptData(String data) {
        Blob key = Blob.valueOf(ENCRYPTION_KEY);
        return EncodingUtil.base64Encode(Crypto.encrypt('AES128', key, Blob.valueOf(data)));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use Custom Metadata Types for more flexible and deployable key management across different environments.</p>
</div>
</div>
<div class="sect3">
<h4 id="_noncompliant_code_example_2">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-apex" data-lang="apex">public class SecureProcessor {
    public static String processSecureData(String input) {
        String secretKey = 'hardcodedSecret123'; // Noncompliant
        Blob keyBlob = Blob.valueOf(secretKey);
        return EncodingUtil.base64Encode(Crypto.encrypt('AES256', keyBlob, Blob.valueOf(input)));
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution_2">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-apex" data-lang="apex">public class SecureProcessor {
    public static String processSecureData(String input) {
        Encryption_Config__mdt config = Encryption_Config__mdt.getInstance('Default');
        String secretKey = config.Key_Value__c;
        Blob keyBlob = Blob.valueOf(secretKey);
        return EncodingUtil.base64Encode(Crypto.encrypt('AES256', keyBlob, Blob.valueOf(input)));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use Protected Custom Settings for enhanced security where keys are not visible to standard users and administrators.</p>
</div>
</div>
<div class="sect3">
<h4 id="_noncompliant_code_example_3">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-apex" data-lang="apex">public class CryptoUtil {
    private static final String API_KEY = 'sk_live_abcd1234567890'; // Noncompliant

    public static String encryptApiData(String data) {
        Blob keyBlob = Blob.valueOf(API_KEY);
        return EncodingUtil.base64Encode(Crypto.encrypt('AES128', keyBlob, Blob.valueOf(data)));
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution_3">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-apex" data-lang="apex">public class CryptoUtil {
    private static final String API_KEY = Protected_Keys__c.getInstance().API_Key__c;

    public static String encryptApiData(String data) {
        Blob keyBlob = Blob.valueOf(API_KEY);
        return EncodingUtil.base64Encode(Crypto.encrypt('AES128', keyBlob, Blob.valueOf(data)));
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Salesforce Secure Secrets Storage - <a href="https://trailhead.salesforce.com/content/learn/modules/secure-secrets-storage">Comprehensive guide on storing and protecting application secrets in Salesforce</a></p>
</li>
<li>
<p>Apex Crypto Class Documentation - <a href="https://developer.salesforce.com/docs/atlas.en-us.apexref.meta/apexref/apex_classes_restful_crypto.htm">Official documentation for Salesforce Apex Crypto class methods</a></p>
</li>
<li>
<p>Custom Settings Developer Guide - <a href="https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/apex_customsettings.htm">Guide to using Custom Settings for application configuration</a></p>
</li>
<li>
<p>Storing Sensitive Data Securely - <a href="https://developer.salesforce.com/docs/atlas.en-us.secure_coding_guide.meta/secure_coding_guide/secure_coding_storing_sensitive_data.htm">Best practices for storing sensitive data in Salesforce applications</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_standards">Standards</h3>
<div class="ulist">
<ul>
<li>
<p>CWE-798: Use of Hard-coded Credentials - <a href="https://cwe.mitre.org/data/definitions/798.html">Common weakness related to hardcoded credentials in software</a></p>
</li>
<li>
<p>OWASP Top 10:2021-A07-Identification and Authentication Failures - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">OWASP guidance on authentication and credential management failures</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>