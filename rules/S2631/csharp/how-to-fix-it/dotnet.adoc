== How to fix it in .NET

=== Code examples

The following noncompliant code is vulnerable to Regex Denial of Service
because untrusted data is used as a regex to scan a string without prior
sanitization or validation.

==== Noncompliant code example

[source,csharp,diff-id=1,diff-type=noncompliant]
----
public class ExampleController : Controller
{
    public IActionResult Validate(string regex, string input)
    {
        bool match = Regex.IsMatch(input, regex);
        return Json(match);
    }
}
----

[source,csharp,diff-id=2,diff-type=noncompliant]
----
public class ExampleController : Controller
{
    public IActionResult Validate(string regex, string input)
    {
        Regex re = new Regex(regex, RegexOptions.None);
        bool match = re.IsMatch(input);
        return Json(match);
    }
}
----

==== Compliant solution

[source,csharp,diff-id=1,diff-type=compliant]
----
public class ExampleController : Controller
{
    public IActionResult Validate(string regex, string input)
    {
        bool match = Regex.IsMatch(input, Regex.Escape(regex));
        return Json(match);
    }
}
----

[source,csharp,diff-id=2,diff-type=compliant]
----
public class ExampleController : Controller
{
    public IActionResult Validate(string regex, string input)
    {
        Regex re = new Regex(regex, RegexOptions.None, TimeSpan.FromMilliseconds(100));
        bool match = re.IsMatch(input);
        return Json(match);
    }
}
----

=== How does this work?

include::../../common/fix/validation.adoc[]

In the first compliant solution example, `Regex.Escape` escapes metacharacters and escape sequences
that could have broken the initially intended logic.

In the second compliant solution example, a match timeout of 100 milliseconds is applied to the
regular expression. An exception will by thrown if the timeout is exceeded.

Starting with .NET 7, `RegexOptions.NonBacktracking` will cause matching to be performed without
backtracking. This prevents the performance issues that backtracking can introduce.
