<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is an issue when a method accepts a <code>Closure</code> parameter and delegates calls to a specific object without using the <code>@DelegatesTo</code> annotation.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When building Domain-Specific Languages (DSLs) in Groovy, methods often accept closures and delegate method calls to specific objects using the builder pattern. Without the <code>@DelegatesTo</code> annotation, several problems arise:</p>
</div>
<div class="paragraph">
<p><strong>IDE Support Issues</strong>: IDEs cannot provide intelligent code completion within closure bodies because they don&#8217;t know which methods are available on the delegate object. Developers lose valuable tooling support when writing DSL code.</p>
</div>
<div class="paragraph">
<p><strong>Static Type Checking Problems</strong>: When using <code>@TypeChecked</code> or <code>@CompileStatic</code>, the compiler cannot verify that method calls within the closure are valid. This leads to compilation errors even for correct code, or forces developers to disable static checking for DSL code.</p>
</div>
<div class="paragraph">
<p><strong>Documentation Gap</strong>: Without explicit annotation, there&#8217;s no clear indication of what object the closure delegates to, making the API harder to understand and maintain.</p>
</div>
<div class="paragraph">
<p>The <code>@DelegatesTo</code> annotation was specifically introduced in Groovy 2.1 to solve these problems by providing compile-time hints about delegation strategy and delegate types.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>Missing <code>@DelegatesTo</code> annotations can significantly impact developer productivity and code quality:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Reduced IDE Support</strong>: Developers lose code completion, method suggestions, and error highlighting within DSL closures</p>
</li>
<li>
<p><strong>Compilation Issues</strong>: Static type checking fails on valid DSL code, forcing developers to either disable type checking or add unnecessary type casts</p>
</li>
<li>
<p><strong>Poor Developer Experience</strong>: Writing DSL code becomes more error-prone without proper tooling support</p>
</li>
<li>
<p><strong>Maintenance Difficulties</strong>: APIs become harder to understand and document without explicit delegation information</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Add the @DelegatesTo annotation to closure parameters, specifying both the delegation strategy and the target class. Include the strategy parameter when using non-default delegation strategies like DELEGATE_ONLY.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">def email(Closure cl) {
    def email = new EmailSpec()
    def code = cl.rehydrate(email, this, this)
    code.resolveStrategy = Closure.DELEGATE_ONLY // Noncompliant
    code()
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">def email(@DelegatesTo(strategy=Closure.DELEGATE_ONLY, value=EmailSpec) Closure cl) {
    def email = new EmailSpec()
    def code = cl.rehydrate(email, this, this)
    code.resolveStrategy = Closure.DELEGATE_ONLY
    code()
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Groovy Documentation - @DelegatesTo - <a href="https://docs.groovy-lang.org/latest/html/documentation/core-domain-specific-languages.html#section-delegatesto">Official Groovy documentation explaining @DelegatesTo annotation and its various modes</a></p>
</li>
<li>
<p>Groovy DSL Guide - <a href="http://groovy-lang.org/dsls.html">Comprehensive guide to building Domain-Specific Languages in Groovy</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>