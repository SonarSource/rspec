<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="https://api.flutter.dev/flutter/widgets/BuildContext/mounted.html"><code>mounted property</code></a> should be checked before using a <a href="https://api.flutter.dev/flutter/widgets/BuildContext-class.html"><code>BuildContext</code></a>, after every async operation.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Asynchronous operations making use of futures or <code>async</code>/<code>await</code> constructs decouple code from its execution. This means that, unlike sequential code, asynchronous code will not necessarily execute in the order it is written.</p>
</div>
<div class="paragraph">
<p>For example, in a sequence of <code>await</code> calls, the code following the first <code>await</code> will not be executed until the future returned by the first <code>await</code> completes, and the same is true for the subsequent <code>await</code> call.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-dart" data-lang="dart">Future&lt;Data&gt; fetchData(String uri) async { /* ... */ }

void sequenceOfAsyncOperations() async {
  final data1 = await fetchData('https://example.com/data1');
  // Executed after the future returned by the 1st fetchData completes
  final data1Info = data1.info;
  print(data1Info);
  final data2 = await fetchData('https://example.com/data2');
  // Executed after the future returned by the 1st fetchData completes
  final data2Info = data2.info;
  print(data2Info);
  // ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because the execution suspends on awaiting, and the thread is potentially assigned to another task, all variables which are in scope need to be stored, so that they can be restored when the result of the future is available and the execution can resume. This is done behind the scenes by the Dart compiler, in a way that makes the code appear to be executed sequentially from a syntactical perspective, whereas it is actually not.</p>
</div>
<div class="paragraph">
<p>When all variables used in an <code>async</code> function are local to that function, and not visible to the outside world, there is no concern of using them after a future completes. This is not the case, however, for <code>BuildContext</code>, which is typically passed to <code>WidgetBuilder</code> functions, and can be accessed via <code>State.context</code>.</p>
</div>
<div class="paragraph">
<p>That means that, the <code>BuildContext</code> instance may change internal state between the time the future has been created and awaited, and the time it completes and the execution restores. That time interval is generally referred to as an "async gap".</p>
</div>
<div class="paragraph">
<p>Dart provides a property of <code>BuildContext</code> called <code>mounted</code>, which can be used to check if the widget associated with the <code>BuildContext</code> is still in the widget tree, and can be safely accessed in the current context.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-dart" data-lang="dart">@override
Widget build(BuildContext context) =&gt; OutlinedButton(
    onPressed: () async {
        await Future&lt;void&gt;.delayed(const Duration(seconds: 1));
        if (context.mounted) {
          // The context is mounted, so it's safe to use it
          Navigator.of(context).pop();
        }
    },
    child: const Text('Delayed pop'),
  );</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>If the <code>BuildContext</code> is used across an async gap without checking the <code>mounted</code> property, the code may access a <code>BuildContext</code> instance made invalid by the Flutter framework, which can lead to runtime errors and unpredictable behaviors.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Checks for the <code>mounted</code> property before every access to an instance of a <code>BuildContext</code>, whether it is a read access (of the instance itself or of any of its properties) or a write access (such as calling a method or setting a property).</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-dart" data-lang="dart">@override
Widget build(BuildContext context) =&gt; OutlinedButton(
    onPressed: () async {
        await Future&lt;void&gt;.delayed(const Duration(seconds: 1));
        Navigator.of(context).pop(); // Non compliant
    },
    child: const Text('Delayed pop'),
  );</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-dart" data-lang="dart">@override
Widget build(BuildContext context) =&gt; OutlinedButton(
    onPressed: () async {
        await Future&lt;void&gt;.delayed(const Duration(seconds: 1));
        if (context.mounted) {
          // The context is mounted, so it's safe to use it
          Navigator.of(context).pop();
        }
    },
    child: const Text('Delayed pop'),
  );</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Dart Docs - <a href="https://dart.dev/tools/linter-rules/use_build_context_synchronously">Dart Linter rule - use_build_context_synchronously</a></p>
</li>
<li>
<p>Dart Docs - <a href="https://dart.dev/libraries/async/async-await">Asynchronous programming: futures, async, await</a></p>
</li>
<li>
<p>Flutter API Reference - <a href="https://api.flutter.dev/flutter/widgets/BuildContext/mounted.html">BuildContext class - mounted property</a></p>
</li>
<li>
<p>Medium - <a href="https://medium.com/@wartelski/everything-you-need-to-know-about-the-mounted-property-in-flutter-b603fdb51cb4">Everything You Need to Know About the Mounted Property in Flutter.</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="ulist">
<ul>
<li>
<p>Don&#8217;t use 'BuildContext&#8217;s across async gaps.</p>
</li>
<li>
<p>Don&#8217;t use 'BuildContext&#8217;s across async gaps, guarded by an unrelated 'mounted' check.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="paragraph">
<p>The identifier of the 'BuildContext' variable: e.g. <code>context</code> in <code>Navigator.of(context).pushNamed('/home')</code>.</p>
</div>
</div>
</div>
</div>