Granting privileges to make significant changes to internal resources can allow
attackers to attack, steal, and persist in an organization's cloud resources.

To prevent improper creation or deletion of resources, proactive measures
include restricting upstream custom roles.

Today, operations teams need to know about two important scenarios that can
occur. +
The first scenario is that attackers may need to deploy new resources to
execute their malicious intent or remain in the infrastructure. Therefore,
operations teams must control what unexpectedly appears in the infrastructure,
e.g. what is -

* added
* written down
* updated
* started
* appended
* applied
* accessed.

The second scenario intervenes once the malicious intent has been executed. At
this stage, the attackers must either persist or remove their fingerprints.
When attacks are detected by the organization, security investigations must
verify what may have disappeared from the infrastructure, e.g., what was

* stopped
* disabled
* canceled
* deleted
* destroyed
* detached
* disconnected
* suspended
* rejected
* removed.

Note: In the event of a security incident, it is not advisable to take
restrictive measures like the previous ones to stop the attack. +
Attackers might notice the deletion and know that an investigation is underway.

== Ask Yourself Whether

* This custom role will be mostly used for read-only purposes.
* Compliance policies require read-only access.

There is a risk if you answered yes to any of these questions.

== Recommended Secure Coding Practices

Replace this list of permissions with as much read-only permissions as possible.

== Sensitive Code Example

Light custom role intended for a user who needs to develop:

----
resource "google_project_iam_custom_role" "example" {
  permissions = [
    resourcemanager.projects.create       # Sensitive
    resourcemanager.projects.delete       # Sensitive
    resourcemanager.projects.get
    resourcemanager.projects.list
    run.services.create
    run.services.delete
    run.services.get
    run.services.getIamPolicy
    run.services.setIamPolicy             # Sensitive
    run.services.list
    run.services.update
  ]
}
----

Light custom role intended for a user who needs visibility only:

----
resource "google_project_iam_custom_role" "example" {
  permissions = [
    resourcemanager.projects.create # Sensitive
    resourcemanager.projects.delete # Sensitive
    resourcemanager.projects.get
    resourcemanager.projects.list
    run.services.create             # Sensitive
    run.services.delete             # Sensitive
    run.services.get
    run.services.getIamPolicy
    run.services.setIamPolicy       # Sensitive
    run.services.list
    run.services.update             # Sensitive
  ]
}
----

== Compliant Solution

Light custom role intended for a user who needs to develop:

----
resource "google_project_iam_custom_role" "example" {
  permissions = [
    resourcemanager.projects.get
    resourcemanager.projects.list
    run.services.create
    run.services.delete
    run.services.get
    run.services.getIamPolicy
    run.services.list
    run.services.update
  ]
}
----

Light custom role intended for a user who needs visibility only:

----
resource "google_project_iam_custom_role" "example" {
  permissions = [
    resourcemanager.projects.get
    resourcemanager.projects.list
    run.services.get
    run.services.getIamPolicy
    run.services.list
  ]
}
----

== See

* https://owasp.org/Top10/A01_2021-Broken_Access_Control/[OWASP Top 10 2021 Category A1] - Boken Access Control
* https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control[OWASP Top 10 2017 Category A5] - Broken Access Control
* https://cwe.mitre.org/data/definitions/668.html[MITRE, CWE-668] - Exposure of Resource to Wrong Sphere

ifdef::env-github,rspecator-view[]

'''
== Implementation Specification
(visible only on this page)

=== Message

Replace unneeded write permissions with as many read-only permissions as
possible.

=== Highlighting

Highlight the sensitive list item.

endif::env-github,rspecator-view[]

