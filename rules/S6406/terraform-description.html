<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Excessive granting of GCP IAM permissions can allow attackers to exploit an
organization&#8217;s cloud resources with malicious intent.</p>
</div>
<div class="paragraph">
<p>To prevent improper creation or deletion of resources after an account is
compromised, proactive measures include both following GCP Security Insights
and ensuring custom roles contain as few privileges as possible.</p>
</div>
<div class="paragraph">
<p>After gaining a foothold in the target infrastructure, sophisticated attacks
typically consist of two major parts.<br>
First, attackers must deploy new resources to carry out their malicious intent.
To guard against this, operations teams must control what unexpectedly appears
in the infrastructure, such as what is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>added</p>
</li>
<li>
<p>written down</p>
</li>
<li>
<p>updated</p>
</li>
<li>
<p>started</p>
</li>
<li>
<p>appended</p>
</li>
<li>
<p>applied</p>
</li>
<li>
<p>accessed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Once the malicious intent is executed, attackers must avoid detection at all
costs.<br>
To counter attackers' attempts to remove their fingerprints, operations teams
must control what unexpectedly disappears from the infrastructure, such as what
is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>stopped</p>
</li>
<li>
<p>disabled</p>
</li>
<li>
<p>canceled</p>
</li>
<li>
<p>deleted</p>
</li>
<li>
<p>destroyed</p>
</li>
<li>
<p>detached</p>
</li>
<li>
<p>disconnected</p>
</li>
<li>
<p>suspended</p>
</li>
<li>
<p>rejected</p>
</li>
<li>
<p>removed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For operations teams to be resilient in this scenario, their organization must
apply both:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Detection security: log these actions to better detect malicious actions.</p>
</li>
<li>
<p>Preventive security: review and limit granted permissions.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This rule raises an issue when a custom role grants a number of sensitive permissions
(read-write or destructive permission) that is greater than a given parameter.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ask_yourself_whether">Ask Yourself Whether</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>This custom role will be mostly used for read-only purposes.</p>
</li>
<li>
<p>Compliance policies require read-only access.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There is a risk if you answered yes to any of these questions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_recommended_secure_coding_practices">Recommended Secure Coding Practices</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To reduce the risks associated with this role after a compromise:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Reduce the list of permissions to grant only those that are actually needed.</p>
</li>
<li>
<p>Favor read-only over read-write.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sensitive_code_example">Sensitive Code Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This custom role grants more than 5 sensitive permissions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terraform" data-lang="terraform">resource "google_project_iam_custom_role" "example" {
  permissions = [ # Sensitive
    "resourcemanager.projects.create", # Sensitive permission
    "resourcemanager.projects.delete", # Sensitive permission
    "resourcemanager.projects.get",
    "resourcemanager.projects.list",
    "run.services.create", # Sensitive permission
    "run.services.delete", # Sensitive permission
    "run.services.get",
    "run.services.getIamPolicy",
    "run.services.setIamPolicy",  # Sensitive permission
    "run.services.list",
    "run.services.update",  # Sensitive permission
  ]
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This custom role grants less than 5 sensitive permissions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terraform" data-lang="terraform">resource "google_project_iam_custom_role" "example" {
  permissions = [
    "resourcemanager.projects.get",
    "resourcemanager.projects.list",
    "run.services.create",
    "run.services.delete",
    "run.services.get",
    "run.services.getIamPolicy",
    "run.services.list",
    "run.services.update",
  ]
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://cloud.google.com/iam/docs/recommender-overview">GCP Docs</a> - Enforce least privilege with role recommendations</p>
</li>
<li>
<p><a href="https://cloud.google.com/iam/docs/manage-policy-insights">GCP Docs</a> - Security Insights</p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/668">CWE-668 - Exposure of Resource to Wrong Sphere</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="ulist">
<ul>
<li>
<p>Primary Message: This role grants more than <code>max</code> sensitive permissions. Make sure they are all required.</p>
</li>
<li>
<p>Secondary Message: Sensitive permission: read-write or destructive</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_parameters">Parameters</h3>
<div class="sidebarblock">
<div class="content">
<div class="title">max</div>
<div class="listingblock">
<div class="content">
<pre>5</pre>
</div>
</div>
<div class="paragraph">
<p>Number of sensitive permissions for a custom role.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="paragraph">
<p>Highlight the sensitive list item.</p>
</div>
</div>
</div>
</div>