<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A non-static inner class has a reference to its outer class, and access to the outer class' fields and methods. That class reference makes the inner class larger and could cause the outer class instance to live in memory longer than necessary.</p>
</div>
<div class="paragraph">
<p>If the reference to the outer class isn&#8217;t used, it is more efficient to make the inner class <code>static</code> (also called nested). If the reference is used only in the class constructor, then explicitly pass a class reference to the constructor. If the inner class is anonymous, it will also be necessary to name it.</p>
</div>
<div class="paragraph">
<p>However, while a nested/<code>static</code> class would be more efficient, it&#8217;s worth noting that there are semantic differences between an inner class and a nested one:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an inner class can only be instantiated within the context of an instance of the outer class.</p>
</li>
<li>
<p>a nested (<code>static</code>) class can be instantiated independently of the outer class.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are two scenarios in which this rule will raise an issue:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On an <em>inner class</em>: make it <code>static</code>.</p>
</li>
<li>
<p>On a <em>local class</em>: extract it as a <code>static</code> <em>inner class</em>.</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="paragraph">
<p>Inner classes that don&#8217;t use the outer class reference should be static.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class Fruit {
  // ...

  public class Seed {  // Noncompliant; there's no use of the outer class reference so make it static
    int germinationDays = 0;
    public Seed(int germinationDays) {
      this.germinationDays = germinationDays;
    }
    public int getGerminationDays() {
      return germinationDays;
    }
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class Fruit {
  // ...

  public static class Seed {
    int germinationDays = 0;
    public Seed(int germinationDays) {
      this.germinationDays = germinationDays;
    }
    public int getGerminationDays() {
      return germinationDays;
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Local classes that don&#8217;t use the outer class reference should be extracted as a static inner classes.</p>
</div>
</div>
<div class="sect3">
<h4 id="_noncompliant_code_example_2">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class Foo {
  public Foo() {
    class Bar { // Noncompliant
      void doSomething() {
        // ...
      }
    }
    new Bar().doSomething();
  }

  public void method() {
    class Baz { // Noncompliant
      void doSomething() {
        // ...
      }
    }
    new Baz().doSomething();
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution_2">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class Foo {
  public Foo() {
    new Bar().doSomething();
  }

  public void method()  {
    new Baz().doSomething();
  }

  private static class Bar { // Compliant
    void doSomething() {
      // ...
    }
  }

  private static class Baz { // Compliant
    void doSomething() {
      // ...
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.oracle.com/javase/tutorial/java/javaOO/nested.html">Oracle Java SE - Nested Classes</a></p>
</li>
<li>
<p><a href="https://docs.oracle.com/javase/tutorial/java/javaOO/localclasses.html">Oracle Java SE - Local Classes</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_articles_blog_posts">Articles &amp; blog posts</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.geeksforgeeks.org/difference-between-static-and-non-static-nested-class-in-java/">GeeksforGeeks - Difference between static and non-static nested class in Java</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Make this a [named] "static" inner class.</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_6_oct_2015_193330_ann_campbell_wrote">on 6 Oct 2015, 19:33:30 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~nicolas.peru], <em><a href="http://www.securingjava.com/chapter-seven/chapter-seven-1.html">Securing Java</a></em> (see Rule 5) says that inner classes (presumably only non-<code>static</code>) are security holes because the compiler translates them to ordinary classes with <code>package</code> accessibility, and "upgrades" the owning&#8217;s class&#8217;s <code>private</code> member visibility to <code>package</code>.</p>
</div>
<div class="paragraph">
<p>The upshot is a recommendation against using inner classes. Since those problems go away if the inner class is <code>static</code>, I&#8217;m wondering whether to combine "Don&#8217;t use non-static inner classes" with this rule or handle it in a separate RSpec. WDYT?</p>
</div>
</div>
</div>
</div>