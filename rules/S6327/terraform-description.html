<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Amazon Simple Notification Service (SNS) is a managed messaging service for application-to-application (A2A) and application-to-person (A2P) communication. SNS topics allows publisher systems to fanout messages to a large number of subscriber systems. Amazon SNS allows to encrypt messages when they are received. In the case that adversaries gain physical access to the storage medium or otherwise leak a message they are not able to access the data.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ask_yourself_whether">Ask Yourself Whether</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>The topic contains sensitive data that could cause harm when leaked.</p>
</li>
<li>
<p>There are compliance requirements for the service to store data encrypted.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There is a risk if you answered yes to any of those questions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_recommended_secure_coding_practices">Recommended Secure Coding Practices</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is recommended to encrypt SNS topics that contain sensitive information.</p>
</div>
<div class="paragraph">
<p>To do so, create a master key and assign the SNS topic to it. Note that this
system does not encrypt the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Topic metadata (topic name and attributes)</p>
</li>
<li>
<p>Message metadata (subject, message ID, timestamp, and attributes)</p>
</li>
<li>
<p>Data protection policy</p>
</li>
<li>
<p>Per-topic metrics</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Then, make sure that any publishers have the <code>kms:GenerateDataKey*</code> and
<code>kms:Decrypt</code> permissions for the AWS KMS key.</p>
</div>
<div class="paragraph">
<p>See <a href="https://docs.aws.amazon.com/sns/latest/dg/sns-key-management.html#sns-what-permissions-for-sse">AWS SNS Key Management Documentation</a>
for more information.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sensitive_code_example">Sensitive Code Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/sns_topic">aws_sns_topic</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terraform" data-lang="terraform">resource "aws_sns_topic" "topic" {  # Sensitive, encryption disabled by default
  name = "sns-unencrypted"
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/sns_topic">aws_sns_topic</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terraform" data-lang="terraform">resource "aws_sns_topic" "topic" {
  name = "sns-encrypted"
  kms_master_key_id = aws_kms_key.enc_key.key_id
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.aws.amazon.com/sns/latest/dg/sns-server-side-encryption.html">AWS Documentation</a> - Encryption at rest</p>
</li>
<li>
<p><a href="https://aws.amazon.com/blogs/compute/encrypting-messages-published-to-amazon-sns-with-aws-kms/">Encrypting messages published to Amazon SNS with AWS KMS</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a></p>
</li>
<li>
<p>STIG Viewer - <a href="https://stigviewer.com/stigs/application_security_and_development/2024-12-06/finding/V-222588">Application Security and Development: V-222588</a> - The application must implement approved cryptographic mechanisms to prevent unauthorized modification of information at rest.</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="ulist">
<ul>
<li>
<p>Omitting "kms_master_key_id" disables SNS topics encryption. Make sure it is safe here.</p>
</li>
</ul>
</div>
</div>
</div>
</div>