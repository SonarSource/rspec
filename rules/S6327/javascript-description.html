<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Amazon Simple Notification Service (SNS) is a managed messaging service for application-to-application (A2A) and application-to-person (A2P) communication. SNS topics allows publisher systems to fanout messages to a large number of subscriber systems. Amazon SNS allows to encrypt messages when they are received. In the case that adversaries gain physical access to the storage medium or otherwise leak a message they are not able to access the data.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ask_yourself_whether">Ask Yourself Whether</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>The topic contains sensitive data that could cause harm when leaked.</p>
</li>
<li>
<p>There are compliance requirements for the service to store data encrypted.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There is a risk if you answered yes to any of those questions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_recommended_secure_coding_practices">Recommended Secure Coding Practices</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is recommended to encrypt SNS topics that contain sensitive information.</p>
</div>
<div class="paragraph">
<p>To do so, create a master key and assign the SNS topic to it. Note that this
system does not encrypt the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Topic metadata (topic name and attributes)</p>
</li>
<li>
<p>Message metadata (subject, message ID, timestamp, and attributes)</p>
</li>
<li>
<p>Data protection policy</p>
</li>
<li>
<p>Per-topic metrics</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Then, make sure that any publishers have the <code>kms:GenerateDataKey*</code> and
<code>kms:Decrypt</code> permissions for the AWS KMS key.</p>
</div>
<div class="paragraph">
<p>See <a href="https://docs.aws.amazon.com/sns/latest/dg/sns-key-management.html#sns-what-permissions-for-sse">AWS SNS Key Management Documentation</a>
for more information.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sensitive_code_example">Sensitive Code Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sns.Topic.html"><code>aws_cdk.aws_sns.Topic</code></a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { Topic } from 'aws-cdk-lib/aws-sns';

new Topic(this, 'exampleTopic'); // Sensitive</code></pre>
</div>
</div>
<div class="paragraph">
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sns.CfnTopic.html"><code>aws_cdk.aws_sns.CfnTopic</code></a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { Topic, CfnTopic } from 'aws-cdk-lib/aws-sns';

new CfnTopic(this, 'exampleCfnTopic'); // Sensitive</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sns.Topic.html"><code>aws_cdk.aws_sns.Topic</code></a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { Topic } from 'aws-cdk-lib/aws-sns';

const encryptionKey = new Key(this, 'exampleKey', {
    enableKeyRotation: true,
});

new Topic(this, 'exampleTopic', {
    masterKey: encryptionKey
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sns.CfnTopic.html"><code>aws_cdk.aws_sns.CfnTopic</code></a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { CfnTopic } from 'aws-cdk-lib/aws-sns';

const encryptionKey = new Key(this, 'exampleKey', {
    enableKeyRotation: true,
});

cfnTopic = new CfnTopic(this, 'exampleCfnTopic', {
    kmsMasterKeyId: encryptionKey.keyId
});</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.aws.amazon.com/sns/latest/dg/sns-server-side-encryption.html">AWS Documentation</a> - Encryption at rest</p>
</li>
<li>
<p><a href="https://aws.amazon.com/blogs/compute/encrypting-messages-published-to-amazon-sns-with-aws-kms/">Encrypting messages published to Amazon SNS with AWS KMS</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a></p>
</li>
<li>
<p>STIG Viewer - <a href="https://stigviewer.com/stigs/application_security_and_development/2024-12-06/finding/V-222588">Application Security and Development: V-222588</a> - The application must implement approved cryptographic mechanisms to prevent unauthorized modification of information at rest.</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>For Topic:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Omitting "masterKey" disables SNS topics encryption. Make sure it is safe here.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For CfnTopic:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Omitting "kmsMasterKeyId" disables SNS topics encryption. Make sure it is safe here.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="ulist">
<ul>
<li>
<p>Highlight the initializer function if it does not contain the third argument <code>props</code> or <code>props</code> is set to <code>undefined</code>.</p>
</li>
<li>
<p>For Topic: Highlight the <code>props</code> object if it does not contain the property <code>masterKey</code>.</p>
</li>
<li>
<p>For Topic: Highlight the <code>masterKey</code> attribute if it is set to <code>undefined</code>.</p>
</li>
<li>
<p>For CfnTopic: Highlight the <code>props</code> object if it does not contain the property <code>kmsMasterKeyId</code>.</p>
</li>
<li>
<p>For CfnTopic: Highlight the <code>kmsMasterKeyId</code> attribute if it is set to <code>undefined</code>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>