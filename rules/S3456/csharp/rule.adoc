== Why is this an issue?

The method `ToCharArray`, if called on a `String` or a UTF-8 literal type (`ReadOnlySpan<byte>`, `Span<byte>`) it copies the characters from the object to a new Unicode character array. In certain cases, such as accessing a specific character via an index or iterating over all the characters, calling `ToCharArray` is not performant and might create confusion.

The `String` and the utf-8 literals types offer an indexer property that allows you to treat them as an array of chars directly without the need to call `ToCharArray`.

== How to fix it

=== Code examples

==== Noncompliant code example

[source,csharp,diff-id=1,diff-type=noncompliant]
----
string str = "some string";
foreach (var c in str.ToCharArray()) // Noncompliant
{
  // ...    
}

ReadOnlySpan<byte> span = "some UTF-8 string literal"u8;
foreach (var c in span.ToArray()) // Noncompliant
{
  // ...    
}
----


==== Compliant solution

[source,csharp,diff-id=1,diff-type=compliant]
----
string str = "some string";
foreach (var c in str)
{
  // ...    
}

ReadOnlySpan<byte> span = "some UTF-8 string literal"u8;
foreach (var b in span) // Compliant 
{
  // ...    
}
----

== Resources

=== Documentation

* https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/proposals/csharp-11.0/utf8-string-literals[UTF-8 Strings literals]
* https://learn.microsoft.com/en-us/dotnet/csharp/programming-guide/strings/#accessing-individual-characters[Accessing individual characters]
* https://learn.microsoft.com/en-us/dotnet/api/system.string.tochararray[String.ToCharArray Method]


include::./rspecator.adoc[]