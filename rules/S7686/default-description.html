<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This rule raises an issue when a script changes directory with <code>cd</code> and then attempts to change back with <code>cd ..</code> or similar commands.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Changing directories and then changing back with <code>cd ..</code> creates a fragile pattern that can leave your shell in an unexpected location if the script fails.</p>
</div>
<div class="paragraph">
<p>When you use <code>cd</code> to change directories, you modify the current shell&#8217;s working directory. If your script encounters an error or exits unexpectedly between the <code>cd</code> command and the <code>cd ..</code> command, the shell remains in the changed directory. This can confuse users and potentially cause subsequent commands to run in the wrong location.</p>
</div>
<div class="paragraph">
<p>Subshells provide a safer alternative because they create an isolated environment. Any directory changes within a subshell only affect that subshell and don&#8217;t impact the parent shell&#8217;s working directory. When the subshell exits, the parent shell remains in its original directory.</p>
</div>
<div class="paragraph">
<p>The <code>pushd</code> and <code>popd</code> commands offer another robust solution. The <code>pushd</code> command saves the current directory on a stack before changing to the new directory, while <code>popd</code> reliably returns to the previously saved directory. This approach is more resilient to errors than manually tracking directory changes.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>If the script fails between the directory change and the attempt to change back, users may find themselves in an unexpected directory. This can lead to confusion and potentially cause subsequent commands to operate on the wrong files or directories.</p>
</div>
</div>
<div class="sect2">
<h3 id="_how_to_fix">How to fix?</h3>
<div class="paragraph">
<p>Use a subshell to isolate directory changes. Commands within parentheses run in a subshell, so any directory changes only affect that subshell.</p>
</div>
<div class="sect3">
<h4 id="_non_compliant_code_example">Non-compliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">cd "${target_dir}"
ls -la
cd ..</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_code_example">Compliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">(
  cd "${target_dir}"
  ls -la
)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Bash Manual - Command Grouping - <a href="https://www.gnu.org/software/bash/manual/html_node/Command-Grouping.html">Official documentation on subshells and command grouping in Bash</a></p>
</li>
<li>
<p>Bash Manual - Directory Stack - <a href="https://www.gnu.org/software/bash/manual/html_node/Directory-Stack.html">Official documentation on pushd and popd commands</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>