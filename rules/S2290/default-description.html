<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://learn.microsoft.com/en-us/dotnet/csharp/event-pattern#define-and-raise-field-like-events">Field-like</a> events are events that do not have explicit <a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/add"><code>add</code></a> and <a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/remove"><code>remove</code></a> accessors.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">public event EventHandler MyEvent; // No add and remove accessors</code></pre>
</div>
</div>
<div class="paragraph">
<p>The compiler generates a <code>private</code> <code>delegate</code> field to back the event, as well as generating the implicit <code>add</code> and <code>remove</code> accessors.</p>
</div>
<div class="paragraph">
<p>When a <code>virtual</code> field-like <code>event</code> is overridden by another field-like <code>event</code>, the behavior of the C# compiler is to generate a new <code>private</code> <code>delegate</code> field in the derived class, separate from the parent&#8217;s field. This results in multiple and separate events being created, which is rarely what&#8217;s actually intended.</p>
</div>
<div class="sect2">
<h3 id="_noncompliant_code_example">Noncompliant code example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">abstract class Car
{
  public virtual event EventHandler OnRefuel; // Noncompliant

  public void Refuel()
  {
    // This OnRefuel will always be null
     if (OnRefuel != null)
     {
       OnRefuel(this, EventArgs.Empty);
     }
  }
}

class R2 : Car
{
  public override event EventHandler OnRefuel;
}

class Program
{
  static void Main(string[] args)
  {
    var r2 = new R2();
    r2.OnRefuel += (o, a) =&gt;
    {
        Console.WriteLine("This event will be called");
    };
    r2.Refuel();
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_compliant_solution">Compliant solution</h3>
<div class="paragraph">
<p>To prevent this, remove the <code>virtual</code> designation from the parent class event.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">abstract class Car
{
  public event EventHandler OnRefuel; // Compliant

  public void Refuel()
  {
    if (OnRefuel != null)
    {
      OnRefuel(this, EventArgs.Empty);
    }
  }
}

class R2 : Car
{

}

class Program
{
  static void Main(string[] args)
  {
    var r2 = new R2();
    r2.OnRefuel += (o, a) =&gt;
    {
        Console.WriteLine("This event will be called");
    };
    r2.Refuel();
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/add">Add keyword</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/remove">Remove keyword</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/csharp/delegate-class">Delegates</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/csharp/events-overview">Introduction to events</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/csharp/event-pattern#define-and-raise-field-like-events">Field-like events</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Remove this "virtual" modifier of "xxx".</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_11_may_2015_144923_dinesh_bolkensteyn_wrote">on 11 May 2015, 14:49:23 Dinesh Bolkensteyn wrote:</h3>
<div class="paragraph">
<p>The description sounds like chinese and the compliant solution still includes a <code>// Noncompliant</code> flag</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_11_may_2015_153130_dinesh_bolkensteyn_wrote">on 11 May 2015, 15:31:30 Dinesh Bolkensteyn wrote:</h3>
<div class="paragraph">
<p>In fact this is quite complex, I&#8217;ve managed to understand the issue only after carefully reading the following article in full:</p>
</div>
<div class="paragraph">
<p><a href="http://blogs.msdn.com/b/samng/archive/2007/11/26/virtual-events-in-c.aspx" class="bare">http://blogs.msdn.com/b/samng/archive/2007/11/26/virtual-events-in-c.aspx</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_on_12_may_2015_122349_ann_campbell_wrote">on 12 May 2015, 12:23:49 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~dinesh.bolkensteyn] can you be more specific about what in the description you find unhelpful and/or suggest or make some edits, please?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_12_may_2015_143546_dinesh_bolkensteyn_wrote">on 12 May 2015, 14:35:46 Dinesh Bolkensteyn wrote:</h3>
<div class="paragraph">
<p>What is the initial source for this rule [~ann.campbell.2]?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_12_may_2015_154518_dinesh_bolkensteyn_wrote">on 12 May 2015, 15:45:18 Dinesh Bolkensteyn wrote:</h3>
<div class="paragraph">
<p>I&#8217;ve tried to give a bit more context and a full example.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_14_may_2015_124713_ann_campbell_wrote">on 14 May 2015, 12:47:13 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>I&#8217;ve made some edits [~dinesh.bolkensteyn]. See what you think.</p>
</div>
<div class="paragraph">
<p>In particular, I&#8217;m not sure about the correct order of the words <code>private</code> and <code>delegate</code>. You had <code>delegate</code> <code>private</code>, which sounds odd to me in English, so I swapped them. But please swap back if that&#8217;s the particular order they should appear in.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_18_may_2015_060530_dinesh_bolkensteyn_wrote">on 18 May 2015, 06:05:30 Dinesh Bolkensteyn wrote:</h3>
<div class="paragraph">
<p>LGTM!</p>
</div>
</div>
</div>
</div>