<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Using the equality <code>==</code> and inequality <code>!=</code> operators to compare two objects generally works. The operators can be overloaded, and therefore the comparison can resolve to the appropriate method. However, when the operators are used on interface instances, then <code>==</code> resolves to reference equality, which may result in unexpected behavior if implementing classes override <code>Equals</code>. Similarly, when a class overrides <code>Equals</code>, but instances are compared with non-overloaded <code>==</code>, there is a high chance that value comparison was meant instead of the reference one.</p>
</div>
<div class="sect2">
<h3 id="_noncompliant_code_example">Noncompliant code example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">public interface IMyInterface
{
}

public class MyClass : IMyInterface
{
    public override bool Equals(object obj)
    {
        //...
    }
}

public class Program
{
    public static void Method(IMyInterface instance1, IMyInterface instance2)
    {
        if (instance1 == instance2) // Noncompliant, will do reference equality check, but was that intended? MyClass overrides Equals.
        {
            Console.WriteLine("Equal");
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_compliant_solution">Compliant solution</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">public interface IMyInterface
{
}

public class MyClass : IMyInterface
{
    public override bool Equals(object obj)
    {
        //...
    }
}

public class Program
{
    public static void Method(IMyInterface instance1, IMyInterface instance2)
    {
        if (object.Equals(instance1, instance2)) // object.Equals checks for null and then calls the instance based Equals, so MyClass.Equals
        {
            Console.WriteLine("Equal");
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_exceptions">Exceptions</h3>
<div class="paragraph">
<p>The rule does not report on comparisons of <code>System.Type</code> instances and on comparisons inside <code>Equals</code> overrides.</p>
</div>
<div class="paragraph">
<p>It also does not raise an issue when one of the operands is <code>null</code> nor when one of the operand is cast to <code>object</code> (because in this case we want to ensure reference equality even if some <code>==</code> overload is present).</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/595">CWE-595 - Comparison of Object References Instead of Object Contents</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/597">CWE-597 - Use of Wrong Operator in String Comparison</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Consider using "Equals" if value comparison was intended.</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_8_dec_2015_140751_tamas_vajk_wrote">on 8 Dec 2015, 14:07:51 Tamas Vajk wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] Could you check this subtask. It&#8217;s a relatively big change from the parent task.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_8_dec_2015_163502_ann_campbell_wrote">on 8 Dec 2015, 16:35:02 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>looks fine [~tamas.vajk]</p>
</div>
</div>
<div class="sect2">
<h3 id="_deprecates_s1127">deprecates: <a data-rspec-id="S1127" class="rspec-auto-link">S1127</a></h3>

</div>
<div class="sect2">
<h3 id="_is_related_to_s4973">is related to: <a data-rspec-id="S4973" class="rspec-auto-link">S4973</a></h3>

</div>
<div class="sect2">
<h3 id="_on_14_apr_2014_203957_ann_campbell_wrote">on 14 Apr 2014, 20:39:57 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>Note that there is a separate, specific rule for string comparisons. Should this rule ignore strings?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_20_may_2014_151638_ann_campbell_wrote">on 20 May 2014, 15:16:38 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>In Python, the "==" operator is supposed to compare values, not identities.</p>
</div>
<div class="paragraph">
<p><a href="http://stackoverflow.com/a/1504742" class="bare">http://stackoverflow.com/a/1504742</a></p>
</div>
<div class="paragraph">
<p><a href="http://www.rafekettler.com/magicmethods.html#operators" class="bare">http://www.rafekettler.com/magicmethods.html#operators</a></p>
</div>
<div class="paragraph">
<p>This rule therefore cannot be applied to Python.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_13_jun_2014_071729_nicolas_peru_wrote">on 13 Jun 2014, 07:17:29 Nicolas Peru wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] String comparison rule works only for comparison with a String literal. I think that this rule should cover strings and once it is implemented the other one should be deprecated.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_2_feb_2015_204052_sébastien_gioria_wrote">on 2 Feb 2015, 20:40:52 Sébastien Gioria wrote:</h3>
<div class="paragraph">
<p>Rule : CERT  EXP03-J</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_3_feb_2015_203100_ann_campbell_wrote">on 3 Feb 2015, 20:31:00 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>Thanks [~sebastien.gioria]</p>
</div>
</div>
</div>
</div>