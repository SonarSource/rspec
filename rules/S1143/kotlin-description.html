<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Using <code>break</code>, <code>continue</code>, <code>return</code> and <code>throw</code> inside of a <code>finally</code> block suppresses the propagation of any unhandled <code>Throwable</code> thrown in the <code>try</code> or <code>catch</code> block.</p>
</div>
<div class="paragraph">
<p>This rule raises an issue when a jump statement (<code>break</code>, <code>continue</code>, <code>return</code>, <code>throw</code>) would force control flow to leave a <code>finally</code> block.</p>
</div>
<div class="sect2">
<h3 id="_noncompliant_code_example">Noncompliant code example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">fun main() {
    try {
        doSomethingWhichThrowsException(5)
        println("OK") // incorrect "OK" message is printed
    } catch (e: RuntimeException) {
        println("ERROR") // this message is not shown
    }
    try {
        doSomethingThatAlsoThrowsException(5)
        println("OK") // incorrect "OK" message is printed
    } catch (e: RuntimeException) {
        println("ERROR") // this message is not shown
    }
}

fun doSomethingWhichThrowsException(q: Int) {
    try {
        throw RuntimeException()
    } finally {
        //...
        if (someOtherCondition) {
            return  // Noncompliant - prevents the RuntimeException from being propagated
        }
        if (aLastConditionIsVerified) {
            throw IllegalStateException()  // Noncompliant - prevents the RuntimeException from being propagated
        }
    }
}

fun doSomethingThatAlsoThrowsException(q: Int) {
    while (someConditionIsVerified) {
        try {
            throw RuntimeException()
        } finally {
            //...
            if (someOtherCondition) {
                continue  // Noncompliant - prevents the RuntimeException from being propagated
            }
            break  // Noncompliant - prevents the RuntimeException from being propagated
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_compliant_solution">Compliant solution</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">fun main() {
    try {
        doSomethingWhichThrowsException()
        println("OK")
    } catch (e: RuntimeException) {
        println("ERROR") // prints "ERROR" as expected
    }
}

fun doSomethingWhichThrowsException(q: Int) {
    try {
        throw RuntimeException()
    } finally {
        while (someConditionIsVerified) {
            //...
            if (someOtherCondition) {
                continue  // Compliant - does not prevent the RuntimeException from being propagated

            }
            break  // compliant - does not prevent the RuntimeException from being propagated
        }
    }
}</code></pre>
</div>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_25_jul_2013_164513_freddy_mallet_wrote">on 25 Jul 2013, 16:45:13 Freddy Mallet wrote:</h3>
<div class="paragraph">
<p>Is implemented by SONARJAVA-231</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_27_feb_2015_101100_freddy_mallet_wrote">on 27 Feb 2015, 10:11:00 Freddy Mallet wrote:</h3>
<div class="paragraph">
<p>FYI @Ann, in the Klockwork java analyser, this rule is associated to OWASP Top 10 A5 category: http://docs.klocwork.com/Insight-10.0/Checkers:JD.FINRET</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_27_feb_2015_134237_ann_campbell_wrote">on 27 Feb 2015, 13:42:37 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~freddy.mallet] I find the association tenuous at best.</p>
</div>
</div>
</div>
</div>