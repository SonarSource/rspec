<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>finally</code> block is a part of a <code>try&#8230;&#8203;catch&#8230;&#8203;finally</code> statement, which allows you to handle errors and perform cleanup operations regardless of whether an exception is thrown or not. The <code>finally</code> block is executed regardless of whether an exception occurs or not, and it is placed after the <code>try</code> and <code>catch</code> blocks.</p>
</div>
<div class="paragraph">
<p>Having a jump statement, such as <code>return</code>, <code>break</code>, <code>continue</code>, or <code>throw</code>, inside a <code>finally</code> block can lead to unexpected and undesirable behavior, making your code difficult to understand and maintain. While it&#8217;s not inherently forbidden to use jump statements in <code>finally</code> blocks, it is generally discouraged for the following reasons:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The primary purpose of the <code>finally</code> block is to ensure cleanup operations and code that must run regardless of the outcome, such as releasing resources or closing connections. If you use a <code>return</code> statement inside the finally block, it will override any previous <code>return</code> statements in the <code>try</code> or <code>catch</code> blocks. This can lead to unexpected values being returned from a function.</p>
</li>
<li>
<p>Jump statements like <code>break</code>, <code>continue</code>, or even another <code>throw</code> inside the <code>finally</code> block can alter the normal control flow of the program. This can make it difficult to reason about the behavior of the code and may introduce subtle bugs that are hard to detect.</p>
</li>
<li>
<p>If a <code>return</code> or <code>throw</code> statement inside the <code>finally</code> block causes a new exception or alters the return value, it can hide or suppress the original exception or return value from the <code>try</code> or <code>catch</code> blocks. This can make it challenging to identify the actual cause of an error.</p>
</li>
<li>
<p>Code that uses jump statements in <code>finally</code> blocks can be hard to read and understand, especially for other developers who might not be familiar with the unusual control flow. Such code can lead to maintenance issues and make it harder to debug and maintain the application in the long run.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This rule reports on all usages of jump statements from a <code>finally</code> block. Even if it&#8217;s guaranteed that no unhandled exception can happen in <code>try</code> or <code>catch</code> blocks, it&#8217;s not recommended to use any jump statements inside the <code>finally</code> block to have the logic there limited to the "cleanup".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">async function foo() {
    let result, connection;
    try {
        connection = await connect();
        result = connection.send(1);
    } catch(err) {
        console.error(err.message);
    } finally {
        if (connection) {
            connection.close();
        }
        return result; // Noncompliant: Jump statement 'return' in the 'finally' block
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>While there might be rare cases where using jump statements in a <code>finally</code> block is necessary, it&#8217;s generally recommended to avoid it whenever possible. Instead, use the <code>finally</code> block only for cleanup operations and critical tasks that should always be executed, regardless of exceptions or return values.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">async function foo() {
    let result, connection;
    try {
        connection = await connect();
        result = connection.send(1);
    } catch(err) {
        console.error(err.message);
    } finally {
        if (connection) {
            connection.close();
        }
    }
    return result;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://eslint.org">eslint</a> - Rule <a href="https://eslint.org/docs/latest/rules/no-unsafe-finally">no-unsafe-finally</a></p>
</li>
<li>
<p>MDN web docs - <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/try...catch#the_finally_block">The <code>finally</code> block</a></p>
</li>
<li>
<p>MDN web docs - <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/try...catch"><code>try...catch</code></a></p>
</li>
<li>
<p>MDN web docs - <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/return"><code>return</code></a></p>
</li>
<li>
<p>MDN web docs - <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/throw"><code>throw</code></a></p>
</li>
<li>
<p>MDN web docs - <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/break"><code>break</code></a></p>
</li>
<li>
<p>MDN web docs - <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/continue"><code>continue</code></a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Remove this "xxx" statement from this "finally" block.</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_25_jul_2013_164513_freddy_mallet_wrote">on 25 Jul 2013, 16:45:13 Freddy Mallet wrote:</h3>
<div class="paragraph">
<p>Is implemented by SONARJAVA-231</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_27_feb_2015_101100_freddy_mallet_wrote">on 27 Feb 2015, 10:11:00 Freddy Mallet wrote:</h3>
<div class="paragraph">
<p>FYI @Ann, in the Klockwork java analyser, this rule is associated to OWASP Top 10 A5 category: http://docs.klocwork.com/Insight-10.0/Checkers:JD.FINRET</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_27_feb_2015_134237_ann_campbell_wrote">on 27 Feb 2015, 13:42:37 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~freddy.mallet] I find the association tenuous at best.</p>
</div>
</div>
</div>
</div>