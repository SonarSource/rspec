<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When <code>~</code> and <code>&lt;&lt;</code> are applied to small integer types (<code>unsigned char</code> or <code>unsigned short</code>), the operations are preceded by integral promotion, and the result may contain high-order bits which have not been anticipated.</p>
</div>
<div class="sect2">
<h3 id="_noncompliant_code_example">Noncompliant code example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">unsigned char port = 0x5aU;
unsigned char result_8;
unsigned short result_16;
unsigned short mode;
result_8 = (~port) &gt;&gt; 4; // Noncompliant; '~port' is 0xFFA5 on a 16-bit machine but 0xFFFFFFA5 on a 32-bit machine. Result is 0xFA for both, but 0x0A may have been expected.
result_16 = ((port &lt;&lt; 4) &amp; mode) &gt;&gt; 6; // Noncompliant; result_16 value depends on the implemented size of an int.</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_compliant_solution">Compliant solution</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">result_8 = ((unsigned char)(~port)) &gt;&gt; 4; // Compliant
result_16 = ((unsigned short)((unsigned short) port &lt;&lt; 4) &amp; mode) &gt;&gt; 6; // Compliant</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>MISRA C 2004, 10.5 - If the bitwise operators ~ and &lt;&lt; are applied to an operand of <em>underlying type</em> unsigned char or unsigned short, the result shall be immediately cast to the <em>underlying type</em> of the operand.</p>
</li>
<li>
<p>MISRA C&#43;&#43; 2008, 5-0-10 - If the bitwise operators ~ and &lt;&lt; are applied to an operand with an <em>underlying type</em> of unsigned char or unsigned short, the result shall be immediately cast to the <em>underlying type</em> of the operand.</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Add an explicit cast to the result of the 'x' operator.</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_relates_to_s5451">relates to: <a data-rspec-id="S5451" class="rspec-auto-link">S5451</a></h3>

</div>
<div class="sect2">
<h3 id="_on_21_oct_2014_183406_ann_campbell_wrote">on 21 Oct 2014, 18:34:06 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~samuel.mercier] please</p>
</div>
<div class="ulist">
<ul>
<li>
<p>move the code commentary into the code in the form of comments if needed</p>
</li>
</ul>
</div>
</div>
</div>
</div>