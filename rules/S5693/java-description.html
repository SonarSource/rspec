<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Rejecting requests with significant content length is a good practice to control the network traffic intensity and thus resource consumption in order to prevent DoS attacks.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ask_yourself_whether">Ask Yourself Whether</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>size limits are not defined for the different resources of the web application.</p>
</li>
<li>
<p>the web application is not protected by <a href="https://en.wikipedia.org/wiki/Rate_limiting">rate limiting</a> features.</p>
</li>
<li>
<p>the web application infrastructure has limited resources.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There is a risk if you answered yes to any of those questions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_recommended_secure_coding_practices">Recommended Secure Coding Practices</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>For most of the features of an application, it is recommended to limit the size of requests to:</p>
<div class="ulist">
<ul>
<li>
<p>lower or equal to 8mb for file uploads.</p>
</li>
<li>
<p>lower or equal to 2mb for other requests.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is recommended to customize the rule with the limit values that correspond to the web application.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sensitive_code_example">Sensitive Code Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>With default limit value of 8388608 (8MB).</p>
</div>
<div class="paragraph">
<p>A 100 MB file is allowed to be uploaded:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Bean(name = "multipartResolver")
public CommonsMultipartResolver multipartResolver() {
  CommonsMultipartResolver multipartResolver = new CommonsMultipartResolver();
  multipartResolver.setMaxUploadSize(104857600); // Sensitive (100MB)
  return multipartResolver;
}

@Bean(name = "multipartResolver")
public CommonsMultipartResolver multipartResolver() {
  CommonsMultipartResolver multipartResolver = new CommonsMultipartResolver(); // Sensitive, by default if maxUploadSize property is not defined, there is no limit and thus it's insecure
  return multipartResolver;
}

@Bean
public MultipartConfigElement multipartConfigElement() {
  MultipartConfigFactory factory = new MultipartConfigFactory(); // Sensitive, no limit by default
  return factory.createMultipartConfig();
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>File upload size is limited to 8 MB:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Bean(name = "multipartResolver")
public CommonsMultipartResolver multipartResolver() {
  multipartResolver.setMaxUploadSize(8388608); // Compliant (8 MB)
  return multipartResolver;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a></p>
</li>
<li>
<p><a href="https://cheatsheetseries.owasp.org/cheatsheets/Denial_of_Service_Cheat_Sheet.html">Owasp Cheat Sheet</a> - Owasp Denial of Service Cheat Sheet</p>
</li>
<li>
<p>OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security Misconfiguration</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/770">CWE-770 - Allocation of Resources Without Limits or Throttling</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/400">CWE-400 - Uncontrolled Resource Consumption</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Make sure the content length limit is safe here.</p>
</div>
</div>
<div class="sect2">
<h3 id="_parameters">Parameters</h3>
<div class="sidebarblock">
<div class="content">
<div class="title">fileUploadSizeLimit</div>
<div class="paragraph">
<p><em>integer</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre>8388608</pre>
</div>
</div>
<div class="paragraph">
<p>The maximum size of HTTP requests handling file uploads (in bytes)</p>
</div>
</div>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_17_feb_2021_113517_andrei_epure_wrote">on 17 Feb 2021, 11:35:17 Andrei Epure wrote:</h3>
<div class="paragraph">
<p>\[~pierre-loup.tristant], [~csaba.sagi] - based on googling, I see that 8 MB are 8388608 bytes (<a href="https://convertlive.com/u/convert/megabytes/to/bytes#8">source</a>)</p>
</div>
<div class="paragraph">
<p>Even if we set in the default param to 8000000 to be more readable, internally shouldn&#8217;t we account that people may use the <code>8388608</code> value as well?</p>
</div>
<div class="paragraph">
<p>(sorry, this was meant for the C# flavor, but it&#8217;s relevant for the rule in general)</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_17_feb_2021_142054_pierre_loup_tristant_wrote">on 17 Feb 2021, 14:20:54 Pierre-Loup Tristant wrote:</h3>
<div class="paragraph">
<p>\[~andrei.epure] Yes we should probably use 8388608 to be consistent with the code examples or update the code examples themself. In the other and this is a rather arbitrary limit and it&#8217;s up to the user to make it what he thinks fits the best his application constraints.</p>
</div>
</div>
</div>
</div>