<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is an issue when <code>Trigger.old</code> or <code>Trigger.oldMap</code> are accessed without first checking if they are null or verifying the appropriate trigger context.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In Salesforce Apex triggers, <code>Trigger.old</code> and <code>Trigger.oldMap</code> contain the previous versions of records before they were modified. However, these variables are only populated during update and delete operations.</p>
</div>
<div class="paragraph">
<p>During insert operations, both <code>Trigger.old</code> and <code>Trigger.oldMap</code> are null because there are no previous versions of the records being created. Attempting to access these variables without proper null checks will result in a <code>NullPointerException</code> at runtime.</p>
</div>
<div class="paragraph">
<p>This issue commonly occurs when developers write triggers that handle multiple operations (insert, update, delete) but forget to account for the different contexts. The problem is particularly subtle because the code may work fine during testing with update operations but fail unexpectedly when insert operations are performed.</p>
</div>
<div class="paragraph">
<p>The Salesforce platform provides context variables like <code>Trigger.isUpdate</code> and <code>Trigger.isDelete</code> specifically to help developers write context-aware trigger logic. Using these variables along with null checks ensures that trigger code behaves correctly across all supported operations.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>When this issue occurs, it causes immediate runtime failures with <code>NullPointerException</code> errors. This can break critical business processes, prevent users from creating or updating records, and lead to poor user experience. In production environments, such failures can disrupt business operations and require immediate attention to resolve.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Check the trigger context and verify that old context variables are not null before accessing them. Use <code>Trigger.isUpdate</code> or <code>Trigger.isDelete</code> to ensure you&#8217;re in the correct context, and add null checks for additional safety.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-apex" data-lang="apex">trigger AccountTrigger on Account (before insert, before update) {
    for (Integer i = 0; i &lt; Trigger.new.size(); i++) {
        Account newAcc = Trigger.new[i];
        Account oldAcc = Trigger.old[i]; // Noncompliant: null during insert
        if (newAcc.Name != oldAcc.Name) {
            // Logic here
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-apex" data-lang="apex">trigger AccountTrigger on Account (before insert, before update) {
    for (Integer i = 0; i &lt; Trigger.new.size(); i++) {
        Account newAcc = Trigger.new[i];
        if (Trigger.isUpdate &amp;&amp; Trigger.old != null) {
            Account oldAcc = Trigger.old[i];
            if (newAcc.Name != oldAcc.Name) {
                // Logic here
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Salesforce Apex Trigger Context Variables - <a href="https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/apex_triggers_context_variables.htm">Official documentation on trigger context variables including Trigger.old and Trigger.oldMap</a></p>
</li>
<li>
<p>Apex Triggers Best Practices - <a href="https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/apex_triggers_best_practices.htm">Best practices for writing robust and efficient Apex triggers</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>