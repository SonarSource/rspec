<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This rule raises an issue when a shell script executes a command without checking its exit code, potentially allowing the script to continue even when the command fails.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In shell scripts, commands can fail for various reasons: missing files, insufficient permissions, network issues, or invalid arguments. When a command fails, it returns a non-zero exit code to indicate the failure.</p>
</div>
<div class="paragraph">
<p>By default, shell scripts continue executing subsequent commands even when a previous command fails. This behavior can lead to several problems:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Silent failures</strong>: Critical operations may fail without the script or user being aware of it</p>
</li>
<li>
<p><strong>Cascading errors</strong>: Later commands may operate on invalid or missing data from failed earlier commands</p>
</li>
<li>
<p><strong>Inconsistent state</strong>: The system may be left in an unexpected or corrupted state</p>
</li>
<li>
<p><strong>Difficult debugging</strong>: Issues may only surface much later, making it hard to trace back to the original failure</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, if a script fails to download a file but continues to process it, the processing will likely fail in unexpected ways. Or if a database backup command fails but the script continues to delete old backups, you might lose data without realizing the new backup never completed.</p>
</div>
<div class="paragraph">
<p>Proper exit code checking allows scripts to detect failures immediately and take appropriate action, such as logging errors, cleaning up resources, or terminating execution safely.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>Scripts may continue executing after critical commands fail, leading to data corruption, incomplete operations, or systems being left in inconsistent states. This can result in production outages, data loss, or security vulnerabilities that are difficult to diagnose.</p>
</div>
</div>
<div class="sect2">
<h3 id="_how_to_fix">How to fix?</h3>
<div class="paragraph">
<p>Check the exit code using the special variable <code>$?</code> immediately after the command. Use an if statement to handle failures appropriately.</p>
</div>
<div class="sect3">
<h4 id="_non_compliant_code_example">Non-compliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">#!/bin/bash
cp important_file.txt /backup/
echo "Backup completed successfully"</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_code_example">Compliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">#!/bin/bash
cp important_file.txt /backup/
if [ $? -ne 0 ]; then
    echo "Error: Failed to backup important_file.txt"
    exit 1
fi
echo "Backup completed successfully"</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Bash Manual - Exit Status - <a href="https://www.gnu.org/software/bash/manual/html_node/Exit-Status.html">Official documentation on exit status handling in Bash</a></p>
</li>
<li>
<p>Advanced Bash-Scripting Guide - Exit Codes - <a href="https://tldp.org/LDP/abs/html/exit-status.html">Comprehensive guide to exit codes and error handling in shell scripts</a></p>
</li>
<li>
<p>ShellCheck Wiki - Error Handling - <a href="https://github.com/koalaman/shellcheck/wiki/Checks#error-handling">Best practices for error handling in shell scripts</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_standards">Standards</h3>
<div class="ulist">
<ul>
<li>
<p>CWE-754: Improper Check for Unusual or Exceptional Conditions - <a href="https://cwe.mitre.org/data/definitions/754.html">Failure to properly handle exceptional conditions can lead to unexpected behavior</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>