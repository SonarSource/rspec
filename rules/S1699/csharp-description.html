<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Calling an overridable method from a constructor could result in failures or strange behaviors when instantiating a subclass which overrides the method.</p>
</div>
<div class="paragraph">
<p>When constructing an object of a derived class, the constructor of the parent class is invoked first, and only then the constructor of the derived class is called. This sequential construction process applies to multiple levels of inheritance as well, starting from the base class and progressing to the most derived class.</p>
</div>
<div class="paragraph">
<p>If an overridable method is called within the constructor of the parent class, it may inadvertently invoke an overridden implementation in the derived class. This can lead to unexpected failures or strange behaviors because the object&#8217;s construction is still in progress and may not have reached a fully initialized state. Consequently, the overridden method may rely on uninitialized members or have assumptions about the object&#8217;s state that are not yet valid.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">public class Parent
{
  public Parent()
  {
    DoSomething();  // Noncompliant
  }

  public virtual void DoSomething() // can be overridden
  {
    // ...
  }
}

public class Child : Parent
{
  private string foo;

  public Child(string foo) // leads to call DoSomething() in Parent constructor which triggers a NullReferenceException as foo has not yet been initialized
  {
    this.foo = foo;
  }

  public override void DoSomething()
  {
    Console.WriteLine(this.foo.Length);
  }
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>Child</code> class constructor starts by calling the <code>Parent</code> class constructor.</p>
</li>
<li>
<p>The <code>Parent</code> class constructor calls the method <code>DoSomething</code>, which has been overridden in the <code>Child</code> class.</p>
</li>
<li>
<p>If the behavior of the <code>Child</code> class overridden <code>DoSomething</code> method depends on fields that are initialized in the <code>Child</code> class constructor, unexpected behavior (such as a <code>NullReferenceException</code>) can result, because the fields aren&#8217;t initialized yet.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Depending on the context, you can either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>avoid calling overridable methods from constructors. This is the recommended approach</p>
</li>
<li>
<p>ensure that the method is not overridden in any derived classes. This can be done by marking the method as <code>sealed</code> in the current class</p>
</li>
<li>
<p>ensure that the class is not inherited from. This can be done by marking the class as <code>sealed</code></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">class Parent
{
  public virtual void DoSomething() { }
}

class Child : Parent
{
  public Child()
  {
    DoSomething();  // Noncompliant
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">class Parent
{
  public virtual void DoSomething() { }
}

class Child : Parent
{
  public Child()
  {
    DoSomething();  // Noncompliant
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">class Parent
{
  public virtual void DoSomething() { }
}

class Child : Parent
{
  public Child()
  {
    DoSomething();  // Noncompliant
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">class Parent
{
  public virtual void DoSomething() { }
}

class Child : Parent
{
  public Child()
  {
    // Call removed
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">class Parent
{
  public virtual void DoSomething() { }
}

class Child : Parent
{
  public Child()
  {
    DoSomething();
  }

  // Method sealed to prevent overriding
  public sealed override void DoSomething()
  {
    base.DoSomething();
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">class Parent
{
  public virtual void DoSomething() { }
}

// Class sealed to prevent inheritance
sealed class Child : Parent
{
  public Child()
  {
    DoSomething();
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Microsoft Learn - <a href="https://learn.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/constructors">Constructors</a></p>
</li>
<li>
<p>Microsoft Learn - <a href="https://learn.microsoft.com/en-us/dotnet/csharp/fundamentals/object-oriented/inheritance">Inheritance</a></p>
</li>
<li>
<p>Microsoft Learn - <a href="https://learn.microsoft.com/en-us/dotnet/csharp/fundamentals/object-oriented/polymorphism">Polimorphism</a></p>
</li>
<li>
<p>Microsoft Learn - <a href="https://learn.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/methods#method-signatures">Methods - Method signatures</a></p>
</li>
<li>
<p>Stack Overflow - Answer by Eric Lippert for <a href="https://stackoverflow.com/a/20418640">Overriding and calling same method in Base class constructor in C#</a></p>
</li>
<li>
<p>Fabulous adventures in coding - <a href="https://ericlippert.com/2008/02/15/why-do-initializers-run-in-the-opposite-order-as-constructors-part-one">Why Do Initializers Run In The Opposite Order As Constructors?</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Remove this call from a constructor to the overridable "XXXX" method.</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_23_jun_2015_074721_tamas_vajk_wrote">on 23 Jun 2015, 07:47:21 Tamas Vajk wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] Other then changing the code sample and removing the "by contract" from the first bullet point, I&#8217;ve added this rule to the SonarQube Way profile. I think this is a really useful rule, which should be enabled by default.</p>
</div>
<div class="paragraph">
<p>The main difference between C# and Java in this case is that you need to opt in for overridable methods. So you explicitly need to say that <code>DoSomething</code> is <code>virtual</code>. So in case of Java you might have just forget to add the <code>final</code> to the method, but in C# you explicitly stated that you are calling and overridable method from the constructor.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_23_jun_2015_115147_ann_campbell_wrote">on 23 Jun 2015, 11:51:47 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>looks good to me [~tamas.vajk]</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_15_mar_2016_114940_alban_auzeill_wrote">on 15 Mar 2016, 11:49:40 Alban Auzeill wrote:</h3>
<div class="paragraph">
<p>Add C&#43;&#43; Language-Specification</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_8_jun_2023_111500_cristian_ambrosini_wrote">on 8 Jun 2023, 11:15:00 Cristian Ambrosini wrote:</h3>
<div class="paragraph">
<p>During a LaYC sprint, I removed dummy implementations for the following language:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>php</p>
</li>
<li>
<p>python</p>
</li>
<li>
<p>vbnet</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is not implemented in the corresponding analyzer and there currently are no tickets open in order to do so.</p>
</div>
</div>
</div>
</div>