<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Setting capabilities can lead to privilege escalation.</p>
</div>
<div class="paragraph">
<p>Linux capabilities allow you to assign narrow slices of <code>root</code>'s permissions to files or processes. A thread with capabilities bypasses the normal kernel security checks to execute high-privilege actions such as mounting a device to a directory, without requiring (additional) root privileges.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ask_yourself_whether">Ask Yourself Whether</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Capabilities are granted:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To a process that does not require all capabilities to do its job.</p>
</li>
<li>
<p>To a not trusted process.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There is a risk if you answered yes to any of those questions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_recommended_secure_coding_practices">Recommended Secure Coding Practices</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Capabilities are high privileges, traditionally associated with superuser (root), thus make sure that the most restrictive and necessary capabilities are assigned to files and processes.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sensitive_code_example">Sensitive Code Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When setting capabilities:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">cap_t caps = cap_init();
cap_value_t cap_list[2];
cap_list[0] = CAP_FOWNER;
cap_list[1] = CAP_CHOWN;
cap_set_flag(caps, CAP_PERMITTED, 2, cap_list, CAP_SET);

cap_set_file("file", caps); // Sensitive
cap_set_fd(fd, caps); // Sensitive
cap_set_proc(caps); // Sensitive
capsetp(pid, caps); // Sensitive
capset(hdrp, datap); // Sensitive: is discouraged to be used because it is a system call</code></pre>
</div>
</div>
<div class="paragraph">
<p>When setting SUID/SGID attributes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">chmod("file", S_ISUID|S_ISGID); // Sensitive
fchmod(fd, S_ISUID|S_ISGID); // Sensitive</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a></p>
</li>
<li>
<p>OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/250">CWE-250 - Execution with Unnecessary Privileges</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/266">CWE-266 -  Incorrect Privilege Assignment</a></p>
</li>
<li>
<p><a href="https://forums.grsecurity.net/viewtopic.php?f=7&amp;t=2522">False Boundaries and Arbitrary Code Execution</a></p>
</li>
<li>
<p><a href="https://man7.org/linux/man-pages/man7/capabilities.7.html">Linux manual page</a> - capabilities(7)</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Make sure setting capabilities is safe here.</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_23_sep_2020_203818_ann_campbell_wrote">on 23 Sep 2020, 20:38:18 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~hendrik.buchwald] this description would benefit from a little background on what capabilities are. I&#8217;ve been using Linux for a long time &amp; this is my first exposure.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_24_sep_2020_154947_hendrik_buchwald_wrote">on 24 Sep 2020, 15:49:47 Hendrik Buchwald wrote:</h3>
<div class="paragraph">
<p>Updated based on Ann&#8217;s feedback.</p>
</div>
</div>
</div>
</div>