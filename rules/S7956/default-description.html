<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This rule raises an issue when trigger logic executes in update triggers without comparing current field values to previous values using <code>Trigger.oldMap</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In Salesforce, triggers fire on every DML operation, regardless of whether the fields that matter to your business logic have actually changed. This can lead to several problems:</p>
</div>
<div class="paragraph">
<p>First, unnecessary processing occurs when trigger logic runs even though no relevant field values have changed. This wastes computational resources and can impact performance, especially with large data volumes.</p>
</div>
<div class="paragraph">
<p>Second, recursion issues can arise. When workflow field updates occur during Salesforce&#8217;s order of execution, before and after update triggers fire one additional time. Without proper field comparison, this can cause duplicate processing or infinite loops.</p>
</div>
<div class="paragraph">
<p>Third, duplicate records or actions may be created. For example, if a trigger creates a Task when an Opportunity reaches 'Closed Won' status, it might create multiple Tasks due to workflow re-execution if it doesn&#8217;t check whether the stage actually changed.</p>
</div>
<div class="paragraph">
<p>Using <code>Trigger.oldMap</code> allows you to compare the current field values with their previous values. This ensures your trigger logic only executes when specific field values actually change, preventing unnecessary executions and potential recursion issues.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>Without proper field comparison, triggers may execute unnecessarily, leading to performance degradation, duplicate record creation, or infinite recursion that could hit Salesforce governor limits and cause system failures.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Compare current field values with previous values using Trigger.oldMap before executing trigger logic. Access the old record using Trigger.oldMap.get(recordId) and compare specific field values.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-apex" data-lang="apex">trigger OpportunityTrigger on Opportunity (after update) {
    for(Opportunity opp : Trigger.New) {
        // Logic executes on every update regardless of field changes
        if(opp.StageName == 'Closed Won') { // Noncompliant
            updateRelatedRecords(opp);
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-apex" data-lang="apex">trigger OpportunityTrigger on Opportunity (after update) {
    for(Opportunity opp : Trigger.New) {
        Opportunity oldOpp = Trigger.oldMap.get(opp.Id);
        // Logic only executes when Stage actually changes
        if(opp.StageName == 'Closed Won' &amp;&amp; oldOpp.StageName != 'Closed Won') {
            updateRelatedRecords(opp);
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Salesforce Trigger Context Variables - <a href="https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/apex_triggers_context_variables.htm">Official documentation on trigger context variables including Trigger.oldMap</a></p>
</li>
<li>
<p>Order of Execution in Salesforce - <a href="https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/apex_triggers_order_of_execution.htm">Understanding how workflow field updates affect trigger execution order</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_standards">Standards</h3>
<div class="ulist">
<ul>
<li>
<p>Salesforce Best Practices - <a href="https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/apex_best_practices.htm">Official Salesforce guidelines for writing efficient and maintainable Apex code</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>