<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is an issue when controllers contain complex, nested, or repetitive validation logic for form parameters instead of delegating this responsibility to dedicated form objects.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Controllers should focus on coordinating between models and views, not performing detailed parameter validation. When validation logic is embedded directly in controller actions, several problems arise:</p>
</div>
<div class="paragraph">
<p><strong>Violation of Single Responsibility Principle</strong>: Controllers become responsible for both request coordination and data validation, making them harder to understand and maintain.</p>
</div>
<div class="paragraph">
<p><strong>Code Duplication</strong>: Similar validation patterns get repeated across multiple controller actions, leading to maintenance overhead when validation rules need to change.</p>
</div>
<div class="paragraph">
<p><strong>Poor Testability</strong>: Testing validation logic mixed with controller logic requires more complex test setups and makes it harder to isolate specific validation scenarios.</p>
</div>
<div class="paragraph">
<p><strong>Reduced Reusability</strong>: Validation logic tied to specific controller actions cannot be easily reused in other parts of the application.</p>
</div>
<div class="paragraph">
<p><strong>Increased Complexity</strong>: Nested conditional statements for parameter validation make controller methods longer and harder to follow, especially when handling multiple parameters with different validation requirements.</p>
</div>
<div class="paragraph">
<p>Form objects that include <code>ActiveModel::Model</code> provide a clean solution by encapsulating validation logic in dedicated classes. This approach leverages Rails' built-in validation framework while maintaining clear separation of concerns.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>Controllers with embedded validation logic become harder to maintain and test. Code duplication increases maintenance costs when validation rules change. The lack of separation between coordination logic and validation logic makes the codebase more complex and error-prone.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Create a form object that includes ActiveModel::Model and move validation logic from the controller to this dedicated class. The controller should instantiate the form object and delegate validation responsibilities to it.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">class QueryController &lt; ApplicationController
  def results
    # Complex nested validation in controller
    if params[:name] &amp;&amp; !params[:name].blank?
      @name = params[:name]
    else
      flash[:error] = 'You must give a name' # Noncompliant
      redirect_to :action =&gt; 'index'
      return
    end

    if params.has_key?(:filter)
      if params[:filter].present?
        if ['popular', 'following'].include?(params[:filter])
          @filter = params[:filter]
        else
          flash[:error] = 'Invalid filter' # Noncompliant
          redirect_to :action =&gt; 'index'
          return
        end
      end
    end
  end
end</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">class QueryForm
  include ActiveModel::Model

  attr_accessor :name, :filter

  validates_presence_of :name, message: "You must give a name"
  validates_inclusion_of :filter, in: %w[popular following], allow_blank: true
end

class QueryController &lt; ApplicationController
  def results
    @form = QueryForm.new(params[:query])

    if @form.valid?
      @name = @form.name
      @filter = @form.filter
    else
      flash[:error] = @form.errors.full_messages.join(', ')
      redirect_to :action =&gt; 'index'
    end
  end
end</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>ActiveModel::Model Documentation - <a href="https://api.rubyonrails.org/classes/ActiveModel/Model.html">Official Rails documentation for ActiveModel::Model, which provides form object capabilities</a></p>
</li>
<li>
<p>Rails Form Objects Guide - <a href="https://guides.rubyonrails.org/form_helpers.html#dealing-with-model-objects">Rails guide covering form objects and model validation patterns</a></p>
</li>
<li>
<p>ActiveModel::Validations - <a href="https://api.rubyonrails.org/classes/ActiveModel/Validations.html">Documentation for Rails validation framework used in form objects</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_standards">Standards</h3>
<div class="ulist">
<ul>
<li>
<p>Single Responsibility Principle - <a href="https://en.wikipedia.org/wiki/Single-responsibility_principle">SOLID principle stating that a class should have only one reason to change</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>