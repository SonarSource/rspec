<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Open redirection occurs when an application uses user-controllable data to build URLs used during redirects.</p>
</div>
<div class="paragraph">
<p>An attacker with malicious intent could manipulate a user to browse into a specially crafted URL, such as <code>https://trusted.example.com/redirect?url=evil.com</code>, to redirect the victim to their evil domain.</p>
</div>
<div class="paragraph">
<p>Open redirection is most often used to trick users into browsing to a malicious domain that they believe is safe. As such, attackers commonly use open redirect exploits in mass phishing campaigns.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>An attacker can use this vulnerability to redirect a user from a trusted domain to a malicious domain controlled by the attacker. At that point, the attacker can perform various attacks, such as phishing.</p>
</div>
<div class="paragraph">
<p>Below are some scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
</div>
<div class="sect3">
<h4 id="_phishing">Phishing</h4>
<div class="paragraph">
<p>Suppose the attacker creates a malicious website that mirrors the interface of the trusted website. In that case, they can use the open redirect vulnerability to lead the user to this malicious site.</p>
</div>
<div class="paragraph">
<p>Due to the similarity in the application appearance and the supposedly trustable hyperlink, the user fails to identify that they are browsing on a malicious domain. From here, an attacker can capture the user&#8217;s credentials, bypass Multi-Factor Authentication (MFA), and take over the user&#8217;s account on the trusted website.</p>
</div>
</div>
<div class="sect3">
<h4 id="_malware_distribution">Malware distribution</h4>
<div class="paragraph">
<p>By leveraging the domain mirroring technique explained above, the attacker could also create a website that hosts malware. A user who is unaware of the redirection from a trusted website to this malicious website might then download and execute the attacker&#8217;s malware. In the worst case, this can lead to a complete system compromise for the user.</p>
</div>
</div>
<div class="sect3">
<h4 id="_javascript_injection_xss">JavaScript injection (XSS)</h4>
<div class="paragraph">
<p>In certain circumstances, an attacker can use DOM-based open redirection to execute JavaScript code. This can lead to further exploitation in the trusted domain and has consequences such as the compromise of the user&#8217;s account.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it_in_dom_api">How to fix it in DOM API</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="paragraph">
<p>The following noncompliant code example is vulnerable to open redirection as it constructs a URL with user-controllable data. This URL is then used to redirect the user without being first validated. An attacker can leverage this to manipulate users into performing unwanted redirects.</p>
</div>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="paragraph">
<p>The following example is vulnerable to open redirection through the following URL: <code>https://example.com/redirect?url=https://evil.com</code>;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const queryParams = new URLSearchParams(document.location.search);
const redirectUrl = queryParams.get("url");
document.location = redirectUrl; // Noncompliant</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const queryParams = new URLSearchParams(document.location.search);
const redirectUrl = queryParams.get("url");

if (redirectUrl.startsWith("https://www.example.com/")) {
    document.location = redirectUrl;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_how_does_this_work">How does this work?</h3>
<div class="paragraph">
<p>Most client-side frameworks, such as <code>Vue.js</code> or <code>React.js</code>, provide built-in redirection methods. Those should be preferred as they often provide additional security mechanisms. However, these built-in methods are usually engineered for internal page redirections. Thus, they might not solve the reader&#8217;s use case.</p>
</div>
<div class="paragraph">
<p>In case the application strictly requires external redirections based on user-controllable data, the following should be done instead:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Validating the <code>authority</code> part of the URL against a statically defined value (see Pitfalls.)</p>
</li>
<li>
<p>Using an allowlist approach in case the destination URLs are multiple but limited.</p>
</li>
<li>
<p>Adding a dynamic confirmation dialog, warning about the imminent action and requiring manual authorization to proceed to the actual redirection.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_pitfalls">Pitfalls</h3>
<div class="sect3">
<h4 id="_the_trap_of_string_startswith_and_equivalents">The trap of <code>String.startsWith</code> and equivalents</h4>
<div class="paragraph">
<p>When validating untrusted URLs by checking if they start with a trusted scheme and authority pair <code>scheme://authority</code>, <strong>ensure that the validation string contains a path separator character (i.e., a <code>/</code>) as the last character</strong>.</p>
</div>
<div class="paragraph">
<p>When this character is not present, attackers may be able to register a specific domain name that both passes validation and is controlled by them.</p>
</div>
<div class="paragraph">
<p>For example, when validating the <code>https://example.com</code> domain, suppose an attacker owns the <code>https://example.evil</code> domain. If the prefix-based validation is implemented incorrectly, they could create a <code>https://example.com.example.evil</code> subdomain to abuse the broken validation.</p>
</div>
<div class="paragraph">
<p>The practice of taking over domains that maliciously look like existing domains is widespread and is called <a href="https://en.wikipedia.org/wiki/Cybersquatting">cybersquatting</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_standards">Standards</h3>
<div class="ulist">
<ul>
<li>
<p>OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a></p>
</li>
<li>
<p>OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/601">CWE-601 - URL Redirection to Untrusted Site ('Open Redirect')</a></p>
</li>
<li>
<p>STIG Viewer - <a href="https://stigviewer.com/stigs/application_security_and_development/2024-12-06/finding/V-222609">Application Security and Development: V-222609</a> - The application must not be subject to input handling vulnerabilities.</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Change this code to not perform client-side redirection based on user-controlled data.</p>
</div>
<hr>
</div>
</div>
</div>