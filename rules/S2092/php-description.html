<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When a cookie is protected with the <code>secure</code> attribute set to <em>true</em> it will not be send by the browser over an unencrypted HTTP request and thus cannot be observed by an unauthorized person during a man-in-the-middle attack.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ask_yourself_whether">Ask Yourself Whether</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>the cookie is for instance a <em>session-cookie</em>  not designed to be sent over non-HTTPS communication.</p>
</li>
<li>
<p>it&#8217;s not sure that the website contains <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Mixed_content">mixed content</a> or not (ie HTTPS everywhere or not)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There is a risk if you answered yes to any of those questions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_recommended_secure_coding_practices">Recommended Secure Coding Practices</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>It is recommended to use <code>HTTPs</code> everywhere so setting the <code>secure</code> flag to <em>true</em> should be the default behaviour when creating cookies.</p>
</li>
<li>
<p>Set the <code>secure</code> flag to <em>true</em> for session-cookies.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sensitive_code_example">Sensitive Code Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In <em>php.ini</em> you can specify the flags for the session cookie which is security-sensitive:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>session.cookie_secure = 0; // Sensitive: this security-sensitive session cookie is created with the secure flag set to false (cookie_secure = 0)</pre>
</div>
</div>
<div class="paragraph">
<p>Same thing in PHP code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>session_set_cookie_params($lifetime, $path, $domain, false);
// Sensitive: this security-sensitive session cookie is created with the secure flag (the fourth argument) set to _false_</pre>
</div>
</div>
<div class="paragraph">
<p>If you create a custom security-sensitive cookie in your PHP code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$value = "sensitive data";
setcookie($name, $value, $expire, $path, $domain, false);  // Sensitive: a security-sensitive cookie is created with the secure flag  (the sixth argument) set to _false_</pre>
</div>
</div>
<div class="paragraph">
<p>By default <a href="https://www.php.net/manual/en/function.setcookie.php"><code>setcookie</code></a> and <a href="https://www.php.net/manual/en/function.setrawcookie.php"><code>setrawcookie</code></a> functions set the sixth argument / <code>secure</code> flag to <em>false:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre>$value = "sensitive data";
setcookie($name, $value, $expire, $path, $domain);  // Sensitive: a security-sensitive cookie is created with the secure flag (the sixth argument) not defined (by default to false)
setrawcookie($name, $value, $expire, $path, $domain);  // Sensitive: a security-sensitive cookie is created with the secure flag (the sixth argument) not defined (by default to false)</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">session.cookie_secure = 1; // Compliant: the sensitive cookie will not be send during an unencrypted HTTP request thanks to cookie_secure property set to 1</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">session_set_cookie_params($lifetime, $path, $domain, true); // Compliant: the sensitive cookie will not be send during an unencrypted HTTP request thanks to the secure flag (the fouth argument) set to true</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">$value = "sensitive data";
setcookie($name, $value, $expire, $path, $domain, true); // Compliant: the sensitive cookie will not be send during an unencrypted HTTP request thanks to the secure flag (the sixth  argument) set to true
setrawcookie($name, $value, $expire, $path, $domain, true);// Compliant: the sensitive cookie will not be send during an unencrypted HTTP request thanks to the secure flag (the sixth argument) set to true</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a></p>
</li>
<li>
<p>OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a></p>
</li>
<li>
<p>OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data Exposure</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/315">CWE-315 - Cleartext Storage of Sensitive Information in a Cookie</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/614">CWE-614 - Sensitive Cookie in HTTPS Session Without 'Secure' Attribute</a></p>
</li>
<li>
<p>STIG Viewer - <a href="https://stigviewer.com/stigs/application_security_and_development/2024-12-06/finding/V-222576">Application Security and Development: V-222576</a> - The application must set the secure flag on session cookies.</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>php.ini file: Make sure creating the session cookie without the "secure" flag is safe here.</p>
</div>
<div class="paragraph">
<p>php files: Make sure creating this cookie without the "secure" flag is safe here.</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_18_oct_2016_163044_pierre_yves_nicolas_wrote">on 18 Oct 2016, 16:30:44 Pierre-Yves Nicolas wrote:</h3>
<div class="paragraph">
<p>By default, cookies are not secured. It seems that there are several ways to have an impact on that behavior:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>through a php.ini configuration: <a href="http://php.net/manual/en/session.configuration.php#ini.session.cookie-secure">session.cookie_secure</a></p>
</li>
<li>
<p>by changing the configuration inside PHP code with <a href="http://php.net/manual/en/function.session-set-cookie-params.php">session_set_cookie_params</a></p>
</li>
<li>
<p>when creating a cookie in PHP code: <a href="http://php.net/manual/en/function.setcookie.php">setcookie </a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_on_18_oct_2016_165147_pierre_yves_nicolas_wrote">on 18 Oct 2016, 16:51:47 Pierre-Yves Nicolas wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] Could you please review this PHP subtask?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_18_oct_2016_200428_ann_campbell_wrote">on 18 Oct 2016, 20:04:28 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>Looks fine [~pierre-yves.nicolas], but wouldn&#8217;t a variable named $cookie_security be clearer &amp; allow shorter comments?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_20_oct_2016_171859_pierre_yves_nicolas_wrote">on 20 Oct 2016, 17:18:59 Pierre-Yves Nicolas wrote:</h3>
<div class="paragraph">
<p>Sorry [~ann.campbell.2], I don&#8217;t see how that variable would be used.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_20_oct_2016_184423_ann_campbell_wrote">on 20 Oct 2016, 18:44:23 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~pierre-yves.nicolas] like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>; php.ini
session.cookie_secure = 0 ; Noncompliant

$session_cookie_secure = false;
// in PHP code
session_set_cookie_params($lifetime, $path, $domain, $session_cookie_secure); // Noncompliant

setcookie ($name, $value, $expire, $path, $domain, $session_cookie_secure); // Noncompliant</pre>
</div>
</div>
<div class="paragraph">
<p>I&#8217;m trying to make the code itself more self-explanatory</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_21_oct_2016_081940_pierre_yves_nicolas_wrote">on 21 Oct 2016, 08:19:40 Pierre-Yves Nicolas wrote:</h3>
<div class="paragraph">
<p>I now understand [~ann.campbell.2]. Of course, it&#8217;s harder to implement, and requires symbolic execution for the most general case.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_21_oct_2016_132309_ann_campbell_wrote">on 21 Oct 2016, 13:23:09 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>Ah. And now <em>I</em> understand.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_12_dec_2014_205833_sébastien_gioria_wrote">on 12 Dec 2014, 20:58:33 Sébastien Gioria wrote:</h3>
<div class="paragraph">
<p>This rule must apply on Session cookie but not on all cookie. SomeTime it&#8217;s not a problem to send cookie on HTTP channel</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_15_dec_2014_102432_freddy_mallet_wrote">on 15 Dec 2014, 10:24:32 Freddy Mallet wrote:</h3>
<div class="paragraph">
<p>I see your point [~sebastien.gioria] but for the time being we don&#8217;t see anyway to know exactly what is the type of cookie.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_2_jun_2015_092527_sébastien_gioria_wrote">on 2 Jun 2015, 09:25:27 Sébastien Gioria wrote:</h3>
<div class="paragraph">
<p>I could be at OWASP-top10-A6 and OWASP-Top10-A2</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_3_jun_2015_203551_ann_campbell_wrote">on 3 Jun 2015, 20:35:51 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>Thanks [~sebastien.gioria]. A6 was already listed, but I&#8217;ve added A2.</p>
</div>
</div>
</div>
</div>