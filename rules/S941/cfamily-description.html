<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Outside of the context of an array, explicitly calculating a pointer value will almost never yield the intended result. Even variables declared in the same statement should not be assumed to inhabit sequential memory addresses.</p>
</div>
<div class="paragraph">
<p>Using an explicitly calculated pointer will have unexpected runtime results as you either read or modify the wrong memory addresses.</p>
</div>
<div class="paragraph">
<p>Within limits, array indexes are an acceptable form of pointer math <em>when</em> the pointer in question is an array pointer <em>and</em> the array does not hold polymorphic objects/structs.</p>
</div>
<div class="sect2">
<h3 id="_noncompliant_code_example">Noncompliant code example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">void f(char *c) {
  int i = 0;
  int j = 0;
  int *p1 = &amp;i + 1; // Noncompliant: arithmetic not allowed
  int *p2 = &amp;i;
  p2++; // Noncompliant. Presumably intended to point to j. No guarantee that it does.

  char c2 = c[1];  // Noncompliant; not an array context
  char *c3 = c + 1; // Noncompliant: arithmetic not allowed
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_exceptions">Exceptions</h3>
<div class="paragraph">
<p>Because it can be convenient to treat an array as a contiguous set of memory addresses, the increment operator (<code>&#43;&#43;</code>) is allowed in an array context.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">char message[] = "Hello world";  // implicitly null-terminated
char *p;

for (p = message; *p; p++) {  // Compliant
  // do something;
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>MISRA C:2004, 17.1</p>
</li>
<li>
<p>MISRA C:2004, 17.2</p>
</li>
<li>
<p>MISRA C:2004, 17.4</p>
</li>
<li>
<p>MISRA C&#43;&#43;:2008, 5-0-15</p>
</li>
<li>
<p>MISRA C&#43;&#43;:2008, 5-0-16</p>
</li>
<li>
<p>MISRA C&#43;&#43;:2008, 5-0-17</p>
</li>
<li>
<p>MISRA C:2012, 18.1</p>
</li>
<li>
<p>MISRA C:2012, 18.2</p>
</li>
<li>
<p>MISRA C:2012, 18.4</p>
</li>
<li>
<p><a href="https://wiki.sei.cmu.edu/confluence/x/1dUxBQ">CERT, ARR37-C.</a> - Do not add or subtract an integer to a pointer to a non-array object</p>
</li>
<li>
<p><a href="https://wiki.sei.cmu.edu/confluence/x/ytYxBQ">CERT, ARR39-C.</a> - Do not add or subtract a scaled integer to a pointer</p>
</li>
<li>
<p><a href="https://wiki.sei.cmu.edu/confluence/x/o3w-BQ">CERT, CTR56-CPP.</a> - Do not use pointer arithmetic on polymorphic objects</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Do not perform arithmetic on pointers.</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_relates_to_s5410">relates to: <a data-rspec-id="S5410" class="rspec-auto-link">S5410</a></h3>

</div>
<div class="sect2">
<h3 id="_is_related_to_s939">is related to: <a data-rspec-id="S939" class="rspec-auto-link">S939</a></h3>

</div>
<div class="sect2">
<h3 id="_is_related_to_s942">is related to: <a data-rspec-id="S942" class="rspec-auto-link">S942</a></h3>

</div>
<div class="sect2">
<h3 id="_on_17_sep_2014_101812_freddy_mallet_wrote">on 17 Sep 2014, 10:18:12 Freddy Mallet wrote:</h3>
<div class="paragraph">
<p>@Ann, if my feeling is correct there is a misunderstanding somewhere because for me the main goal of those MISRA rules is to prevent any expression on pointers :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>uint8_t * p1;
uint8_t * p2;

p1++; //non compliant
p2--; //non compliant
p1 - p2; //non compliant
p1 &lt; p2; //non compliant</pre>
</div>
</div>
<div class="paragraph">
<p>The only exception is when those pointers are used to address an array element.</p>
</div>
<div class="paragraph">
<p>According to the provided code snippets, I&#8217;ve the feeling that you&#8217;re trying to cover check something else : prevent accessing to an array element outside of the known limit of the array.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_19_sep_2014_074755_ann_campbell_wrote">on 19 Sep 2014, 07:47:55 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~freddy.mallet] I had the same initial impression from reading the MISRA rule titles.</p>
</div>
<div class="paragraph">
<p>The 2004 descriptions are quite curt, but the description and code samples for the 2012 versions of the same rules are quite extensive. To your specific concern, using pointer math to access an array element outside the bounds of the array is the first thing mentioned in MISRA C:2012, 18.1.</p>
</div>
<div class="paragraph">
<p>I was very tempted to leave out much of the detail, or to try to split it into multiple rules, but in the end decided it was all integral to the same topic.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_16_feb_2015_200215_ann_campbell_wrote">on 16 Feb 2015, 20:02:15 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~evgeny.mandrikov] <a href="http://cwe.mitre.org/data/definitions/131">CWE-131</a> relates to this rule but has a broader scope (some of which is handled in <a data-rspec-id="S2613" class="rspec-auto-link">RSPEC-2613</a>). How would you like to handle? Move all access-beyond-end-of-buffer to a separate rule?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_9_oct_2019_163119_amélie_renard_wrote">on 9 Oct 2019, 16:31:19 Amélie Renard wrote:</h3>
<div class="paragraph">
<p>I have modified the rule to remove everything related to arrays out of bounds so that it does not overlap with <a href="https://jira.sonarsource.com/browse/RSPEC-3519">RSPEC-3519</a> which deals with buffer overflows in general.</p>
</div>
</div>
</div>
</div>