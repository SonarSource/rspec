<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default, GCP SQL instances offer encryption in transit, with support for TLS, but insecure connections are still accepted. On an unsecured network, such as a public network, the risk of traffic being intercepted is high. When the data isn&#8217;t encrypted, an attacker can intercept it and read confidential information.</p>
</div>
<div class="paragraph">
<p>When creating a GCP SQL instance, a public IP address is automatically assigned to it and connections to the SQL instance from public networks can be authorized.</p>
</div>
<div class="paragraph">
<p>TLS is automatically used when connecting to SQL instances through:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <a href="https://cloud.google.com/sql/docs/mysql/connect-admin-proxy">Cloud SQL Auth proxy</a>.</p>
</li>
<li>
<p>The <a href="https://cloud.google.com/sql/docs/mysql/connect-overview#languages">Java Socket Library</a>.</p>
</li>
<li>
<p>The built-in mechanisms in the <a href="https://cloud.google.com/appengine/docs">App Engine</a> environments.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ask_yourself_whether">Ask Yourself Whether</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Connections are not already automatically encrypted by GCP (eg: SQL Auth proxy) and</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Connections to the SQL instance are performed on untrusted networks.</p>
</li>
<li>
<p>The data stored in the SQL instance is confidential.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There is a risk if you answered yes to any of those questions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_recommended_secure_coding_practices">Recommended Secure Coding Practices</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It&#8217;s recommended to encrypt all connections to the SQL instance, whether using public or private IP addresses. However, since private networks can be considered trusted, requiring TLS in this situation is usually a lower priority task.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sensitive_code_example">Sensitive Code Example</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terraform" data-lang="terraform">resource "google_sql_database_instance" "example" { # Sensitive: tls is not required
  name             = "noncompliant-master-instance"
  database_version = "POSTGRES_11"
  region           = "us-central1"

  settings {
    tier = "db-f1-micro"
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terraform" data-lang="terraform">resource "google_sql_database_instance" "example" {
  name             = "compliant-master-instance"
  database_version = "POSTGRES_11"
  region           = "us-central1"

  settings {
    tier = "db-f1-micro"
    ip_configuration {
      require_ssl = true
      ipv4_enabled = true
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/79">CWE-319 - Cleartext Transmission of Sensitive Information</a></p>
</li>
<li>
<p><a href="https://cloud.google.com/sql/docs/mysql/authorize-ssl">GCP Documentation</a> - Cloud SQL: Authorizing with SSL/TLS certificates</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Make sure creating a GCP SQL instance without requiring TLS is safe here.</p>
</div>
<div class="paragraph">
<p>Omitting {parameter} allows unencrypted connections to the database. Make sure it is safe here.</p>
</div>
</div>
</div>
</div>