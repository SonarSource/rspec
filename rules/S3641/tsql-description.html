<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A <code>WHERE</code> clause condition that uses <code>NOT IN</code> with a subquery will have unexpected results if that subquery returns <code>NULL</code>. On the other hand,Â <code>NOT EXISTS</code> subqueries work reliably under the same conditions.</p>
</div>
<div class="paragraph">
<p>This rule raises an issue when <code>NOT IN</code> is used with a subquery. This rule doesn&#8217;t check if the selected column is a nullable column because the rules engine has no information about the table definition. It&#8217;s up to the developer to review manually if the column is nullable.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Use <code>NOT EXISTS</code> or <code>IS NOT NULL</code> instead of <code>NOT IN</code> when the subquery may return <code>NULL</code> values.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sql" data-lang="sql">SELECT *
FROM my_table
WHERE my_column NOT IN (SELECT nullable_column FROM another_table)  -- Noncompliant; "nullable_column" may contain 'NULL' value and the whole SELECT query will return nothing</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sql" data-lang="sql">SELECT *
FROM my_table
WHERE NOT EXISTS (SELECT 1 FROM another_table WHERE nullable_column = my_table.my_column)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sql" data-lang="sql">SELECT *
FROM my_table
WHERE my_column NOT IN (SELECT nullable_column FROM another_table WHERE nullable_column IS NOT NULL)</code></pre>
</div>
</div>
<hr>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Rewrite this to use "NOT EXISTS"; "col" is nullable.</p>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="paragraph">
<p><code>NOT IN (SELECT col</code></p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_16_jun_2016_161318_ann_campbell_wrote">on 16 Jun 2016, 16:13:18 Ann Campbell wrote:</h3>
<div class="paragraph">
<p><a href="https://www.researchgate.net/publication/222432151_Semantic_errors_in_SQL_queries_A_quite_complete_list" class="bare">https://www.researchgate.net/publication/222432151_Semantic_errors_in_SQL_queries_A_quite_complete_list</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_on_29_aug_2018_163032_alexandre_gigleux_wrote">on 29 Aug 2018, 16:30:32 Alexandre Gigleux wrote:</h3>
<div class="listingblock">
<div class="content">
<pre>CREATE TABLE TABLE1 (
         value        VARCHAR2(10)
)

CREATE TABLE TABLE2 (
         value        VARCHAR2(10)
)

INSERT INTO TABLE1 VALUES (1)
INSERT INTO TABLE1 VALUES (2)
INSERT INTO TABLE1 VALUES (NULL)
INSERT INTO TABLE2 VALUES (2)
INSERT INTO TABLE2 VALUES (NULL)

SELECT *
FROM TABLE1

SELECT *
FROM TABLE2

-- KO
SELECT *
FROM TABLE1
WHERE VALUE NOT IN (SELECT VALUE FROM TABLE2)

-- OK
SELECT *
FROM TABLE1
WHERE VALUE NOT IN (SELECT VALUE FROM TABLE2 WHERE VALUE IS NOT NULL)

-- OK
SELECT *
FROM TABLE1
WHERE NOT EXISTS (SELECT 1 FROM TABLE2 WHERE TABLE1.VALUE = TABLE2.VALUE)</pre>
</div>
</div>
</div>
</div>
</div>