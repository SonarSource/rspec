
include::../../../shared_content/secrets/description.adoc[]

== Why is this an issue?

include::../../../shared_content/secrets/rationale.adoc[]

=== What is the potential impact?

Access keys are used to authenticate to Azure Event Grid resources and can be
employed for event publication to the resource.

Shared Access Secrets (SAS) are generated from access keys and used to
authenticate specific resources with particular permissions within a defined
time frame. +
Despite their risk reduction on the overall infrastructure, hardcoding them
exposes them to exploitation to access the resource. This is a risk, unless the
whole resource is free of sensitive data.

*Please note* that the Microsoft docs can use different terminologies for these
two tokens:

* Access Keys are also called SAS keys
* Shared Access Secrets are also called SAS tokens

Below are some real-world scenarios that illustrate some impacts of an attacker
exploiting these types of secrets.

// Set value that can be used to refer to the type of secret in, for example:
// "An attacker can use this {secret_type} to ..."
:secret_type: secret

// Where possible, use predefined content for common impacts. This content can
// be found in the folder "shared_content/secrets/impact".
// When using predefined content, search for any required variables to be set and include them in this file.
// Not adding them will not trigger warnings.

include::../../../shared_content/secrets/impact/non_repudiation.adoc[]

include::../../../shared_content/secrets/impact/data_compromise.adoc[]

include::../../../shared_content/secrets/impact/financial_loss.adoc[]

== How to fix it

include::../../../shared_content/secrets/fix/revoke.adoc[]

include::../../../shared_content/secrets/fix/vault.adoc[]

On top of that, use the Azure SDK as much as possible and their diverse
credential objects.

=== Code examples

==== Noncompliant code example

For Shared Access Secrets:

[source,python]
----
topic_endpoint = "https://example.westeurope-1.eventgrid.azure.net/api/events"

headers = {
    "aeg-sas-token": "r=https%3a%2f%2fexample.westeurope-1.eventgrid.azure.net%2fapi%2fevents&e=1%2f1%2f0001%2012%3a02%3a52%20AM&s=gdcIr5dXR4dC3sNyK4Qree4XogaRma3YdtH7%2boCxSQo%3d", # Noncompliant
    "Content-Type": "application/json"
}

event_data = [{ ... }]

response = requests.post(topic_endpoint, headers=headers, data=json.dumps(event_data))
----

For Access Keys:

[source,python]
----
topic_endpoint = "https://example.westeurope-1.eventgrid.azure.net/api/events"

headers = {
    "aeg-sas-key": "vobPdVO3kYZKwbnil2IsmyrR/gTYenN4vAZEGHUfhj8=", # Noncompliant
    "Content-Type": "application/json"
}

event_data = [{ ... }]

response = requests.post(topic_endpoint, headers=headers, data=json.dumps(event_data))
----

== Resources

include::../../../shared_content/secrets/resources/standards.adoc[]

