<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This rule raises an issue when a machine learning estimator or optimizer is instantiated without specifying the important hyperparameters.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When instantiating an estimator or an optimizer, default values for any hyperparameters that are not specified will be used.
Relying on the default values can lead to non-reproducible results across different versions of the library.</p>
</div>
<div class="paragraph">
<p>Furthermore, the default values might not be the best choice for the specific problem at hand and can lead to suboptimal performance.</p>
</div>
<div class="paragraph">
<p>Here are the estimators and the parameters considered by this rule :</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Scikit-learn - Estimator</th>
<th class="tableblock halign-left valign-top">Hyperparameters</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AdaBoostClassifier</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">learning_rate</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AdaBoostRegressor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">learning_rate</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GradientBoostingClassifier</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">learning_rate</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GradientBoostingRegressor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">learning_rate</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HistGradientBoostingClassifier</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">learning_rate</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HistGradientBoostingRegressor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">learning_rate</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RandomForestClassifier</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">min_samples_leaf, max_features</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RandomForestRegressor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">min_samples_leaf, max_features</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ElasticNet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">alpha, l1_ratio</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NearestNeighbors</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n_neighbors</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">KNeighborsClassifier</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n_neighbors</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">KNeighborsRegressor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n_neighbors</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NuSVC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">nu, kernel, gamma</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NuSVR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C, kernel, gamma</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SVC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C, kernel, gamma</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SVR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C, kernel, gamma</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DecisionTreeClassifier</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ccp_alpha</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DecisionTreeRegressor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ccp_alpha</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MLPClassifier</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hidden_layer_sizes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MLPRegressor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hidden_layer_sizes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PolynomialFeatures</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">degree, interaction_only</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">PyTorch - Optimizer</th>
<th class="tableblock halign-left valign-top">Hyperparameters</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adadelta</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lr, weight_decay</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adagrad</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lr, weight_decay</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adam</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lr, weight_decay</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AdamW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lr, weight_decay</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SparseAdam</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lr</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adamax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lr, weight_decay</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ASGD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lr, weight_decay</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LBFGS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lr</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NAdam</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lr, weight_decay, momentum_decay</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RAdam</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lr, weight_decay</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RMSprop</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lr, weight_decay, momentum</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rprop</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lr</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SGD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lr, weight_decay, momentum</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it_in_scikit_learn">How to fix it in Scikit-Learn</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Specify the hyperparameters when instantiating the estimator.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from sklearn.neighbors import KNeighborsClassifier

clf = KNeighborsClassifier() # Noncompliant : n_neighbors is not specified, different values can change the behaviour of the predictor significantly</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from sklearn.neighbors import KNeighborsClassifier

clf = KNeighborsClassifier( # Compliant
    n_neighbors=5
)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it_in_pytorch">How to fix it in PyTorch</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Specify the hyperparameters when instantiating the optimizer</p>
</div>
<div class="sect2">
<h3 id="_code_examples_2">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example_2">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from my_model import model
from torch.optim import AdamW

optimizer = AdamW(model.parameters(), lr = 0.001) # Noncompliant : weight_decay is not specified, different values can change the behaviour of the optimizer significantly</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution_2">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from my_model import model
from torch.optim import AdamW

optimizer = AdamW(model.parameters(), lr = 0.001, weight_decay = 0.003) # Compliant</code></pre>
</div>
</div>
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Implementation will be quite tricky if we want to avoid false positives.</p>
</div>
<div class="paragraph">
<p>Abort if :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In a Pipeline/make_pipeline used for hyperparameter search</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="https://github.com/SERG-Delft/dslinter/blob/main/dslinter/checkers/hyperparameters_scikitlearn.py#L48-L70">List of DSLinter estimators</a>
<a href="https://github.com/SERG-Delft/dslinter/blob/main/dslinter/checkers/hyperparameters_pytorch.py">List of DSLinter optimizers</a></p>
</div>
<div class="paragraph">
<p>Possible baby step : only check for some estimators ( for exemple the meta-learners)</p>
</div>
<div class="paragraph">
<p>Ignore parameters :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>n_jobs</p>
</li>
<li>
<p>that ends in <code>param</code> ?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>With PyTorch we should check as well when an optimizer as per parameters set</p>
</div>
<div class="paragraph">
<p>optim.SGD([
    {'params': model.base.parameters(), 'lr': 1e-2},
    {'params': model.classifier.parameters()}
], lr=1e-3, momentum=0.9)</p>
</div>
<div class="paragraph">
<p>We should not raise an issue if we cannot inspect the content of the list and the dictionaries.</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>For scikit-learn estimators:
Specify important hyperparameters when instantiating a Scikit-learn estimator.</p>
</div>
<div class="paragraph">
<p>For PyTorch optimizers
Specify important hyperparameters when instantiating a PyTorch optimizer.</p>
</div>
</div>
<div class="sect2">
<h3 id="_issue_location">Issue location</h3>
<div class="paragraph">
<p>Primary : name of the estimator/optimizer</p>
</div>
<div class="paragraph">
<p>No secondary location
=== Quickfix</p>
</div>
<div class="paragraph">
<p>There is a possible quickfix : add all the missing parameters at their default values</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_articles_blog_posts">Articles &amp; blog posts</h3>
<div class="ulist">
<ul>
<li>
<p>Probst, P., Boulesteix, A. L., &amp; Bischl, B. (2019). Tunability: Importance of
Hyperparameters of Machine Learning Algorithms. Journal of Machine Learning Research,
20(53), 1-32.</p>
</li>
<li>
<p>van Rijn, J. N., &amp; Hutter, F. (2018, July). Hyperparameter importance across datasets.
In Proceedings of the 24th ACM SIGKDD International Conference on Knowledge Discovery &amp;
Data Mining (pp. 2367-2376).</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>PyTorch Documentation - <a href="https://pytorch.org/docs/stable/optim.html">torch.optim</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_external_coding_guidelines">External coding guidelines</h3>
<div class="ulist">
<ul>
<li>
<p>Code Smells for Machine Learning Applications - <a href="https://hynn01.github.io/ml-smells/posts/codesmells/11-hyperparameter-not-explicitly-set/">Hyperparameter not Explicitly Set</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>