=== Message

Refactor this function to remove the recursion.

