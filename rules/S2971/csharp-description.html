<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the interests of readability, code that can be simplified should be simplified. To that end, there are several ways <a href="https://learn.microsoft.com/en-us/dotnet/api/system.collections.generic.ienumerable-1">IEnumerable</a> language integrated queries (LINQ) can be simplified.
This not only improves readabilty but can also lead to improved performance.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Simplify the LINQ expressions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use <a href="https://learn.microsoft.com/en-us/dotnet/api/system.linq.enumerable.oftype">OfType</a> instead of <a href="https://learn.microsoft.com/en-us/dotnet/api/system.linq.enumerable.select">Select</a> with the <a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/operators/type-testing-and-cast#as-operator">as operator</a> to type cast elements and then null-checking in a query expression to choose elements based on type.</p>
</li>
<li>
<p>Use <code>OfType</code> instead of using <a href="https://learn.microsoft.com/en-us/dotnet/api/system.linq.enumerable.where">Where</a> and the <a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/operators/type-testing-and-cast#is-operator">is operator</a>, followed by a cast in a <code>Select</code></p>
</li>
<li>
<p>Use an expression in <code>Any</code> instead of <code>Where(element &#8658; [expression]).Any()</code>.</p>
</li>
<li>
<p>Use the <a href="https://learn.microsoft.com/en-us/dotnet/api/system.collections.generic.list-1.count">Count</a> or <a href="https://learn.microsoft.com/en-us/dotnet/api/system.array.length">Length</a> properties instead of the <a href="https://learn.microsoft.com/en-us/dotnet/api/system.linq.enumerable.count">Count() method</a> when it&#8217;s available (unless you use the predicate parameter of the method for filtering).</p>
</li>
<li>
<p>Don&#8217;t call <a href="https://learn.microsoft.com/en-us/dotnet/api/system.linq.enumerable.toarray">ToArray()</a> or <a href="https://learn.microsoft.com/en-us/dotnet/api/system.linq.enumerable.tolist">ToList()</a> in the middle of a query chain.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Using <a href="https://learn.microsoft.com/en-us/ef/">Entity Framework</a> may require enforcing client evaluations. Such queries should use <a href="https://learn.microsoft.com/en-us/dotnet/api/system.linq.enumerable.asenumerable">AsEnumerable()</a> instead of <code>ToArray()</code> or <code>ToList()</code> in the middle of a query chain.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">public void Foo(IEnumerable&lt;Vehicle&gt; seq, List&lt;int&gt; list)
{
    var result1 = seq.Select(x =&gt; x as Car).Any(x =&gt; x != null);               // Noncompliant; use OfType
    var result2 = seq.Select(x =&gt; x as Car).Any(x =&gt; x != null &amp;&amp; x.HasOwner); // Noncompliant; use OfType before calling Any
    var result3 = seq.Where(x =&gt; x is Car).Select(x =&gt; x as Car);              // Noncompliant; use OfType
    var result4 = seq.Where(x =&gt; x is Car).Select(x =&gt; (Car)x);                // Noncompliant; use OfType
    var result5 = seq.Where(x =&gt; x.HasOwner).Any();                            // Noncompliant; use Any([predicate])

    var num = list.Count();                                                    // Noncompliant; use the Count property
    var arr = seq.ToList().ToArray();                                          // Noncompliant; ToList is not needed
    var count = seq.ToList().Count(x =&gt; x.HasOwner);                           // Noncompliant; ToList is not needed
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">public void Foo(IEnumerable&lt;Vehicle&gt; seq, List&lt;int&gt; list)
{
    var result1 = seq.OfType&lt;Car&gt;().Any();
    var result2 = seq.OfType&lt;Car&gt;().Any(x =&gt; x.HasOwner);
    var result3 = seq.OfType&lt;Car&gt;();
    var result4 = seq.OfType&lt;Car&gt;();
    var result5 = seq.Any(x =&gt; x.HasOwner);

    var num = list.Count;
    var arr = seq.ToArray();
    var count = seq.Count(x =&gt; x.HasOwner);
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/csharp/linq">Language Integrated Queries in C#</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="ulist">
<ul>
<li>
<p>Use "OfType&lt;T&gt;()" here instead.</p>
</li>
<li>
<p>Drop "Where" and move the condition into the "Any".</p>
</li>
<li>
<p>Drop "ToArray" from the middle of the call chain.</p>
</li>
<li>
<p>Replace "ToArray" with "AsEnumerable" in the middle of the call chain.</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
</div>
</div>