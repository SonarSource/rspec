<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ownership or write permissions for a file or directory copied to the Docker image have been assigned to a user other than root.</p>
</div>
<div class="paragraph">
<p>Write permissions enable malicious actors, who have a foothold on the container,
to tamper with the resource and thus potentially manipulate the container&#8217;s expected behavior.<br>
Manipulating files could disrupt services or aid in escalating privileges inside the container.<br></p>
</div>
<div class="paragraph">
<p>This also breaches the container immutability principle as it facilitates container
changes during its life. Immutability, a container best practice, allows for a
more reliable and reproducible behavior of Docker containers.</p>
</div>
<div class="paragraph">
<p>If a user is given ownership on a file but no write permissions, the user can still modify it by using his ownership to change the file permissions first. This is why both ownership and write permissions should be avoided.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ask_yourself_whether">Ask Yourself Whether</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>A non-root user owns the resource.</p>
</li>
<li>
<p>A non-root user has been granted write permissions for the resource.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There is a risk if you answered yes to any of these questions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_recommended_secure_coding_practices">Recommended Secure Coding Practices</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Use <code>--chmod</code> to change the permissions so that only root users can write to files.</p>
</li>
<li>
<p>Use <code>--chown</code> to change the file/directory owner to a root user.</p>
</li>
<li>
<p>Be mindful of the container immutability principle.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sensitive_code_example">Sensitive Code Example</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-docker" data-lang="docker">FROM example

RUN useradd exampleuser
# Sensitive
COPY --chown=exampleuser:exampleuser src.py dst.py</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-docker" data-lang="docker">FROM example

COPY --chown=root:root --chmod=755 src.py dst.py</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.docker.com/engine/reference/builder/#add">Dockerfile reference</a> - ADD instruction</p>
</li>
<li>
<p><a href="https://docs.docker.com/engine/reference/builder/#copy">Dockerfile reference</a> - COPY instruction</p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/732">CWE-732 - Incorrect Permission Assignment for Critical Resource</a></p>
</li>
<li>
<p><a href="https://cloud.google.com/architecture/best-practices-for-operating-containers#immutability">Google Cloud, Immutability</a> - Best practices for operating containers</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Make sure no write permissions are assigned to the copied resource.</p>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="paragraph">
<p>Highlight the name of the copied resource as primary location and the chown flag/command as secondary location.</p>
</div>
<hr>
</div>
</div>
</div>