include::../description.adoc[]

include::../ask-yourself.adoc[]

include::../recommended.adoc[]

== Sensitive Code Example

The following code enables the `allowFileAccessFromFileURLs` and `allowUniversalAccessFromFileURLs` preferences.

`allowFileAccessFromFileURLs` is a sensitive preference that allows JavaScript running from the `file://` scheme to access other files in the app's sandbox, even if they were not intended to be accessible.

For example, only the `www` directory is made accessible in the code below, but JavaScript can still access other files in the app's sandbox due to the `allowFileAccessFromFileURLs` enabled.

`allowUniversalAccessFromFileURLs` is a sensitive preference that goes even further, removing the same-origin security policy in general, for both local and remote files.

[source,swift]
----
import WebKit

let webView = WKWebView()

webView.configuration.preferences.setValue(true, forKey: "allowFileAccessFromFileURLs")  // Sensitive
webView.configuration.setValue(true, forKey: "allowUniversalAccessFromFileURLs")  // Sensitive

if let url = Bundle.main.url(forResource: "index", withExtension: "html", subdirectory: "www") {
    webView.loadFileURL(url, allowingReadAccessTo: url.deletingLastPathComponent())
}
----

== Compliant Solution

By not enabling the `allowFileAccessFromFileURLs` and `allowUniversalAccessFromFileURLs` preferences, only files in the `www` directory are accessible to the `WKWebView`. It is important that this directory does not contain any sensitive files.

[source,swift]
----
import WebKit

let webView = WKWebView()

if let url = Bundle.main.url(forResource: "index", withExtension: "html", subdirectory: "www") {
    webView.loadFileURL(url, allowingReadAccessTo: url.deletingLastPathComponent())
}
----

include::../see.adoc[]

ifdef::env-github,rspecator-view[]

'''
== Implementation Specification
(visible only on this page)

include::../message.adoc[]

endif::env-github,rspecator-view[]
