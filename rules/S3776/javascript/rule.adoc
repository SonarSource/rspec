== Why is this an issue?

include::../why.adoc[]

=== What is the potential impact?

include::../impact.adoc[]

== How to fix it

include::../how.adoc[]

=== Code examples

==== Usage of null-coalescing operators

In the below code, the cognitive Complexity is increased due to the multiple checks required to access the manufacturer's name. This can be simplified using the optional chaining operator.

[source,javascript,diff-id=1,diff-type=noncompliant]
----

if (product && product.details && product.details.manufacturer) { // +1 (if) +1 (multiple condition)
    manufacturerName = product.details.manufacturer.name;
}
if (manufacturerName) { // +1 (if)
  console.log(manufacturerName);
} else {
  console.log('Manufacturer name not found');
}
----

The optional chaining operator will return `undefined` if any reference in the chain is `undefined` or `null`, avoiding multiple checks:

[source,javascript,diff-id=1,diff-type=compliant]
----

let manufacturerName = product?.details?.manufacturer?.name;

if (manufacturerName) { // +1 (if)
  console.log(manufacturerName);
} else {
  console.log('Manufacturer name not found');
}
----

==== Break down large functions.

For example, consider a function that calculates the total price of a shopping cart, including sales tax and shipping:

[source,javascript,diff-id=2,diff-type=noncompliant]
----

function calculateTotal(cart) {
  let total = 0;
  for (let i = 0; i < cart.length; i++) {
    total += cart[i].price;
  }

  // calculateSalesTax
  for (let i = 0; i < cart.length; i++) {
    total += 0.2 * cart[i].price;
  }

  //calculateShipping
  total += 5 * cart.length;

  return total;
}

----

This function could be refactored into smaller functions:

[source,javascript,diff-id=2,diff-type=compliant]
----

function calculateTotal(cart) {
  let total = calculateSubtotal(cart);
  total += calculateSalesTax(subtotal);
  total += calculateShipping(subtotal);
  return total;
}

function calculateSubtotal(cart) {
  let subTotal = 0;
  for (const item of cart) {
    subTotal += item.price;
  }
  return subTotal;
}

function calculateSalesTax(cart) {
  let salesTax = 0;
  for (const item of cart) {
    salesTax += 0.2 * item.price;
  }
  return salesTax;
}

function calculateShipping(cart) {
  return 5 * cart.length;
}
...
----

=== Pitfalls

As code is complex, ensure that you have unit tests that cover the code before refactoring.


include::../resources.adoc[]

include::../rspecator.adoc[]