<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When a cookie is configured with the <code>HttpOnly</code> attribute set to <em>true</em>, the browser guaranties that no client-side script will be able to read it. In most cases, when a cookie is created, the default value of <code>HttpOnly</code> is <em>false</em> and it&#8217;s up to the developer to decide whether or not the content of the cookie can be read by the client-side script. As a majority of Cross-Site Scripting (XSS) attacks target the theft of session-cookies, the <code>HttpOnly</code> attribute can help to reduce their impact as it won&#8217;t be possible to exploit the XSS vulnerability to steal session-cookies.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ask_yourself_whether">Ask Yourself Whether</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>the cookie is sensitive, used to authenticate the user, for instance a <em>session-cookie</em></p>
</li>
<li>
<p>the <code>HttpOnly</code> attribute offer an additional protection (not the case for an <em>XSRF-TOKEN cookie</em> / CSRF token for example)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There is a risk if you answered yes to any of those questions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_recommended_secure_coding_practices">Recommended Secure Coding Practices</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>By default the <code>HttpOnly</code> flag should be set to <em>true</em> for most of the cookies and it&#8217;s mandatory for session / sensitive-security cookies.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sensitive_code_example">Sensitive Code Example</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">cookies[:example] = { value: "Value of example cookie" } # Sensitive: HttpOnly is false by default</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">cookies[:example] = { value: "Value of example cookie", httponly: true }</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a></p>
</li>
<li>
<p><a href="https://owasp.org/www-community/HttpOnly">OWASP HttpOnly</a></p>
</li>
<li>
<p>OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS)">Top 10 2017 Category A7 - Cross-Site Scripting (XSS)</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/1004">CWE-1004 - Sensitive Cookie Without 'HttpOnly' Flag</a></p>
</li>
<li>
<p>Derived from FindSecBugs rule <a href="https://find-sec-bugs.github.io/bugs.htm#HTTPONLY_COOKIE">HTTPONLY_COOKIE</a></p>
</li>
<li>
<p>STIG Viewer - <a href="https://stigviewer.com/stigs/application_security_and_development/2024-12-06/finding/V-222575">Application Security and Development: V-222575</a> - The application must set the HTTPOnly flag on session cookies.</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Make sure creating this cookie without the "HttpOnly" flag is safe.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_26_aug_2015_193437_ann_campbell_wrote">on 26 Aug 2015, 19:34:37 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~linda.martin] I recognize that this one may be a bear to implement since the flag could be set either in php.ini <em>or</em> in code. If possible I&#8217;d like to see it work like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>if ( HTTPOnly in php.ini) {
  no issue
} else if (set(cookie) &amp;&amp; ! cookie.has(HTTPOnly)){
  issue
}</pre>
</div>
</div>
<div class="paragraph">
<p>Also, I didn&#8217;t provide any code samples because I wasn&#8217;t sure whether you&#8217;d want to show code or configuration</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_15_sep_2015_211636_evgeny_mandrikov_wrote">on 15 Sep 2015, 21:16:36 Evgeny Mandrikov wrote:</h3>
<div class="paragraph">
<p>IMO from an implementation point of view this RSPEC is underspecified, so removing targeting for <code>C&#43;&#43;</code> for now.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_17_sep_2015_151948_ann_campbell_wrote">on 17 Sep 2015, 15:19:48 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~evgeny.mandrikov] what more are you looking for?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_17_sep_2015_160755_evgeny_mandrikov_wrote">on 17 Sep 2015, 16:07:55 Evgeny Mandrikov wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] what this RSPEC supposed to find in C&#43;&#43; code</p>
</div>
<div class="paragraph">
<p>but the reason of removal targeting: currently there are too much (for my taste) issues in backlog targeting C&#43;&#43; and about which I have no idea of how implementation can look like, which complicates work with this backlog</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_13_nov_2015_150603_linda_martin_wrote">on 13 Nov 2015, 15:06:03 Linda Martin wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] sorry for the delay, looks good that way and maybe both configuration and code could be given as they could both trigger issues.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_17_nov_2015_144556_ann_campbell_wrote">on 17 Nov 2015, 14:45:56 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>Code samples added</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_18_oct_2016_170917_pierre_yves_nicolas_wrote">on 18 Oct 2016, 17:09:17 Pierre-Yves Nicolas wrote:</h3>
<div class="paragraph">
<p>My understanding is that cookies can be created with <a href="http://php.net/manual/en/function.setcookie.php">setcookie</a>, but PHP also manages directly the "session cookie": the settings of the session cookie can be modified with <a href="http://php.net/manual/en/session.configuration.php#ini.session.cookie-httponly">session.cookie_httponly</a> in php.ini or inside PHP code with <a href="http://php.net/manual/en/function.session-set-cookie-params.php">session_set_cookie_params</a>. The rule should probably check all 3 usages.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_2_dec_2018_225425_lars_svensson_wrote">on 2 Dec 2018, 22:54:25 Lars Svensson wrote:</h3>
<div class="paragraph">
<p>There could be many legitimate reasons why an application needs script access to a cookie. To mitigate CSRF is just one example. Another example could be for user interface settings that are persisted across page refreshes.</p>
</div>
<div class="paragraph">
<p>(Also, when mitigating CSRF, there are multiple ways you can go. Using a cookie is just one of them. And the cookie name is framework specific - even though it happens to be called "XSRF-TOKEN" in some popular frameworks, there are many examples of other names used in the field)</p>
</div>
<div class="paragraph">
<p>IMO, it is only relevant to set the HttpOnly flag for security-sensitive cookies. Since it could be difficult to detect whether a cookie is used in a security context, perhaps this rule should be changed into a Security Hotspot instead.</p>
</div>
<div class="paragraph">
<p>I also propose to lower the default severity as a missing HttpOnly flag is not an exploitable vulnerability in itself, even if the cookie is used in a security context. It is only together with for example a Cross Site Scripting vulnerability that it is exploitable.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_18_dec_2018_102250_alexandre_gigleux_wrote">on 18 Dec 2018, 10:22:50 Alexandre Gigleux wrote:</h3>
<div class="paragraph">
<p>My take on this one is that I guess that the FP Rate is below 10% and so majority of the time, HttpOnly should be set. Yes, we will have FPs on CSRF Cookies and in that case, I would expect users to raise the point on https://community.sonarsource.com to start a discussion. I propose to keep it like this for the moment and see users' reactions.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_9_oct_2019_175001_ann_campbell_wrote">on 9 Oct 2019, 17:50:01 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~eric.therond] generally speaking you want to use <em>either</em> "this" or "here" in the message:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Make sure creating a cookie without the "HttpOnly" flag is safe here.</p>
</li>
<li>
<p>Make sure creating this cookie without the "HttpOnly" flag is safe.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>IMO the 2nd version is nicer.</p>
</div>
</div>
</div>
</div>