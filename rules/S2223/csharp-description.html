<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Unlike instance fields, which can only be accessed by code having a hold on the instance, <code>static</code> fields can be accessed by any code having visibility of the field and its type.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">public class Math
{
    public static double Pi = 3.14;  // Noncompliant
}

// Somewhere else, where Math and Math.Pi are visible
var pi = Math.Pi; // Reading the value
Math.Pi = 3.1416; // Mutating the value</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another typical scenario of the use of a non-private mutable <code>static</code> field is the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">public class Shape
{
    public static Shape Empty = new EmptyShape();  // Noncompliant

    private class EmptyShape : Shape
    {
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Non-private <code>static</code> fields that are neither <code>const</code> nor <code>readonly</code>, like the ones in the examples above, can lead to errors and unpredictable behavior.</p>
</div>
<div class="paragraph">
<p>This can happen because:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Any object can modify these fields and alter the global state. This makes the code more difficult to read, debug and test.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">class Counters
{
    public static int ErrorCounter = 0;
}

class Program
{
    public static void Thread1()
    {
        // ...
        Counters.ErrorCounter = 0; // Error counter reset
        // ...
    }

    public static void Thread2()
    {
        // ...
        if (Counters.ErrorCounter &gt; 0)
        {
            Trace.TraceError($"There are {Counters.ErrorCounter} errors"); // It may print "There are 0 errors"
        }
        // ...
    }
}</code></pre>
</div>
</div>
</li>
<li>
<p>Correctly accessing these fields from different threads needs synchronization with <code>lock</code> or equivalent mechanisms. Improper synchronization may lead to unexpected results.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">class Counters
{
    public static volatile int ErrorCounter;
}

class Program
{
    public static void ImproperSynchronization()
    {
        Counters.ErrorCounter = 0;
        Parallel.ForEach(Enumerable.Range(0, 1000), _ =&gt; Counters.ErrorCounter++); // Volatile is not enough
        Console.WriteLine(Counters.ErrorCounter); // May print less than 1000
    }

    public static void ProperSynchronization()
    {
        Counters.ErrorCounter = 0;
        Parallel.ForEach(Enumerable.Range(0, 1000), _ =&gt; Interlocked.Increment(ref Counters.ErrorCounter));
        Console.WriteLine(Counters.ErrorCounter); // Always prints 1000
    }
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Publicly visible <code>static</code> fields should only be used to store shared data that does not change.
To enforce this intent, these fields should be marked <code>readonly</code> or converted to <code>const</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">public class Math
{
    public const double Pi = 3.14;
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">public class Shape
{
    public static readonly Shape Empty = new EmptyShape();

    private class EmptyShape : Shape
    {
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/static">static (C# Reference)</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/standard/threading/overview-of-synchronization-primitives">Overview of synchronization primitives</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/volatile">volatile (C# Reference)</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_articles_blog_posts">Articles &amp; blog posts</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://softwareengineering.stackexchange.com/a/148154">Stack Exchange - Mutable global state is evil and alternatives to it</a></p>
</li>
<li>
<p><a href="https://ericlippert.com/2007/11/13/immutability-in-c-part-one-kinds-of-immutability/">Fabulous adventures in coding - Eric Lippert: Immutability in C#</a></p>
</li>
<li>
<p><a href="https://stackoverflow.com/a/4628660">Stack Overflow - Eric Lippert: ++ is not "threadsafe"</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Change the visibility of "xxx" or make it "const" or "readonly".</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_relates_to_s2226">relates to: <a data-rspec-id="S2226" class="rspec-auto-link">S2226</a></h3>

</div>
<div class="sect2">
<h3 id="_on_21_nov_2014_144945_freddy_mallet_wrote">on 21 Nov 2014, 14:49:45 Freddy Mallet wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] we should forget the technical difficulty to implement rules. If we really do that, this rule should become"A static field should never be updated from a thread". Because if the rule is really ""public static" fields should be "readonly"" we&#8217;re going to generate a big amount of false positives</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_21_nov_2014_145126_freddy_mallet_wrote">on 21 Nov 2014, 14:51:26 Freddy Mallet wrote:</h3>
<div class="paragraph">
<p>And as soon as we&#8217;re talking about multi-threading issue, the "multi-threading" tag should be used.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_28_may_2015_120052_tamas_vajk_wrote">on 28 May 2015, 12:00:52 Tamas Vajk wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] I rewrote this rule to match the description here: https://msdn.microsoft.com/en-us/library/ms182353.aspx</p>
</div>
<div class="paragraph">
<p>The main idea is the same, <code>public static</code> fields should be either <code>const</code> or <code>readonly</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_28_may_2015_142944_tamas_vajk_wrote">on 28 May 2015, 14:29:44 Tamas Vajk wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2], could you go through the description?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_28_may_2015_154738_ann_campbell_wrote">on 28 May 2015, 15:47:38 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>the description looks fine [~tamas.vajk]. Could you revert the code samples too, please?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_29_may_2015_071530_tamas_vajk_wrote">on 29 May 2015, 07:15:30 Tamas Vajk wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2], the code samples were written by me, there is no need to revert them.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_29_may_2015_145132_ann_campbell_wrote">on 29 May 2015, 14:51:32 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>Cool. Thanks [~tamas.vajk]</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_1_jun_2015_150242_tamas_vajk_wrote">on 1 Jun 2015, 15:02:42 Tamas Vajk wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] I&#8217;ve changed the severity to major, it shouldn&#8217;t be critical IMO</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_1_jun_2015_171022_ann_campbell_wrote">on 1 Jun 2015, 17:10:22 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>that&#8217;s fine [~tamas.vajk]</p>
</div>
</div>
</div>
</div>