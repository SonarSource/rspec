<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Assertions are statements that check whether certain conditions are true. They are used to validate that the actual results of a code snippet match the expected outcomes. By using assertions, developers can ensure that their code behaves as intended and identify potential bugs or issues early in the development process.</p>
</div>
<div class="paragraph">
<p>When the unit test is executed, the assertions are evaluated. If all the assertions in the test pass, it means the unit is functioning correctly for that specific set of inputs. If any of the assertions fail, it indicates that there is a problem with the unit&#8217;s implementation, and the test case helps identify the issue.</p>
</div>
<div class="paragraph">
<p>It is not good enough to test if an exception is raised, without checking which exception it is. Such tests will not be able to differentiate the expected exception from an unexpected one.</p>
</div>
<div class="paragraph">
<p>This rule raises an issue in the following cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When an asynchronous Mocha test calls the <code>done()</code> callback, without parameters, in a <code>catch</code> block, and there is no reference to the caught exception in this block. Either the error should be passed to <code>done()</code> or the exception should be checked further.</p>
</li>
<li>
<p>When Chai assertions are used to test if a function throws any exception, or an exception of type <code>Error</code> without checking the message.</p>
</li>
<li>
<p>When Chai assertions are used to test if a function does not throw an exception of type <code>Error</code> without checking the message.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This rule doesn&#8217;t raise an issue when an assertion is negated. In such a case, the exception doesn&#8217;t need to be specific.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const expect = require("chai").expect;
const fs = require("fs");

describe("exceptions are not tested properly", function() {
    const funcThrows = function () { throw new TypeError('What is this type?'); };
    const funcNoThrow = function () { /*noop*/ };

    it("forgot to pass the error to 'done()'", function(done) {
        fs.readFile("/etc/zshrc", 'utf8', function(err, data) {
            try {
                expect(data).to.match(/some expected string/);
            } catch (e) {
                done(); // Noncompliant: either the exception should be passed to done(e), or the exception should be tested further.
            }
        });
    });

    it("does not 'expect' a specific exception", function() {
        expect(funcThrows).to.throw(); // Noncompliant: the exception should be tested.
        expect(funcThrows).to.throw(Error); // Noncompliant: the exception should be tested further.
    });
});</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Tests should instead validate the exception message and/or type. By checking for the specific exception that is expected to be thrown, the test case can verify that the code is behaving correctly and handling exceptions as expected. This helps to improve the overall quality and reliability of the code.</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const expect = require("chai").expect;
const { AssertionError } = require('chai');
const fs = require("fs");

describe("exceptions are tested properly", function() {
    const funcThrows = function () { throw new TypeError('What is this type?'); };
    const funcNoThrow = function () { /*noop*/ };

    it("did not forget to pass the error to 'done()'", function(done) {
        fs.readFile("/etc/zshrc", 'utf8', function(err, data) {
            try {
                expect(data).to.match(/some expected string/);
            } catch (e) {
                expect(e).to.be.an.instanceof(AssertionError);
                done();
            }
        });
    });

    it("does 'expect' a specific exception", function() {
        expect(funcThrows).to.throw(TypeError);
        expect(funcNoThrow).to.not.throw(Error, /My error message/);
    });
});</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Node.js Documentation - <a href="https://nodejs.org/api/assert.html">Assert</a></p>
</li>
<li>
<p>Chai.js Documentation - <a href="https://www.chaijs.com/api/assert">Assert</a></p>
</li>
<li>
<p>Chai.js Documentation - <a href="https://www.chaijs.com/api/bdd"><code>expect</code> and <code>should</code></a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="ulist">
<ul>
<li>
<p>When an assertion function is used:
message: 'Test precisely which exception is [not] thrown.'</p>
</li>
<li>
<p>When <code>try...catch...done</code> is used:
message: 'Test if the right exception is caught, or pass it to "done()" below.'</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="ulist">
<ul>
<li>
<p>When an assertion function is used:</p>
<div class="ulist">
<ul>
<li>
<p>location: the assertion function</p>
</li>
</ul>
</div>
</li>
<li>
<p>When <code>try...catch...done</code> is used:</p>
<div class="ulist">
<ul>
<li>
<p>Primary location: the <code>catch (e)</code> statement</p>
</li>
<li>
<p>Secondary location: the call to <code>done()</code>
message: 'done()" is called without checking the exception.'</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>