<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Disabling logging of this component can lead to missing traceability in case of a security incident.</p>
</div>
<div class="paragraph">
<p>Logging allows operational and security teams to get detailed and real-time feedback on an information system&#8217;s events. The logging coverage enables them to quickly react to events, ranging from the most benign bugs to the most impactful security incidents, such as intrusions.</p>
</div>
<div class="paragraph">
<p>Apart from security detection, logging capabilities also directly influence future digital forensic analyses. For example, detailed logging will allow investigators to establish a timeline of the actions perpetrated by an attacker.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ask_yourself_whether">Ask Yourself Whether</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>This component is essential for the information system infrastructure.</p>
</li>
<li>
<p>This component is essential for mission-critical functions.</p>
</li>
<li>
<p>Compliance policies require this component to be monitored.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There is a risk if you answered yes to any of those questions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_recommended_secure_coding_practices">Recommended Secure Coding Practices</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Enable the logging capabilities of this component. Depending on the component,
new permissions might be required by the logging storage components.<br>
You should consult the official documentation to enable logging for the impacted components.
For example, AWS Application Load Balancer Access Logs
<a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/enable-access-logging.html">require
an additional bucket policy</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sensitive_code_example">Sensitive Code Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For Amazon <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket">S3 access requests</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terraform" data-lang="terraform">resource "aws_s3_bucket" "example" { # Sensitive
  bucket = "example"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For Amazon <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/api_gateway_stage">API Gateway stages</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terraform" data-lang="terraform">resource "aws_api_gateway_stage" "example" { # Sensitive
  xray_tracing_enabled = false # Sensitive
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For Amazon <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/msk_cluster">MSK Broker logs</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terraform" data-lang="terraform">resource "aws_msk_cluster" "example" {
  cluster_name           = "example"
  kafka_version          = "2.7.1"
  number_of_broker_nodes = 3

  logging_info {
    broker_logs { # Sensitive
      firehose {
        enabled = false
      }
      s3 {
        enabled = false
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For Amazon <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/mq_broker">MQ Brokers</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terraform" data-lang="terraform">resource "aws_mq_broker" "example" {
  logs {  # Sensitive
    audit   = false
    general = false
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For Amazon <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/docdb_cluster">Amazon DocumentDB</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terraform" data-lang="terraform">resource "aws_docdb_cluster" "example" { # Sensitive
  cluster_identifier = "example"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For Azure <a href="https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service">App Services</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terraform" data-lang="terraform">resource "azurerm_app_service" "example" {
  logs {
    application_logs {
      file_system_level = "Off" # Sensitive
      azure_blob_storage {
        level = "Off"           # Sensitive
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For GCP <a href="https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_subnetwork/">VPC Subnetwork</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terraform" data-lang="terraform">resource "google_compute_subnetwork" "example" { # Sensitive
  name          = "example"
  ip_cidr_range = "10.2.0.0/16"
  region        = "us-central1"
  network       = google_compute_network.example.id
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For GCP <a href="https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance/">SQL Database Instance</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terraform" data-lang="terraform">resource "google_sql_database_instance" "example" {
  name = "example"

  settings { # Sensitive
    tier = "db-f1-micro"
    ip_configuration {
      require_ssl  = true
      ipv4_enabled = true
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For GCP <a href="https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster/">Kubernetes Engine (GKE) cluster</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terraform" data-lang="terraform">resource "google_container_cluster" "example" {
  name               = "example"
  logging_service    = "none" # Sensitive
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For Amazon <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket">S3 access requests</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terraform" data-lang="terraform">resource "aws_s3_bucket" "example" {
  bucket = "example"
}

resource "aws_s3_bucket_logging" "example" {
  bucket = aws_s3_bucket.example.id

  target_bucket = aws_s3_bucket.logs.id
  target_prefix = "testing-logs"
}

# Set up a logging bucket
resource "aws_s3_bucket" "logs" {
  bucket = "example_logstorage"
}

data "aws_iam_policy_document" "logs" {
  statement {
      sid    = "s3-log-delivery"
      effect = "Allow"

      principals {
        type        = "Service"
        identifiers = ["logging.s3.amazonaws.com"]
      }

      actions = ["s3:PutObject"]

      resources = [
        "${aws_s3_bucket.logs.arn}/*",
      ]
    }
}

resource "aws_s3_bucket_policy" "logs" {
  bucket = aws_s3_bucket.example-logs.id
  policy = data.aws_iam_policy_document.example.json
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For Amazon <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/api_gateway_stage">API Gateway stages</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terraform" data-lang="terraform">resource "aws_api_gateway_stage" "example" {
  xray_tracing_enabled = true

  access_log_settings {
    destination_arn = "arn:aws:logs:eu-west-1:123456789:example"
    format = "..."
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For Amazon <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/msk_cluster">MSK Broker logs</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terraform" data-lang="terraform">resource "aws_msk_cluster" "example" {
  cluster_name           = "example"
  kafka_version          = "2.7.1"
  number_of_broker_nodes = 3

  logging_info {
    broker_logs {
      firehose   {
        enabled = false
      }
      s3 {
        enabled = true
        bucket  = "example"
        prefix  = "log/msk-"
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For Amazon <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/mq_broker">MQ Brokers</a>, enable <code>audit</code> or <code>general</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terraform" data-lang="terraform">resource "aws_mq_broker" "example" {
  logs {
    audit   = true
    general = true
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For Amazon <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/docdb_cluster">Amazon DocumentDB</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terraform" data-lang="terraform">resource "aws_docdb_cluster" "example" {
  cluster_identifier              = "example"
  enabled_cloudwatch_logs_exports = ["audit"]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For Azure <a href="https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service">App Services</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terraform" data-lang="terraform">resource "azurerm_app_service" "example" {
 logs {
    http_logs {
      file_system {
        retention_in_days = 90
        retention_in_mb   = 100
      }
    }

 application_logs {
      file_system_level = "Error"
      azure_blob_storage {
        retention_in_days = 90
        level             = "Error"
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For GCP <a href="https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_subnetwork/">VPC Subnetwork</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terraform" data-lang="terraform">resource "google_compute_subnetwork" "example" {
  name          = "example"
  ip_cidr_range = "10.2.0.0/16"
  region        = "us-central1"
  network       = google_compute_network.example.id

  log_config {
    aggregation_interval = "INTERVAL_10_MIN"
    flow_sampling        = 0.5
    metadata             = "INCLUDE_ALL_METADATA"
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For GCP <a href="https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance/">SQL Database Instance</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terraform" data-lang="terraform">resource "google_sql_database_instance" "example" {
  name             = "example"

  settings {
    ip_configuration {
      require_ssl  = true
      ipv4_enabled = true
    }
    database_flags {
      name  = "log_connections"
      value = "on"
    }
    database_flags {
      name  = "log_disconnections"
      value = "on"
    }
    database_flags {
      name  = "log_checkpoints"
      value = "on"
    }
    database_flags {
      name  = "log_lock_waits"
      value = "on"
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For GCP <a href="https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster/">Kubernetes Engine (GKE) cluster</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terraform" data-lang="terraform">resource "google_container_cluster" "example" {
  name               = "example"
  logging_service    = "logging.googleapis.com/kubernetes"
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/ServerLogs.html">AWS Documentation</a> - Logging requests using server access logging</p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/778">CWE-778 - Insufficient Logging</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Make sure that disabling logging is safe here.</p>
</div>
</div>
</div>
</div>