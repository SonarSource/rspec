<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Exposing HTTP endpoints is security-sensitive. It has led in the past to the following vulnerabilities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.cve.org/CVERecord?id=CVE-2016-3072">CVE-2016-3072</a></p>
</li>
<li>
<p><a href="https://www.cve.org/CVERecord?id=CVE-2015-3175">CVE-2015-3175</a></p>
</li>
<li>
<p><a href="https://www.cve.org/CVERecord?id=CVE-2003-0218">CVE-2003-0218</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>HTTP endpoints are webservices' main entrypoint. Attackers will take advantage of any vulnerability by sending crafted inputs for headers (including cookies), body and URI. No input should be trusted and extreme care should be taken with all returned value (header, body and status code).</p>
</div>
<div class="paragraph">
<p>This rule flags code which creates HTTP endpoint. It guides security code reviews to security-sensitive code.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ask_yourself_whether">Ask Yourself Whether</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>an input is not sanitized before being used. This includes any value coming from the URI, header, body and cookies.</p>
</li>
<li>
<p>the response contains some unsafe data. for example the input could come from a database which contains user inputs. Check the response&#8217;s headers, cookies, body and status code.</p>
</li>
<li>
<p>the response contains some sensitive information which the user shouldn&#8217;t have access to.</p>
</li>
<li>
<p>no access control prevents attackers from successfully performing a forbidden request.</p>
</li>
<li>
<p>an attacker can get sensitive information by analyzing the returned errors. For example, a web service can expose the existence of user accounts by returning 403 (Forbidden) instead of 404 (Not Found) when an attacker ask for them.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You are at risk if you answered yes to any of those questions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_recommended_secure_coding_practices">Recommended Secure Coding Practices</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Never trust any part of the request to be safe. Make sure that the URI, header and body are properly <a href="https://www.owasp.org/index.php/Input_Validation_Cheat_Sheet">sanitized</a> before being used. Their content, length, encoding, name (ex: name of URL query parameters) should be checked. Validate that the values are in a predefined whitelist. The opposite, i.e. searching for dangerous values in a given input, can easily miss some of them.</p>
</div>
<div class="paragraph">
<p>Do not rely solely on cookies when you implement your authentication and permission logic. Use additional protections such as   <a href="https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF)_Prevention_Cheat_Sheet">CSRF</a> tokens when possible.</p>
</div>
<div class="paragraph">
<p>Do not expose sensitive information in your response. If the endpoint serves files, limit the access to a dedicated directory. <a href="https://cheatsheetseries.owasp.org/cheatsheets/Session_Management_Cheat_Sheet.html#cookies">Protect your sensitive cookies</a> so that client-side javascript cannot read or modify them.</p>
</div>
<div class="paragraph">
<p>Sanitize all values before returning them in a response, be it in the body, header or status code. Special care should be taken to avoid the following attacks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.owasp.org/index.php/XSS_(Cross_Site_Scripting)_Prevention_Cheat_Sheet">Cross-site Scripting (XSS)</a>, which happens when an unsafe value is included in an HTML page.</p>
</li>
<li>
<p><a href="https://www.owasp.org/index.php/Unvalidated_Redirects_and_Forwards_Cheat_Sheet">Unvalidated redirects</a> which can happen when the <code>Location</code> header is compromised.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Restrict security-sensitive actions, such as file upload, to authenticated users.</p>
</div>
<div class="paragraph">
<p>Be careful when errors are returned to the client, as they can provide sensitive information. Use 404 (Not Found) instead of 403 (Forbidden) when the existence of a resource is sensitive.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sensitive_code_example">Sensitive Code Example</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>// === NodeJS built-in modules ===
const http = require('http');
const https = require('https');

// Endpoints exposed by http.Server and https.Server objects are security-sensitive and should be reviewed.
// Examples:

const srv = new http.Server((req, res) =&gt; {});
srv.listen(3000); // Sensitive

// http.createServer creates a new http.Server object.
const srv = http.createServer((req, res) =&gt; {});
srv.listen(3000); // Sensitive

const srv = new https.Server((req, res) =&gt; {});
srv.listen(3000); // Sensitive

// https.createServer creates a new https.Server object.
const srv = https.createServer((req, res) =&gt; {});
srv.listen(3000); // Sensitive</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>// === ExpressJS ===
const express = require('express');
const app = express();

// Endpoints exposed by ExpressJS are security-sensitive and should be reviewed.
// Example:

app.get('/', function (req, res) {});
app.post('/', function (req, res) {});
app.all('/', function (req, res) {});
app.listen(3000); // Sensitive</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a></p>
</li>
<li>
<p>OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data Exposure</a></p>
</li>
<li>
<p>OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS)">Top 10 2017 Category A7 - Cross-Site Scripting (XSS)</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation </a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/352">CWE-352 - Cross-Site Request Forgery (CSRF)</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/79">CWE-79 - Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/22">CWE-22 - Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal')</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Make sure that exposing this HTTP endpoint is safe here.</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_7_dec_2018_125535_lars_svensson_wrote">on 7 Dec 2018, 12:55:35 Lars Svensson wrote:</h3>
<div class="paragraph">
<p><a href="https://nodejs.org/api/http.html" class="bare">https://nodejs.org/api/http.html</a></p>
</div>
<div class="paragraph">
<p><a href="https://nodejs.org/api/https.html" class="bare">https://nodejs.org/api/https.html</a></p>
</div>
<div class="paragraph">
<p><a href="https://expressjs.com/en/4x/api.html" class="bare">https://expressjs.com/en/4x/api.html</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_relates_to_s4530">relates to: <a data-rspec-id="S4530" class="rspec-auto-link">S4530</a></h3>

</div>
<div class="sect2">
<h3 id="_relates_to_s4531">relates to: <a data-rspec-id="S4531" class="rspec-auto-link">S4531</a></h3>

</div>
</div>
</div>