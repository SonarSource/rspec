<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Comparisons of dissimilar types will always return false. The comparison and all its dependent code can simply be removed. This includes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>comparing an object with null</p>
</li>
<li>
<p>comparing an object with an unrelated primitive (E.G. a string with an int)</p>
</li>
<li>
<p>comparing unrelated classes</p>
</li>
<li>
<p>comparing an unrelated <code>class</code> and <code>interface</code></p>
</li>
<li>
<p>comparing unrelated <code>interface</code> types</p>
</li>
<li>
<p>comparing an array to a non-array</p>
</li>
<li>
<p>comparing two arrays</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Specifically in the case of arrays, since arrays don&#8217;t override <code>Object.equals()</code>, calling <code>equals</code> on two arrays is the same as comparing their addresses. This means that <code>array1.equals(array2)</code> is equivalent to <code>array1==array2</code>.</p>
</div>
<div class="paragraph">
<p>However, some developers might expect <code>Array.equals(Object obj)</code> to do more than a simple memory address comparison, comparing for instance the size and content of the two arrays. Instead, the <code>==</code> operator or <code>Arrays.equals(array1, array2)</code> should always be used with arrays.</p>
</div>
<div class="sect2">
<h3 id="_noncompliant_code_example">Noncompliant code example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">interface KitchenTool { ... };
interface Plant {...}

public class Spatula implements KitchenTool { ... }
public class Tree implements Plant { ...}
//...

Spatula spatula = new Spatula();
KitchenTool tool = spatula;
KitchenTool [] tools = {tool};

Tree tree = new Tree();
Plant plant = tree;
Tree [] trees = {tree};


if (spatula.equals(tree)) { // Noncompliant; unrelated classes
  // ...
}
else if (spatula.equals(plant)) { // Noncompliant; unrelated class and interface
  // ...
}
else if (tool.equals(plant)) { // Noncompliant; unrelated interfaces
  // ...
}
else if (tool.equals(tools)) { // Noncompliant; array &amp; non-array
  // ...
}
else if (trees.equals(tools)) { // Noncompliant; incompatible arrays
  // ...
}
else if (tree.equals(null)) { // Noncompliant
  // ...
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://wiki.sei.cmu.edu/confluence/x/5zdGBQ">CERT, EXP02-J.</a> - Do not use the Object.equals() method to compare two arrays</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="ulist">
<ul>
<li>
<p>Remove this call to "equals"; comparisons against null always return false.</p>
</li>
<li>
<p>Remove this call to "equals"; comparisons between a type and an array always return false.</p>
</li>
<li>
<p>Remove this call to "equals"; comparisons between an array and a type always return false.</p>
</li>
<li>
<p>Use "Arrays.equals(array1, array2)" or the "==" operator instead of using the "Object.equals(Object obj)" method.</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_21_nov_2024_164800_alban_auzeill_wrote">on 21 Nov 2024, 16:48:00 Alban Auzeill wrote:</h3>
<div class="paragraph">
<p>[test-code-support-investigation-for-java] Decision for scope: Keep 'Main'. Silly equality comparisons are useful to fully tests "equals"".</p>
</div>
</div>
<div class="sect2">
<h3 id="_deprecates_s1294">deprecates: <a data-rspec-id="S1294" class="rspec-auto-link">S1294</a></h3>

</div>
<div class="sect2">
<h3 id="_deprecates_s1318">deprecates: <a data-rspec-id="S1318" class="rspec-auto-link">S1318</a></h3>

</div>
<div class="sect2">
<h3 id="_is_related_to_s5845">is related to: <a data-rspec-id="S5845" class="rspec-auto-link">S5845</a></h3>

</div>
<div class="sect2">
<h3 id="_on_15_oct_2014_220422_freddy_mallet_wrote">on 15 Oct 2014, 22:04:22 Freddy Mallet wrote:</h3>
<div class="paragraph">
<p>My 2 cents:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>I would prefer the "Reliability" SQALE category because such kind of comparison can&#8217;t be done on purpose</p>
</li>
<li>
<p>Providing a compliant solution is valueless and can even be misleading</p>
</li>
<li>
<p>I would extend the Noncompliant Code Example to provide an example for each kind silly equality checks</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_on_21_oct_2014_151606_nicolas_peru_wrote">on 21 Oct 2014, 15:16:06 Nicolas Peru wrote:</h3>
<div class="paragraph">
<p>How would we detect cases such as  :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Interface I {}
class A extends B implements I{}
class B {}
...
B b = new A();
I i;
b.equals(i); //On this call B and I have nothing in common in the class hierarchy, but this can return true.</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_on_22_oct_2014_132905_ann_campbell_wrote">on 22 Oct 2014, 13:29:05 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>Let me know which cases you want to cover</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_22_apr_2015_163644_samuel_mercier_wrote">on 22 Apr 2015, 16:36:44 Samuel Mercier wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] As a first step I will implement the following:</p>
</div>
<div class="paragraph">
<p>EC: equals() used to compare array and non-array (EC_ARRAY_AND_NONARRAY)</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Object[] array = ...;
MyObject object = ...;
array.equals(object); // Always false
object.equals(array); // Could return true, but following specification of equals this should always return false (different message to prevent misleading ?)
-&gt; 'contract of 'equals' requires false as return value when the passed argument has type 'array''</pre>
</div>
</div>
<div class="paragraph">
<p>EC: equals(&#8230;&#8203;) used to compare incompatible arrays (EC_INCOMPATIBLE_ARRAY_COMPARE)</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Object[] objects = ...;
String[] strings = ...;
objects.equals(strings); // Always false: message should probably suggest usage of java.util.Arrays.equals(Object[], Object[]) to compare contents</pre>
</div>
</div>
<div class="paragraph">
<p>EC: Call to equals(null) (EC_NULL_ARG)</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Object object = ...;
object.equals(null); // could return true, but following specification of equals this should always return false
-&gt; 'contract of 'equals' requires false as return value when null is passed as argument</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_on_22_apr_2015_164223_samuel_mercier_wrote">on 22 Apr 2015, 16:42:23 Samuel Mercier wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] As stated by Nico it is easy to build examples which generate false positives.</p>
</div>
<div class="paragraph">
<p>For this reason I think EC_UNRELATED_CLASS_AND_INTERFACE, EC_UNRELATED_INTERFACES and EC_UNRELATED_TYPES should not be covered by this RSPEC, because the message and description would be misleading.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_23_apr_2015_153906_ann_campbell_wrote">on 23 Apr 2015, 15:39:06 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>Per our discussion, I&#8217;ve left EC_UNRELATED_CLASS_AND_INTERFACE, EC_UNRELATED_INTERFACES and EC_UNRELATED_TYPES in this RSpec since, as you pointed out [~samuel.mercier] EC_ARRAY_AND_NONARRAY, EC_INCOMPATIBLE_ARRAY_COMPARE are more specific examples of the general cases - i.e. it would eventually be confusing for users to have this as 2 separate rules.</p>
</div>
<div class="paragraph">
<p>Note that the FB description indicates that the FB check includes an examination of the relevant <code>equals</code> methods and limits issue raising to when the comparison will always return false or not be symmetric.</p>
</div>
</div>
</div>
</div>