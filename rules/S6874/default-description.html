<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>apiVersion</code> of a resource is used to determine the configurable properties and values for the resource.
Setting it as a parameter or variable is not recommended, as it can lead to unexpected behaviors and deployment failures.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In Azure, different API versions of a resource can have different properties and values.</p>
</div>
<div class="paragraph">
<p>Using a variable or parameter for the <code>apiVersion</code> for a resource is not an optimal way to always stay up to date with
the latest version.
This can lead to unexpected behaviors like deployment failures,
when the API version you set for a resource doesn&#8217;t match the properties in your template.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it_in_json_templates">How to fix it in JSON templates</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To avoid these issues, it is recommended to set the <code>apiVersion</code> to a hard-coded value for the resource type.</p>
</div>
<div class="paragraph">
<p>When creating a new template, we suggest you use the latest API version for a resource type.</p>
</div>
<div class="paragraph">
<p>To determine which version to use, you can refer to the template reference of the official documentation linked below.
Make sure to choose a version that supports all the features you need.</p>
</div>
<div class="paragraph">
<p>When your template works as expected, we recommend you continue using the same API version.
Using the same API version means you don&#8217;t have to worry about breaking changes that might be introduced in later versions.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "parameters": {
    "customApiVersion": {
      "type": "string"
    }
  },
  "resources": [
    {
      "apiVersion": "[parameters('customApiVersion')]",
      "type": "Microsoft.Compute/virtualMachines",
      "name": "nonCompliantResource",
      "location": "[resourceGroup().location]"
    }
  ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "variables": {
    "customApiVersion": "[first(providers(‘Microsoft.Compute’,’virtualMachines’).apiVersions)]"
  },
  "resources": [
    {
      "apiVersion": "[variables('customApiVersion')]",
      "type": "Microsoft.Compute/virtualMachines",
      "name": "nonCompliantResource",
      "location": "[resourceGroup().location]"
    }
  ]
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "resources": [
    {
      "apiVersion": "2023-09-01",
      "type": "Microsoft.Compute/virtualMachines",
      "name": "compliantResource",
      "location": "[resourceGroup().location]"
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://learn.microsoft.com/en-us/azure/azure-resource-manager/templates/best-practices#api-version">ARM template best practices: API version</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/azure/templates/">Resource Template Reference</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Use a hard-coded value for the <code>apiVersion</code> of this resource.</p>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="ulist">
<ul>
<li>
<p>Highlight <code>apiVersion</code> of a resource where a parameter or variable is used.</p>
</li>
</ul>
</div>
</div>
</div>
</div>