<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This vulnerability exposes encrypted data to attacks whose goal is to recover the plaintext.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Encryption algorithms are essential for protecting sensitive information and
ensuring secure communications in a variety of domains. They are used for
several important reasons:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Confidentiality, privacy, and intellectual property protection</p>
</li>
<li>
<p>Security during transmission or on storage devices</p>
</li>
<li>
<p>Data integrity, general trust, and authentication</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When selecting encryption algorithms, tools, or combinations, you should also
consider two things:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>No encryption is unbreakable.</p>
</li>
<li>
<p>The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In today&#8217;s cryptography, the length of the <strong>key</strong> directly affects the security
level of cryptographic algorithms.</p>
</div>
<div class="paragraph">
<p>Note that depending on the algorithm, the term <strong>key</strong> refers to a different
mathematical property. For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For RSA, the key is the product of two large prime numbers, also called the <strong>modulus</strong>.</p>
</li>
<li>
<p>For Elliptic Curve Cryptography (ECC), the key is only a sequence of randomly generated bytes.</p>
<div class="ulist">
<ul>
<li>
<p>In some cases, keys are derived from a master key or a passphrase using a Key Derivation Function (KDF) like PBKDF2 (Password-Based Key Derivation Function 2)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>If an application uses a key that is considered short and <strong>insecure</strong>, the
encrypted data is exposed to attacks aimed at getting at the plaintext.</p>
</div>
<div class="paragraph">
<p>In general, it is best practice to expect a breach: that a user or organization
with malicious intent will perform cryptographic attacks on this data after
obtaining it by other means.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>After retrieving encrypted data and performing cryptographic attacks on it on a
given timeframe, attackers can recover the plaintext that encryption was
supposed to protect.</p>
</div>
<div class="paragraph">
<p>Depending on the recovered data, the impact may vary.</p>
</div>
<div class="paragraph">
<p>Below are some real-world scenarios that illustrate the potential impact of an
attacker exploiting the vulnerability.</p>
</div>
<div class="sect3">
<h4 id="_additional_attack_surface">Additional attack surface</h4>
<div class="paragraph">
<p>By modifying the plaintext of the encrypted message, an attacker may be able to
trigger additional vulnerabilities in the code. An attacker can further exploit
a system to obtain more information.<br>
Encrypted values are often considered trustworthy because it would not be
possible for a third party to modify them under normal circumstances.</p>
</div>
</div>
<div class="sect3">
<h4 id="_breach_of_confidentiality_and_privacy">Breach of confidentiality and privacy</h4>
<div class="paragraph">
<p>When encrypted data contains personal or sensitive information, its retrieval
by an attacker can lead to privacy violations, identity theft, financial loss,
reputational damage, or unauthorized access to confidential systems.</p>
</div>
<div class="paragraph">
<p>In this scenario, the company, its employees, users, and partners could be
seriously affected.</p>
</div>
<div class="paragraph">
<p>The impact is twofold, as data breaches and exposure of encrypted data can
undermine trust in the organization, as customers, clients and stakeholders may
lose confidence in the organization&#8217;s ability to protect their sensitive data.</p>
</div>
</div>
<div class="sect3">
<h4 id="_legal_and_compliance_issues">Legal and compliance issues</h4>
<div class="paragraph">
<p>In many industries and locations, there are legal and compliance requirements
to protect sensitive data. If encrypted data is compromised and the plaintext
can be recovered, companies face legal consequences, penalties, or violations
of privacy laws.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it_in_security_framework">How to fix it in Security Framework</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="paragraph">
<p>The following code examples either explicitly or implicitly generate keys.
Note that there are differences in the size of the keys depending on the
algorithm.</p>
</div>
<div class="paragraph">
<p>Due to the mathematical properties of the algorithms, the security requirements
for the key size vary depending on the algorithm.<br>
For example, a 256-bit ECC key provides about the same level of security as a
3072-bit RSA key and a 128-bit symmetric key.</p>
</div>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-swift" data-lang="swift">import Security

// The attributes for the key.
let attributes: [String: Any] = [
    kSecAttrKeyType as String: kSecAttrKeyTypeRSA,
    kSecAttrKeySizeInBits as String: 1024, // Noncompliant: keys of 1024 bits are considered weak.
]

// A call to generate a new private key.
var error: Unmanaged&lt;CFError&gt;?
if let privateKey = SecKeyCreateRandomKey(attributes as CFDictionary, &amp;error) {
    // ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is an example of an Elliptic Curve (EC) initialization. It implicitly
generates a private key whose size is indicated in the elliptic curve name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-swift" data-lang="swift">import Security

// The attributes for the key.
let attributes: [String: Any] = [
    kSecAttrKeyType as String: kSecAttrKeyTypeECSECPrimeRandom,
    kSecAttrKeySizeInBits as String: 192, // Noncompliant: keys of 192 bits are considered weak for EC.
]

// A call to generate a new private key.
var error: Unmanaged&lt;CFError&gt;?
if let privateKey = SecKeyCreateRandomKey(attributes as CFDictionary, &amp;error) {
    // ...
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-swift" data-lang="swift">import Security

// The attributes for the key.
let attributes: [String: Any] = [
    kSecAttrKeyType as String: kSecAttrKeyTypeRSA,
    kSecAttrKeySizeInBits as String: 2048,
]

// A call to generate a new private key.
var error: Unmanaged&lt;CFError&gt;?
if let privateKey = SecKeyCreateRandomKey(attributes as CFDictionary, &amp;error) {
    // ...
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-swift" data-lang="swift">import Security

// The attributes for the key.
let attributes: [String: Any] = [
    kSecAttrKeyType as String: kSecAttrKeyTypeECSECPrimeRandom,
    kSecAttrKeySizeInBits as String: 256,
]

// A call to generate a new private key.
var error: Unmanaged&lt;CFError&gt;?
if let privateKey = SecKeyCreateRandomKey(attributes as CFDictionary, &amp;error) {
    // ...
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_how_does_this_work">How does this work?</h3>
<div class="paragraph">
<p>As a rule of thumb, use the cryptographic algorithms and mechanisms that are
considered strong by the cryptography community.</p>
</div>
<div class="paragraph">
<p>The appropriate choices are the following.</p>
</div>
<div class="sect3">
<h4 id="_rsa_rivest_shamir_adleman_and_dsa_digital_signature_algorithm">RSA (Rivest-Shamir-Adleman) and DSA (Digital Signature Algorithm)</h4>
<div class="paragraph">
<p>The security of these algorithms depends on the difficulty of attacks
attempting to solve their underlying mathematical problem.</p>
</div>
<div class="paragraph">
<p>In general, a minimum key size of <strong>2048</strong> bits is recommended for both.  It
provides 112 bits of security. A key length of <strong>3072</strong> or <strong>4096</strong> should be
preferred when possible.</p>
</div>
</div>
<div class="sect3">
<h4 id="_elliptic_curve_cryptography_ecc">Elliptic Curve Cryptography (ECC)</h4>
<div class="paragraph">
<p>Elliptic curve cryptography is also used in various algorithms, such as ECDSA,
ECDH, or ECMQV. The length of keys generated with elliptic curve algorithms is mentioned
directly in their names. For example, <code>secp256k1</code> generates a 256-bits long
private key.</p>
</div>
<div class="paragraph">
<p>Currently, a minimum key size of <strong>224 bits</strong> is recommended for EC-based
algorithms.</p>
</div>
<div class="paragraph">
<p>Additionally, some curves that theoretically provide sufficiently long keys are
still discouraged. This can be because of a flaw in the curve parameters, a bad
overall design, or poor performance. It is generally advised to use a
NIST-approved elliptic curve wherever possible. Such curves currently include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>NIST P curves with a size of at least 224 bits, e.g. secp256r1.</p>
</li>
<li>
<p>Curve25519, generally known as ed25519 or x25519 depending on its application.</p>
</li>
<li>
<p>Curve448.</p>
</li>
<li>
<p>Brainpool curves with a size of at least 224 bits, e.g. brainpoolP224r1</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_going_the_extra_mile">Going the extra mile</h3>
<div class="sect3">
<h4 id="_pre_quantum_cryptography">Pre-Quantum Cryptography</h4>
<div class="paragraph">
<p>Encrypted data and communications recorded today could be decrypted in the
future by an attack from a quantum computer.<br>
It is important to keep in mind that NIST-approved digital signature schemes,
key agreement, and key transport may need to be replaced with secure
quantum-resistant (or "post-quantum") counterpart.</p>
</div>
<div class="paragraph">
<p>Thus, if data is to remain secure beyond 2030, proactive measures should be
taken now to ensure its safety.</p>
</div>
<div class="paragraph">
<p><a href="https://www.enisa.europa.eu/publications/post-quantum-cryptography-current-state-and-quantum-mitigation">Learn more here</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it_in_swift_crypto">How to fix it in Swift Crypto</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_code_examples_2">Code examples</h3>
<div class="paragraph">
<p>The following code examples either explicitly or implicitly generate keys.
Note that there are differences in the size of the keys depending on the
algorithm.</p>
</div>
<div class="paragraph">
<p>Due to the mathematical properties of the algorithms, the security requirements
for the key size vary depending on the algorithm.<br>
For example, a 256-bit ECC key provides about the same level of security as a
3072-bit RSA key and a 128-bit symmetric key.</p>
</div>
<div class="sect3">
<h4 id="_noncompliant_code_example_2">Noncompliant code example</h4>
<div class="paragraph">
<p>Here is an example of a private key generation with RSA:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-swift" data-lang="swift">import Crypto
import _CryptoExtras

do {
    let privateKey = try _RSA.Encryption.PrivateKey(keySize: _RSA.Signing.KeySize(bitCount: 1024))  // Noncompliant
} catch {
    // ...
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution_2">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-swift" data-lang="swift">import Crypto
import _CryptoExtras

do {
    let privateKey = try _RSA.Encryption.PrivateKey(keySize: .bits2048)
} catch {
    // ...
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_how_does_this_work_2">How does this work?</h3>
<div class="paragraph">
<p>As a rule of thumb, use the cryptographic algorithms and mechanisms that are
considered strong by the cryptography community.</p>
</div>
<div class="paragraph">
<p>The appropriate choices are the following.</p>
</div>
<div class="sect3">
<h4 id="_rsa_rivest_shamir_adleman_and_dsa_digital_signature_algorithm_2">RSA (Rivest-Shamir-Adleman) and DSA (Digital Signature Algorithm)</h4>
<div class="paragraph">
<p>The security of these algorithms depends on the difficulty of attacks
attempting to solve their underlying mathematical problem.</p>
</div>
<div class="paragraph">
<p>In general, a minimum key size of <strong>2048</strong> bits is recommended for both.  It
provides 112 bits of security. A key length of <strong>3072</strong> or <strong>4096</strong> should be
preferred when possible.</p>
</div>
</div>
<div class="sect3">
<h4 id="_elliptic_curve_cryptography_ecc_2">Elliptic Curve Cryptography (ECC)</h4>
<div class="paragraph">
<p>Elliptic curve cryptography is also used in various algorithms, such as ECDSA,
ECDH, or ECMQV. The length of keys generated with elliptic curve algorithms is mentioned
directly in their names. For example, <code>secp256k1</code> generates a 256-bits long
private key.</p>
</div>
<div class="paragraph">
<p>Currently, a minimum key size of <strong>224 bits</strong> is recommended for EC-based
algorithms.</p>
</div>
<div class="paragraph">
<p>Additionally, some curves that theoretically provide sufficiently long keys are
still discouraged. This can be because of a flaw in the curve parameters, a bad
overall design, or poor performance. It is generally advised to use a
NIST-approved elliptic curve wherever possible. Such curves currently include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>NIST P curves with a size of at least 224 bits, e.g. secp256r1.</p>
</li>
<li>
<p>Curve25519, generally known as ed25519 or x25519 depending on its application.</p>
</li>
<li>
<p>Curve448.</p>
</li>
<li>
<p>Brainpool curves with a size of at least 224 bits, e.g. brainpoolP224r1</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_going_the_extra_mile_2">Going the extra mile</h3>
<div class="sect3">
<h4 id="_pre_quantum_cryptography_2">Pre-Quantum Cryptography</h4>
<div class="paragraph">
<p>Encrypted data and communications recorded today could be decrypted in the
future by an attack from a quantum computer.<br>
It is important to keep in mind that NIST-approved digital signature schemes,
key agreement, and key transport may need to be replaced with secure
quantum-resistant (or "post-quantum") counterpart.</p>
</div>
<div class="paragraph">
<p>Thus, if data is to remain secure beyond 2030, proactive measures should be
taken now to ensure its safety.</p>
</div>
<div class="paragraph">
<p><a href="https://www.enisa.europa.eu/publications/post-quantum-cryptography-current-state-and-quantum-mitigation">Learn more here</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Documentation</p>
<div class="ulist">
<ul>
<li>
<p>NIST Documentation - <a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-186.pdf">NIST SP 800-186: Recommendations for Discrete Logarithm-based Cryptography: Elliptic Curve Domain Parameters</a></p>
</li>
<li>
<p>IETF - <a href="https://datatracker.ietf.org/doc/html/rfc5639">rfc5639: Elliptic Curve Cryptography (ECC) Brainpool Standard Curves and Curve Generation</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_articles_blog_posts">Articles &amp; blog posts</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/standard/security/vulnerabilities-cbc-mode">Microsoft, Timing vulnerabilities with CBC-mode symmetric decryption using padding</a></p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Padding_oracle_attack">Wikipedia, Padding Oracle Attack</a></p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack">Wikipedia, Chosen-Ciphertext Attack</a></p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack">Wikipedia, Chosen-Plaintext Attack</a></p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Semantic_security">Wikipedia, Semantically Secure Cryptosystems</a></p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding">Wikipedia, OAEP</a></p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode">Wikipedia, Galois/Counter Mode</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_standards">Standards</h3>
<div class="ulist">
<ul>
<li>
<p>OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a></p>
</li>
<li>
<p>OWASP - <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data Exposure</a></p>
</li>
<li>
<p>OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security Misconfiguration</a></p>
</li>
<li>
<p>OWASP - <a href="https://mas.owasp.org/checklists/MASVS-CRYPTO/">Mobile AppSec Verification Standard - Cryptography Requirements</a></p>
</li>
<li>
<p>OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">Mobile Top 10 2016 Category M5 - Insufficient Cryptography</a></p>
</li>
<li>
<p>OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2023-risks/m10-insufficient-cryptography">Mobile Top 10 2024 Category M10 - Insufficient Cryptography</a></p>
</li>
<li>
<p><a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-131Ar1.pdf">NIST 800-131A</a> - Recommendation for Transitioning the Use of Cryptographic Algorithms and Key Lengths</p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/326">CWE-326 - Inadequate Encryption Strength</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a></p>
</li>
<li>
<p><a href="https://wiki.sei.cmu.edu/confluence/x/hDdGBQ">CERT, MSC61-J.</a> - Do not use insecure or weak cryptographic algorithms</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Use a key length of at least 'xxx' bits for 'xxx' cipher algorithm.</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_deprecates_s4787">deprecates: <a data-rspec-id="S4787" class="rspec-auto-link">S4787</a></h3>

</div>
<div class="sect2">
<h3 id="_relates_to_s4787">relates to: <a data-rspec-id="S4787" class="rspec-auto-link">S4787</a></h3>

</div>
</div>
</div>