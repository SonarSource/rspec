<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Web browsers, CDNs or similar proxy-servers can cache HTTP responses (especially large content such as images, scripts etc) to improve web browsing performance and to not overload the application serving the resources. However this may lead to privacy issues if a private web page containing personal user information is cached and served to another user. A different type of attacks allowed when caching resources at the web-browser level is cross-site leak attacks/side-channel attacks, here the attacker infers information about an user (for instance,  web page he is visiting) by observing timing responses or other relevant data when requesting private resources that may be cached.</p>
</div>
<div class="paragraph">
<p>Example of a side channel attack:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The attacker wants to known if a user is involved in a confidential agreement between two companies A and B.</p>
</li>
<li>
<p>If it is the case, the user can access to the resource <em>contract-between-A-and-B.png</em> after being authenticated on a website.</p>
</li>
<li>
<p>The attacker tricks the user to visit a malicious website containing the below code in order to determine the desired information:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;img id="leakyimage" src=""&gt;
&lt;script language="javascript"&gt;
  leakyimage.src = "https://targetexample.com/private/contract-between-A-and-B.png";

  leakyimage.onload = function SideChannelObservations() {
    // compare timing between a cached image and not cached image
    // or success of load
    // in order to determine if the image is cached and so if the user has right to access to this image
  }
&lt;/script&gt;</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ask_yourself_whether">Ask Yourself Whether</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>The web application serves HTTP responses which contain confidential information belonging to an authenticated user for instance.</p>
</li>
<li>
<p>Resources like images or documents (contract.png, attachment.png etc&#8230;&#8203;) are only accessible to private groups (authenticated, administrators &#8230;&#8203;) of users.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There is a risk if you answered yes to any of those questions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_recommended_secure_coding_practices">Recommended Secure Coding Practices</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Implement <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cache-Control">Cache-Control</a> HTTP header with a cacheability directive set to <code>private</code> in order to instruct shared caches (CDNs, proxies) to avoid caching. If the risk is too important, it is recommended to not cache anything at the web browser level too, with a cacheability directive set to <code>no-store</code>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sensitive_code_example">Sensitive Code Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In Express.js application the code is sensitive if the <a href="https://www.npmjs.com/package/nocache">helmet nocache</a> middleware is not used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>const express = require('express');
let app = express(); // Sensitive</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In Express.js application a standard way to implement cache-control HTTP header with no-store directive is with the <a href="https://www.npmjs.com/package/nocache">helmet nocache</a> middleware:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const express = require('express');
const nocache = require('nocache');
const helmet = require('helmet');

let app = express();
app.use(nocache()); // Compliant
// or
app.use(helmet.nocache()); // Compliant</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a></p>
</li>
<li>
<p>OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/525">CWE-525 - Use of Web Browser Cache Containing Sensitive Information</a></p>
</li>
<li>
<p>OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data Exposure</a></p>
</li>
<li>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cache-Control">developer.mozilla.org</a> - Cache-Control</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Make sure allowing HTTP responses caching is safe here.</p>
</div>
</div>
</div>
</div>