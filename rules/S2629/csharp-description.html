<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Logging arguments should not require evaluation in order to avoid unnecessary performance overhead. When passing concatenated strings or string interpolations directly into a logging method, the evaluation of these expressions occurs every time the logging method is called, regardless of the log level. This can lead to inefficient code execution and increased resource consumption.</p>
</div>
<div class="paragraph">
<p>Instead, it is recommended to use the overload of the logger that accepts a log format and its arguments as separate parameters. By separating the log format from the arguments, the evaluation of expressions can be deferred until it is necessary, based on the log level. This approach improves performance by reducing unnecessary evaluations and ensures that logging statements are only evaluated when needed.</p>
</div>
<div class="paragraph">
<p>Furthermore, using a constant log format enhances observability and facilitates searchability in log aggregation and monitoring software.</p>
</div>
<div class="paragraph">
<p>The rule covers the following logging frameworks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.nuget.org/packages/Microsoft.Extensions.Logging">Microsoft.Extensions.Logging</a></p>
</li>
<li>
<p><a href="https://www.nuget.org/packages/Castle.Core">Castle.Core</a></p>
</li>
<li>
<p><a href="https://www.nuget.org/packages/log4net">log4net</a></p>
</li>
<li>
<p><a href="https://www.nuget.org/packages/Serilog">Serilog</a></p>
</li>
<li>
<p><a href="https://www.nuget.org/packages/NLog">Nlog</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Use an overload that takes the log format and the parameters as separate arguments. The log format should be a constant string.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">logger.DebugFormat($"The value of the parameter is: {parameter}.");</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">logger.DebugFormat("The value of the parameter is: {Parameter}.", parameter);</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Microsoft Learn - <a href="https://learn.microsoft.com/en-us/dotnet/api/system.runtime.compilerservices.interpolatedstringhandlerattribute">InterpolatedStringHandlerArgumentAttribute</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_benchmarks">Benchmarks</h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Runtime</th>
<th class="tableblock halign-left valign-top">Mean</th>
<th class="tableblock halign-left valign-top">Standard Deviation</th>
<th class="tableblock halign-left valign-top">Allocated</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CastleCoreLoggingTemplateNotConstant</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET 9.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">230.306 us</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.7116 us</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">479200 B</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CastleCoreLoggingTemplateConstant</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET 9.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">46.827 us</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.4743 us</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">560000 B</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CastleCoreLoggingTemplateNotConstant</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET Framework 4.8.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1,060.413 us</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32.3559 us</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1115276 B</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CastleCoreLoggingTemplateConstant</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET Framework 4.8.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">93.697 us</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.8201 us</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">561650 B</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MSLoggingTemplateNotConstant</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET 9.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">333.246 us</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12.9214 us</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">479200 B</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MSLoggingTemplateConstant</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET 9.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">441.118 us</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">68.7999 us</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">560000 B</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MSLoggingTemplateNotConstant</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET Framework 4.8.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1,542.076 us</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">99.3423 us</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1115276 B</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MSLoggingTemplateConstant</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET Framework 4.8.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">698.071 us</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">18.6319 us</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">561653 B</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NLogLoggingTemplateNotConstant</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET 9.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">178.789 us</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9.2528 us</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">479200 B</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NLogLoggingTemplateConstant</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET 9.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6.009 us</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.3303 us</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NLogLoggingTemplateNotConstant</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET Framework 4.8.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1,086.260 us</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">44.1670 us</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1115276 B</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NLogLoggingTemplateConstant</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET Framework 4.8.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">25.132 us</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.5666 us</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SerilogLoggingTemplateNotConstant</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET 9.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">234.460 us</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7.4831 us</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">479200 B</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SerilogLoggingTemplateConstant</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET 9.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">49.854 us</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.8232 us</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SerilogLoggingTemplateNotConstant</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET Framework 4.8.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1,103.939 us</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">47.0203 us</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1115276 B</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SerilogLoggingTemplateConstant</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET Framework 4.8.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">35.752 us</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.6022 us</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log4NetLoggingTemplateNotConstant</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET 9.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">255.754 us</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5.6046 us</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">479200 B</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log4NetLoggingTemplateConstant</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET 9.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">46.425 us</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.7087 us</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">240000 B</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log4NetLoggingTemplateNotConstant</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET Framework 4.8.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1,109.874 us</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">23.4388 us</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1115276 B</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log4NetLoggingTemplateConstant</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET Framework 4.8.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">92.305 us</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.4161 us</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">240707 B</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_glossary">Glossary</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://en.wikipedia.org/wiki/Arithmetic_mean">Mean</a></p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Standard_deviation">Standard Deviation</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The results were generated by running the following snippet with <a href="https://github.com/dotnet/BenchmarkDotNet">BenchmarkDotNet</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Microsoft.Extensions.Logging;
using ILogger = Microsoft.Extensions.Logging.ILogger;

[Params(10_000)]
public int Iterations;

private ILogger ms_logger;
private Castle.Core.Logging.ILogger cc_logger;
private log4net.ILog l4n_logger;
private Serilog.ILogger se_logger;
private NLog.ILogger nl_logger;

[GlobalSetup]
public void GlobalSetup()
{
    ms_logger = new LoggerFactory().CreateLogger&lt;LoggingTemplates&gt;();
    cc_logger = new Castle.Core.Logging.NullLogFactory().Create("Castle.Core.Logging");
    l4n_logger = log4net.LogManager.GetLogger(typeof(LoggingTemplates));
    se_logger = Serilog.Log.Logger;
    nl_logger = NLog.LogManager.GetLogger("NLog");
}

[BenchmarkCategory("Microsoft.Extensions.Logging")]
[Benchmark]
public void MSLoggingTemplateNotConstant()
{
    for (int i = 0; i &lt; Iterations; i++)
    {
        ms_logger.LogInformation($"Param: {i}");
    }
}

[BenchmarkCategory("Microsoft.Extensions.Logging")]
[Benchmark]
public void MSLoggingTemplateConstant()
{
    for (int i = 0; i &lt; Iterations; i++)
    {
        ms_logger.LogInformation("Param: {Parameter}", i);
    }
}

[BenchmarkCategory("Castle.Core.Logging")]
[Benchmark]
public void CastleCoreLoggingTemplateNotConstant()
{
    for (int i = 0; i &lt; Iterations; i++)
    {
        cc_logger.Info($"Param: {i}");
    }
}

[BenchmarkCategory("Castle.Core.Logging")]
[Benchmark]
public void CastleCoreLoggingTemplateConstant()
{
    for (int i = 0; i &lt; Iterations; i++)
    {
        cc_logger.InfoFormat("Param: {Parameter}", i);
    }
}

[BenchmarkCategory("log4net")]
[Benchmark]
public void Log4NetLoggingTemplateNotConstant()
{
    for (int i = 0; i &lt; Iterations; i++)
    {
        l4n_logger.Info($"Param: {i}");
    }
}

[BenchmarkCategory("log4net")]
[Benchmark]
public void Log4NetLoggingTemplateConstant()
{
    for (int i = 0; i &lt; Iterations; i++)
    {
        l4n_logger.InfoFormat("Param: {Parameter}", i);
    }
}

[BenchmarkCategory("Serilog")]
[Benchmark]
public void SerilogLoggingTemplateNotConstant()
{
    for (int i = 0; i &lt; Iterations; i++)
    {
        se_logger.Information($"Param: {i}");
    }
}

[BenchmarkCategory("Serilog")]
[Benchmark]
public void SerilogLoggingTemplateConstant()
{
    for (int i = 0; i &lt; Iterations; i++)
    {
        se_logger.Information("Param: {Parameter}", i);
    }
}

[BenchmarkCategory("NLog")]
[Benchmark]
public void NLogLoggingTemplateNotConstant()
{
    for (int i = 0; i &lt; Iterations; i++)
    {
        nl_logger.Info($"Param: {i}");
    }
}

[BenchmarkCategory("NLog")]
[Benchmark]
public void NLogLoggingTemplateConstant()
{
    for (int i = 0; i &lt; Iterations; i++)
    {
        nl_logger.Info("Param: {Parameter}", i);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Hardware Configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>BenchmarkDotNet v0.14.0, Windows 10 (10.0.19045.5247/22H2/2022Update)
12th Gen Intel Core i7-12800H, 1 CPU, 20 logical and 14 physical cores
  [Host]               : .NET Framework 4.8.1 (4.8.9282.0), X64 RyuJIT VectorSize=256
  .NET 9.0             : .NET 9.0.0 (9.0.24.52809), X64 RyuJIT AVX2
  .NET Framework 4.8.1 : .NET Framework 4.8.1 (4.8.9282.0), X64 RyuJIT VectorSize=256</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>