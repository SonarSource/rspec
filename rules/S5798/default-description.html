<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If a buffer contains sensitive data, such as passwords or access tokens, it is good practice to overwrite the buffer before releasing the memory. This ensures that the sensitive data is not available when that memory is reallocated. The <code>memset</code> function is commonly used for this purpose.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The C language specification allows the compiler to remove unnecessary code during the optimization phase. For example, when a memory buffer is about to be destroyed, any writes to that buffer may be seen as unnecessary to the operation of the program. The compiler may choose to remove these write operations.</p>
</div>
<div class="paragraph">
<p>When the <code>memset</code> function is used to clear sensitive data from memory and that memory is destroyed immediately afterward, the compiler may see the <code>memset</code> call as unnecessary and remove it. The sensitive data will, therefore, remain in memory.</p>
</div>
<div class="paragraph">
<p>This rule raises an issue when a call to <code>memset</code> is followed by the destruction of the buffer.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The function <a href="https://en.cppreference.com/w/c/string/byte/memset"><code>memset_s</code></a> behaves similarly to <code>memset</code>. The main difference is that it cannot be optimized away and the memory will be overwritten in all cases. You should use <code>memset_s</code> to clear security-sensitive data.</p>
</div>
<div class="paragraph">
<p>The <code>memset_s</code> function is defined in annex K of C11 and is optional for C11 compilers. It will only be available if the macro <code>__STDC_LIB_EXT1__</code> is defined, and it must be enabled by defining the macro <code>__STDC_WANT_LIB_EXT1__</code> before including <code>&lt;string.h&gt;</code>.</p>
</div>
<div class="paragraph">
<p>Other platform-specific functions can perform the same operation, such as <a href="https://docs.microsoft.com/en-us/previous-versions/windows/desktop/legacy/aa366877(v=vs.85)?redirectedfrom=MSDN">SecureZeroMemory</a> (Windows) or <a href="https://www.freebsd.org/cgi/man.cgi?query=explicit_bzero">explicit_bzero</a> (FreeBSD).</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">#include &lt;string&gt;

void f(char *password, size_t bufferSize) {
  char localToken[256];
  init(localToken, password);
  memset(password, 0, strlen(password));  // Noncompliant
  memset(localToken, 0, strlen(localToken));  // Noncompliant
  free(password);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>memset</code> calls may be optimized away because <code>password</code> is about to be freed and <code>localToken</code> is about to go out of scope.</p>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">#define __STDC_WANT_LIB_EXT1__
#include &lt;string&gt;

void f(char *password, size_t bufferSize) {
  char localToken[256];
  init(localToken, password);
  memset_s(password, bufferSize, 0, strlen(password));
  memset_s(localToken, sizeof(localToken), 0, strlen(localToken));
  free(password);
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>C&#43;&#43; reference - <a href="https://en.cppreference.com/w/c/string/byte/memset"><code>memset</code>, <code>memset_s</code></a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_standards">Standards</h3>
<div class="ulist">
<ul>
<li>
<p>OWASP - <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data Exposure</a></p>
</li>
<li>
<p>OWASP - <a href="https://github.com/OWASP/ASVS/blob/master/4.0/en/0x16-V8-Data-Protection.md#v83-sensitive-private-data">Application Security Verification Standard 4.0 - 8.3.6</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/14">CWE-14 - Compiler Removal of Code to Clear Buffers</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Use "memset_s" if you want to scrub memory, or remove this useless operation</p>
</div>
</div>
</div>
</div>