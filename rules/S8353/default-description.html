<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is an issue when pipeline parameters use environment variables (env.*) in their default values, as these variables are not available during parameter definition.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Pipeline parameters are defined before the pipeline starts executing, but environment variables only become available after a node is allocated and the pipeline begins running. This creates a timing problem where the environment variables will be null or undefined when the parameter defaults are evaluated.</p>
</div>
<div class="paragraph">
<p>This can lead to several problems:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Parameters may receive null or empty values instead of the intended defaults</p>
</li>
<li>
<p>Runtime errors when the pipeline tries to use these undefined values</p>
</li>
<li>
<p>Unpredictable behavior that&#8217;s difficult to debug</p>
</li>
<li>
<p>Inconsistent pipeline behavior across different environments</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The fundamental issue is a chicken-and-egg problem: you need environment variables to set parameter defaults, but you need to define parameters before the environment is available.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>Using environment variables in parameter defaults can cause pipeline failures, unpredictable behavior, and make debugging difficult. Parameters may receive unexpected null values, leading to runtime errors or incorrect pipeline execution paths.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Replace environment variable references with static values or computed variables that are available during parameter definition. Use context like BRANCH_NAME that&#8217;s available early in the pipeline lifecycle.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">pipeline {
  parameters {
    string(name: 'BUILD_ARCH', defaultValue: "${env.BUILD_ARCHS}", description: 'Architecture to build') // Noncompliant
    booleanParam(name: 'DEPLOY', defaultValue: env.AUTO_DEPLOY == 'true', description: 'Deploy after build') // Noncompliant
  }
  stages {
    // pipeline stages
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">def defaultArch = 'linux-x86_64'
def defaultDeploy = BRANCH_NAME != 'production'

pipeline {
  parameters {
    string(name: 'BUILD_ARCH', defaultValue: defaultArch, description: 'Architecture to build')
    booleanParam(name: 'DEPLOY', defaultValue: defaultDeploy, description: 'Deploy after build')
  }
  stages {
    // pipeline stages
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Jenkins Pipeline Parameters - <a href="https://www.jenkins.io/doc/book/pipeline/syntax/#parameters">Official Jenkins documentation on pipeline parameters and their usage</a></p>
</li>
<li>
<p>Jenkins Environment Variables - <a href="https://www.jenkins.io/doc/book/pipeline/jenkinsfile/#using-environment-variables">Documentation on when and how environment variables are available in Jenkins pipelines</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>