<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There&#8217;s no point in chaining multiple <code>OrderBy</code> calls in a LINQ; only the last one will be reflected in the result because each subsequent call completely reorders the list. Thus, calling <code>OrderBy</code> multiple times is a performance issue as well, because all of the sorting will be executed, but only the result of the last sort will be kept.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Instead, use <code>ThenBy</code> for each call after the first.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">var x = personList
  .OrderBy(person =&gt; person.Age)
  .OrderBy(person =&gt; person.Name)  // Noncompliant
  .ToList();  // x is sorted by Name, not sub-sorted</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">var x = personList
  .OrderBy(person =&gt; person.Age)
  .ThenBy(person =&gt; person.Name)
  .ToList();</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_benchmarks">Benchmarks</h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Runtime</th>
<th class="tableblock halign-left valign-top">Mean</th>
<th class="tableblock halign-left valign-top">StdDev</th>
<th class="tableblock halign-left valign-top">Allocated</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OrderByAge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET 9.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12.84 ms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.804 ms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.53 MB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OrderByAgeOrderBySize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET 9.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">24.08 ms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.267 ms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.05 MB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OrderByAgeThenBySize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET 9.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">18.58 ms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.747 ms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.91 MB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OrderByAge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET Framework 4.8.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">22.99 ms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.228 ms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.53 MB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OrderByAgeOrderBySize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET Framework 4.8.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">44.90 ms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.581 ms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.3 MB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OrderByAgeThenBySize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET Framework 4.8.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">31.72 ms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.402 ms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.91 MB</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_glossary">Glossary</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://en.wikipedia.org/wiki/Arithmetic_mean">Mean</a></p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Standard_deviation">Standard Deviation</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The results were generated by running the following snippet with <a href="https://github.com/dotnet/BenchmarkDotNet">BenchmarkDotNet</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">public class Person
{
    public string Name { get; set; }
    public int Age { get; set; }
    public int Size { get; set; }
}

private Random random = new Random(1);
private Consumer consumer = new Consumer();
private Person[] array;

[Params(100_000)]
public int N { get; set; }

[GlobalSetup]
public void GlobalSetup()
{
    array = Enumerable.Range(0, N).Select(x =&gt; new Person
    {
      Name = Path.GetRandomFileName(),
      Age = random.Next(0, 100),
      Size = random.Next(0, 200)
    }).ToArray();
}

[Benchmark(Baseline = true)]
public void OrderByAge() =&gt;
    array.OrderBy(x =&gt; x.Age).Consume(consumer);

[Benchmark]
public void OrderByAgeOrderBySize() =&gt;
    array.OrderBy(x =&gt; x.Age).OrderBy(x =&gt; x.Size).Consume(consumer);

[Benchmark]
public void OrderByAgeThenBySize() =&gt;
    array.OrderBy(x =&gt; x.Age).ThenBy(x =&gt; x.Size).Consume(consumer);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Hardware configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>BenchmarkDotNet v0.14.0, Windows 10 (10.0.19045.5247/22H2/2022Update)
Intel Core Ultra 7 165H, 1 CPU, 22 logical and 16 physical cores
  [Host]               : .NET Framework 4.8.1 (4.8.9282.0), X64 RyuJIT VectorSize=256
  .NET 9.0             : .NET 9.0.0 (9.0.24.52809), X64 RyuJIT AVX2
  .NET Framework 4.8.1 : .NET Framework 4.8.1 (4.8.9282.0), X64 RyuJIT VectorSize=256</code></pre>
</div>
</div>
<hr>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Use "ThenBy" instead.</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_30_jun_2015_135154_ann_campbell_wrote">on 30 Jun 2015, 13:51:54 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~tamas.vajk] I wonder if this is also an efficiency issue. The end result is a list that is sorted only by the last OrderBy argument, but doe all the previous OrderBy&#8217;s take place, then get thrown away? If so, this would probably be worth adding to the description.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_30_jun_2015_135528_tamas_vajk_wrote">on 30 Jun 2015, 13:55:28 Tamas Vajk wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] I added a performance related sentence.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_30_jun_2015_145239_ann_campbell_wrote">on 30 Jun 2015, 14:52:39 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>I shuffled the text some, [~tamas.vajk]</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_1_jul_2015_064010_tamas_vajk_wrote">on 1 Jul 2015, 06:40:10 Tamas Vajk wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] Shouldn&#8217;t this issue have some performance related label as well?</p>
</div>
<div class="paragraph">
<p>I simplified the message as the ordering might not happen by some property, but by some complex logic, and in this case we can&#8217;t display the whole expression and <code>Comparer</code> in the message.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_1_jul_2015_112648_ann_campbell_wrote">on 1 Jul 2015, 11:26:48 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>added [~tamas.vajk]</p>
</div>
</div>
</div>
</div>