<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This rule raises an issue when a dictionary comprehension uses a static key.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Dictionary comprehensions are a concise way to create dictionaries, typically by dynamically generating key-value pairs during iteration.
When the key part of a dictionary comprehension is static (e.g., a string literal like <code>"key"</code> or a variable defined outside the comprehension that isn&#8217;t updated during the comprehension),
each iteration of the comprehension will attempt to assign a value to this <strong>same single key</strong>.</p>
</div>
<div class="paragraph">
<p>The consequence is that the dictionary will only contain one entry for that static key,
and its value will be the one computed during the <strong>last</strong> iteration of the comprehension.
This behavior is often a misunderstanding of how dictionary comprehensions work or a logical error, as the intention is usually to create multiple distinct key-value pairs.</p>
</div>
<div class="paragraph">
<p>Consider this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">data = ["apple", "banana", "cherry"]

# Each iteration overwrites the value associated with "fruit_type"
result_dict = {"fruit_type": value.capitalize() for value in data}
# After the first iteration: {"fruit_type": "Apple"}
# After the second iteration: {"fruit_type": "Banana"}
# Final result: {"fruit_type": "Cherry"}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the code above, the loop iterates three times, but because <code>"fruit_type"</code> is always the same key, the final dictionary <code>result_dict</code> will only be <code>{'fruit_type': 'CHERRY'}</code>.
All previous assignments for this key are overwritten. This is usually not what the developer intends when using a comprehension over <code>data</code>.</p>
</div>
<div class="paragraph">
<p>If the goal was to have multiple distinct keys, the key expression in the comprehension must vary with each iteration.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To fix this issue ensure that the key expression within the dictionary comprehension is dynamic, meaning it changes with each iteration, typically by using the iteration variable(s).
This ensures that unique keys are generated, leading to a dictionary with multiple entries as usually intended.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">data = ["some", "Data"]

output_dict = {"key": value.upper() for value in data} # Noncompliant: "key" is not modify for each iteration</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">data = ["some", "Data"]

output_dict = {value: value.upper() for value in data} # Compliant</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Python Documentation - <a href="https://docs.python.org/3/tutorial/datastructures.html#dictionaries">Dictionaries</a></p>
</li>
<li>
<p>Python Documentation - <a href="https://docs.python.org/3/reference/expressions.html#dictionary-displays">Dictionary displays</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="paragraph">
<p>We should detect when a String literal is used as the key, and a generator as the value.
We could detect if the string literal is assigned to a value which is used as the key (and defined outside of the comprehension), and a generator as the value.</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Replace this static key with a dynamic one.</p>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="paragraph">
<p>The static key</p>
</div>
<hr>
</div>
</div>
</div>