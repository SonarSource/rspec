<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Overly complicated regular expressions are hard to read and to maintain and can easily cause hard-to-find bugs. If a regex is too complicated, you should consider replacing it or parts of it with regular code or splitting it apart into multiple patterns at least.</p>
</div>
<div class="paragraph">
<p>The complexity of a regular expression is determined as follows:</p>
</div>
<div class="paragraph">
<p>Each of the following operators increases the complexity by an amount equal to the current nesting level and also increases the current nesting level by one for its arguments:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>|</code> - when multiple <code>|</code> operators are used together, the subsequent ones only increase the complexity by 1</p>
</li>
<li>
<p><code>&amp;&amp;</code> (inside character classes) - when multiple <code>&amp;&amp;</code> operators are used together, the subsequent ones only increase the complexity by 1</p>
</li>
<li>
<p>Quantifiers (<code>*</code>, <code>+</code>, <code>?</code>, <code>{n,m}</code>, <code>{n,}</code> or <code>{n}</code>)</p>
</li>
<li>
<p>Non-capturing groups that set flags (such as <code>(?i:some_pattern)</code> or <code>(?i)some_pattern</code>)</p>
</li>
<li>
<p>Lookahead and lookbehind assertions</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additionally, each use of the following features increase the complexity by 1 regardless of nesting:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>character classes</p>
</li>
<li>
<p>back references</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If a regular expression is split among multiple variables, the complexity is calculated for each variable individually, not for the whole regular expression. If a regular expression is split over multiple lines, each line is treated individually if it is accompanied by a comment (either a Java comment or a comment within the regular expression), otherwise the regular expression is analyzed as a whole.</p>
</div>
<div class="sect2">
<h3 id="_noncompliant_code_example">Noncompliant code example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">if (dateString.matches(Regex("^(?:(?:31(\\/|-|\\.)(?:0?[13578]|1[02]))\\1|(?:(?:29|30)(\\/|-|\\.)(?:0?[13-9]|1[0-2])\\2))(?:(?:1[6-9]|[2-9]\\d)?\\d{2})$|^(?:29(\\/|-|\\.)0?2\\3(?:(?:(?:1[6-9]|[2-9]\\d)?(?:0[48]|[2468][048]|[13579][26])|(?:(?:16|[2468][048]|[3579][26])00))))$|^(?:0?[1-9]|1\\d|2[0-8])(\\/|-|\\.)(?:(?:0?[1-9])|(?:1[0-2]))\\4(?:(?:1[6-9]|[2-9]\\d)?\\d{2})$"))) {
    handleDate(dateString)
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_compliant_solution">Compliant solution</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">if (dateString.matches(Regex("^\\d{1,2}([-/.])\\d{1,2}\\1\\d{1,4}$"))) {
    val dateParts = dateString.split("[-/.]").toTypedArray()
    val day = dateParts[0].toInt()
    val month = dateParts[1].toInt()
    val year = dateParts[2].toInt()
    // Put logic to validate and process the date based on its integer parts here
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_exceptions">Exceptions</h3>
<div class="paragraph">
<p>Regular expressions are only analyzed if all parts of the regular expression are either string literals, effectively final local variables or <code>static final</code> fields, all of which can be combined using the '<code>+</code>' operator.</p>
</div>
<div class="paragraph">
<p>When a regular expression is split among multiple variables or commented lines, each part is only analyzed if it is syntactically valid by itself.</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Simplify this regular expression to reduce its complexity from x to the y allowed.</p>
</div>
</div>
<div class="sect2">
<h3 id="_parameters">Parameters</h3>
<div class="sidebarblock">
<div class="content">
<div class="title">maxComplexity</div>
<div class="listingblock">
<div class="content">
<pre>20</pre>
</div>
</div>
<div class="paragraph">
<p>The maximum allowed complexity.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="paragraph">
<p>The regular expression</p>
</div>
</div>
</div>
</div>