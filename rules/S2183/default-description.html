<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/operators/bitwise-and-shift-operators#left-shift-operator-">shifting</a> operators are used to do an <a href="https://en.wikipedia.org/wiki/Arithmetic_shift">arithmetic shift</a> to the bits of an <a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/builtin-types/integral-numeric-types">integral numeric</a> value, either to the left or the right.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">var number = 14;         // ...01110 (14)
var left = number &lt;&lt; 1;  // ...11100 (28)
var right = number &gt;&gt; 1; // ...00111 (7)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Therefore, shifting an integral number by 0 is equivalent to doing nothing, since the bits do not move any positions to the left or the right.</p>
</div>
<div class="paragraph">
<p>On the other hand, shifting an integral number by a value greater than their count of bits minus one (<code>n_bits-1</code>) is equivalent to shifting by the value <a href="https://en.wikipedia.org/wiki/Modulo">modulo</a> the bit count of the number (<code>value % n_bits</code>).</p>
</div>
<div class="paragraph">
<p>In the case of <code>int</code> and <code>uint</code>, which take 32 bits in the memory, the shift count is given by the five low-order bits of the second operand, which can represent numbers from 0 to 31. This means that numbers having the same five low-order bits are treated the same by the shift operators.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">var one =         0b0_00001;
var thirtyThree = 0b1_00001; // Same five low-order bits, 33 % 32 = 1

var shifted1 = 42 &lt;&lt; one;           // Results in 84
var shifted2 = 42 &lt;&lt; thirtyThree;   // Results in 84</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that integral number with a less than 32-bit quantity (e.g. <code>short</code>, <code>ushort</code>) are implicitly converted to <code>int</code> before the shifting operation and so the rule for <code>int</code>/<code>uint</code> applies.</p>
</div>
<div class="paragraph">
<p>If the first operand is a <code>long</code> or <code>ulong</code> (64-bit quantity), the shift count is given by the six low-order bits of the second operand. That is, the actual shift count is 0 to 63 bits.</p>
</div>
<div class="sect2">
<h3 id="_exceptions">Exceptions</h3>
<div class="paragraph">
<p>This rule doesn&#8217;t raise an issue when the shift by zero is obviously for cosmetic reasons:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When the value shifted is a literal.</p>
</li>
<li>
<p>When there is a similar shift at the same position on line before or after. E.g.:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>bytes[loc+0] = (byte)(value &gt;&gt; 8);
bytes[loc+1] = (byte)(value &gt;&gt; 0);</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">short s = 1;
short shortShift1 = (short)(s &lt;&lt; 0); // Noncompliant: the value does not change
short shortShift2 = (short)(s &lt;&lt; 33); // Noncompliant: this is equivalent to shifting by 1

int i = 1;
int intShift = i &lt;&lt; 33; // Noncompliant: this is equivalent to shifting by 1

long lg = 1;
long longShift1 = lg &lt;&lt; 0; // Noncompliant: the value does not change
long longShift2 = lg &lt;&lt; 65; // Noncompliant: this is equivalent to shifting by 1</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">short s = 1;
short shortShift1 = s;
short shortShift2 = (short)(s &lt;&lt; 1);

int i = 1;
var intShift = i &lt;&lt; 1;

long lg = 1;
var longShift1 = lg;
var longShift2 = lg &lt;&lt; 1;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Microsoft Learn - <a href="https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/operators/bitwise-and-shift-operators#left-shift-operator-">Bitwise and shift operators (C# reference)</a></p>
</li>
<li>
<p>Wikipedia - <a href="https://en.wikipedia.org/wiki/Arithmetic_shift">Arithmetic shift</a></p>
</li>
<li>
<p>Wikipedia - <a href="https://en.wikipedia.org/wiki/Modulo">Modulo</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Either make "xxx" a "long" or correct this shift to (shiftBy%32).</p>
</div>
<div class="paragraph">
<p>Correct this shift to (shiftBy%64).</p>
</div>
<div class="paragraph">
<p>Remove this useless shift (multiple of 32/64).</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_21_nov_2024_164800_alban_auzeill_wrote">on 21 Nov 2024, 16:48:00 Alban Auzeill wrote:</h3>
<div class="paragraph">
<p>[test-code-support-investigation-for-java] Decision for scope: Main &#8594; All.</p>
</div>
</div>
<div class="sect2">
<h3 id="_relates_to_s875">relates to: <a data-rspec-id="S875" class="rspec-auto-link">S875</a></h3>

</div>
<div class="sect2">
<h3 id="_on_30_oct_2014_103308_evgeny_mandrikov_wrote">on 30 Oct 2014, 10:33:08 Evgeny Mandrikov wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] what about shifting long by 64? shouldn&#8217;t it be a part of this rule?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_30_oct_2014_113810_ann_campbell_wrote">on 30 Oct 2014, 11:38:10 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>Good point [~evgeny.mandrikov]. Thanks.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_30_oct_2014_121259_evgeny_mandrikov_wrote">on 30 Oct 2014, 12:12:59 Evgeny Mandrikov wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] maybe better to use term "bits" instead of "size"&#8230;&#8203;</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_30_oct_2014_123212_evgeny_mandrikov_wrote">on 30 Oct 2014, 12:32:12 Evgeny Mandrikov wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] thanks!</p>
</div>
</div>
</div>
</div>