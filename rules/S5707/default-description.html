<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This rule raise an issue if something other than <code>None</code> or a valid exception is provided as the cause of an exception chain.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Exception chaining enables users to see if an exception is the direct consequence of another exception (see <a href="https://peps.python.org/pep-3134/">PEP-3134</a>). This is useful to propagate the original context of the error.</p>
</div>
<div class="paragraph">
<p>Exceptions are chained using either of the following syntax:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>With the <code>from</code> keyword</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">try:
    ...
except OSError as e:
    raise RuntimeError("Something went wrong") from e</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>With the <code>__cause__</code> property</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">try:
    ...
except OSError as e:
    new_exception = RuntimeError("Something went wrong")
    new_exception.__cause__ = e
    raise new_exception</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also possible to erase a chaining by setting <code>new_exception.__cause__ = None</code> or using <code>raise new_exception from None</code> (see <a href="https://peps.python.org/pep-0409/">PEP-409</a>).</p>
</div>
<div class="paragraph">
<p>Chaining will fail and raise a <code>TypeError</code> if something other than <code>None</code> or a valid exception, i.e. an instance or a subclass of <code>BaseException</code>, is provided.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Make sure the cause of a chain of exceptions is either <code>None</code> or a valid exception.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">class A:
    pass

try:
    raise ValueError("orig")
except ValueError as e:
    new_exc = TypeError("new")
    new_exc.__cause__ = A()  # Noncompliant: A is not a subclass of BaseException.
    raise new_exc

try:
    raise ValueError("orig")
except ValueError as e:
    raise TypeError("new") from "test"  # Noncompliant: "test" is not a valid exception.</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">try:
    raise ValueError("orig")
except ValueError as e:
    new_exc = TypeError("new")
    new_exc.__cause__ = None  # Ok
    raise new_exc

try:
    raise ValueError("orig")
except ValueError as e:
    new_exc = TypeError("new")
    new_exc.__cause__ = e  # Ok
    raise new_exc

try:
    raise ValueError("orig")
except ValueError as e:
    raise TypeError("new") from None  # Ok

try:
    raise ValueError("orig")
except ValueError as e:
    raise TypeError("new") from e  # Ok</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.python.org/3/library/exceptions.html">Built-in Exceptions</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_standards">Standards</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://peps.python.org/pep-3134/">Exception Chaining and Embedded Tracebacks</a> - PEP 3134</p>
</li>
<li>
<p><a href="https://peps.python.org/pep-0409/">Suppressing exception context</a> - PEP 409</p>
</li>
<li>
<p><a href="https://peps.python.org/pep-0352/#exception-hierarchy-changes">Required Superclass for Exceptions</a> - PEP 352</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Replace this expression of type X with an exception or None</p>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="ulist">
<ul>
<li>
<p>In a "raise X from Y" statement:</p>
<div class="ulist">
<ul>
<li>
<p>highlight Y</p>
</li>
</ul>
</div>
</li>
<li>
<p>In an "myexception.<em>cause</em> = Y" statement:</p>
<div class="ulist">
<ul>
<li>
<p>highlight Y</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>