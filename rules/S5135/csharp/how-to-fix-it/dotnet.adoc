=== How to fix it in .Net

The following code is vulnerable to deserialization attacks because it
deserializes HTTP data without validating it first.

[cols="a"]
|===
h| Non-compliant code example
|
[source,csharp]
----
public class Example : Controller
{
  public ActionResult Deserialize(HttpPostedFileBase inputFile) 
  {
    ExpectedType expectedObject = null;
    Type type                   = Type.GetType(expectedType);
    XmlSerializer serializer    = new XmlSerializer(type); // Noncompliant
    expectedObject              = (ExpectedType) serializer.Deserialize(inputFile);
  }
}
----
h| Compliant solution
|
[source,csharp]
----
public class Example : Controller
{
  public ActionResult Deserialize(HttpPostedFileBase inputFile) 
  {
    ExpectedType expectedObject = null;
    XmlSerializer serializer    = new XmlSerializer(typeof(ExpectedObject));
    expectedObject              = (ExpectedType) serializer.Deserialize(inputFile);
  }
}
----
|===

=== How does this work?

include::../../common/fix/introduction.adoc[]

include::../../common/fix/safer-serialization.adoc[]

include::../../common/fix/integrity-check.adoc[]

include::../../common/fix/pre-approved-list.adoc[]

In the previous example, a pre-approved class is used to validate the class
during deserialization.
