<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Whether the valid value ranges for <code>Date</code> fields start with 0 or 1 varies by field. For instance, month starts at 0, and day of month starts at 1. Enter a date value that goes past the end of the valid range, and the date will roll without error or exception. For instance, enter 12 for month, and you&#8217;ll get January of the following year.</p>
</div>
<div class="paragraph">
<p>This rule checks for bad values used in conjunction with <code>java.util.Date</code>, <code>java.sql.Date</code>, and <code>java.util.Calendar</code>. Specifically, values outside of the valid ranges:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Field</th>
<th class="tableblock halign-center valign-top">Valid</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">month</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0-11</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">date (day)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0-31</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">hour</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0-23</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">minute</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0-60</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">second</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0-61</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Note that this rule does not check for invalid leap years, leap seconds (second = 61), or invalid uses of the 31st day of the month.</p>
</div>
<div class="sect2">
<h3 id="_noncompliant_code_example">Noncompliant code example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Date d = new Date();
d.setDate(25);
d.setYear(2014);
d.setMonth(12);  // Noncompliant; rolls d into the next year

Calendar c = new GregorianCalendar(2014, 12, 25);  // Noncompliant
if (c.get(Calendar.MONTH) == 12) {  // Noncompliant; invalid comparison
  // ...
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_compliant_solution">Compliant solution</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Date d = new Date();
d.setDate(25);
d.setYear(2014);
d.setMonth(11);

Calendar c = new Gregorian Calendar(2014, 11, 25);
if (c.get(Calendar.MONTH) == 11) {
  // ...
}</code></pre>
</div>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>"XX" is not a valid value for "YY" method.</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_7_oct_2014_151255_nicolas_peru_wrote">on 7 Oct 2014, 15:12:55 Nicolas Peru wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] I am wondering why not push the idea a little bit further and check the value for the whole API : hours, day of month, etc. Month is a little bit trickier but concept is the same.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_8_oct_2014_161536_ann_campbell_wrote">on 8 Oct 2014, 16:15:36 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~nicolas.peru] are you willing to determine when day=31 is appropriate? Ditto Feb 29?</p>
</div>
<div class="paragraph">
<p>Also, I tested setting date (day) to 32. While while setting month to 12 rolls the date over into the next year, setting day to 32 does not roll the month over. It (bizarrely) stores 32. So I was able to construct and use a Date for 32 Feb 2014.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_10_oct_2014_150836_freddy_mallet_wrote">on 10 Oct 2014, 15:08:36 Freddy Mallet wrote:</h3>
<div class="paragraph">
<p>+1 @Ann to extend the scope of this rule to day and even year fields. Even if this doesn&#8217;t fail when setting the day to 54 for instance, this is for sure a bug. And for years, we could for instance check that years is not greater than 2100 ?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_10_oct_2014_191226_ann_campbell_wrote">on 10 Oct 2014, 19:12:26 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>Assigning to you [~nicolas.peru] since I&#8217;m waiting for you to get back to me on this.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_13_oct_2014_131303_nicolas_peru_wrote">on 13 Oct 2014, 13:13:03 Nicolas Peru wrote:</h3>
<div class="paragraph">
<p>Ok after a little test :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SimpleDateFormat sdf = new SimpleDateFormat("dd/MM/yyyy");

    Date date = new Date();
    date.setDate(30);
    date.setMonth(1);
    date.setYear(70);
    date.setHours(1);
    date.setMinutes(1);
    date.setSeconds(1);
    System.out.println(date.getTime());
    System.out.println(sdf.format(date));

    Date date2 = new Date();
    date2.setDate(2);
    date2.setMonth(2);
    date2.setYear(70);
    date2.setHours(1);
    date2.setMinutes(1);
    date2.setSeconds(1);
    System.out.println(date2.getTime());
    System.out.println(sdf.format(date2));</pre>
</div>
</div>
<div class="paragraph">
<p>This, output the following :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>5184061257
02/03/1970
5184061265
02/03/1970</pre>
</div>
</div>
<div class="paragraph">
<p>So it rolls out to the next month as expected (30 of feb is 2 of march for non bissextil year) but the idea behind the rule should be to detect cases where you know you will have a rollout (month &gt;11, day&lt;0, day &gt;31, etc&#8230;&#8203; ) to avoid unreadable writing of dates.</p>
</div>
<div class="paragraph">
<p>For a first implementation I would not try to go and detect cases such as 30 of february.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_13_oct_2014_154113_ann_campbell_wrote">on 13 Oct 2014, 15:41:13 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>Okay, see what you think.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_25_nov_2014_201544_freddy_mallet_wrote">on 25 Nov 2014, 20:15:44 Freddy Mallet wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] I would activate this rule by default &#8230;&#8203;</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_4_feb_2015_085456_nicolas_peru_wrote">on 4 Feb 2015, 08:54:56 Nicolas Peru wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] Given the extended scope of the rule the title should be reworked. I put this rule in the backlog of sonar-java 3.0.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_4_feb_2015_124940_ann_campbell_wrote">on 4 Feb 2015, 12:49:40 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>Done [~nicolas.peru]</p>
</div>
</div>
</div>
</div>