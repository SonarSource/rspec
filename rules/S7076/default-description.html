<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>file://</code> protocol gets more privileges in Electron than in a browser, which allows attackers to load arbitrary files from users' machines. To prevent this, local pages should be served using custom protocols instead.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In Electron, the <code>file://</code> protocol gets more privileges than other protocols do, such as <code>http</code> and <code>https</code>. Among other things, the <code>file://</code> protocol allows access to the entire local file system, which can be a security risk if not handled properly.</p>
</div>
<div class="paragraph">
<p>If an attacker is able to execute JavaScript within an Electron application that uses <code>file://</code> to serve local pages, then they can use this vulnerability to read any file on the user&#8217;s machine. This works even if the renderer is fully isolated using sandboxing and context isolation.</p>
</div>
<div class="paragraph">
<p>By having access to the local file system, an attacker could read sensitive information stored on the user&#8217;s machine, such as configuration files, credentials, or other sensitive data.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it_in_electron">How to fix it in Electron</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const { app, BrowserWindow } = require('electron');

app.whenReady().then(() =&gt; {
    const win = new BrowserWindow({
        width: 800,
        height: 600,
    });

    win.loadFile(path.join(__dirname, 'index.html')); // Noncompliant
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="paragraph">
<p>This solution gives an example implementation of a custom protocol. It may need to be adapted to fit the specific needs of the application.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">onst { app, net, protocol, BrowserWindow } = require('electron');

protocol.registerSchemesAsPrivileged([{
    scheme: 'app',
    privileges: {
        standard: true,
        secure: true,
        supportFetchAPI: true
    }
}]);

app.whenReady().then(() =&gt; {
    protocol.handle('app', (req) =&gt; {
        const url = new URL(req.url);
        if (url.hostname === 'local') {
            const requestedPath = url.pathname.substring(1);

            const pathToServe = path.resolve(__dirname, requestedPath);
            const relativePath = path.relative(__dirname, pathToServe);
            if (!relativePath &amp;&amp; !relativePath.startsWith('..') &amp;&amp; !path.isAbsolute(relativePath)) {
                return new Response('Only local application files are allowed', {status: 400});
            }

            return net.fetch(pathToFileURL(pathToServe).toString());
        } else {
            // Handle other types of requests
        }
    });

    const win = new BrowserWindow({
        width: 800,
        height: 600,
    });

    win.loadURL("app://local/index.html");
});</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_how_does_this_work">How does this work?</h3>
<div class="paragraph">
<p>The compliant solution uses a custom protocol. By using this instead of the <code>file://</code> protocol, it becomes possible to limit the access to the local file system. In this case, the custom protocol is used to mimic local file requests. However, any request for a local file that is not part of the Electron application will be rejected.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Electron - <a href="https://www.electronjs.org/docs/latest/tutorial/security#18-avoid-usage-of-the-file-protocol-and-prefer-usage-of-custom-protocols">Avoid usage of the file:// protocol and prefer usage of custom protocols</a></p>
</li>
<li>
<p>Electron - <a href="https://www.electronjs.org/docs/latest/api/protocol#protocolhandlescheme-handler">protocol.handle</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="ulist">
<ul>
<li>
<p>Change this code to load using a custom protocol.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="paragraph">
<p>Highlight the entire <code>loadFile</code> or <code>loadURL</code> function call.</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
</div>
</div>