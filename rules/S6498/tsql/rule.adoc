There is no good reason to silence errors, decrease performance or or block indexes creation in a procedure, but that's the result of disabling this options.

This rule raises an issue when "ANSI_WARNINGS" and/or "ARITHABORT" are disabled in a procedure.

ANSI_WARNINGS must be ON when you are creating or manipulating indexes on computed columns or indexed views. If SET ANSI_WARNINGS is OFF, CREATE, UPDATE, INSERT, and DELETE statements on tables with indexes on computed columns or indexed views will fail.

When ANSI_WARNINGS is ON, if null values appear in aggregate functions, such as SUM, AVG, MAX, MIN, STDEV, STDEVP, VAR, VARP, or COUNT, a warning message is generated. When set to OFF, no warning is issued.

When ANSI_WARNINGS is ON, the divide-by-zero and arithmetic overflow errors cause the statement to be rolled back and an error message is generated. When set to OFF, the divide-by-zero and arithmetic overflow errors cause null values to be returned.

Always set ARITHABORT to ON in your logon sessions. Setting ARITHABORT to OFF can negatively impact query optimization, leading to performance issues.

For expression evaluation, if SET ARITHABORT is OFF and an INSERT, UPDATE, or DELETE statement comes across an arithmetic, overflow, divide-by-zero, or domain error, SQL Server inserts or updates a NULL value. If the target column isn't nullable, the insert or update action fails and the user sees an error.

// If you want to factorize the description uncomment the following line and create the file.
//include::../description.adoc[]

== Noncompliant Code Example

[source,sql]
----
CREATE PROCEDURE myProc
AS
BEGIN
SET ANSI_WARNINGS OFF; // Noncompliant
// ...
END

CREATE PROCEDURE myProc
AS
BEGIN
SET ARITHABORT OFF; // Noncompliant
// ...
END
----

== Compliant Solution

[source,sql]
----
// OK
CREATE PROCEDURE myProc
AS
BEGIN
END

// OK
CREATE PROCEDURE myProc
AS
BEGIN
SET ANSI_WARNINGS ON;
SET ARITHABORT ON;
END
----

:link-with-uscores1: https://learn.microsoft.com/en-us/sql/t-sql/statements/set-arithabort-transact-sql
:link-with-uscores2: https://learn.microsoft.com/en-us/sql/t-sql/statements/set-ansi-warnings-transact-sql
:link-with-uscores3: https://community.sonarsource.com/t/set-ansi-warnings-off-should-not-used-in-stored-procedures-or-indexed-views/3756/6

== See

* {link-with-uscores1}[Microsoft Documentation: SET ARITHABORT (Transact-SQL)]
* {link-with-uscores2}[Microsoft Documentation: SET ANSI_WARNINGS (Transact-SQL)]
* {link-with-uscores3}[Sonar Community thread]
