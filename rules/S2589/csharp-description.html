<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Gratuitous boolean expressions are conditions that do not change the evaluation
of a program.
This issue can indicate logical errors and affect the correctness of an
application, as well as its maintainability.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Control flow constructs like <code>if</code>-statements allow the programmer to direct the
flow of a program depending on a boolean expression.
However, if the condition is always true or always false, only one of the
branches will ever be executed.
In that case, the control flow construct and the condition no longer serve a
purpose; they become <em>gratuitous</em>.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>The presence of gratuitous conditions can indicate a logical error.
For example, the programmer <em>intended</em> to have the program branch into different
paths but made a mistake when formulating the branching condition.
In this case, this issue might result in a bug and thus affect the reliability
of the application.
For instance, it might lead to the computation of incorrect results.</p>
</div>
<div class="paragraph">
<p>Additionally, gratuitous conditions and control flow constructs introduce
unnecessary complexity.
The source code becomes harder to understand, and thus, the application becomes
more difficult to maintain.</p>
</div>
<div class="paragraph">
<p>This rule looks for operands of a boolean expression never changing the result of the expression. It also applies to the <a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/operators/null-coalescing-operator">null coalescing operator</a> when one of the operands always evaluates to <code>null</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">string d = null;
var v1 = d ?? "value";      // Noncompliant</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_exceptions">Exceptions</h3>
<div class="paragraph">
<p>This rule will not raise an issue in either of these cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When the condition is a single <code>const bool</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">const bool debug = false;
//...
if (debug)                  // Compliant
{
  // Print something
}</code></pre>
</div>
</div>
</li>
<li>
<p>When the condition is the literal <code>true</code> or <code>false</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In these cases, it is obvious the code is as intended.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Gratuitous boolean expressions are suspicious and should be carefully removed from the code.</p>
</div>
<div class="paragraph">
<p>First, the boolean expression in question should be closely inspected for logical errors.
If a mistake was made, it can be corrected so the condition is no longer gratuitous.</p>
</div>
<div class="paragraph">
<p>If it becomes apparent that the condition is actually unnecessary, it can be removed. The associated control flow construct
(e.g., the <code>if</code>-statement containing the condition) will be adapted or even removed, leaving only the necessary branches.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">public void Sample(bool b, bool c)
{
    var a = true;
    if (a)                  // Noncompliant: "a" is always "true"
    {
        DoSomething();
    }

    if (b &amp;&amp; a)             // Noncompliant: "a" is always "true"
    {
        DoSomething();
    }

    if (c || !a)            // Noncompliant: "!a" is always "false"
    {
        DoSomething();
    }

    string d = null;
    var v1 = d ?? "value";  // Noncompliant: "d" is always null and v1 is always "value".
    var v2 = s ?? d;        // Noncompliant: "d" is always null and v2 is always equal to s.
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="paragraph">
<p>The unnecessary operand is updated:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">public void Sample(bool b, bool c, string s)
{
    var a = IsAllowed();
    if (a)                  // Compliant
    {
        DoSomething();
    }

    if (b &amp;&amp; a)             // Compliant
    {
        DoSomething();
    }

    if (c || !a)            // Compliant
    {
        DoSomething();
    }

    string d = GetStringData();
    var v1 = d ?? "value";  // Compliant
    var v2 = s ?? d;        // Compliant
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The unnecessary operand is removed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">public void Sample(bool b, bool c, string s)
{
    DoSomething();

    if (b)                  // Compliant
    {
        DoSomething();
    }

    if (c)                  // Compliant
    {
        DoSomething();
    }

    var v1 = "value";       // Compliant
    var v2 = s;             // Compliant
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/571">CWE-571 - Expression is Always True</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/570">CWE-570 - Expression is Always False</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/operators/boolean-logical-operators#conditional-logical-and-operator-">Conditional logical AND operator &amp;&amp;</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/operators/boolean-logical-operators#conditional-logical-or-operator-">Conditional logical OR operator ||</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/operators/null-coalescing-operator">Null-coalescing operators ?? and ??=</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="ulist">
<ul>
<li>
<p>Change this condition so that it does not always evaluate to "[true|false]".</p>
</li>
<li>
<p>Change this expression which always evaluates to the same result.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="paragraph">
<p>Primary: the gratuitous expression</p>
</div>
<div class="paragraph">
<p>Secondary: the last locations in the code leading to know something on each variable part of the gratuitous expression.</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_deprecates_s1850">deprecates: <a data-rspec-id="S1850" class="rspec-auto-link">S1850</a></h3>

</div>
<div class="sect2">
<h3 id="_is_related_to_s3650">is related to: <a data-rspec-id="S3650" class="rspec-auto-link">S3650</a></h3>

</div>
<div class="sect2">
<h3 id="_relates_to_s1764">relates to: <a data-rspec-id="S1764" class="rspec-auto-link">S1764</a></h3>

</div>
<div class="sect2">
<h3 id="_on_1_feb_2016_102145_freddy_mallet_wrote">on 1 Feb 2016, 10:21:45 Freddy Mallet wrote:</h3>
<div class="paragraph">
<p>Question : should we consider this RSPEC as being fully a subset of <a data-rspec-id="S2583" class="rspec-auto-link">RSPEC-2583</a> ? I think the only motivation behind this split was to use a different severity and this remains a relevant point.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_29_feb_2016_083704_pierre_yves_nicolas_wrote">on 29 Feb 2016, 08:37:04 Pierre-Yves Nicolas wrote:</h3>
<div class="paragraph">
<p>\[~freddy.mallet] I don&#8217;t really see why this RSPEC is "fully a subset of <a data-rspec-id="S2583" class="rspec-auto-link">RSPEC-2583</a>". Maybe that makes sense if it is implemented through symbolic execution with short-circuit logical operators, but then it all depends on the order of sub-conditions. Please consider <code>IF X &gt; 1 AND X = 5</code>: I think that this code would raise an issue for the current description of this RSPEC, but not for <a data-rspec-id="S2583" class="rspec-auto-link">RSPEC-2583</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_26_mar_2024_081500_philipp_dominik_schubert_wrote">on 26 Mar 2024, 08:15:00 Philipp Dominik Schubert wrote:</h3>
<div class="paragraph">
<p>We created a circle to discuss CFamily&#8217;s rules on dead code and decided to disable this rule in the CFamily analyzer since we believe it provides relatively low value and is not even implemented in CFamily&#8217;s analyzer (cf. <a href="https://sonarsource.atlassian.net/browse/CPP-5165" class="bare">https://sonarsource.atlassian.net/browse/CPP-5165</a>).</p>
</div>
</div>
</div>
</div>