<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This rule raises an issue when <code>default_factory</code> is incorrectly supplied as a keyword argument during the initialization of <code>collections.defaultdict</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>collections.defaultdict</code> class provides a dictionary-like structure that calls a factory function to supply missing values.
This factory function (like <code>list</code>, <code>int</code>, or a <code>lambda</code>) is specified during initialization.</p>
</div>
<div class="paragraph">
<p>Crucially, the <code>defaultdict</code> constructor signature requires the <code>default_factory</code> as its <strong>first positional argument</strong>.
Any subsequent positional or keyword arguments are used to initialize the contents of the dictionary. This mirrors the behavior of the standard <code>dict</code> constructor.</p>
</div>
<div class="paragraph">
<p>Providing the factory using the keyword <code>default_factory=&#8230;&#8203;</code>, as in <code>defaultdict(default_factory=list)</code>, is therefore incorrect and leads to unexpected behavior:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It does <strong>not</strong> set the default factory for missing keys. The <code>defaultdict</code> behaves like a regular <code>dict</code> in this regard and will raise a <code>KeyError</code> when a missing key is accessed.</p>
</li>
<li>
<p>It <strong>does</strong> initialize the dictionary with a single key-value pair: <code>{'default_factory': list}</code>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To fix this issue correctly initialize the <code>defaultdict</code> with a default factory by providing the factory callable as the first positional argument, not as a keyword argument.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from collections import defaultdict

d1 = defaultdict(default_factory=int) # Noncompliant: this creates a dictionary with a single key-value pair.</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from collections import defaultdict

d1 = defaultdict(int) # Compliant</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Python Documentation - <a href="https://docs.python.org/3/library/collections.html#collections.defaultdict">collections.defaultdict</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_details">Implementation details</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_highlight">Highlight</h3>
<div class="paragraph">
<p>The <code>default_factory</code> keyword.</p>
</div>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Replace this <code>default_factory</code> keyword argument by the factory callable as the first positional argument.</p>
</div>
</div>
<div class="sect2">
<h3 id="_quickfix">Quickfix</h3>
<div class="paragraph">
<p>We could remove the keyword argument and replace it by its value.</p>
</div>
</div>
</div>
</div>