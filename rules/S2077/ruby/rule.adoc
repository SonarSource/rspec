include::../description.adoc[]

include::../ask-yourself.adoc[]

include::../recommended.adoc[]

== Sensitive Code Example

For https://guides.rubyonrails.org/active_record_querying.html[Ruby on Rails's ActiveRecord]:

[source,ruby,diff-id=1,diff-type=noncompliant]
----
class User < ActiveRecord::Base
end

def sensitive
  User.where("username = '#{params[:username]}'")  # Sensitive
end
----

For https://github.com/brianmario/mysql2[mysql2]:

[source,ruby,diff-id=2,diff-type=noncompliant]
----
def sensitive
  client = Mysql2::Client.new(host: 'mysql')

  results = client.query("SELECT * FROM users WHERE username = '#{params[:username]}'") # Sensitive
end
----

For https://github.com/ged/ruby-pg[pg]:

[source,ruby,diff-id=3,diff-type=noncompliant]
----
def sensitive
  conn = PG.connect(dbname: "pg")

  results = conn.exec("SELECT * FROM users WHERE username = '#{username}'") # Sensitive
end
----

For https://sequel.jeremyevans.net/[Sequel]:

[source,ruby,diff-id=4,diff-type=noncompliant]
----
def sensitive
  DB = Sequel.sqlite("example.db")

  DB[:users].where(Sequel.lit("username = '#{params[:username]}'")) # Sensitive
end
----


For https://github.com/sparklemotion/sqlite3-ruby[sqlite3]:

[source,ruby,diff-id=5,diff-type=noncompliant]
----
def sensitive
  db = SQLite3::Database.new('example.db')

  db.execute("SELECT * FROM users WHERE username = '#{params[:username]}'") # Sensitive
end
----


== Compliant Solution

For https://guides.rubyonrails.org/active_record_querying.html[Ruby on Rails's ActiveRecord]:

[source,ruby,diff-id=1,diff-type=compliant]
----
class User < ActiveRecord::Base
end

def compliant
  User.find_by(username: params[:username])
end
----

For https://github.com/brianmario/mysql2[mysql2]:

[source,ruby,diff-id=2,diff-type=compliant]
----
def compliant
  client = Mysql2::Client.new(host: 'mysql')

  stmt = client.prepare("SELECT * FROM users WHERE username = ?")
  stmt.execute(username)
end
----

For https://github.com/ged/ruby-pg[pg]:

[source,ruby,diff-id=3,diff-type=compliant]
----
def compliant
  conn = PG.connect(dbname: "pg")

  conn.exec_params("SELECT * FROM users WHERE username = $1", [username])
end
----

For https://sequel.jeremyevans.net/[Sequel]:

[source,ruby,diff-id=4,diff-type=compliant]
----
def compliant
  DB = Sequel.sqlite("example.db")

  DB[:users].where(Sequel.lit("username = ?", params[:username]))
end
----


For https://github.com/sparklemotion/sqlite3-ruby[sqlite3]:

[source,ruby,diff-id=5,diff-type=compliant]
----
def compliant
  db = SQLite3::Database.new('example.db')

  db.execute("SELECT * FROM users WHERE username = ?", params[:username])
end
----


include::../see.adoc[]

ifdef::env-github,rspecator-view[]

'''
== Implementation Specification
(visible only on this page)

include::../message.adoc[]

include::../highlighting.adoc[]

'''
== Comments And Links
(visible only on this page)

include::../comments-and-links.adoc[]

endif::env-github,rspecator-view[]
