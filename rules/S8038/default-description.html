<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is an issue when manual field or object accessibility checks using <code>Schema.SObjectType</code> methods are performed before SOQL queries, instead of using built-in security enforcement clauses like <code>WITH SECURITY_ENFORCED</code> or <code>WITH USER_MODE</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Manual accessibility checks using <code>Schema.SObjectType</code> methods before SOQL queries create several problems:</p>
</div>
<div class="paragraph">
<p><strong>Code Complexity and Maintenance</strong>: Manual checks require verbose, repetitive code that becomes harder to maintain as queries grow more complex. Each field and object must be individually validated, leading to lengthy conditional statements.</p>
</div>
<div class="paragraph">
<p><strong>Incomplete Security Coverage</strong>: Manual checks don&#8217;t handle all security scenarios comprehensively. They may miss edge cases, relationship field security, or new security features like Restriction Rules that Salesforce introduces.</p>
</div>
<div class="paragraph">
<p><strong>Error-Prone Implementation</strong>: Developers can easily forget to check all necessary fields or objects, creating security gaps. The manual approach also doesn&#8217;t provide detailed error information when access is denied.</p>
</div>
<div class="paragraph">
<p><strong>Performance Impact</strong>: Multiple describe calls can impact performance, especially in bulk operations or when checking many fields.</p>
</div>
<div class="paragraph">
<p><strong>Scalability Issues</strong>: As queries become more complex with subqueries and relationship fields, manual checks become increasingly difficult to implement correctly.</p>
</div>
<div class="paragraph">
<p>Salesforce provides built-in security enforcement mechanisms that address all these concerns automatically and more reliably.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>Using manual accessibility checks instead of built-in security enforcement can lead to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Security vulnerabilities</strong> from incomplete or incorrect manual validation</p>
</li>
<li>
<p><strong>Increased maintenance burden</strong> due to verbose, repetitive code</p>
</li>
<li>
<p><strong>Performance degradation</strong> from multiple describe operations</p>
</li>
<li>
<p><strong>Runtime errors</strong> when security requirements change but manual checks aren&#8217;t updated</p>
</li>
<li>
<p><strong>Inconsistent security enforcement</strong> across different parts of the application</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Replace manual Schema accessibility checks with <code>WITH SECURITY_ENFORCED</code> clause in SOQL queries. This provides comprehensive field and object-level security enforcement with proper error handling.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-apex" data-lang="apex">if(Schema.SObjectType.Account.Fields.Name.isAccessible() &amp;&amp;
   Schema.SObjectType.Account.Fields.Phone.isAccessible()) {
    List&lt;Account&gt; accList = [Select Name,Phone from Account Limit 100]; // Noncompliant
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-apex" data-lang="apex">try {
    List&lt;Account&gt; accList = [Select Name,Phone from Account WITH SECURITY_ENFORCED Limit 100];
} catch(System.QueryException ee) {
    System.debug('Access denied to Account fields');
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Field Level Security in SOQL With SECURITY_ENFORCED - <a href="https://www.apexhours.com/field-level-security-in-soql-with-security_enforced">Comprehensive guide on using WITH SECURITY_ENFORCED clause for field-level security in SOQL queries</a></p>
</li>
<li>
<p>User Mode Database Operations - <a href="https://www.apexhours.com/secure-apex-code-with-user-mode-database-operations">Detailed explanation of WITH USER_MODE and other user mode database operations in Apex</a></p>
</li>
<li>
<p>Salesforce Developer Tips - <a href="https://www.apexhours.com/20-tips-for-salesforce-developers">Best practices for Salesforce developers including security enforcement in SOQL</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_standards">Standards</h3>
<div class="ulist">
<ul>
<li>
<p>CWE-285: Improper Authorization - <a href="https://cwe.mitre.org/data/definitions/285.html">Weakness related to improper authorization checks that can lead to security vulnerabilities</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>