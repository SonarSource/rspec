<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The JEE standard forbids the direct management of connections in JEE applications.
The application code should not directly create, manage, or close database connections.
Instead, the application code should use the connection pool managed by the container via <code>DataSource</code> objects.</p>
</div>
<div class="paragraph">
<p>The container is responsible for creating and managing the connection pool,
as well as monitoring the usage of connections and releasing them when they are no longer needed.
By delegating connection management to the container, JEE applications can avoid connection leaks and resource exhaustion and ensure that database connections are used efficiently and securely.</p>
</div>
<div class="paragraph">
<p>When an application manages connections directly, connection leaks may arise.
These leaks occur when an application fails to release a database connection after it has finished using it.
Another risk is vulnerability to SQL injection attacks, which occur when an attacker is able to inject malicious SQL code
into an application&#8217;s database queries, allowing them to access or modify sensitive data.
Finally, these applications have difficulty managing and monitoring database connections.
Without a centralized connection pool, tracking the usage of database connections and ensuring they are used efficiently and securely can be challenging.</p>
</div>
<div class="paragraph">
<p>This rule raises an issue for using a <code>DriverManager</code> in a servlet class.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Replace usage of <code>DriverManager</code> with a <code>DataSource</code> obtained via JNDI lookup.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">private static final String CONNECT_STRING = "jdbc:mysql://localhost:3306/mysqldb";

public void doGet(HttpServletRequest req, HttpServletResponse res)
throws ServletException, IOException  {

  Connection conn = null;
  try {
    conn = DriverManager.getConnection(CONNECT_STRING);  // Noncompliant
    // ...
  } catch (SQLException ex) {...}
    //...
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">private static final String DB_LOOKUP = "jdbc/mainDb";

public void doGet(HttpServletRequest req, HttpServletResponse res)
throws ServletException, IOException  {

  Connection conn = null;
  try {
    InitialContext ctx = new InitialContext();
    DataSource datasource = (DataSource) ctx.lookup(DB_LOOKUP);
    conn = datasource.getConnection();
    // ...
  } catch (SQLException ex) {...}
    //...
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/245">CWE-245 - J2EE Bad Practices: Direct Management of Connections</a></p>
</li>
<li>
<p><a href="https://docs.oracle.com/en/java/javase/20/docs/api/java.sql/javax/sql/DataSource.html">Oracle SDK 20 - javax.sql.DataSource</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_articles_blog_posts">Articles &amp; blog posts</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://owasp.org/www-community/attacks/SQL_Injection">OWASP - SQL Injection</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Use a JNDI-supplied DataSource instead.</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_27_feb_2015_201442_ann_campbell_wrote">on 27 Feb 2015, 20:14:42 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~nicolas.peru] I&#8217;ve written this rule more narrowly than the CWE example shows: i.e. I&#8217;ve written that we&#8217;ll raise an issue when a servlet class uses <code>DriverManager</code>, but the CWE example shows a delegate class being used to interact with <code>DriverManager</code>.</p>
</div>
<div class="paragraph">
<p>I&#8217;m guessing that detecting this case as well will take CFG?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_13_apr_2015_144839_nicolas_peru_wrote">on 13 Apr 2015, 14:48:39 Nicolas Peru wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2]just to be sure of my understanding : you are talking about a servlet using a class of the project using <code>DriverManager</code> ?</p>
</div>
<div class="paragraph">
<p>This is not related to CFG, but more to an analysis of what is in the project or not. We can find way to do it but it is not easy given the current implementation of things right now to know if a class is defined in the project or not.</p>
</div>
<div class="paragraph">
<p>I would probably stick to this simpler implementation as a first step.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_20_jul_2015_073726_ann_campbell_wrote">on 20 Jul 2015, 07:37:26 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>Tagged java-top by Ann</p>
</div>
</div>
</div>
</div>