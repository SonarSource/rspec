<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>#pragma pack</code> is a non-standard extension that specifies the packing alignment for structure, union, and class members.</p>
</div>
<div class="paragraph">
<p>It is useful to</p>
</div>
<div class="ulist">
<ul>
<li>
<p>remove padding and decrease the size of objects</p>
</li>
<li>
<p>align members to better fit optimal cpu alignment</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>However, the pragma pack directives need to be correctly defined to work properly.</p>
</div>
<div class="paragraph">
<p>This rule raises an issue if:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the specified packing value is incorrect: it can only be 1, 2, 4, 8, or 16</p>
</li>
<li>
<p>a parameter is ill-formed</p>
</li>
<li>
<p>the <code>pop</code> variant of this <code>#pragma</code> is called with both arguments <code>identifier</code> and <code>value</code>: such a call is undefined behavior</p>
</li>
<li>
<p>a <code>#pragma pack(push...)</code> is performed but there is not corresponding use of <code>#pragma pack(pop...)</code></p>
</li>
<li>
<p>a <code>#pragma pack(pop...)</code> is performed but there is not corresponding use of <code>#pragma pack(push...)</code></p>
</li>
<li>
<p>a <code>#pragma pack</code> is in effect across several files: this becomes too complex and could easily lead to undefined behavior, the same structure having a different layout when seen from different translation units</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_noncompliant_code_example">Noncompliant code example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">#pragma pack(5) // Noncompliant, value is invalid
#pragma pack(2+2) // Noncompliant, value should be a literal

#pragma pack(4)
#include "myFile.h" // Noncompliant, the specified alignment value will be applied to this file

struct T {
   int i;
   short j;
   double k;
};

#pragma pack(push, r1, 16)
#pragma pack(pop, r1, 4)  // Noncompliant, call to pop with two arguments is undefined

#pragma pack(push, r2, 16) // Noncompliant, call to push with no matching pop
#pragma pack(pop, r3)  // Noncompliant, call to pop with no matching push

#pragma pack(push, 8) // Noncompliant, unmatched push</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_compliant_solution">Compliant solution</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">#include "myFile.h"

#pragma pack(4)

struct T {
   int i;
   short j;
   double k;
};

#pragma pack(push, r1, 16)
#pragma pack(pop, r1)

#pragma pack(push, r2, 16)
#pragma pack(pop, r2)

#pragma pack(push, 8)
#pragma pack(pop)</code></pre>
</div>
</div>
</div>
</div>
</div>