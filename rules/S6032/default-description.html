<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Unintentional expensive copy should be avoided when using <code>auto</code> as a placeholder type.</p>
</div>
<div class="paragraph">
<p>When using <code>const auto</code> as a placeholder type, you might unintentionally forget to add an ampersand(<code>&amp;</code>) after the <code>auto</code> keyword. This can silently create a pointless copy and possibly have a bad impact on the performance of your code depending on the size of the created object and its context.</p>
</div>
<div class="paragraph">
<p>For example, if it happens in a range-based for loop context, it is going to lead to creating as many useless objects as the size of the range.</p>
</div>
<div class="paragraph">
<p>This rule will detect a declaration of an unmodified local variable with expensive to copy type and <code>auto</code> as a placeholder type that is initialized with a non-temporary object.</p>
</div>
<div class="sect2">
<h3 id="_noncompliant_code_example">Noncompliant code example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">void printVec(const std::vector&lt;std::string&gt;&amp; namesOfTheEntirePopulation) {
  for (const auto name : namesOfTheEntirePopulation) { // Noncompliant
    std::cout &lt;&lt; name;
  }
}

void ignore(const std::vector&lt;std::string&gt;&amp; vec);
void ignoreAgain(const std::vector&lt;std::string&gt;&amp; vec);

void ignore(VecWrapper vec) {
  const auto namesOfCPPHaters = vec.getNamesOfCPPHaters(); // Noncompliant
  ignore(namesOfCPPHaters);
  ignoreAgain(namesOfCPPHaters);
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_compliant_solution">Compliant solution</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">void modifyName(std::string&amp; a);
void printVec(std::vector&lt;std::string&gt;&amp; namesOfTheEntirePopulation) {
  for (const auto&amp; name : namesOfTheEntirePopulation) { // Compliant
    std::cout &lt;&lt; name;
  }

  for (auto name : namesOfTheEntirePopulation) { // Compliant: a copy is needed to avoid modifying the original list of names
    modifyName(name);
    std::cout &lt;&lt; name;
  }
}

void ignore(const std::vector&lt;std::string&gt;&amp; vec);
void ignoreAgain(const std::vector&lt;std::string&gt;&amp; vec);

void ignore(VecWrapper vec) {
  const auto&amp; namesOfCPPHaters = vec.getNamesOfCPPHaters(); // Compliant
  ignore(namesOfCPPHaters);
  ignoreAgain(namesOfCPPHaters);
}</code></pre>
</div>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_21_oct_2020_135809_ann_campbell_wrote">on 21 Oct 2020, 13:58:09 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>Title &amp; description currently talk about "expensive copy"&#8230;&#8203; as though there&#8217;s a "cheap copy" option&#8230;&#8203;?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_21_oct_2020_162922_abbas_sabra_wrote">on 21 Oct 2020, 16:29:22 Abbas Sabra wrote:</h3>
<div class="paragraph">
<p>Hello [~ann.campbell.2],</p>
</div>
<div class="paragraph">
<p>Yes, a copy is expensive or cheap based on the size of the copied object. So if the user is needlessly copying an integer this rule shouldn&#8217;t raise an issue as it is a "cheap copy". If the user is copying namesOfTheEntirePopulation(as in the example) that is an "expensive copy" and the rule should trigger.</p>
</div>
</div>
</div>
</div>