<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Connections, streams, files, and other classes that implement the <code>Closeable</code> interface or its super-interface, <code>AutoCloseable</code>, needs to be closed after use. Further, that <code>close</code> call must be made in a <code>finally</code> block otherwise an exception could keep the call from being made. Preferably, when class implements <code>AutoCloseable</code>, resource should be created using "try-with-resources" pattern and will be closed automatically.</p>
</div>
<div class="paragraph">
<p>Failure to properly close resources will result in a resource leak which could bring first the application and then perhaps the box the application is on to their knees.</p>
</div>
<div class="sect2">
<h3 id="_noncompliant_code_example">Noncompliant code example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">private void readTheFile() throws IOException {
  Path path = Paths.get(this.fileName);
  BufferedReader reader = Files.newBufferedReader(path, this.charset);
  // ...
  reader.close();  // Noncompliant
  // ...
  Files.lines("input.txt").forEach(System.out::println); // Noncompliant: The stream needs to be closed
}

private void doSomething() {
  OutputStream stream = null;
  try {
    for (String property : propertyList) {
      stream = new FileOutputStream("myfile.txt");  // Noncompliant
      // ...
    }
  } catch (Exception e) {
    // ...
  } finally {
    stream.close();  // Multiple streams were opened. Only the last is closed.
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_compliant_solution">Compliant solution</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">private void readTheFile(String fileName) throws IOException {
    Path path = Paths.get(fileName);
    try (BufferedReader reader = Files.newBufferedReader(path, StandardCharsets.UTF_8)) {
      reader.readLine();
      // ...
    }
    // ..
    try (Stream&lt;String&gt; input = Files.lines("input.txt"))  {
      input.forEach(System.out::println);
    }
}

private void doSomething() {
  OutputStream stream = null;
  try {
    stream = new FileOutputStream("myfile.txt");
    for (String property : propertyList) {
      // ...
    }
  } catch (Exception e) {
    // ...
  } finally {
    stream.close();
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_exceptions">Exceptions</h3>
<div class="paragraph">
<p>Instances of the following classes are ignored by this rule because <code>close</code> has no effect:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>java.io.ByteArrayOutputStream</code></p>
</li>
<li>
<p><code>java.io.ByteArrayInputStream</code></p>
</li>
<li>
<p><code>java.io.CharArrayReader</code></p>
</li>
<li>
<p><code>java.io.CharArrayWriter</code></p>
</li>
<li>
<p><code>java.io.StringReader</code></p>
</li>
<li>
<p><code>java.io.StringWriter</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Java 7 introduced the try-with-resources statement, which implicitly closes <code>Closeables</code>. All resources opened in a try-with-resources statement are ignored by this rule.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">try (BufferedReader br = new BufferedReader(new FileReader(fileName))) {
  //...
}
catch ( ... ) {
  //...
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/459">CWE-459 - Incomplete Cleanup</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/772">CWE-772 - Missing Release of Resource after Effective Lifetime</a></p>
</li>
<li>
<p><a href="https://wiki.sei.cmu.edu/confluence/x/vjdGBQ">CERT, FIO04-J.</a> - Release resources when they are no longer needed</p>
</li>
<li>
<p><a href="https://wiki.sei.cmu.edu/confluence/x/QtUxBQ">CERT, FIO42-C.</a> - Close files when they are no longer needed</p>
</li>
<li>
<p><a href="https://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html">Try With Resources</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Use try-with-resources or close this "xxx" in a "finally" clause.</p>
</div>
</div>
<div class="sect2">
<h3 id="_parameters">Parameters</h3>
<div class="sidebarblock">
<div class="content">
<div class="title">excludedResourceTypes</div>
<div class="paragraph">
<p>Comma separated list of the excluded resource types, using fully qualified names (example: "org.apache.hadoop.fs.FileSystem")</p>
</div>
</div>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_relates_to_s5485">relates to: <a data-rspec-id="S5485" class="rspec-auto-link">S5485</a></h3>

</div>
<div class="sect2">
<h3 id="_is_related_to_s3546">is related to: <a data-rspec-id="S3546" class="rspec-auto-link">S3546</a></h3>

</div>
<div class="sect2">
<h3 id="_is_related_to_s2930">is related to: <a data-rspec-id="S2930" class="rspec-auto-link">S2930</a></h3>

</div>
<div class="sect2">
<h3 id="_on_2_feb_2015_142837_sébastien_gioria_wrote">on 2 Feb 2015, 14:28:37 Sébastien Gioria wrote:</h3>
<div class="paragraph">
<p>Could be tag</p>
</div>
<div class="ulist">
<ul>
<li>
<p>OWASP Top10 2013 A5 (Denial Of Service fall mostly in this category because finishing most the time in stacktrace of the JavaVM. )</p>
</li>
<li>
<p>CERT Secure Coding FIO04-J</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_on_4_feb_2015_131112_ann_campbell_wrote">on 4 Feb 2015, 13:11:12 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>Thanks for the CERT reference [~sebastien.gioria], but I don&#8217;t understand the OWASP tie.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_11_feb_2015_230232_freddy_mallet_wrote">on 11 Feb 2015, 23:02:32 Freddy Mallet wrote:</h3>
<div class="paragraph">
<p>This one can lead to a denial of service.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_24_apr_2015_075503_michael_gumowski_wrote">on 24 Apr 2015, 07:55:03 Michael Gumowski wrote:</h3>
<div class="paragraph">
<p>As for the moment we are not making cross-file or cross-method analysis (it is planned), we are not able to tell if it is the responsibility of the method to close a Closeable/AutoCloseable retrieved using method invocation. There is no existing annotation neither which would provide the information. I changed the non-compliant example and compliant solution to something that we can actually detect.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_11_jun_2015_185732_ann_campbell_wrote">on 11 Jun 2015, 18:57:32 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~michael.gumowski], would it be appropriate to map this rule to the CodePro rule <a href="https://developers.google.com/java-dev-tools/codepro/doc/features/audit/audit_rules_com.instantiations.assist.eclipse.auditGroup.possibleErrors#com.instantiations.assist.eclipse.audit.closeInFinally">Close In Finally</a>?</p>
</div>
<div class="paragraph">
<p>I&#8217;m asking first for an answer based on the current implementation.</p>
</div>
<div class="paragraph">
<p>And if that answer&#8217;s "no" my second question is whether we should go ahead &amp; do the mapping &amp; extend the implementation.</p>
</div>
<div class="paragraph">
<p>As a followup, there is also this CodePro rule: <a href="https://developers.google.com/java-dev-tools/codepro/doc/features/audit/audit_rules_com.instantiations.assist.eclipse.auditGroup.jdbc#com.instantiations.assist.eclipse.audit.closeOrder">Close Order</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_on_17_jun_2015_141804_ann_campbell_wrote">on 17 Jun 2015, 14:18:04 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>CodePro: Close In Finally</p>
</div>
</div>
</div>
</div>