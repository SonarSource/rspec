<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This rule raises an issue when global variables (prefixed with <code>$</code>) are used in Rails applications.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Global variables create tight coupling between different parts of your Rails application, making your code harder to maintain and test.</p>
</div>
<div class="paragraph">
<p>When you use global variables, you create hidden dependencies that are not obvious from looking at a class or method signature. This makes it difficult to understand what data a piece of code depends on, and it becomes nearly impossible to test components in isolation.</p>
</div>
<div class="paragraph">
<p>Global variables also introduce the risk of unexpected side effects. Since they can be modified from anywhere in your application, tracking down bugs becomes much more challenging. In a multi-threaded environment like Rails, global variables can also lead to race conditions.</p>
</div>
<div class="paragraph">
<p>Rails provides better alternatives for sharing data across your application. These alternatives are more explicit, easier to test, and follow Rails conventions.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>Using global variables can lead to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Code that is difficult to test and debug</p>
</li>
<li>
<p>Tight coupling between unrelated parts of your application</p>
</li>
<li>
<p>Unexpected side effects and hard-to-track bugs</p>
</li>
<li>
<p>Race conditions in multi-threaded environments</p>
</li>
<li>
<p>Violation of Rails conventions and best practices</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it_in_rails">How to fix it in Rails</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="paragraph">
<p>Use Rails configuration objects for application-wide settings instead of global variables. This approach is thread-safe and follows Rails conventions.</p>
</div>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby"># Using global variable for application-wide values
$CUSTOMER_NAME = 'John' # Noncompliant

def some_method
  puts $CUSTOMER_NAME  # Creates tight coupling
end</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby"># config/application.rb - Using Rails configuration
MyApp::Application.configure do
  config.customer_name = 'John'
end

# Accessing the value
def some_method
  puts MyApp::Application.config.customer_name
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use session storage for user-specific data that needs to persist across requests instead of global variables.</p>
</div>
</div>
<div class="sect3">
<h4 id="_noncompliant_code_example_2">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">class UsersController &lt; ApplicationController
  def user_clicked
    $current_user_id = params[:user_id] # Noncompliant
  end

  def view_user
    @current_user_id = $current_user_id
  end
end</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution_2">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">class UsersController &lt; ApplicationController
  def user_clicked
    session[:current_user_id] = params[:user_id]
    redirect_to view_user_path
  end

  def view_user
    @current_user_id = session[:current_user_id]
  end
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use constants defined in initializers for application-wide constants instead of global variables.</p>
</div>
</div>
<div class="sect3">
<h4 id="_noncompliant_code_example_3">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">$API_VERSION = '1.0' # Noncompliant

class ApiController &lt; ApplicationController
  def version
    render json: { version: $API_VERSION }
  end
end</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution_3">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby"># config/initializers/api.rb
API_VERSION = '1.0'.freeze

class ApiController &lt; ApplicationController
  def version
    render json: { version: API_VERSION }
  end
end</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Rails Configuration Guide - <a href="https://guides.rubyonrails.org/configuring.html">Official Rails guide on application configuration</a></p>
</li>
<li>
<p>Ruby user&#8217;s guide - <a href="https://ruby-doc.org/docs/ruby-doc-bundle/UsersGuide/rg/globalvars.html">Global variables</a></p>
</li>
<li>
<p>Rails Session Management - <a href="https://guides.rubyonrails.org/action_controller_overview.html#session">Rails guide on using sessions for data persistence</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_standards">Standards</h3>
<div class="ulist">
<ul>
<li>
<p>CWE-1108: Excessive Reliance on Global Variables - <a href="https://cwe.mitre.org/data/definitions/1108.html">Common weakness related to overuse of global variables</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>