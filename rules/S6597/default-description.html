<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In Dockerfile, instructions <code>RUN</code>, <code>CMD</code>, and <code>ENTRYPOINT</code> can contain long shell scripts chaining multiple commands, including the <code>cd</code> command for changing directories.
Using <code>WORKDIR</code> instruction instead reduces the complexity of the above instructions and makes them easier to read, understand, troubleshoot, and maintain.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>The Dockerfile instructions like <code>RUN</code> allow users to execute longer scripts. See the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-docker" data-lang="docker">RUN cd /tmp &amp;&amp; \
  git clone myrepository.com/MyOrganization/project &amp;&amp; \
  cd project &amp;&amp; \
  make &amp;&amp; \
  cd /app/bin</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the first <code>cd /tmp</code> command can be replaced by <code>WORKDIR /tmp</code> before <code>RUN</code>.
The last <code>cd /app/bin</code> command can be replaced with <code>WORKDIR /app/bin</code> after the <code>RUN</code> instruction.
The result will be the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-docker" data-lang="docker">WORKDIR /tmp
RUN git clone myrepository.com/MyOrganization/project &amp;&amp; \
  cd project &amp;&amp; \
  make
WORKDIR /app/bin</code></pre>
</div>
</div>
<div class="paragraph">
<p>Those actions will reduce the length of the <code>RUN</code> instruction, which makes it easier to read and understand.
Sometimes, it is hard to avoid the usage of <code>cd</code> command, especially in the middle of a long script.
Removing them from the beginning and end of a multi-line is an easy improvement.
Additionally, many commands work well with absolute paths, so changing directories can be avoided in most cases.</p>
</div>
<div class="paragraph">
<p>The <code>WORKDIR</code> instruction can be used multiple times in a Dockerfile.
It changes the current directory for the next instructions and until there is a following change.
This approach simplifies understanding of what is a current directory.</p>
</div>
<div class="paragraph">
<p>The same principles apply to <code>CMD</code> and <code>ENTRYPOINT</code> instructions.</p>
</div>
<div class="paragraph">
<p>This recommendation provides a clear structure for Dockerfiles, making it easier to maintain.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Where possible, ensure that all usages of <code>cd</code> commands are replaced by a <code>WORKDIR</code> instruction.
The <code>cd</code> commands at the beginning or end of a chain of commands are a reliable sign that they can be replaced.
Also, using absolute paths can be considered for commands that accept them.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-docker" data-lang="docker">RUN cd /app/bin &amp;&amp; ./start.sh</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-docker" data-lang="docker">WORKDIR /app/bin
RUN ./start.sh

# Or:
RUN /app/bin/start.sh</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices/#workdir">WORKDIR - Best practices for writing Dockerfiles</a></p>
</li>
<li>
<p><a href="https://docs.docker.com/engine/reference/builder/#workdir">WORKDIR - Dockerfile reference</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>WORKDIR instruction should be used instead of cd command.</p>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="paragraph">
<p>Highlight usage of cd command.</p>
</div>
<hr>
</div>
</div>
</div>