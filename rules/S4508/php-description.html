<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Deserializing objects is security-sensitive. For example, it has led in the past to the following vulnerabilities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.cve.org/CVERecord?id=CVE-2017-17672">CVE-2017-17672</a>: vBulletin: Unserialize PHP Code Execution</p>
</li>
<li>
<p><a href="https://www.cve.org/CVERecord?id=CVE-2018-1000167">CVE-2018-1000167</a>: Jenkins Pipeline: arbitrary code execution vulnerability</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Object deserialization from an untrusted source can lead to unexpected code execution. Deserialization takes a stream of bits and turns it into an object. If the stream contains the type of object you expect, all is well. But if you&#8217;re deserializing data coming from untrusted input, and an attacker has inserted some other type of object, you&#8217;re in trouble. Why? <a href="https://www.owasp.org/index.php/PHP_Object_Injection">A known attack scenario</a> involves the creation of a serialized PHP object with crafted attributes which will modify your application&#8217;s behavior. This attack relies on <a href="https://php.net/manual/en/language.oop5.magic.php">PHP magic methods</a> like <code>__desctruct</code>, <code>__wakeup</code> or <code>__string</code>. The attacker doesn&#8217;t necessarily need the source code of the targeted application to exploit the vulnerability, he can also rely on the presence of open-source component and use <a href="https://github.com/ambionics/phpggc">tools to craft malicious payloads</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ask_yourself_whether">Ask Yourself Whether</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>an attacker could have tampered with the source provided to the deserialization function</p>
</li>
<li>
<p>you are using an unsafe deserialization function</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You are at risk if you answered yes to any of those questions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_recommended_secure_coding_practices">Recommended Secure Coding Practices</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To prevent insecure deserialization, it is recommended to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use safe libraries that do not allow code execution at deserialization.</p>
</li>
<li>
<p>Not communicate with the outside world using serialized objects</p>
</li>
<li>
<p>Limit access to the serialized source</p>
<div class="ulist">
<ul>
<li>
<p>if it is a file, restrict the access to it.</p>
</li>
<li>
<p>if it comes from the network, restrict who has access to the process, such as with a Firewall or by authenticating the sender first.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://owasp.org/www-community/vulnerabilities/Deserialization_of_untrusted_data">OWASP - Deserialization of untrusted data</a></p>
</li>
<li>
<p>OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A8_2017-Insecure_Deserialization">Top 10 2017 Category A8 - Insecure Deserialization</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/502">CWE-502 - Deserialization of Untrusted Data</a></p>
</li>
<li>
<p>Derived from FindSecBugs rule <a href="https://find-sec-bugs.github.io/bugs.htm#OBJECT_DESERIALIZATION">OBJECT_DESERIALIZATION </a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Make sure deserializing objects is safe here.</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_24_jul_2018_152718_pierre_yves_nicolas_wrote">on 24 Jul 2018, 15:27:18 Pierre-Yves Nicolas wrote:</h3>
<div class="paragraph">
<p>CVE-2012-0694 doesn&#8217;t contain any relevant information: nothing about the fact that it&#8217;s related to deserialization.</p>
</div>
</div>
<div class="sect2">
<h3 id="_is_duplicated_by_s4066">is duplicated by: <a data-rspec-id="S4066" class="rspec-auto-link">S4066</a></h3>

</div>
<div class="sect2">
<h3 id="_on_19_mar_2018_111813_sébastien_gioria_appsecfr_wrote">on 19 Mar 2018, 11:18:13 Sébastien GIORIA - AppSecFR wrote:</h3>
<div class="paragraph">
<p>Need Tag A8:2017</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_20_mar_2018_073010_freddy_mallet_wrote">on 20 Mar 2018, 07:30:10 Freddy Mallet wrote:</h3>
<div class="paragraph">
<p>Thanks [~SPoint] ! And I would even remove the A1 category [~alexandre.gigleux] to keep our referential orthogonal.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_20_mar_2018_082058_alexandre_gigleux_wrote">on 20 Mar 2018, 08:20:58 Alexandre Gigleux wrote:</h3>
<div class="paragraph">
<p>\[~freddy.mallet] I agree the main problem here is the "Insecure Deserialization" that can lead to a potential "Injection". The "Injection" can&#8217;t be performed easily, you need first to bypass the deserialization layer. So I removed OWASP A1.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_7_jul_2018_152825_tibor_blenessy_wrote">on 7 Jul 2018, 15:28:25 Tibor Blenessy wrote:</h3>
<div class="paragraph">
<p>Method <code>ObjectInputStream.readArray(boolean)</code>  is private, so it can&#8217;t be called. Why we should detect it?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_9_jul_2018_132712_andrei_epure_wrote">on 9 Jul 2018, 13:27:12 Andrei Epure wrote:</h3>
<div class="paragraph">
<p>@ [~alexandre.gigleux] , [~tibor.blenessy] Should we take into consideration <code>setObjectInputFilter​</code> ?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_9_jul_2018_155604_alexandre_gigleux_wrote">on 9 Jul 2018, 15:56:04 Alexandre Gigleux wrote:</h3>
<div class="paragraph">
<p>\[~andrei.epure] Hotspots rules are going to be revisited with "recommendations" that a Security Auditors should follow to be sure the code is safe. This <code>setObjectInputFilter]} will be part of them. Here we just want to raise a simple issue when the {{readObject</code> is called. Then up to the Security Auditor to look around this code and see if some sanitization of in the input is made.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_23_jul_2018_171426_pierre_yves_nicolas_wrote">on 23 Jul 2018, 17:14:26 Pierre-Yves Nicolas wrote:</h3>
<div class="paragraph">
<p>\[~alexandre.gigleux] The current description is really specific to Java. Can it be adapted to PHP? Thanks.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_27_may_2020_164846_eric_therond_wrote">on 27 May 2020, 16:48:46 Eric Therond wrote:</h3>
<div class="paragraph">
<p>Deprecated because it overlaps with SonarSecurity</p>
</div>
</div>
</div>
</div>