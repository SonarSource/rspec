<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This rule raises an issue when <code>toPandas</code> is used in PySpark in a way that can lead to memory or performance bottlenecks.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The use of <code>toPandas</code> in PySpark can lead to performance and memory management issues.</p>
</div>
<div class="paragraph">
<p>PySpark is designed to handle large-scale data processing in a distributed manner, leveraging the power of cluster computing to efficiently manage and process big data. Calling <code>toPandas</code> collects all data from a Spark <code>DataFrame</code> into a Pandas <code>DataFrame</code> on a single machine. This can lead to memory issues and performance bottlenecks, especially with large datasets, which is contrary to the distributed nature of Spark.</p>
</div>
<div class="paragraph">
<p>For this reason, it is generally advisable to avoid using <code>toPandas</code> unless you are certain that the dataset is small enough to be handled comfortably by a single machine. Instead, consider using Spark&#8217;s built-in functions and capabilities to perform data processing tasks in a distributed manner.</p>
</div>
<div class="paragraph">
<p>If the conversion to Pandas is necessary, ensure that the dataset size is manageable and that the conversion is justified by specific requirements, such as integration with libraries that require Pandas DataFrames.</p>
</div>
<div class="sect2">
<h3 id="_exceptions">Exceptions</h3>
<div class="paragraph">
<p>This rule will not raise issues in the following context:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When visualization is performed with other libraries such as <code>matplotlib</code>, <code>seaborn</code>, etc.</p>
</li>
<li>
<p>When the <code>DataFrame</code> is of a limited size (e.g. following a call to <code>limit</code> or an aggregation through <code>groupBy</code>)</p>
</li>
<li>
<p>In tests</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To fix this issue, consider using PySpark built-in capabilities without relying on Pandas whenever possible.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python"># Converting a PySpark DataFrame to a Pandas DataFrame
df = spark.read.csv("my_data.csv")
pandas_df = df.toPandas()  # Noncompliant: May cause memory issues with large datasets
filtered_df = df[df['id'] &gt; 1]
print(filtered_df)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from pyspark.sql.functions import col

# Using PySpark DataFrame operations
df = spark.read.csv("my_data.csv")

# Perform operations using PySpark's distributed capabilities
filtered_df = df.filter(col("id") &gt; 1)
filtered_df.show()</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>PySpark Documentation - <a href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrame.toPandas.html">pyspark.sql.DataFrame.toPandas</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Consider using PySpark&#8217;s built-in capabilities instead of converting this <code>DataFrame</code> to Pandas.</p>
</div>
</div>
</div>
</div>