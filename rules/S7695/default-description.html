<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This rule raises an issue when <code>super()</code> calls are used in methods that are decorated with TorchScript decorators like <code>@torch.jit.script_method</code> or within classes likely to be compiled with TorchScript.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>TorchScript has limited support for Python&#8217;s <code>super()</code> mechanism, which can lead to compilation errors when converting PyTorch models for deployment.</p>
</div>
<div class="paragraph">
<p>TorchScript is PyTorch&#8217;s way to create serializable and optimizable models from PyTorch code. It allows you to run models independently from Python, which is essential for production deployment, mobile applications, and performance optimization.</p>
</div>
<div class="paragraph">
<p>However, TorchScript operates with a subset of Python&#8217;s features. The <code>super()</code> function relies on Python&#8217;s method resolution order (MRO) and dynamic attribute lookup, which are not fully supported in TorchScript&#8217;s static compilation environment.</p>
</div>
<div class="paragraph">
<p>When TorchScript encounters <code>super()</code> calls, it may fail to properly resolve the method calls during compilation, resulting in runtime errors or unexpected behavior. This is particularly problematic in <code>forward()</code> methods of neural network modules, where inheritance is commonly used.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>Using <code>super()</code> calls in TorchScript methods can cause:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Compilation failures when converting models to TorchScript format</p>
</li>
<li>
<p>Runtime errors in deployed models</p>
</li>
<li>
<p>Inconsistent behavior between eager mode and TorchScript execution</p>
</li>
<li>
<p>Deployment issues in production environments and mobile applications</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_how_to_fix_in_pytorch">How to fix in PyTorch?</h3>
<div class="paragraph">
<p>Replace super() calls with direct method calls or refactor the inheritance structure to avoid super() usage in TorchScript methods.</p>
</div>
<div class="sect3">
<h4 id="_non_compliant_code_example">Non-compliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import torch
import torch.nn as nn

class BaseModel(nn.Module):
    def forward(self, x):
        return x

class MyModel(BaseModel):
    @torch.jit.script_method
    def forward(self, x):
        return super().forward(x)  # Noncompliant</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_code_example">Compliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import torch
import torch.nn as nn

class MyModel(nn.Module):
    def forward(self, x):
        # Avoid super() in TorchScript methods
        return self.process(x)
    def process(self, x):
        return x</code></pre>
</div>
</div>
<div class="paragraph">
<p>For complex inheritance scenarios, explicitly call parent class methods by name instead of using super().</p>
</div>
</div>
<div class="sect3">
<h4 id="_non_compliant_code_example_2">Non-compliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import torch
import torch.nn as nn

class BaseModel(nn.Module):
    def forward(self, x):
        return x * 2

class DerivedModel(BaseModel):
    @torch.jit.script_method
    def forward(self, x):
        result = super().forward(x)  # Noncompliant
        return result + 1</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_code_example_2">Compliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import torch
import torch.nn as nn

class BaseModel(nn.Module):
    def forward(self, x):
        return x * 2

    def base_forward(self, x):
        return x * 2

class DerivedModel(BaseModel):
    @torch.jit.script_method
    def forward(self, x):
        result = self.base_forward(x)
        return result + 1</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>TorchScript Language Reference - <a href="https://pytorch.org/docs/stable/jit_language_reference.html">Official documentation on TorchScript language features and limitations</a></p>
</li>
<li>
<p>TorchScript Unsupported Features - <a href="https://pytorch.org/docs/stable/jit_unsupported.html">List of Python features not supported in TorchScript</a></p>
</li>
<li>
<p>PyTorch JIT Tutorial - <a href="https://pytorch.org/tutorials/beginner/Intro_to_TorchScript_tutorial.html">Introduction to TorchScript and best practices</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>