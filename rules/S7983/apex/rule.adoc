This rule raises an issue when the `Crypto.generateMac()` method uses the 'HMACMD5' algorithm parameter.

== Why is this an issue?

Hash-based Message Authentication Codes (HMACs) are used to verify both the authenticity of message senders and the integrity of messages during transmission. They play a crucial role in securing communications by ensuring that messages haven't been tampered with and come from trusted sources.

The HMACMD5 algorithm relies on the MD5 hash function, which has known cryptographic weaknesses. MD5 is vulnerable to collision attacks, where different inputs can produce the same hash output. This vulnerability can be exploited by attackers to forge message authentication codes, potentially allowing them to:

* Impersonate legitimate message senders
* Modify messages without detection
* Bypass authentication mechanisms

While HMAC provides some additional security over plain MD5 hashing, the underlying weaknesses of MD5 still pose significant risks in security-critical applications.

=== What is the potential impact?

Using HMACMD5 can compromise the security of your application's message authentication system. Attackers may be able to forge authentication codes, leading to unauthorized access, data tampering, or successful impersonation attacks. This is particularly concerning in applications that handle sensitive data or financial transactions.

== How to fix it

Replace HMACMD5 with a stronger algorithm like HMACSHA256 or HMACSHA512. These algorithms are based on the SHA-2 family, which provides much better security against collision attacks.

=== Code examples

==== Noncompliant code example

[source,apex,diff-id=1,diff-type=noncompliant]
----
Blob mac = Crypto.generateMac('HMACMD5', data, key); // Noncompliant
----

==== Compliant solution

[source,apex,diff-id=1,diff-type=compliant]
----
Blob mac = Crypto.generateMac('HMACSHA256', data, key);
----

== Resources

=== Documentation

 * Salesforce Apex Crypto Class Documentation - https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/apex_classes_restful_crypto.htm[Official documentation for the Apex Crypto class and its methods]

 * Salesforce Trailhead: Use Encryption in Custom Applications - https://trailhead.salesforce.com/content/learn/modules/secure-secrets-storage/use-encryption-in-custom-apps[Salesforce guide on implementing secure encryption practices]

=== Standards

 * CWE-327: Use of a Broken or Risky Cryptographic Algorithm - https://cwe.mitre.org/data/definitions/327.html[Common weakness related to using cryptographically weak algorithms]

 * OWASP Top 10:2021-A02-Cryptographic Failures - https://owasp.org/Top10/A02_2021-Cryptographic_Failures/[OWASP guidance on avoiding cryptographic failures]

=== Related rules

 * RSPEC-4790 - https://rules.sonarsource.com/csharp/RSPEC-4790/[Using weak hashing algorithms is security-sensitive (C# implementation)]
