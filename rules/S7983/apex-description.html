<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This rule raises an issue when the <code>Crypto.generateMac()</code> method uses the 'HMACMD5' algorithm parameter.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hash-based Message Authentication Codes (HMACs) are used to verify both the authenticity of message senders and the integrity of messages during transmission. They play a crucial role in securing communications by ensuring that messages haven&#8217;t been tampered with and come from trusted sources.</p>
</div>
<div class="paragraph">
<p>The HMACMD5 algorithm relies on the MD5 hash function, which has known cryptographic weaknesses. MD5 is vulnerable to collision attacks, where different inputs can produce the same hash output. This vulnerability can be exploited by attackers to forge message authentication codes, potentially allowing them to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Impersonate legitimate message senders</p>
</li>
<li>
<p>Modify messages without detection</p>
</li>
<li>
<p>Bypass authentication mechanisms</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>While HMAC provides some additional security over plain MD5 hashing, the underlying weaknesses of MD5 still pose significant risks in security-critical applications.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>Using HMACMD5 can compromise the security of your application&#8217;s message authentication system. Attackers may be able to forge authentication codes, leading to unauthorized access, data tampering, or successful impersonation attacks. This is particularly concerning in applications that handle sensitive data or financial transactions.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Replace HMACMD5 with a stronger algorithm like HMACSHA256 or HMACSHA512. These algorithms are based on the SHA-2 family, which provides much better security against collision attacks.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-apex" data-lang="apex">Blob mac = Crypto.generateMac('HMACMD5', data, key); // Noncompliant</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-apex" data-lang="apex">Blob mac = Crypto.generateMac('HMACSHA256', data, key);</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Salesforce Apex Crypto Class Documentation - <a href="https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/apex_classes_restful_crypto.htm">Official documentation for the Apex Crypto class and its methods</a></p>
</li>
<li>
<p>Salesforce Trailhead: Use Encryption in Custom Applications - <a href="https://trailhead.salesforce.com/content/learn/modules/secure-secrets-storage/use-encryption-in-custom-apps">Salesforce guide on implementing secure encryption practices</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_standards">Standards</h3>
<div class="ulist">
<ul>
<li>
<p>CWE-327: Use of a Broken or Risky Cryptographic Algorithm - <a href="https://cwe.mitre.org/data/definitions/327.html">Common weakness related to using cryptographically weak algorithms</a></p>
</li>
<li>
<p>OWASP Top 10:2021-A02-Cryptographic Failures - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">OWASP guidance on avoiding cryptographic failures</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_related_rules">Related rules</h3>
<div class="ulist">
<ul>
<li>
<p><a data-rspec-id="S4790" class="rspec-auto-link">RSPEC-4790</a> - <a href="https://rules.sonarsource.com/csharp/RSPEC-4790/">Using weak hashing algorithms is security-sensitive (C# implementation)</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>