<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This rule raises an issue when Go tests are executed without the <code>-race</code> flag, which means potential race conditions in concurrent code may go undetected.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Race conditions are among the most challenging bugs to detect and debug in concurrent programs. They occur when multiple goroutines access shared data simultaneously without proper synchronization, leading to unpredictable behavior that may only manifest under specific timing conditions.</p>
</div>
<div class="paragraph">
<p>Go&#8217;s built-in race detector is a powerful tool that instruments memory accesses to identify when shared variables are accessed concurrently without synchronization. However, it only works when explicitly enabled with the <code>-race</code> flag during compilation and execution.</p>
</div>
<div class="paragraph">
<p>Without race detection enabled during testing:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Race conditions may remain hidden during development and testing phases</p>
</li>
<li>
<p>Bugs can surface unpredictably in production environments under different load conditions</p>
</li>
<li>
<p>Data corruption or incorrect calculations may occur silently</p>
</li>
<li>
<p>Debugging becomes significantly more difficult once issues reach production</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The race detector adds runtime overhead (typically 5-10x slower execution and higher memory usage), making it impractical for production use. However, this overhead is acceptable during testing phases where catching concurrency bugs early provides immense value.</p>
</div>
<div class="paragraph">
<p>Running tests with race detection is particularly important for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Code that uses goroutines and shared state</p>
</li>
<li>
<p>Libraries and frameworks that will be used in concurrent contexts</p>
</li>
<li>
<p>Integration tests that exercise concurrent code paths</p>
</li>
<li>
<p>Load tests that simulate realistic concurrent usage patterns</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>Race conditions can lead to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Data corruption</strong>: Concurrent writes to shared variables can result in partially written or inconsistent data</p>
</li>
<li>
<p><strong>Incorrect results</strong>: Race conditions in calculations or business logic can produce wrong outcomes</p>
</li>
<li>
<p><strong>Unpredictable failures</strong>: Applications may work correctly most of the time but fail intermittently under load</p>
</li>
<li>
<p><strong>Security vulnerabilities</strong>: Race conditions can sometimes be exploited to bypass security checks or cause privilege escalation</p>
</li>
<li>
<p><strong>Difficult debugging</strong>: Race-related bugs are notoriously hard to reproduce and debug in production environments</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Add the <code>-race</code> flag to your <code>go test</code> commands to enable race detection during testing.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">go test ./...</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">go test -race ./...</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Go Race Detector - <a href="https://go.dev/doc/articles/race_detector">Official Go documentation on the race detector tool</a></p>
</li>
<li>
<p>Introducing the Go Race Detector - <a href="https://go.dev/blog/race-detector">Go blog post introducing the race detector with examples</a></p>
</li>
<li>
<p>Go Testing Package - <a href="https://pkg.go.dev/testing">Official documentation for Go&#8217;s testing package</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_standards">Standards</h3>
<div class="ulist">
<ul>
<li>
<p>CWE-362: Concurrent Execution using Shared Resource with Improper Synchronization - <a href="https://cwe.mitre.org/data/definitions/362.html">Common weakness enumeration for race condition vulnerabilities</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>