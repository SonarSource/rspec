<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A global variable can be modified from anywhere in the program. At first, this might look convenient. However, it makes programs harder to understand and maintain. When you see a function call, you cannot know if the function will affect the value of the global variable or not. You have lost the ability to reason locally about your code and must always have the whole program in mind.</p>
</div>
<div class="paragraph">
<p>Additionally, global variables are often subject to race conditions in multi-threaded environments.</p>
</div>
<div class="paragraph">
<p>These issues are related to modification and cannot occur when the global variable is <code>const</code> (or, in the case of a pointer, if it is <code>const</code> at every level).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">unsigned** noncompliantPtr;
unsigned const* const* const compliantPtr = ...;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Some global variables defined in external libraries (such as <code>std::cout</code>, <code>std::cin</code>, <code>std::cerr</code>) are acceptable to use, but you should have a good reason to create your own.
If you use a global variable, ensure they can be safely accessed concurrently, and there are no issues related to order of their initialization (see <a data-rspec-id="S7119" class="rspec-auto-link">S7119</a>).</p>
</div>
<div class="paragraph">
<p>Remember that it is much easier to maintain software without globals. Instead of such variables, it is better to design functions to take as input all the required variables. In addition to serving documentation, this also helps future refactoring and the evolution of the code.</p>
</div>
<div class="paragraph">
<p>This rule detects all declarations of global variables (at file scope or in any namespace) that are not constant.</p>
</div>
<div class="sect2">
<h3 id="_noncompliant_code_example">Noncompliant code example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">double oneFoot = 0.3048; // Noncompliant
double userValue; // Noncompliant

void readValue();
void writeResult();

int main() {
  readValue();
  writeResult();
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_compliant_solution">Compliant solution</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">constexpr double footToMeter = 0.3048;

double readValueInFeet();
void writeResult(double valueInMeters);

int main() {
  auto userValue = readValueInFeet();
  writeResult(userValue * footToMeter);
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_exceptions">Exceptions</h3>
<div class="paragraph">
<p><code>volatile</code> is used to indicate that some piece of memory can be mutated by external factors. For embedded software, some hardware inputs/outputs can be mapped to specific memory addresses, and accessing these bound data is usually done through a global pointer to <code>volatile</code> data.</p>
</div>
<div class="paragraph">
<p>In that situation, the pointer itself should be const, but the pointee can be non-const if the memory maps an output register that is supposed to be written to.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">unsigned volatile      *       gpio1;       // Noncompliant
unsigned volatile      * const gpio2 = ...; // Compliant, used for input &amp; output
unsigned volatile const* const gpio3 = ...; // Compliant, used for input only</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_standards">Standards</h3>
<div class="ulist">
<ul>
<li>
<p>C++ Core Guidelines - <a href="https://github.com/isocpp/CppCoreGuidelines/blob/e49158a/CppCoreGuidelines.md#i2-avoid-non-const-global-variables">I.2: Avoid non-<code>const</code> global variables</a></p>
</li>
<li>
<p>STIG Viewer - <a href="https://stigviewer.com/stigs/application_security_and_development/2024-12-06/finding/V-222567">Application Security and Development: V-222567</a> - The application must not be vulnerable to race conditions.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_related_rules">Related rules</h3>
<div class="ulist">
<ul>
<li>
<p><a data-rspec-id="S7119" class="rspec-auto-link">S7119</a> detects order of initialization issues between global variables.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_articles_blog_posts">Articles &amp; blog posts</h3>
<div class="ulist">
<ul>
<li>
<p>Stack Overflow - Answer by Gabriel Staples for <a href="https://stackoverflow.com/a/73027793/24103368">What is the point of declaring "const volatile int *p"?</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_is_related_to_s6233">is related to: <a data-rspec-id="S6233" class="rspec-auto-link">S6233</a></h3>

</div>
<div class="sect2">
<h3 id="_on_28_aug_2019_221153_loïc_joly_wrote">on 28 Aug 2019, 22:11:53 Loïc Joly wrote:</h3>
<div class="paragraph">
<p>\[~geoffray.adde] Could you please review my changes?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_9_sep_2019_203340_ann_campbell_wrote">on 9 Sep 2019, 20:33:40 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~geoffray.adde], [~loic.joly] this seems remarkably similar to <a data-rspec-id="S1902" class="rspec-auto-link">RSPEC-1902</a> to me. And related to <a data-rspec-id="S997" class="rspec-auto-link">RSPEC-997</a>. I suggest this be made a subtask of <a data-rspec-id="S1902" class="rspec-auto-link">RSPEC-1902</a>.</p>
</div>
<div class="paragraph">
<p>Also Geoffray, the Exceptions section should come after the code samples, and the text of an exception should describe (only) when and issue would normally be expected but will not be raised. This exception text is broader than that. The second sentence should be relocated into the description and the first should probably be sharpened from "are fine to use" to "will be ignored".</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_10_sep_2019_102726_loïc_joly_wrote">on 10 Sep 2019, 10:27:26 Loïc Joly wrote:</h3>
<div class="paragraph">
<p>I&#8217;m not sure the issues with global variables are the same in C&#43;&#43; and in RPG&#8230;&#8203; Could you please tell what would be the advantage of handling this as a subtask that has nothing in common with the main task? I know so disadvantages (for instances, RulesAPI has some issues when it comes to handling those sub-tasks), and since the rule ID is hidden from the user, I don&#8217;t see the point&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>As for <a data-rspec-id="S997" class="rspec-auto-link">RSPEC-997</a>, it&#8217;s not really related, since a namespace can also hold global variables.</p>
</div>
<div class="paragraph">
<p>I removed the exception section (there will be nothing specific in the rule about those, since issues would be raised in system headers, and those are systematically ignored.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_10_sep_2019_185145_ann_campbell_wrote">on 10 Sep 2019, 18:51:45 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~loic.joly] if it truly "has nothing in common with the main task" then there is no advantage. But I don&#8217;t think that&#8217;s the case. In this instance, what I see is two currently-independent rules that deal with "global variables Bad!" and it makes sense to me to centralize that theme under one RSpec. In terms of the rule id, it should always be that of the top-level spec, so I don&#8217;t understand how anything would be hidden. I also don&#8217;t understand what disadvantages you see from the RuleAPI side.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_10_sep_2019_200724_loïc_joly_wrote">on 10 Sep 2019, 20:07:24 Loïc Joly wrote:</h3>
<div class="paragraph">
<p>When I said the rule ID is hidden, I meant it&#8217;s not displayed in rules.sonarsource.com, and is not displayed visibly in the UI for sonarqube. From a user perspective, the only element that links the rule for C&#43;&#43; and the rule for RPG is the ruleId that we don&#8217;t want out users to use. This is why I don&#8217;t understand the benefits of this added complexity.</p>
</div>
<div class="paragraph">
<p>On RuleAPI: Reading the <code>See</code> section to fill standards and put labels automatically does not work with subtasks.</p>
</div>
<div class="paragraph">
<p>And if someone adds a section for one language in the main rules, it may silently appear for other languages too&#8230;&#8203;</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_10_oct_2019_154417_geoffray_adde_wrote">on 10 Oct 2019, 15:44:17 Geoffray Adde wrote:</h3>
<div class="paragraph">
<p>\[~loic.joly], I like your version. I tend to be a bit more on your side about creating subtasks or not but I do think that it would be good to have common good practice about it.</p>
</div>
</div>
</div>
</div>