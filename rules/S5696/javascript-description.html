<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>DOM-based cross-site scripting (XSS) occurs in a web application when its client-side logic reads user-controllable data, such as the URL, and then uses this data in dangerous functions defined by the browser, such as <code>eval()</code>, without sanitizing it first.</p>
</div>
<div class="paragraph">
<p>When well-intentioned users open a link to a page vulnerable to DOM-based XSS, they are exposed to several attacks targeting their browsers.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>A well-intentioned user opens a malicious link that injects data into the web application. This data can be text, but also arbitrary code that can be interpreted by the user&#8217;s browser, such as HTML, CSS, or JavaScript.</p>
</div>
<div class="paragraph">
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting this vulnerability.</p>
</div>
<div class="sect3">
<h4 id="_website_defacement">Website defacement</h4>
<div class="paragraph">
<p>An attacker can use the vulnerability to change the target web application&#8217;s content as they see fit. Therefore, they might replace the website&#8217;s original content with inappropriate content, leading to brand and reputation damage for the web application owner. It could additionally be used in phishing campaigns, leading to the potential loss of user credentials.</p>
</div>
</div>
<div class="sect3">
<h4 id="_user_impersonation">User impersonation</h4>
<div class="paragraph">
<p>When a user is logged into a web application and opens a malicious link, the attacker can steal that user&#8217;s web session and carry out unauthorized actions on their account. If the credentials of a privileged user (such as an administrator) are stolen, the attacker might be able to compromise all of the web application&#8217;s data.</p>
</div>
</div>
<div class="sect3">
<h4 id="_theft_of_sensitive_data">Theft of sensitive data</h4>
<div class="paragraph">
<p>Cross-site scripting allows an attacker to extract the application data of any user that opens their malicious link. Depending on the application, this can include sensitive data such as financial or health information. Furthermore, by injecting malicious code into the web application, it might be possible to record keyboard activity (keylogger) or even request access to other devices, such as the camera or microphone.</p>
</div>
</div>
<div class="sect3">
<h4 id="_chaining_xss_with_other_vulnerabilities">Chaining XSS with other vulnerabilities</h4>
<div class="paragraph">
<p>In many cases, bug hunters and attackers can use cross-site scripting vulnerabilities as a first step to exploit more dangerous vulnerabilities.</p>
</div>
<div class="paragraph">
<p>For example, suppose that the admin control panel of a web application contains an SQL injection vulnerability. In this case, an attacker could find an XSS vulnerability and send a malicious link to an administrator. Once the administrator opens the link, the SQL injection is exploited, giving the attacker access to all user data stored in the web application.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it_in_dom_api">How to fix it in DOM API</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="paragraph">
<p>The following code is vulnerable to DOM-based cross-site scripting because it uses unsanitized URL parameters to alter the DOM of its webpage.</p>
</div>
<div class="paragraph">
<p>Because the user input is not sanitized here and the used DOM property is vulnerable to XSS, it is possible to inject arbitrary code in the user&#8217;s browser through this example.</p>
</div>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="paragraph">
<p>The <a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/innerHTML"><code>Element.innerHTML</code></a> property is used to replace the contents of the <code>root</code> element with user-supplied contents. The <code>innerHTML</code> property does not sanitize its input, thus allowing for code injection.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const rootEl = document.getElementById('root');
const queryParams = new URLSearchParams(document.location.search);
const input = queryParams.get("input");

rootEl.innerHTML = input; // Noncompliant</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="paragraph">
<p>The <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/innerText"><code>HTMLElement.innerText</code></a> property does not create DOM elements out of its input, rather treating its input as a string. This makes it a safe alternative to <code>Element.innerHTML</code> depending on the use case.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const rootEl = document.getElementById('root');
const queryParams = new URLSearchParams(document.location.search);
const input = queryParams.get("input");

rootEl.innerText = input;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_how_does_this_work">How does this work?</h3>
<div class="paragraph">
<p>In general, one should limit the use of dangerous properties and methods, such as <code>Element.innerHTML</code> or <code>Document.write()</code>, as there exist many ways for an attacker to exploit their usage. Instead, prefer the usage of safe alternatives such as <code>HTMLElement.innerText</code> or <code>Node.textContent</code>. Furthermore, frameworks such as React or Vue.js will automatically escape variables used in views, making it much harder to accidentally write vulnerable code.</p>
</div>
<div class="paragraph">
<p>If these options are not possible, sanitization of the attacker-controllable input should be preferred.</p>
</div>
<div class="sect3">
<h4 id="_sanitization_of_user_supplied_data">Sanitization of user-supplied data</h4>
<div class="paragraph">
<p>By systematically encoding data that is written to the DOM, it is possible to prevent XSS attacks. In this case, the goal is to leave the data intact from the end user&#8217;s point of view but make it uninterpretable by web browsers.</p>
</div>
<div class="paragraph">
<p>However, selecting an encoding that is guaranteed to be safe can be a complex task. XSS exploitation techniques vary depending on the HTML context where malicious input is injected. As a result, a combination of HTML encoding, URL encoding and JavaScript escaping may be required, depending on the context. <a href="https://cheatsheetseries.owasp.org/cheatsheets/DOM_based_XSS_Prevention_Cheat_Sheet.html">OWASP&#8217;s DOM-based XSS Prevention Cheat Sheet</a> goes into more detail about the required sanitization.</p>
</div>
<div class="paragraph">
<p>Though browsers do not yet provide any direct API to do this sanitization, the <a href="https://github.com/cure53/DOMPurify">DOMPurify library</a> offers extensive functionality to prevent XSS and has been tested by a large user base.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_pitfalls">Pitfalls</h3>
<div class="sect3">
<h4 id="_the_limits_of_validation">The limits of validation</h4>
<div class="paragraph">
<p>Validation of user inputs is a good practice to protect against various injection attacks. But for XSS, validation on its own is not the recommended approach.</p>
</div>
<div class="paragraph">
<p>For example, filtering out user inputs based on a denylist will never fully prevent XSS vulnerabilities from being exploited. This practice is sometimes used by web application firewalls. Time and time again, malicious users are able to find the exploitation payload that will defeat the filters of these firewalls.</p>
</div>
<div class="paragraph">
<p>Another common approach is to parse HTML and strip sensitive HTML tags. Again, this denylist approach is vulnerable by design: maintaining a list of sensitive HTML tags is very difficult in the long run.</p>
</div>
</div>
<div class="sect3">
<h4 id="_modification_after_sanitization">Modification after sanitization</h4>
<div class="paragraph">
<p>Caution should be taken if the user-supplied data is further modified <strong>after</strong> this data was sanitized. Doing so might void the effects of sanitization and introduce new XSS vulnerabilities. In general, modification of this data should occur beforehand instead.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_going_the_extra_mile">Going the extra mile</h3>
<div class="sect3">
<h4 id="_content_security_policy">Content Security Policy</h4>
<div class="paragraph">
<p>With a defense-in-depth security approach, a <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP">Content Security Policy</a> (CSP) can be added through the <code>Content-Security-Policy</code> HTTP header, or using a <code>&lt;meta&gt;</code> element. The CSP aims to mitigate XSS attacks by instructing client browsers not to load data that does not meet the application&#8217;s security requirements.</p>
</div>
<div class="paragraph">
<p>Server administrators can define an allowlist of domains that contain valid scripts, which will prevent malicious scripts (not stored on one of these domains) from being executed. If script execution is not needed on a certain webpage, it can also be blocked altogether.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/OWASP/CheatSheetSeries/blob/master/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.md">OWASP Cheat Sheet</a> - XSS Prevention Cheat Sheet</p>
</li>
<li>
<p><a href="http://www.webappsec.org/projects/articles/071105.shtml">webappsec.org</a> -  DOM Based Cross Site Scripting or XSS of the Third Kind</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_articles_blog_posts">Articles &amp; blog posts</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.sonarsource.com/blog/ghost-admin-takeover/">Ghost CMS 4.3.2 - Cross-Origin Admin Takeover</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_standards">Standards</h3>
<div class="ulist">
<ul>
<li>
<p>OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a></p>
</li>
<li>
<p>OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS)">Top 10 2017 Category A7 - Cross-Site Scripting (XSS)</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/79">CWE-79 - Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')</a></p>
</li>
<li>
<p>STIG Viewer - <a href="https://stigviewer.com/stigs/application_security_and_development/2024-12-06/finding/V-222609">Application Security and Development: V-222609</a> - The application must not be subject to input handling vulnerabilities.</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Change this code to prevent execution of arbitrary client-side code.</p>
</div>
</div>
</div>
</div>