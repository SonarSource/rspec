<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is very easy to write incomplete assertions when using some test frameworks. This rule enforces complete assertions in the following cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Fest: <code>assertThat</code> is not followed by an assertion invocation</p>
</li>
<li>
<p>AssertJ: <code>assertThat</code> is not followed by an assertion invocation</p>
</li>
<li>
<p>Mockito: <code>verify</code> is not followed by a method invocation</p>
</li>
<li>
<p>Truth: <code>assertXXX</code> is not followed by an assertion invocation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In such cases, what is intended to be a test doesn&#8217;t actually verify anything</p>
</div>
<div class="sect2">
<h3 id="_noncompliant_code_example">Noncompliant code example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Fest
boolean result = performAction();
// let's now check that result value is true
assertThat(result); // Noncompliant; nothing is actually checked, the test passes whether "result" is true or false

// Mockito
List mockedList = Mockito.mock(List.class);
mockedList.add("one");
mockedList.clear();
// let's check that "add" and "clear" methods are actually called
Mockito.verify(mockedList); // Noncompliant; nothing is checked here, oups no call is chained to verify()</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_compliant_solution">Compliant solution</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Fest
boolean result = performAction();
// let's now check that result value is true
assertThat(result).isTrue();

// Mockito
List mockedList = Mockito.mock(List.class);
mockedList.add("one");
mockedList.clear();
// let's check that "add" and "clear" methods are actually called
Mockito.verify(mockedList).add("one");
Mockito.verify(mockedList).clear();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_exceptions">Exceptions</h3>
<div class="paragraph">
<p>Variable assignments and return statements are skipped to allow helper methods.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">private BooleanAssert check(String filename, String key) {
  String fileContent = readFileContent(filename);
  performReplacements(fileContent);
  return assertThat(fileContent.contains(key)); // No issue is raised here
}

@Test
public void test() {
  check("foo.txt", "key1").isTrue();
  check("bar.txt", "key2").isTrue();
}</code></pre>
</div>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="ulist">
<ul>
<li>
<p>Complete the assertion.</p>
</li>
<li>
<p>Add a call to 'assertAll' after all 'assertThat'.</p>
</li>
<li>
<p>Add one or more 'assertThat' before 'assertAll'.</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_is_duplicated_by_s2858">is duplicated by: <a data-rspec-id="S2858" class="rspec-auto-link">S2858</a></h3>

</div>
<div class="sect2">
<h3 id="_on_22_may_2015_154959_ann_campbell_wrote">on 22 May 2015, 15:49:59 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>Thanks for this nearly-complete "stub", [~massimo.paladin].</p>
</div>
<div class="paragraph">
<p>Now I&#8217;m going to ask you to work some more :-)</p>
</div>
<div class="paragraph">
<p>Could you add a code snipped to illustrated the exception? I don&#8217;t quite understand it as-is, and I&#8217;m afraid others won&#8217;t either.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_26_may_2015_122221_massimo_paladin_wrote">on 26 May 2015, 12:22:21 Massimo PALADIN wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] I added a code snippet to the exceptions section, back to you for verification.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_26_may_2015_140008_ann_campbell_wrote">on 26 May 2015, 14:00:08 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>This looks great [~massimo.paladin], thanks!</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_29_may_2015_121220_dinesh_bolkensteyn_wrote">on 29 May 2015, 12:12:20 Dinesh Bolkensteyn wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] I&#8217;m increasing the severity to CRITICAL with the agreement of [~mpaladin]: These issues must be fixed immediately - else you might ship broken code</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_29_may_2015_121521_ann_campbell_wrote">on 29 May 2015, 12:15:21 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>Okay [~dinesh.bolkensteyn].</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_19_mar_2019_162904_jeffrey_naisbitt_wrote">on 19 Mar 2019, 16:29:04 Jeffrey Naisbitt wrote:</h3>
<div class="paragraph">
<p>This rule appears to have a bug/false-positive when using AssertJ&#8217;s SoftAssertion feature.  AssertJ has a static method (SoftAssertions.assertSoftly) that calls assertAll() after its soft assertions.  Therefore, this case should not trigger the rule violation indicating 'assertAll' is needed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>import org.assertj.core.api.SoftAssertions;
import org.junit.Test;

public class Rule2970 {

  @Test
  public void test() {
    SoftAssertions.assertSoftly(softly -&gt; {
      softly.assertThat(true).isTrue();
      softly.assertThat(false).isFalse();
    });
  } // False-positive here: squid:S2970: "Add a call to 'assertAll' after all 'assertThat'."
}</pre>
</div>
</div>
</div>
</div>
</div>