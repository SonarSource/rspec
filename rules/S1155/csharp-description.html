<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When you call <code>Any()</code>, it clearly communicates the code&#8217;s intention, which is to check if the collection is empty. Using <code>Count() == 0</code> for this purpose is less direct and makes the code slightly more complex. However, there are some cases where special attention should be paid:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if the collection is an <code>EntityFramework</code> or other ORM query, calling <code>Count()</code> will cause executing a potentially massive SQL query and could put a large overhead on the application database. Calling <code>Any()</code> will also connect to the database, but will generate much more efficient SQL.</p>
</li>
<li>
<p>if the collection is part of a LINQ query that contains <code>Select()</code> statements that create objects, a large amount of memory could be unnecessarily allocated. Calling <code>Any()</code> will be much more efficient because it will execute fewer iterations of the enumerable.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Prefer using <code>Any()</code> to test for emptiness over <code>Count()</code>.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">private static bool HasContent(IEnumerable&lt;string&gt; strings)
{
  return strings.Count() &gt; 0;  // Noncompliant
}

private static bool HasContent2(IEnumerable&lt;string&gt; strings)
{
  return strings.Count() &gt;= 1;  // Noncompliant
}

private static bool IsEmpty(IEnumerable&lt;string&gt; strings)
{
  return strings.Count() == 0;  // Noncompliant
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">private static bool HasContent(IEnumerable&lt;string&gt; strings)
{
  return strings.Any();
}

private static bool HasContent2(IEnumerable&lt;string&gt; strings)
{
  return strings.Any();
}

private static bool IsEmpty(IEnumerable&lt;string&gt; strings)
{
  return !strings.Any();
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_benchmarks">Benchmarks</h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Runtime</th>
<th class="tableblock halign-left valign-top">Mean</th>
<th class="tableblock halign-left valign-top">Standard Deviation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Count</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET 9.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2,841.003 ns</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">266.0238 ns</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET 9.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.749 ns</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.1242 ns</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Count</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET Framework 4.8.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">71,125.275 ns</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">731.0382 ns</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET Framework 4.8.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">31.774 ns</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.3196 ns</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_glossary">Glossary</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://en.wikipedia.org/wiki/Arithmetic_mean">Mean</a></p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Standard_deviation">Standard Deviation</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The results were generated by running the following snippet with <a href="https://github.com/dotnet/BenchmarkDotNet">BenchmarkDotNet</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">private IEnumerable&lt;int&gt; collection;

public const int N = 10_000;

[GlobalSetup]
public void GlobalSetup()
{
    collection = Enumerable.Range(0, N).Select(x =&gt; N - x);
}

[Benchmark(Baseline = true)]
public bool Count() =&gt;
    collection.Count() &gt; 0;

[Benchmark]
public bool Any() =&gt;
    collection.Any();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Hardware Configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>BenchmarkDotNet v0.14.0, Windows 10 (10.0.19045.5247/22H2/2022Update)
12th Gen Intel Core i7-12800H, 1 CPU, 20 logical and 14 physical cores
  [Host]               : .NET Framework 4.8.1 (4.8.9282.0), X64 RyuJIT VectorSize=256
  .NET 9.0             : .NET 9.0.0 (9.0.24.52809), X64 RyuJIT AVX2
  .NET Framework 4.8.1 : .NET Framework 4.8.1 (4.8.9282.0), X64 RyuJIT VectorSize=256</code></pre>
</div>
</div>
<hr>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Use ".Any()" to test whether this "IEnumerable&lt;XXX&gt;" is empty or not.</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_20_may_2015_153139_ann_campbell_wrote">on 20 May 2015, 15:31:39 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~tamas.vajk] please fill in code samples.</p>
</div>
<div class="paragraph">
<p>Also, the description is a shallow modification of the Java version. The reasoning sounded plausible, but please verify that the efficiency argument is valid for C#.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_22_may_2015_111559_tamas_vajk_wrote">on 22 May 2015, 11:15:59 Tamas Vajk wrote:</h3>
<div class="paragraph">
<p>Added a small sample.</p>
</div>
<div class="paragraph">
<p>The performance reasoning is not 100% true:</p>
</div>
<div class="paragraph">
<p>If you call <code>Count()</code> on a <code>List&lt;T&gt;</code>, it will cast the list to an <code>ICollection&lt;T&gt;</code>, and call the <code>Count</code> property. Whereas an <code>Any()</code> on a <code>List&lt;T&gt;</code> will get the underlying <code>IEnumerator</code>, and call <code>GetNext()</code> on it. My feeling is that the second one is going to be slower, but I haven&#8217;t done any measurements.</p>
</div>
<div class="paragraph">
<p>Also, an <code>IEnumerable</code> can be an abstraction on top of a database as well. In this case <code>Any()</code> and <code>Count()</code> are transformed to SQL, and the performance may depend on many things. It seems that <code>Count()</code> performs better for SQL Server and Entity Framework: 2nd answer of http://stackoverflow.com/questions/305092/which-method-performs-better-any-vs-count-0. But the samples there use predicates in the <code>Any()</code> and <code>Count()</code>, which might also affect the performance.</p>
</div>
<div class="paragraph">
<p>So I would emphasize the intention and not the performance.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_22_may_2015_121746_ann_campbell_wrote">on 22 May 2015, 12:17:46 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~tamas.vajk], your response makes me wonder whether we should write the opposite rule (in addition to this one? instead of this one?).</p>
</div>
<div class="paragraph">
<p>That aside, I&#8217;ve made some edits. Please double-check me.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_22_may_2015_124040_tamas_vajk_wrote">on 22 May 2015, 12:40:40 Tamas Vajk wrote:</h3>
<div class="paragraph">
<p>LGTM</p>
</div>
<div class="paragraph">
<p>I wouldn&#8217;t write the opposite rule. The developer needs to know whatever he is doing. In case of an underlying database table, the queries always need performance profiling, so the developer will need to optimize that, and can suppress this warning if he finds that for performance reasons he needs to use <code>Count() &gt; 0</code>.</p>
</div>
<div class="paragraph">
<p>For in-memory operations, the performance difference won&#8217;t matter. Or if it does, then other micro-optimizations will have to be done as well.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_22_may_2015_133237_tamas_vajk_wrote">on 22 May 2015, 13:32:37 Tamas Vajk wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] I&#8217;ve added a new noncompliant code sample</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_22_may_2015_143751_ann_campbell_wrote">on 22 May 2015, 14:37:51 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>Okay [~tamas.vajk]</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_26_may_2015_113552_tamas_vajk_wrote">on 26 May 2015, 11:35:52 Tamas Vajk wrote:</h3>
<div class="paragraph">
<p>Added the <code>Count() == 0</code> to the description and extended the code samples</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_26_may_2015_140318_ann_campbell_wrote">on 26 May 2015, 14:03:18 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~tamas.vajk] the description talks about comparing <code>.Count()</code> to 0, but one of the code samples illustrates a comparison to 1.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_26_may_2015_141347_tamas_vajk_wrote">on 26 May 2015, 14:13:47 Tamas Vajk wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] You are right, I removed the comparison to <code>0</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_27_may_2015_140431_ann_campbell_wrote">on 27 May 2015, 14:04:31 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>Thanks [~tamas.vajk]. I&#8217;ve merged the code blocks into one block each for Compliant and Noncompliant</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_1_jun_2015_143042_ann_campbell_wrote">on 1 Jun 2015, 14:30:42 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>I&#8217;ve updated the examples with <code>List&lt;string&gt;</code>. Please double-check me.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_1_jun_2015_144945_tamas_vajk_wrote">on 1 Jun 2015, 14:49:45 Tamas Vajk wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2], I&#8217;ve changed the <code>List&lt;string&gt;</code> to <code>IEnumerable&lt;string&gt;</code>, because the <code>List</code> has a <code>Count</code> property, so calling the <code>Count()</code> on it might not be the best example.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_1_jun_2015_174945_ann_campbell_wrote">on 1 Jun 2015, 17:49:45 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>okay, thanks [~tamas.vajk]</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_2_mar_2017_154513_valeri_hristov_wrote">on 2 Mar 2017, 15:45:13 Valeri Hristov wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2], I updated the description a bit, could you please review?</p>
</div>
</div>
<div class="sect2">
<h3 id="_is_related_to_s3981">is related to: <a data-rspec-id="S3981" class="rspec-auto-link">S3981</a></h3>

</div>
<div class="sect2">
<h3 id="_is_related_to_s2250">is related to: <a data-rspec-id="S2250" class="rspec-auto-link">S2250</a></h3>

</div>
<div class="sect2">
<h3 id="_on_30_jul_2013_170625_dinesh_bolkensteyn_wrote">on 30 Jul 2013, 17:06:25 Dinesh Bolkensteyn wrote:</h3>
<div class="paragraph">
<p>Implemented by https://jira.codehaus.org/browse/SONARJAVA-243</p>
</div>
</div>
</div>
</div>