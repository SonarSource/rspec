<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Creating a new <code>Random</code> object each time a random value is needed is inefficient and may produce numbers that are not random, depending on
the JDK. For better efficiency and randomness, create a single <code>Random</code>, store it, and reuse it.</p>
</div>
<div class="paragraph">
<p>The <code>Random()</code> constructor tries to set the seed with a distinct value every time. However, there is no guarantee that the seed will be
randomly or uniformly distributed. Some JDK will use the current time as seed, making the generated numbers not random.</p>
</div>
<div class="paragraph">
<p>This rule finds cases where a new <code>Random</code> is created each time a method is invoked.</p>
</div>
<div class="sect2">
<h3 id="_exceptions">Exceptions</h3>
<div class="paragraph">
<p>This rule doesn&#8217;t apply to classes that use a <code>Random</code> in their constructors or the static <code>main</code> function and nowhere else.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Define and reuse the <code>Random</code> object.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">class MyClass {

    public void doSomethingCommon() {
      Random random = new Random();        // Noncompliant - new instance created with each invocation
      int rValue = random.nextInt();
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">class MyClass {
    private Random random = new Random();  // Compliant

    public void doSomethingCommon() {
      int rValue = this.random.nextInt();
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.oracle.com/en/java/javase/20/docs/api/java.base/java/util/Random.html">Oracle Java SE - Random</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_articles_blog_posts">Articles &amp; blog posts</h3>
<div class="ulist">
<ul>
<li>
<p>OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security Misconfiguration</a></p>
</li>
<li>
<p><a href="https://www.baeldung.com/java-generating-random-numbers">Baeldung - generating random number</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Save and re-use this "Random".</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_8_oct_2014_181047_ann_campbell_wrote">on 8 Oct 2014, 18:10:47 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~nicolas.peru] to what degree do we see/pay attention to "run once" annotations during analysis, e.g. @PostConstruct?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_22_oct_2014_191436_nicolas_peru_wrote">on 22 Oct 2014, 19:14:36 Nicolas Peru wrote:</h3>
<div class="paragraph">
<p>At the moment : none.</p>
</div>
<div class="paragraph">
<p>So this rule won&#8217;t detect that your random object is initialized in an init method.</p>
</div>
<div class="paragraph">
<p>It might makes more sense to actually detect Random local variables.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_22_oct_2014_194032_ann_campbell_wrote">on 22 Oct 2014, 19:40:32 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~nicolas.peru] you mean local <code>Random</code> variables, right? :-)</p>
</div>
<div class="paragraph">
<p>(I did actually have to read that twice &amp; note the capital letter to understand your meaning :-) )</p>
</div>
<div class="paragraph">
<p>I&#8217;d say that as written, this rule is about local <code>Random</code>s (did you assign it back to me because you don&#8217;t agree?), but I was hoping to be able to make it smarter. Oh well.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_15_aug_2018_182835_nicolas_harraudeau_wrote">on 15 Aug 2018, 18:28:35 Nicolas Harraudeau wrote:</h3>
<div class="paragraph">
<p>This RSPEC is for now limited to detecting local variables of type <code>java.util.Random</code>.</p>
</div>
<div class="paragraph">
<p>It could later cover cases where the Random object is not even assigned:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>(new Random()).nextInt()</pre>
</div>
</div>
</div>
</div>
</div>