<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The usage of HTTPS is not enforced here. As it is possible for the HTTP client to follow redirects, such redirects might lead to websites using HTTP.</p>
</div>
<div class="paragraph">
<p>As HTTP is a clear-text protocol, it is considered insecure. Due to its lack of encryption, attackers that are able to sniff traffic from the network can read, modify, or corrupt the transported content. Therefore, allowing redirects to HTTP can lead to several risks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Exposure of sensitive data</p>
</li>
<li>
<p>Malware-infected software updates or installers</p>
</li>
<li>
<p>Corruption of critical information</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Even in isolated networks, such as segmented cloud or offline environments, it is important to ensure the usage of HTTPS. If not, then insider threats with access to these environments might still be able to monitor or tamper with communications.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ask_yourself_whether">Ask Yourself Whether</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>It is possible for the requested resource to be redirected to an insecure location in the future.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There is a risk if you answered yes to the question.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_recommended_secure_coding_practices">Recommended Secure Coding Practices</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Ensure that the HTTP client only accepts HTTPS pages. In <code>curl</code> this can be enabled using the option
<code>--proto "=https"</code>.</p>
</li>
<li>
<p>If it is not necessary to follow HTTP redirects, disable this in the HTTP client. In <code>curl</code> this is done by omitting
the <code>-L</code> or <code>--location</code> option. In <code>wget</code> this is done by adding the option <code>--max-redirect=0</code>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sensitive_code_example">Sensitive Code Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the examples below, an install script is downloaded using <code>curl</code> or <code>wget</code> and then executed.</p>
</div>
<div class="paragraph">
<p>While connections made using HTTPS are generally considered secure, <code>https://might-redirect.example.com/install.sh</code>
might redirect to a location that uses HTTP. Downloads made using HTTP are not secure and can be intercepted and
modified. An attacker could modify the install script to run malicious code inside the container.</p>
</div>
<div class="paragraph">
<p><code>curl</code> will not follow redirects unless either <code>-L</code> or <code>--location</code> option is used.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-docker" data-lang="docker">FROM ubuntu:22.04

# Sensitive
RUN curl --tlsv1.2 -sSf -L https://might-redirect.example.com/install.sh | sh</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>wget</code> will follow redirects by default.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-docker" data-lang="docker">FROM ubuntu:22.04

# Sensitive
RUN wget --secure-protocol=TLSv1_2 -q -O - https://might-redirect.example.com/install.sh | sh</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you expect the server to redirect the download to a new location, <code>curl</code> can use the option <code>--proto "=https"</code>
to ensure requests are only made using HTTPS. Any attempt to redirect to a location using HTTP will result in an error.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-docker" data-lang="docker">FROM ubuntu:22.04

RUN curl --proto "=https" --tlsv1.2 -sSf -L https://might-redirect.example.com/install.sh | sh</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>wget</code> does not support this functionality so <code>curl</code> should be used instead.</p>
</div>
<div class="paragraph">
<p>If you expect the server to return the file without redirects, <code>curl</code> should not be instructed to follow redirects.
Remove any <code>-L</code> or <code>--location</code> options from the command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-docker" data-lang="docker">FROM ubuntu:22.04

RUN curl --tlsv1.2 -sSf https://might-redirect.example.com/install.sh | sh</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>wget</code> uses the option <code>--max-redirect=0</code> to disable redirects.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-docker" data-lang="docker">FROM ubuntu:22.04

RUN wget --secure-protocol=TLSv1_2 --max-redirect=0 -q -O - https://might-redirect.example.com/install.sh | sh</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/757">CWE-757 - Selection of Less-Secure Algorithm During Negotiation ('Algorithm Downgrade')</a></p>
</li>
<li>
<p><a href="https://curl.se/docs/manpage.html#--proto">curl.1 the man page</a> - <code>--proto &lt;protocols&gt;</code></p>
</li>
<li>
<p><a href="https://www.gnu.org/software/wget/manual/wget.html#HTTP-Options">wget - GNU Wget Manual</a> - <code>--max-redirect=</code></p>
</li>
<li>
<p><a href="https://github.com/ssllabs/research/wiki/SSL-and-TLS-Deployment-Best-Practices#41-encrypt-everything">SSL and TLS Deployment Best Practices</a> - Encrypt Everything</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>For <code>curl</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Not enforcing HTTPS here might allow for redirections to insecure websites. Make sure it is safe here.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For <code>wget</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Not disabling redirects might allow for redirections to insecure websites. Make sure it is safe here.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="paragraph">
<p>For <code>curl</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Highlight the <code>curl</code> command, the <code>-L</code> option, and the URL.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For <code>wget</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Highlight the <code>wget</code> command and the URL.</p>
</li>
</ul>
</div>
</div>
</div>
</div>