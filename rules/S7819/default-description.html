<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This rule raises an issue when code references local variables or methods that are undefined or inaccessible due to Ruby&#8217;s scoping rules.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ruby has strict scoping rules that determine where variables and methods can be accessed. Local variables are only accessible within the scope where they are defined, and method definitions create new scopes.</p>
</div>
<div class="paragraph">
<p>When code attempts to reference a local variable that doesn&#8217;t exist in the current scope, Ruby will raise a <code>NameError</code> at runtime. This commonly happens in two scenarios:</p>
</div>
<div class="paragraph">
<p><strong>Local variables assigned in one method but referenced in another</strong>: In Ruby, local variables are scoped to the method where they are defined. Assigning <code>current_user = user</code> inside a method creates a local variable that cannot be accessed from other methods.</p>
</div>
<div class="paragraph">
<p><strong>Local variables referenced across scope boundaries</strong>: Method definitions create new scopes, so local variables defined outside a method are not accessible within that method. This is different from some other languages where inner scopes can access outer scope variables.</p>
</div>
<div class="paragraph">
<p>Ruby&#8217;s method call syntax can make this confusing because method calls don&#8217;t require parentheses. When Ruby encounters an undefined identifier, it first checks for local variables, then looks for method calls. If neither exists, it raises a <code>NameError</code>.</p>
</div>
<div class="paragraph">
<p>These scoping violations indicate a misunderstanding of Ruby&#8217;s variable accessibility rules and often suggest that the code needs to be restructured to use appropriate mechanisms for sharing data between different parts of the program.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>This issue will cause <code>NameError</code> exceptions at runtime, leading to application crashes. The error may not be discovered until the specific code path is executed, potentially causing failures in production environments. This can result in poor user experience and system reliability issues.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Use instance variables and proper getter/setter methods instead of local variables when you need to share state between methods.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">class SessionsHelper
  def sign_in(user)
    current_user = user  # Local variable, not accessible elsewhere
  end

  def signed_in?
    !current_user.nil?  # Noncompliant: undefined local variable or method
  end
end</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">class SessionsHelper
  def current_user
    @current_user ||= user_from_remember_token
  end

  def current_user=(user)
    @current_user = user
  end

  def signed_in?
    !current_user.nil?  # References properly defined method
  end

  private

  def user_from_remember_token
    # Implementation details
  end
end</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Ruby Documentation - Variables and Constants - <a href="https://ruby-doc.org/core/doc/syntax/assignment_rdoc.html">Official Ruby documentation explaining variable scoping and assignment rules</a></p>
</li>
<li>
<p>Ruby Style Guide - Variables - <a href="https://rubystyle.guide/#variables">Community style guide covering proper variable usage patterns in Ruby</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>