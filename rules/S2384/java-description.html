<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Mutable objects are those whose state can be changed. For instance, an array is mutable, but a String is not. Private mutable class members should never be returned to a caller or accepted and stored directly. Doing so leaves you vulnerable to unexpected changes in your class state.</p>
</div>
<div class="paragraph">
<p>Instead use an unmodifiable <code>Collection</code> (via <code>Collections.unmodifiableCollection</code>, <code>Collections.unmodifiableList</code>, &#8230;&#8203;) or make a copy of the mutable object, and store or return the copy instead.</p>
</div>
<div class="paragraph">
<p>This rule checks that private arrays, collections and Dates are not stored or returned directly.</p>
</div>
<div class="sect2">
<h3 id="_exceptions">Exceptions</h3>
<div class="paragraph">
<p>The rule violation is not reported for mutable values stored in private methods if no non-private methods directly passes a mutable parameter to them.</p>
</div>
<div class="paragraph">
<p>Similarly, rule violations are not reported for mutable values returned by a private getter if that getter&#8217;s value is not directly exposed by a non-private method.</p>
</div>
</div>
<div class="sect2">
<h3 id="_noncompliant_code_example">Noncompliant code example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">class A {
  private String[] strings;

  public A () {
    strings = new String[]{"first", "second"};
  }

  public String[] getStrings() {
    return strings; // Noncompliant
  }

  public void setStrings(String[] strings) {
    this.strings = strings;  // Noncompliant
  }
}

public class B {

  private A a = new A();  // At this point a.strings = {"first", "second"};

  public void wreakHavoc() {
    a.getStrings()[0] = "yellow";  // a.strings = {"yellow", "second"};
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_compliant_solution">Compliant solution</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">class A {
  private String [] strings;

  public A () {
    strings = new String[]{"first", "second"};
  }

  public String[] getStrings() {
    return getStringsInternal().clone();
  }

  private String[] getStringsInternal() {
    return strings;
  }

  private void setStringsInternal(String[] strings) {
    this.strings = strings;
  }

  public void setStrings(String[] strings) {
    this.strings = strings.clone();
  }
}

public class B {

  private A a = new A();  // At this point a.strings = {"first", "second"};

  public void wreakHavoc() {
    a.getStrings()[0] = "yellow";  // a.strings = {"first", "second"};
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/374">CWE-374 - Passing Mutable Objects to an Untrusted Method</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/375">CWE-375 - Returning a Mutable Object to an Untrusted Caller</a></p>
</li>
<li>
<p><a href="https://wiki.sei.cmu.edu/confluence/x/OTdGBQ">CERT, OBJ05-J.</a> - Do not return references to private mutable class members</p>
</li>
<li>
<p><a href="https://wiki.sei.cmu.edu/confluence/x/HTdGBQ">CERT, OBJ06-J.</a> - Defensively copy mutable inputs and mutable internal components</p>
</li>
<li>
<p><a href="https://wiki.sei.cmu.edu/confluence/x/VzZGBQ">CERT, OBJ13-J.</a> - Ensure that references to mutable objects are not exposed</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>(Store|Return) a copy of "xxx" [or use an immutable "Collection"].</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_is_duplicated_by_s1240">is duplicated by: <a data-rspec-id="S1240" class="rspec-auto-link">S1240</a></h3>

</div>
<div class="sect2">
<h3 id="_on_27_jan_2015_205142_freddy_mallet_wrote">on 27 Jan 2015, 20:51:42 Freddy Mallet wrote:</h3>
<div class="paragraph">
<p>My comment on <a data-rspec-id="S2385" class="rspec-auto-link">RSPEC-2385</a> is also relevant here, I would limit the scope of this rule to some known and widely used mutable objects. Moreover I would not activate this rule by default and would use the tag 'security'. Looks like we could link this rule to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>http://cwe.mitre.org/data/definitions/375.html</p>
</li>
<li>
<p>http://cwe.mitre.org/data/definitions/374.html</p>
</li>
<li>
<p>https://www.securecoding.cert.org/confluence/display/java/OBJ05-J.+Defensively+copy+private+mutable+class+members+before+returning+their+references</p>
</li>
</ul>
</div>
</div>
</div>
</div>