<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When the same code is duplicated in two or more separate branches of a conditional,
it can make the code harder to understand, maintain, and can potentially introduce
bugs if one instance of the code is changed but others are not.</p>
</div>
<div class="paragraph">
<p>Having two <code>WHEN</code> clauses in the same <code>EVALUATE</code> statement or two branches in the same <code>IF</code> structure with the same implementation is at best duplicate code, and at worst a coding error.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cobol" data-lang="cobol">IF X = 1
  MOVE A TO B.
  PERFORM SECTION1
ELSE
  IF X &gt; 10
    PERFORM SECTION2
  ELSE                *&gt; Noncompliant
    MOVE A TO B.
    PERFORM SECTION1
  END-IF
END-IF.</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cobol" data-lang="cobol">EVALUATE X
  WHEN 1
    MOVE A TO B.
    PERFORM SECTION1
  WHEN 2
    MOVE A TO C.
    PERFORM SECTION2
  WHEN 3              *&gt; Noncompliant; duplicates WHEN 1's implementation
    MOVE A TO B.
    PERFORM SECTION1
END-EVALUATE.</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the same logic is truly needed for both instances, then:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>in an <code>IF</code> structure they should be combined</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cobol" data-lang="cobol">IF (X = 1) OR (X &lt;= 10)
  MOVE A TO B.
  PERFORM SECTION1
ELSE
  PERFORM SECTION2
END-IF.</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>for an <code>EVALUATE</code>, one should fall through to the other</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cobol" data-lang="cobol">EVALUATE X
  WHEN 1
  WHEN 3
    MOVE A TO B.
    PERFORM SECTION1
  WHEN 2
    MOVE A TO C.
    PERFORM SECTION2
END-EVALUATE.</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_exceptions">Exceptions</h3>
<div class="paragraph">
<p>Blocks in an <code>IF</code> chain that contain a single line of code are ignored, as are blocks in a <code>EVALUATE</code> statement that contain a single line of code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cobol" data-lang="cobol">EVALUATE X
  WHEN 1
    PERFORM SECTION1
  WHEN 2
    PERFORM SECTION2
  WHEN 3              *&gt; no issue, usually this is done on purpose to increase the readability
    PERFORM SECTION1
END-EVALUATE.</code></pre>
</div>
</div>
<div class="paragraph">
<p>But this exception does not apply to <code>IF</code> chains without <code>ELSE</code>-s, or to <code>EVALUATE</code>-s without <code>WHEN OTHER</code> clauses when all branches have the same single line of code. In case of <code>IF</code> chains with <code>ELSE</code>-s, or of <code>EVALUATE</code>-es with <code>WHEN OTHER</code> clauses, rule <a data-rspec-id="S3923" class="rspec-auto-link">S3923</a> raises a bug.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cobol" data-lang="cobol">EVALUATE X
  WHEN 1
    PERFORM SECTION1
  WHEN 3              *&gt; Noncompliant, this might have been done on purpose but probably not
    PERFORM SECTION1
END-EVALUATE.</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_related_rules">Related rules</h3>
<div class="ulist">
<ul>
<li>
<p><a data-rspec-id="S3923" class="rspec-auto-link">S3923</a> - All branches in a conditional structure should not have exactly the same implementation</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>This [branch|"WHEN" clause]'s code is the same as the code for the [branch|"WHEN" clause] on line X.</p>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="ulist">
<ul>
<li>
<p>Primary: 2nd block</p>
</li>
<li>
<p>Secondary: 1st block</p>
<div class="ulist">
<ul>
<li>
<p>Message: Original</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>All characters in both blocks should be underlined.</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_30_sep_2014_104956_evgeny_mandrikov_wrote">on 30 Sep 2014, 10:49:56 Evgeny Mandrikov wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] why not activated by default?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_1_oct_2014_073446_nicolas_peru_wrote">on 1 Oct 2014, 07:34:46 Nicolas Peru wrote:</h3>
<div class="paragraph">
<p>Good question indeed : is there a reason to not have this one activated by default ?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_1_oct_2014_115827_ann_campbell_wrote">on 1 Oct 2014, 11:58:27 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~evgeny.mandrikov] &amp; [~nicolas.peru] in light of the allowed fall-through exception in <a data-rspec-id="S128" class="rspec-auto-link">RSPEC-128</a> (I had been forgetting it was there), there&#8217;s not. Change made.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_7_apr_2015_193519_evgeny_mandrikov_wrote">on 7 Apr 2015, 19:35:19 Evgeny Mandrikov wrote:</h3>
<div class="paragraph">
<p>I want to believe that</p>
</div>
<div class="listingblock">
<div class="content">
<pre>if (...) {

  doSomething();

} else {

  doSomething();

}</pre>
</div>
</div>
<div class="paragraph">
<p>is part of this rule. But this is not clear from description.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_8_apr_2015_141339_ann_campbell_wrote">on 8 Apr 2015, 14:13:39 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>Not sure I get your point [~evgeny.mandrikov]</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_8_apr_2015_160213_evgeny_mandrikov_wrote">on 8 Apr 2015, 16:02:13 Evgeny Mandrikov wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] description looks good, and I updated examples to cover this case explicitly.</p>
</div>
</div>
</div>
</div>