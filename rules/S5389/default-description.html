<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Using absolute URLs to Salesforce Pages is bug prone. Different sandboxes and production environments will have different instance names (like "na10", "na15" etc.). Code using absolute URLs will only work when it runs in the corresponding salesforce instances. It will break as soon as it is deployed in another one. Thus only relative URLs, i.e. without the domain and subdomain names, should be used when pointing to a salesforce page.</p>
</div>
<div class="paragraph">
<p>This rule raises an issue when a string matches the regular expression:</p>
</div>
<div class="paragraph">
<p>{noformat}</p>
</div>
<div class="paragraph">
<p>(?&lt;!\w)(login|test|(dns|test|[a-z]{1,2})\d&#43;&#43;)\.(salesforce|force|visual\.force|content\.force)\.com(?!\w)</p>
</div>
<div class="paragraph">
<p>{noformat}</p>
</div>
<div class="sect2">
<h3 id="_noncompliant_code_example">Noncompliant code example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-apex" data-lang="apex">public PageReference testRedirect() {
    String strUrl ='https://na8.salesforce.com/TestVFPage?AcoountId=999'; // Noncompliant
    PageReference newUrl = new PageReference(strUrl);
    newURL.setRedirect(true);
    return newURL;
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_compliant_solution">Compliant solution</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-apex" data-lang="apex">public PageReference testRedirect() {
    String strUrl = URL.getSalesforceBaseUrl().toExternalForm() + '/TestVFPage?AcoountId=999';
    PageReference newUrl = new PageReference(strUrl);
    newURL.setRedirect(true);
    return newURL;
}
OR
public PageReference testRedirect() {
    String strUrl = URL.getOrgDomainUrl().toExternalForm() + '/TestVFPage?AcoountId=999';
    PageReference newUrl = new PageReference(strUrl);
    newURL.setRedirect(true);
    return newURL;
}</code></pre>
</div>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Make this absolute URL relative.</p>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="paragraph">
<p>The URL String</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_6_aug_2019_104628_alban_auzeill_wrote">on 6 Aug 2019, 10:46:28 Alban Auzeill wrote:</h3>
<div class="paragraph">
<p>\[~nicolas.harraudeau],</p>
</div>
<div class="paragraph">
<p>I disagree with theÂ regular expression (http|https)://[^/]\.(salesforce|force)\.com.*</p>
</div>
<div class="literalblock">
<div class="content">
<pre>IMO it's too generic (and by the way wrong because [^/] match only one character), we should only report issues for server hostnames that belong to a group, for example:</pre>
</div>
</div>
<div class="paragraph">
<p>{noformat}</p>
</div>
<div class="paragraph">
<p>dns03.salesforce.com</p>
</div>
<div class="paragraph">
<p>dns06.salesforce.com</p>
</div>
<div class="paragraph">
<p>ns2.salesforce.com</p>
</div>
<div class="paragraph">
<p>ns4.salesforce.com</p>
</div>
<div class="paragraph">
<p><a href="https://cs1.salesforce.com" class="bare">https://cs1.salesforce.com</a></p>
</div>
<div class="paragraph">
<p><a href="https://cs2.salesforce.com" class="bare">https://cs2.salesforce.com</a></p>
</div>
<div class="paragraph">
<p><a href="https://c.cs3.visual.force.com" class="bare">https://c.cs3.visual.force.com</a></p>
</div>
<div class="paragraph">
<p><a href="https://c.cs4.visual.force.com" class="bare">https://c.cs4.visual.force.com</a></p>
</div>
<div class="paragraph">
<p><a href="https://na4.salesforce.com" class="bare">https://na4.salesforce.com</a></p>
</div>
<div class="paragraph">
<p><a href="https://ap7.salesforce.com" class="bare">https://ap7.salesforce.com</a></p>
</div>
<div class="paragraph">
<p><a href="https://eu9.salesforce.com" class="bare">https://eu9.salesforce.com</a></p>
</div>
<div class="paragraph">
<p><a href="https://cs12.salesforce.com" class="bare">https://cs12.salesforce.com</a></p>
</div>
<div class="paragraph">
<p><a href="https://my-domain-dev-ed&#8212;&#8203;c.na50.content.force.com/" class="bare">https://my-domain-dev-ed&#8212;&#8203;c.na50.content.force.com/</a></p>
</div>
<div class="paragraph">
<p>test1.force.com</p>
</div>
<div class="paragraph">
<p>test3.force.com</p>
</div>
<div class="paragraph">
<p><a href="https://login.salesforce.com" class="bare">https://login.salesforce.com</a> (production)</p>
</div>
<div class="paragraph">
<p><a href="https://test.salesforce.com" class="bare">https://test.salesforce.com</a> (sandbox)</p>
</div>
<div class="paragraph">
<p>{noformat}</p>
</div>
<div class="paragraph">
<p>But not if the server hostname does not belong to a group, for example:</p>
</div>
<div class="paragraph">
<p>{noformat}</p>
</div>
<div class="paragraph">
<p>www.salesforce.com</p>
</div>
<div class="paragraph">
<p>admin.salesforce.com</p>
</div>
<div class="paragraph">
<p>blog.salesforce.com</p>
</div>
<div class="paragraph">
<p>community.salesforce.com</p>
</div>
<div class="paragraph">
<p>developers.salesforce.com</p>
</div>
<div class="paragraph">
<p>downloads.salesforce.com</p>
</div>
<div class="paragraph">
<p>info.salesforce.com</p>
</div>
<div class="paragraph">
<p>mail.salesforce.com</p>
</div>
<div class="paragraph">
<p>mobile.salesforce.com</p>
</div>
<div class="paragraph">
<p>support.salesforce.com</p>
</div>
<div class="paragraph">
<p>video.salesforce.com</p>
</div>
<div class="paragraph">
<p>mydomain.my.salesforce.com</p>
</div>
<div class="paragraph">
<p>m.force.com</p>
</div>
<div class="paragraph">
<p>error.force.com</p>
</div>
<div class="paragraph">
<p>payment.force.com</p>
</div>
<div class="paragraph">
<p>directory.force.com</p>
</div>
<div class="paragraph">
<p>database.force.com</p>
</div>
<div class="paragraph">
<p>redhat.force.com</p>
</div>
<div class="paragraph">
<p>cisco.force.com</p>
</div>
<div class="paragraph">
<p>dell.force.com</p>
</div>
<div class="paragraph">
<p>{noformat}</p>
</div>
<div class="paragraph">
<p>I prefer a more specific expression compliant with the above lists:</p>
</div>
<div class="paragraph">
<p>{noformat}</p>
</div>
<div class="paragraph">
<p>(?&lt;!\w)(login|test|(dns|test|[a-z]{1,2})\d&#43;&#43;)\.(salesforce|force|visual\.force|content\.force)\.com(?!\w)</p>
</div>
<div class="paragraph">
<p>{noformat}</p>
</div>
</div>
</div>
</div>