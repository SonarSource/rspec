<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This rule raises an issue when an empty list is provided to PySpark <code>DataFrame.dropDuplicates</code>, <code>DataFrame.drop_duplicates</code> or <code>DataFrame.dropDuplicatesWithinWatermark</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A list of columns can be provided to the <code>subset</code> argument of PySpark&#8217;s <code>DataFrame.dropDuplicates</code> method.
This will cause the method to only consider the columns in the <code>subset</code> argument when evaluating if a row is a duplicate.
It is also possible to use all columns of the <code>DataFrame</code> by passing <code>None</code> to the <code>subset</code> argument or leaving it empty (as <code>None</code> is the default value).
However when an empty list is provided to the <code>subset</code> argument, <code>dropDuplicates</code> does not perform any deduplication but instead removes all row except one,
which can lead to unexpected results and potentially incorrect data analysis.
This rule ensures that <code>DataFrame.dropDuplicates</code> is used correctly by specifying at least one column, or not specifying a column at all.</p>
</div>
<div class="paragraph">
<p>This rule will raise issues as well on <code>DataFrame.drop_duplicates</code> and <code>DataFrame.dropDuplicatesWithinWatermark</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To fix this issue remove the empty list or provide at least one column to the subset argument.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from pyspark.sql import SparkSession

spark = SparkSession.builder.master("local").appName("Example").getOrCreate()

data = [("Alice", 1), ("Bob", 2), ("Alice", 1)]
df = spark.createDataFrame(data, ["name", "id"])

df.dropDuplicates([]) # Noncompliant: an empty list is provided as parameter</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from pyspark.sql import SparkSession

spark = SparkSession.builder.master("local").appName("Example").getOrCreate()

data = [("Alice", 1), ("Bob", 2), ("Alice", 1)]
df = spark.createDataFrame(data, ["name", "id"])

df.dropDuplicates(["name"]) # Compliant</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>PySpark Documentation - <a href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrame.dropDuplicates.html">DataFrame.dropDuplicates</a></p>
</li>
<li>
<p>PySpark Documentation - <a href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrame.dropDuplicatesWithinWatermark.html">DataFrame.dropDuplicatesWithinWatermark</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_implementation_specification">Implementation Specification</h3>

</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Provide an adequate value to the "subset" parameter instead of an empty list.</p>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="paragraph">
<p>The main location is the method <code>dropDuplicates</code> and the secondary location is the empty list literal.</p>
</div>
</div>
<div class="sect2">
<h3 id="_quickfix">Quickfix</h3>
<div class="paragraph">
<p>We can simply remove the empty list literal if it is directly provided to the method or change it to <code>None</code> (this could be done also when a variable is provided as argument.
Quick fix message: <code>Remove this empty list.</code>, or <code>Replace this empty list with None.</code></p>
</div>
</div>
</div>
</div>