<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A code block should not contain too many logging statements of a specific level.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Excessive logging within a code block can lead to several problems:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Log file overload</strong>: generating an overwhelming number of log entries can fill up disk space quickly (thus increasing the storage space cost) and make it challenging to identify important log events promptly.</p>
</li>
<li>
<p><strong>Performance degradation</strong>: writing a large number of log statements can impact the performance of an application, especially when the logs are placed in frequently executed paths.</p>
</li>
<li>
<p><strong>Code readability and maintainability</strong>: excessive logging can clutter the code and increase the code&#8217;s complexity, making it difficult for developers to identify essential logic.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Only the logging statements that are directly within the <a href="https://learn.microsoft.com/en-us/dotnet/csharp/tour-of-csharp/program-building-blocks#statements">code block</a> will be counted, and any logging statements within nested blocks will count towards their own. For example consider the snippet below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">void MyMethod(List&lt;MyObject&gt; items)
{
    logger.Debug("The operation started");
    foreach(var item in items)
    {
        logger.Debug($"Evaluating {item.Name}");
        var result = Evaluate(item);
        logger.Debug($"Evaluating resulted in {result}");
    }
    logger.Debug("The operation ended");
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The rule will count 2 logging statements that are within the method block (namely <code>logger.Debug("The operation started")</code> and <code>logger.Debug("The operation ended")</code>). Any statements within nested blocks, such as the <code>foreach</code> block will be counted separately.
The rule considers the log level of the calls, as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Debug</strong>, <strong>Trace</strong> and <strong>Verbose</strong> logging level statements will count together and raise when the <strong><em>Debug threshold</em></strong> parameter is exceeded (default value: <em>4</em>);</p>
</li>
<li>
<p><strong>Information</strong> logging level statements will raise when the <strong><em>Information threshold</em></strong> parameter is exceeded (default value: <em>2</em>);</p>
</li>
<li>
<p><strong>Warning</strong> logging level statements will raise when the <strong><em>Warning threshold</em></strong> parameter is exceeded (default value: <em>1</em>);</p>
</li>
<li>
<p><strong>Error</strong> and <strong>Fatal</strong> logging level statements will count together and raise when the <strong><em>Error threshold</em></strong> parameter is exceeded (default value: <em>1</em>);</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The most popular logging frameworks are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Nuget package - <a href="https://www.nuget.org/packages/Microsoft.Extensions.Logging">Microsoft.Extensions.Logging</a></p>
</li>
<li>
<p>Nuget package - <a href="https://www.nuget.org/packages/Serilog">Serilog</a></p>
</li>
<li>
<p>Nuget package - <a href="https://www.nuget.org/packages/Castle.Core">Castle.Core</a></p>
</li>
<li>
<p>Nuget package - <a href="https://www.nuget.org/packages/NLog">NLog</a></p>
</li>
<li>
<p>Nuget package - <a href="https://www.nuget.org/packages/log4net">log4net</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Reduce the number of specific logging level calls within the code block by identifying and selecting essential log statements with relevant information, necessary for understanding the flow of execution or diagnosing issues.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="paragraph">
<p>With the default Information threshold parameter value 2:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">void MyMethod(List&lt;MyObject&gt; items)
{
    logger.Debug("The operation started");
    foreach(var item in items)
    {
        logger.Information($"Evaluating {item.Name}"); // Noncompliant
        var result = Evaluate(item);
        logger.Information($"Evaluating resulted in {result}"); // Secondary 1
        if (item.Name is string.Empty)
        {
            logger.Error("Invalid item name");
        }
        logger.Information("End item evaluation"); // Secondary 2
    }
    logger.Debug("The operation ended");
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="paragraph">
<p>With the default Information threshold parameter value 2:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">void MyMethod(List&lt;MyObject&gt; items)
{
    logger.Debug("The operation started");
    foreach(var item in items)
    {
        logger.Information($"Evaluating {item.Name}");
        var result = Evaluate(item);
        if (item.Name is string.Empty)
        {
            logger.Error("Invalid item name");
        }
        logger.Information($"End item evaluation with result: {result}");
    }
    logger.Debug("The operation ended");
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Microsoft Learn - <a href="https://learn.microsoft.com/en-us/dotnet/csharp/tour-of-csharp/program-building-blocks#statements">Code blocks</a></p>
</li>
<li>
<p>Microsoft Learn - <a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/statements/exception-handling-statements">Exception-handling statements</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Reduce the XXX logging calls within this code block.</p>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="ulist">
<ul>
<li>
<p>Primary: 1st logging statement</p>
</li>
<li>
<p>Secondary 1: 2nd logging statement</p>
</li>
<li>
<p>Secondary 2: 3rd logging statement</p>
</li>
<li>
<p>Secondary 3: 4th logging statement
&#8230;&#8203;</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_parameters">Parameters</h3>
<div class="sidebarblock">
<div class="content">
<div class="title">debugThreshold</div>
<div class="listingblock">
<div class="content">
<pre>4</pre>
</div>
</div>
<div class="paragraph">
<p>The maximum number of DEBUG, TRACE and VERBOSE statements allowed in the same code block</p>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">informationThreshold</div>
<div class="listingblock">
<div class="content">
<pre>2</pre>
</div>
</div>
<div class="paragraph">
<p>The maximum number of INFORMATION statements allowed in the same code block</p>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">warningThreshold</div>
<div class="listingblock">
<div class="content">
<pre>1</pre>
</div>
</div>
<div class="paragraph">
<p>The maximum number of WARNING statements allowed in the same code block</p>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">errorThreshold</div>
<div class="listingblock">
<div class="content">
<pre>1</pre>
</div>
</div>
<div class="paragraph">
<p>The maximum number of ERROR and FATAL statements allowed in the same code block</p>
</div>
</div>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
</div>
</div>