<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Throwing <code>swap</code>, <code>move operator</code> or <code>default constructor</code> make it very difficult to handle exception or can lead to undefined/inconsistent state.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>If exceptions can be thrown there:</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Creation and destruction of local variables allocated on the stack can throw. It makes that any scope should be protected by a <code>try-catch</code> block, in your own code and in all the dependencies.</p>
</li>
<li>
<p>If a move operator/constructor could throw, objects could be left in an inconsistent states as partially moved (just a few members moved). In what state is the source object? the target one?
Copy does not have this problem as the source object is not modified. It is then much easier to recover from an exception.</p>
</li>
<li>
<p>For the same sort of reason as above, a throwing swap could create inconsistent states. If a swap throws, what are the states of the 2 objects. Was any state lost in the process
The comparison with copy still holds.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Notes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If a <code>noexcept</code> function tries to raise an exception, the program will terminate. For the above case, it might often be the best way to cope with an exception arising in a default constructor, a swap or a move.</p>
</li>
<li>
<p>If a move constructor/operator can throw, the STL will replace it with a copy if available.</p>
</li>
<li>
<p><code>std::swap</code> is required to be <code>noexcept</code></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_noncompliant_code_example">Noncompliant code example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">class S {};
void swap(S&amp; s1, S&amp; s2);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_compliant_solution">Compliant solution</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">class S {};
void swap(S&amp; s1, S&amp; s2) noexcept;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>C&#43;&#43; reference - <a href="https://en.cppreference.com/w/cpp/language/noexcept_spec">Noexcept specifier</a></p>
</li>
<li>
<p><a href="http://blogs.microsoft.co.il/sasha/2014/08/08/make-move-constructors-no-throw/">Make move constructor nothrow</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_is_related_to_s1048">is related to: <a data-rspec-id="S1048" class="rspec-auto-link">S1048</a></h3>

</div>
<div class="sect2">
<h3 id="_duplicates_s5018">duplicates: <a data-rspec-id="S5018" class="rspec-auto-link">S5018</a></h3>

</div>
<div class="sect2">
<h3 id="_on_28_aug_2019_213724_lo誰c_joly_wrote">on 28 Aug 2019, 21:37:24 Lo誰c Joly wrote:</h3>
<div class="paragraph">
<p>\[~geoffray.adde] I agree for the <code>move</code> part, but we already have <a data-rspec-id="S5018" class="rspec-auto-link">RSPEC-5018</a> for that. I kind of agree for the swap part, but I think it would fit perfectly within <a data-rspec-id="S5018" class="rspec-auto-link">RSPEC-5018</a> that we could just extend a little.</p>
</div>
<div class="paragraph">
<p>For constructor, I&#8217;m not so sure:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"Creation and destruction of local variables allocated on the stack can throw": Yes, and making the default constructor noexcept will not prevent this</p>
</li>
<li>
<p>"It makes that any scope should be protected by a try-catch block": I don&#8217;t see why
It might be desirable that the moved-from state of an object is equivalent to the default constructed one, and for that, having a noexcept default constructor might help, but this looks more like a low priority code smell to me.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>What do you think?</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_3_sep_2019_102256_lo誰c_joly_wrote">on 3 Sep 2019, 10:22:56 Lo誰c Joly wrote:</h3>
<div class="paragraph">
<p>After discussion with [~geoffray.adde]: Ok to add swap to RPSEC-5018, and drop the default constructor part. Which means this RSPEC is no longer needed.</p>
</div>
</div>
</div>
</div>