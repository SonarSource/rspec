<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This rule raises an issue when a string column is defined in a Rails migration without an explicit <code>limit</code> parameter.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In Rails migrations, string columns without explicit limits default to 255 characters. This implicit behavior can lead to unexpected runtime errors when applications try to store data longer than 255 characters.</p>
</div>
<div class="paragraph">
<p>When your application runs on databases like PostgreSQL, attempting to insert data that exceeds the column&#8217;s character limit will result in database constraint violations. These errors typically manifest as <code>PGError: ERROR: value too long for type character varying(255)</code> or similar messages depending on your database system.</p>
</div>
<div class="paragraph">
<p>The problem becomes more severe in production environments where such errors can cause application crashes, data loss, or poor user experience. Users filling out forms with longer content may encounter unexpected errors, and background jobs processing data may fail silently.</p>
</div>
<div class="paragraph">
<p>Explicit column sizing also encourages better database design. By specifying limits, you make conscious decisions about your data requirements, which helps with:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Database performance optimization</p>
</li>
<li>
<p>Storage space planning</p>
</li>
<li>
<p>Data validation consistency</p>
</li>
<li>
<p>Clear communication of business requirements to other developers</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>Applications may crash with database constraint violations when users or systems attempt to store data longer than 255 characters. This can lead to data loss, poor user experience, and application instability in production environments.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it_in_rails">How to fix it in Rails</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Add an explicit limit parameter to string columns based on your expected data length. Choose a reasonable limit that accommodates your business requirements.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">class CreateUsers &lt; ActiveRecord::Migration
  def change
    create_table :users do |t|
      t.string :name     # Noncompliant
      t.string :email    # Noncompliant
    end
  end
end</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">class CreateUsers &lt; ActiveRecord::Migration
  def change
    create_table :users do |t|
      t.string :name, limit: 100
      t.string :email, limit: 255
    end
  end
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use the text type for columns that may contain long or unlimited content, such as descriptions, comments, or article content.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_code_examples_2">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example_2">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">class CreatePosts &lt; ActiveRecord::Migration
  def change
    create_table :posts do |t|
      t.string :title
      t.string :content  # Noncompliant
      t.string :bio      # Noncompliant
    end
  end
end</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution_2">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">class CreatePosts &lt; ActiveRecord::Migration
  def change
    create_table :posts do |t|
      t.string :title, limit: 200
      t.text :content
      t.text :bio
    end
  end
end</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Rails Migration Guide - Column Types - <a href="https://guides.rubyonrails.org/active_record_migrations.html#column-types">Official Rails documentation on migration column types and their options</a></p>
</li>
<li>
<p>Active Record Schema Dumper - <a href="https://api.rubyonrails.org/classes/ActiveRecord/Schema.html">Documentation on Rails schema definitions and column options</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_standards">Standards</h3>
<div class="ulist">
<ul>
<li>
<p>CWE-20: Improper Input Validation - <a href="https://cwe.mitre.org/data/definitions/20.html">Relates to proper data validation and constraint handling</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>