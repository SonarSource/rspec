<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To check the type of an object there are several options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>expr is SomeType</code> or <code>expr.GetType() == typeof(SomeType)</code> if the type is known at compile time,</p>
</li>
<li>
<p><code>typeInstance.IsInstanceOfType(expr)</code> if the type is calculated during runtime.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If runtime calculated <code>Type</code>s need to be compared:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>typeInstance1.IsAssignableFrom(typeInstance2)</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Depending on whether the type is returned by a <code>GetType()</code> or <code>typeof()</code> call, the <code>IsAssignableFrom()</code> and <code>IsInstanceOfType()</code> might be simplified. Similarly, if the type is <code>sealed</code>, the type comparison with <code>==</code> can be converted to an <code>is</code> call. Simplifying the calls also make <code>null</code> checking unnecessary because both <code>is</code> and <code>IsInstanceOfType</code> performs it already.</p>
</div>
<div class="paragraph">
<p>Finally, utilizing the most concise language constructs for type checking makes the code more readable, so</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>expr as T != null</code> checks should be simplified to <code>expr is T</code>, and</p>
</li>
<li>
<p><code>expr is T</code> should be converted to <code>expr != null</code>, when <code>expr</code> is of type <code>T</code>.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_noncompliant_code_example">Noncompliant code example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">class Fruit { }
sealed class Apple : Fruit { }

class Program
{
  static void Main()
  {
    var apple = new Apple();
    var b = apple != null &amp;&amp; apple.GetType() == typeof (Apple); // Noncompliant
    b = typeof(Apple).IsInstanceOfType(apple); // Noncompliant
    if (apple != null)
    {
      b = typeof(Apple).IsAssignableFrom(apple.GetType()); // Noncompliant
    }
    var appleType = typeof (Apple);
    if (apple != null)
    {
      b = appleType.IsAssignableFrom(apple.GetType()); // Noncompliant
    }

    Fruit f = apple;
    if (f as Apple != null) // Noncompliant
    {
    }
    if (apple is Apple) // Noncompliant
    {
    }
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_compliant_solution">Compliant solution</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">class Fruit { }
sealed class Apple : Fruit { }

class Program
{
  static void Main()
  {
    var apple = new Apple();
    var b = apple is Apple;
    b = apple is Apple;
    b = apple is Apple;
    var appleType = typeof(Apple);
    b = appleType.IsInstanceOfType(apple);

    Fruit f = apple;
    if (f is Apple)
    {
    }
    if (apple != null)
    {
    }
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_exceptions">Exceptions</h3>
<div class="paragraph">
<p>Calling <code>GetType</code> on an object of <code>Nullable&lt;T&gt;</code> type returns the underlying generic type parameter <code>T</code>, thus a comparison with <code>typeof(Nullable&lt;T&gt;)</code> can&#8217;t be simplified to use the <code>is</code> operator, which doesn&#8217;t make difference between <code>T</code> and <code>T?</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">int? i = 42;
bool condition = i.GetType() == typeof(int?); // false;
condition = i is int?; // true</code></pre>
</div>
</div>
<div class="paragraph">
<p>No issue is reported on the following expressions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>expr is T</code>Â when either operand of the <code>is</code> operator is a value type. In that case CS0183 or CS0184 reports</p>
</li>
<li>
<p><code>expr is object</code>, as this is a common and efficient pattern to do null checks</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Use [the "is" operator|the "IsInstanceOfType()" method|a "null" check] instead.</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_24_may_2019_164710_andrei_epure_wrote">on 24 May 2019, 16:47:10 Andrei Epure wrote:</h3>
<div class="paragraph">
<p>\[~nicolas.harraudeau] there&#8217;s an interesting remark from a user (issue <a href="https://github.com/SonarSource/sonar-dotnet/issues/2424">#2424</a>) who says that it&#8217;s actually better to perform <code>expr is object</code> rather than <code>expr != null</code> because of performance implications</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_24_may_2019_171538_nicolas_harraudeau_wrote">on 24 May 2019, 17:15:38 Nicolas Harraudeau wrote:</h3>
<div class="paragraph">
<p>\[~andrei.epure] It looks to me like this is a tradeof between readability and performance. Using <code>expr is object</code> to do a null check is more performant but less intuitive than <code>expr != null</code>. We could simply accept both <code>expr is object</code> and <code>expr != null</code>, explaining in the description the difference. What do you think?</p>
</div>
</div>
<div class="sect2">
<h3 id="_is_related_to_s3610">is related to: <a data-rspec-id="S3610" class="rspec-auto-link">S3610</a></h3>

</div>
<div class="sect2">
<h3 id="_on_11_may_2015_094123_dinesh_bolkensteyn_wrote">on 11 May 2015, 09:41:23 Dinesh Bolkensteyn wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2] I&#8217;ve updated the rule for C# - the previous example did not match what was detected in Java.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_11_may_2015_094201_dinesh_bolkensteyn_wrote">on 11 May 2015, 09:42:01 Dinesh Bolkensteyn wrote:</h3>
<div class="paragraph">
<p>LGTM</p>
</div>
</div>
</div>
</div>