Disabling certificate-based authentication can reduce an organization's ability to react against attacks on its critical functions and data, if any.

Depending on the Azure resource, multiple authentication choices are possible: Anonymous connections, Basic authentication, or password-based authentication.

Choosing authentication certificates helps bring client/host trust. 
In case of security incident, certificates bring traceability to investigators and allows security operational teams to react faster (by massively revoking certificates, for example). 


== Ask Yourself Whether

* This Azure resource is essential for the information system infrastructure.
* This Azure resource is essential for mission-critical functions.
* Compliance policies require access to this resource to specifically be authenticated with certificates.

There is a risk if you answered yes to any of those questions.

== Recommended Secure Coding Practices

Enable certificate-based authentication in this Azure resource.

== Sensitive Code Example

For https://azure.microsoft.com/en-us/services/app-service/[App Service]:

----
resource "azurerm_app_service" "example" {
  client_cert_enabled = false # Sensitive
----

For https://azure.microsoft.com/en-us/services/functions/[Function Apps]:

----
resource "azurerm_function_app" "example" {
  client_cert_mode = "Optional" # Sensitive
}
----

For https://azure.microsoft.com/en-us/services/data-factory/Data[Factory Linked Services]:

----
resource "azurerm_data_factory_linked_service_web" "example" {
  authentication_type = "Basic" # Sensitive
}
----

For https://azure.microsoft.com/en-us/services/logic-apps/[Logic App Standard definitions] and https://azure.microsoft.com/en-us/services/api-management/[API Management]:

----
resource "azurerm_api_management" "example" {
  sku_name = "Consumption_1"
  client_certificate_mode = "Required"
}
----

== Compliant Solution

For https://azure.microsoft.com/en-us/services/app-service/[App Service]:

----
resource "azurerm_app_service" "example" {
  client_cert_enabled = true
----

For https://azure.microsoft.com/en-us/services/functions/[Function Apps]:

----
resource "azurerm_function_app" "example" {
  client_cert_mode = "Required"
}
----

For https://azure.microsoft.com/en-us/services/data-factory/Data[Factory Linked Services]:

----
resource "azurerm_data_factory_linked_service_web" "example" {
  authentication_type = "ClientCertificate"
}
----

For https://azure.microsoft.com/en-us/services/logic-apps/[Logic App Standard definitions] and https://azure.microsoft.com/en-us/services/api-management/[API Management]:

----
resource "azurerm_api_management" "example" {
  sku_name = "Consumption_1"
  client_certificate_mode = "Required"
}
----

== See

* https://owasp.org/Top10/A01_2021-Broken_Access_Control/[OWASP Top 10 2021 Category A1] - Boken Access Control
* https://cwe.mitre.org/data/definitions/668.html[MITRE, CWE-668] - Exposure of Resource to Wrong Sphere

ifdef::env-github,rspecator-view[]

'''
== Implementation Specification
(visible only on this page)

=== Message

Make sure that disabling mandatory certificate-based authentication is safe here.

=== Highlighting

* For ``client_cert_enabled`` cases: Highlight the resource or ``client_cert_enabled = false``
* For resources supporting ``client_cert_mode`` (or ``client_certificate_mode``): Highlight the resource or ``client_cert_mode = "Optional"``
* For ``authentication_type`` cases: Highlight the resource or the entire assignment if ``authentication_type`` is not "ClientCertificate".

endif::env-github,rspecator-view[]
