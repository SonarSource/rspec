include::../common/description.adoc[]

include::../common/ask-yourself.adoc[]

include::../common/recommended.adoc[]

== Sensitive Code Example

For https://azure.microsoft.com/en-us/services/app-service/[Web Apps]:

[source,json,diff-id=1,diff-type=noncompliant]
----
{
  "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.Web/sites",
      "apiVersion": "2015-08-01",
      "properties": {
        "clientCertEnabled": false
      }
    }
  ]
}
----


For https://azure.microsoft.com/en-us/products/signalr-service/[SignalR] and https://azure.microsoft.com/en-us/products/web-pubsub/[Web PubSub]:

[source,json,diff-id=2,diff-type=noncompliant]
----
{
  "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.SignalRService/webPubSub",
      "apiVersion": "2021-10-01",
      "properties": {
        "tls": {
          "clientCertEnabled": false
        }
      }
    }
  ]
}
----

For https://azure.microsoft.com/en-us/services/data-factory/[Data Factory Linked Services]:

[source,json,diff-id=3,diff-type=noncompliant]
----
{
  "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.DataFactory/factories/linkedservices",
      "apiVersion": "2018-06-01",
      "properties": {
        "type": "Web",
        "typeProperties": {
          "authenticationType": "Basic"
        }
      }
    }
  ]
}
----

For https://azure.microsoft.com/en-us/services/api-management/[API Management]:

[source,json,diff-id=4,diff-type=noncompliant]
----
{
  "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.ApiManagement/service/gateways/hostnameConfigurations",
      "apiVersion": "2019-12-01",
      "properties": {
        "negotiateClientCertificate": false
      }
    }
  ]
}
----

For https://azure.microsoft.com/en-us/products/application-gateway/[Application Gateways]:

[source,json,diff-id=5,diff-type=noncompliant]
----
{
  "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.Network/applicationGateways",
      "apiVersion": "2020-06-01",
      "properties": {
        "[...]": "[gateway configuration]"
      }
    }
  ]
}
----

== Compliant Solution

For https://azure.microsoft.com/en-us/services/app-service/[Web Apps]:

[source,json,diff-id=1,diff-type=compliant]
----
{
  "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.Web/sites",
      "apiVersion": "2015-08-01",
      "properties": {
        "clientCertEnabled": true,
        "clientCertMode": "Required"
      }
    }
  ]
}
----

For https://azure.microsoft.com/en-us/products/signalr-service/[SignalR] and https://azure.microsoft.com/en-us/products/web-pubsub/[Web PubSub]:

[source,json,diff-id=2,diff-type=compliant]
----
{
  "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.SignalRService/webPubSub",
      "apiVersion": "2021-10-01",
      "properties": {
        "tls": {
          "clientCertEnabled": true
        }
      }
    }
  ]
}
----

For https://azure.microsoft.com/en-us/services/data-factory/[Data Factory Linked Services]:

[source,json,diff-id=3,diff-type=compliant]
----
{
  "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.DataFactory/factories/linkedservices",
      "apiVersion": "2018-06-01",
      "properties": {
        "type": "Web",
        "typeProperties": {
          "authenticationType": "ClientCertificate"
        }
      }
    }
  ]
}
----

For https://azure.microsoft.com/en-us/services/api-management/[API Management]:

[source,json,diff-id=4,diff-type=compliant]
----
{
  "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.ApiManagement/service/gateways/hostnameConfigurations",
      "apiVersion": "2019-12-01",
      "properties": {
        "negotiateClientCertificate": true
      }
    }
  ]
}
----

For https://azure.microsoft.com/en-us/products/application-gateway/[Application Gateways]:

[source,json,diff-id=5,diff-type=compliant]
----
{
  "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.Network/applicationGateways",
      "apiVersion": "2020-06-01",
      "properties": {
        "trustedRootCertificates": [
          {
            "[...]": "[root certificate details]"
          }
        ],
        "[...]": "[gateway configuration]"
      }
    }
  ]
}
----


== See

include::../common/resources/docs.adoc[]
include::../common/resources/articles.adoc[]
include::../common/resources/presentations.adoc[]
include::../common/resources/standards.adoc[]


ifdef::env-github,rspecator-view[]

'''
== Implementation Specification
(visible only on this page)

include::message.adoc[]

include::highlighting.adoc[]

endif::env-github,rspecator-view[]
