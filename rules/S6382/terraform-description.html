<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Disabling certificate-based authentication can reduce an organization&#8217;s
ability to react against attacks on its critical functions and data.</p>
</div>
<div class="paragraph">
<p>Azure offers various authentication options to access resources: Anonymous
connections, Basic authentication, password-based authentication, and
certificate-based authentication.</p>
</div>
<div class="paragraph">
<p>Choosing certificate-based authentication helps bring client/host trust by
allowing the host to verify the client and vice versa. It cannot be forged or
forwarded by a man-in-the-middle eavesdropper, and the certificate&#8217;s private
key is never sent over the network so it&#8217;s harder to steal than a password.</p>
</div>
<div class="paragraph">
<p>In case of a security incident, certificates help bring investigators
traceability and allow security operations teams to react faster. For example,
all compromised certificates could be revoked individually, or an issuing
certificate could be revoked which causes all the certificates it issued to
become untrusted.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ask_yourself_whether">Ask Yourself Whether</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>This Azure resource is essential for the information system infrastructure.</p>
</li>
<li>
<p>This Azure resource is essential for mission-critical functions.</p>
</li>
<li>
<p>Compliance policies require access to this resource to be authenticated with certificates.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There is a risk if you answered yes to any of those questions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_recommended_secure_coding_practices">Recommended Secure Coding Practices</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Enable certificate-based authentication.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sensitive_code_example">Sensitive Code Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For <a href="https://azure.microsoft.com/en-us/services/app-service/containers/">Linux and Windows Web Apps</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terraform" data-lang="terraform">resource "azurerm_linux_web_app" "example" {
  client_cert_enabled = false # Sensitive
}
resource "azurerm_linux_web_app" "example2" {
  client_certificate_enabled = true
  client_certificate_mode = "Optional" # Sensitive
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For <a href="https://azure.microsoft.com/en-us/services/logic-apps/">Logic App Standards</a> and <a href="https://azure.microsoft.com/en-us/services/functions/">Function Apps</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terraform" data-lang="terraform">resource "azurerm_linux_function_app" "example" {
  client_cert_mode = "Optional" # Sensitive
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For <a href="https://azure.microsoft.com/en-us/services/data-factory/">Data Factory Linked Services</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terraform" data-lang="terraform">resource "azurerm_data_factory_linked_service_web" "example" {
  authentication_type = "Basic" # Sensitive
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For <a href="https://azure.microsoft.com/en-us/services/api-management/">API Management</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terraform" data-lang="terraform">resource "azurerm_api_management" "example" {
  sku_name = "Consumption_1"
  client_certificate_mode = "Optional" # Sensitive
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For <a href="https://azure.microsoft.com/en-us/services/app-service/">App Service</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terraform" data-lang="terraform">resource "azurerm_app_service" "example" {
  client_cert_enabled = false # Sensitive
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For <a href="https://azure.microsoft.com/en-us/services/app-service/containers/">Linux and Windows Web Apps</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terraform" data-lang="terraform">resource "azurerm_linux_web_app" "example" {
  client_certificate_enabled = true
  client_certificate_mode = "Required"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For <a href="https://azure.microsoft.com/en-us/services/logic-apps/">Logic App Standards</a> and <a href="https://azure.microsoft.com/en-us/services/functions/">Function Apps</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terraform" data-lang="terraform">resource "azurerm_linux_function_app" "example" {
  client_cert_mode = "Required"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For <a href="https://azure.microsoft.com/en-us/services/data-factory/">Data Factory Linked Services</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terraform" data-lang="terraform">resource "azurerm_data_factory_linked_service_web" "example" {
  authentication_type = "ClientCertificate"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For <a href="https://azure.microsoft.com/en-us/services/api-management/">API Management</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terraform" data-lang="terraform">resource "azurerm_api_management" "example" {
  sku_name = "Consumption_1"
  client_certificate_mode = "Required"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For <a href="https://azure.microsoft.com/en-us/services/app-service/">App Service</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terraform" data-lang="terraform">resource "azurerm_app_service" "example" {
  client_cert_enabled = true
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/668">CWE-668 - Exposure of Resource to Wrong Sphere</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>For these resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>api_management</code>:</p>
</li>
<li>
<p><code>app_service</code></p>
</li>
<li>
<p><code>data_factory_linked_service_sftp</code></p>
</li>
<li>
<p><code>data_factory_linked_service_web</code></p>
</li>
<li>
<p><code>linux_web_app</code></p>
</li>
<li>
<p><code>windows_web_app</code> (if both parameters are non-compliant, flag <code>client_certificate_enabled</code> first)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These messages apply:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If an assignment is missing: Omitting {property_name} disables certificate-based authentication. Make sure it is safe here.</p>
</li>
<li>
<p>If the assignment is security-sensitive: Make sure that disabling certificate-based authentication is safe here.</p>
</li>
<li>
<p>For <code>function_app</code>:</p>
<div class="ulist">
<ul>
<li>
<p>Omitting <code>client_cert_mode</code> makes certificate-based authentication optional. Make sure it is safe here.</p>
</li>
<li>
<p>Make sure that setting certificate-based authentication as optional is safe here.</p>
</li>
</ul>
</div>
</li>
<li>
<p>For <code>logic_app_standard</code>:</p>
<div class="ulist">
<ul>
<li>
<p>Omitting <code>client_certificate_mode</code> makes certificate-based authentication optional. Make sure it is safe here.</p>
</li>
<li>
<p>Make sure that setting certificate-based authentication as optional is safe here.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Make sure that disabling certificate-based authentication is safe here.</p>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="ulist">
<ul>
<li>
<p>If one (out of one) assignment is missing: Highlight the resource</p>
</li>
<li>
<p>If an assignment is security-sensitive: Highlight the assignment</p>
</li>
<li>
<p>For <code>linux_web_app</code> and <code>windows_web_app</code>:</p>
<div class="ulist">
<ul>
<li>
<p>If both assignments are present and security-sensitive: Highlight <code>client_certificate_enabled = false</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>