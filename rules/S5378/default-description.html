<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default Apex code executes without checking permissions. Hence the code will not enforce field level security, sharing rules and user permissions during execution of Apex code in Triggers, Classes and Controllers. This creates the risk that unauthorized users may get access to sensitive data records or fields.</p>
</div>
<div class="paragraph">
<p>It is possible to specify different level of sharing via the keywords "with sharing", "without sharing" or "inherited sharing". The last two should be used very carefully as they can create security risks.</p>
</div>
<div class="paragraph">
<p>This rule raises an issue whenever a DML, SOSL or SOQL query is executed in a class marked as <code>without sharing</code> or <code>inherited sharing</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ask_yourself_whether">Ask Yourself Whether</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>this code gives access to or modifies restricted records.</p>
</li>
<li>
<p>this code may be executed by users who shouldn&#8217;t have access to those records.</p>
</li>
<li>
<p>if the class is marked as <code>inherited sharing</code>, it may be called by a class marked as <code>without sharing</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There is a risk if you answered yes to any of those questions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_recommended_secure_coding_practices">Recommended Secure Coding Practices</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Use <code>with sharing</code> whenever possible.</p>
</li>
<li>
<p>Use <code>without sharing</code> only after checking that the code is not accessible to unauthorized users.</p>
</li>
<li>
<p>Use <code>inherited sharing</code> only when all calling <code>without sharing</code> classes are safe.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sensitive_code_example">Sensitive Code Example</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>public without sharing class MyClass {
  List&lt;List&lt;SObject&gt;&gt; sList = [FIND 'TEST' IN ALL FIELDS
                                      RETURNING Case(Name), Contact(FirstName,LastName)]; // Sensitive
}

public inherited sharing class MyClass {
  List&lt;Case&gt; lstCases = new List&lt;Case&gt;();
  for(Case c:[SELECT Id, Status FROM Case WHERE Status = 'In Progress']){ // Sensitive
      c.Status = 'Closed';
      lstCasesToBeUpdated.add(c);
  }
  Update lstCasesToBeUpdated; // Sensitive
}</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-apex" data-lang="apex">public with sharing class MyClass { // Compliant
  List&lt;Case&gt; lstCases = new List&lt;Case&gt;();
  for(Case c:[SELECT Id FROM Case WHERE Status = 'In Progress']){
      // ...
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/apex_classes_keywords_sharing.htm">Using the with sharing, without sharing, and inherited sharing Keywords</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Make sure that executing SOQL, SOSL or DML queries without sharing or with inherited sharing is safe here</p>
</div>
</div>
</div>
</div>