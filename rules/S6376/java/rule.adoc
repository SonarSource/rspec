XML parsers Denial of Service attacks are a type of vulnerability that can be exploited by malicious actors. These attacks target XML parsers, which are software components responsible for parsing and interpreting XML documents.

== Why is this an issue?

To exploit this vulnerability, an attacker typically crafts an XML document that triggers excessive memory consumption or CPU usage when processed by the XML parser. This can be achieved by exploiting vulnerabilities in the parser's implementation or by overwhelming the parser with large or nested XML structures.

=== System Unavailability

When an attacker successfully exploits the vulnerability, it can lead to a Denial of Service (DoS) condition. This means that the affected system becomes unresponsive or crashes, rendering it unavailable to legitimate users. This can have severe consequences, especially for critical systems that rely on continuous availability, such as web servers, APIs, or network services.

=== Amplification Attacks

In some cases, XML parsers Denial of Service attacks can be used as a part of larger-scale amplification attacks. By leveraging the vulnerability, attackers can generate a disproportionately large response from the targeted system, amplifying the impact of their attack. This can result in overwhelming network bandwidth, and causing widespread disruption.

== How to fix it in Java SE

=== Code examples

==== Noncompliant code example

[source,java,diff-id=1,diff-type=noncompliant]
----
DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
factory.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, false); // Noncompliant
----

==== Compliant solution

[source,java,diff-id=1,diff-type=compliant]
----
DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
factory.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true);
----


== How to fix it in Dom4j

=== Code examples

==== Noncompliant code example

[source,java,diff-id=2,diff-type=noncompliant]
----
SAXReader xmlReader = new SAXReader();
xmlReader.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, false); // Noncompliant
----

==== Compliant solution

[source,java,diff-id=2,diff-type=compliant]
----
SAXReader xmlReader = new SAXReader();
xmlReader.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true);
----


== How to fix it in Jdom2

=== Code examples

==== Noncompliant code example

[source,java,diff-id=3,diff-type=noncompliant]
----
SAXBuilder builder = new SAXBuilder();
builder.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, false);  // Noncompliant
----

==== Compliant solution

[source,java,diff-id=3,diff-type=compliant]
----
SAXBuilder builder = new SAXBuilder();
builder.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true);
----


== Resources

=== Documentation

* https://docs.oracle.com/en/java/javase/21/docs/api/java.xml/javax/xml/parsers/DocumentBuilderFactory.html[DocumentBuilder]
* https://docs.oracle.com/en/java/javase/21/docs/api/java.xml/javax/xml/parsers/SAXParserFactory.html[SAXParser]
* https://docs.oracle.com/en/java/javase/21/docs/api/java.xml/javax/xml/validation/SchemaFactory.html[Schema]
* https://docs.oracle.com/en/java/javase/21/docs/api/java.xml/javax/xml/transform/TransformerFactory.html[TransformerFactory]
* https://dom4j.github.io/[Dom4j Library]
* http://www.jdom.org/[Jdom2 Library]


=== Articles & blog posts

* https://docs.oracle.com/en/java/javase/21/security/java-api-xml-processing-jaxp-security-guide.html[Oracle Java Documentation] - Java API for XML Processing (JAXP) Security Guide

=== Standards

* https://owasp.org/Top10/A05_2021-Security_Misconfiguration/[OWASP Top 10 2021 Category A5] - Security Misconfiguratio
* https://owasp.org/www-project-top-ten/2017/A4_2017-XML_External_Entities_(XXE)[OWASP Top 10 2017 Category A4] - XML External Entities (XXE)
* https://cheatsheetseries.owasp.org/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html#java[OWASP XXE Prevention Cheat Sheet]
* https://cwe.mitre.org/data/definitions/776[MITRE, CWE-776] - Improper Restriction of Recursive Entity References in DTDs ('XML Entity Expansion')

ifdef::env-github,rspecator-view[]

'''
== Implementation Specification
(visible only on this page)

=== Message

Enable XML parsing limitations to prevent Denial of Service attacks.


'''
== Comments And Links
(visible only on this page)

=== on 25 Jan 2022, 10:34:00 Quentin Jaquier wrote:
Quick fixes (for Java): even if it is technically possible to provide a fix that would result in compliant code, it does not sound wise to set properties blindly, as it can have side effects. Fixing the issue requires a careful and good understanding of the overall context of the code.

endif::env-github,rspecator-view[]
