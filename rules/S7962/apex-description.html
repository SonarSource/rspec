<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is an issue when a test class contains multiple test methods that create similar or identical test data, leading to code duplication.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When test classes contain multiple test methods that need similar test data, duplicating the data creation code across methods creates several problems.</p>
</div>
<div class="paragraph">
<p>First, it leads to unnecessary code duplication. Each test method repeats the same data setup logic, making the test class longer and harder to maintain. If you need to change how test data is created, you must update multiple locations.</p>
</div>
<div class="paragraph">
<p>Second, it reduces test efficiency. Each test method executes its own data creation code, which means more database operations and longer test execution times. This becomes particularly noticeable in large test suites.</p>
</div>
<div class="paragraph">
<p>Third, it increases the risk of inconsistencies. When test data creation is scattered across multiple methods, it&#8217;s easy for the data setup to drift apart over time, leading to tests that behave differently due to subtle data differences.</p>
</div>
<div class="paragraph">
<p>The <code>@testSetup</code> annotation in Apex provides a clean solution. Methods annotated with <code>@testSetup</code> execute once before any test methods run, creating shared test data that all test methods in the class can use. This approach centralizes data creation, improves performance, and ensures consistency across tests.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>Code duplication makes test classes harder to maintain and increases the risk of inconsistencies. Duplicated data creation logic also leads to longer test execution times and more database operations during testing.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Move common test data creation logic from individual test methods into a single @testSetup method. The setup method will execute once before any test methods run, and all test methods can access the created data.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-apex" data-lang="apex">@isTest
public class AccountServiceTest {
    @isTest
    static void testCreateAccount() {
        Account acc = new Account(Name = 'Test Account'); // Noncompliant
        insert acc;
        // test logic here
    }

    @isTest
    static void testUpdateAccount() {
        Account acc = new Account(Name = 'Test Account'); // Noncompliant
        insert acc;
        // test logic here
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-apex" data-lang="apex">@isTest
public class AccountServiceTest {
    @testSetup
    static void setupTestData() {
        Account acc = new Account(Name = 'Test Account');
        insert acc;
    }

    @isTest
    static void testCreateAccount() {
        Account acc = [SELECT Id, Name FROM Account LIMIT 1];
        // test logic here
    }

    @isTest
    static void testUpdateAccount() {
        Account acc = [SELECT Id, Name FROM Account LIMIT 1];
        // test logic here
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Apex Testing Framework - <a href="https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/apex_testing_framework.htm">Official Salesforce documentation on Apex testing framework and best practices</a></p>
</li>
<li>
<p>Test Setup Methods - <a href="https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/apex_testing_testsetup_using.htm">Salesforce documentation specifically about using @testSetup methods</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>