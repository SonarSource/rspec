<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_description_2">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A web server uses a protocol like Transport Layer Security (TLS) to create a secure, encrypted connection with a user&#8217;s browser. This process relies on a long-term secret key, stored on the server, to help establish a secure session for communication.</p>
</div>
<div class="paragraph">
<p>An issue can arise if an attacker records the encrypted traffic between a user and the server, and later steals the server&#8217;s long-term key. With that key, the attacker could decrypt all the previously recorded conversations.</p>
</div>
<div class="paragraph">
<p>A feature called forward secrecy (or perfect forward secrecy) prevents this situation. It ensures that a new, temporary key is created for every user session. Because these session keys are temporary and not linked to the server&#8217;s long-term key, stealing the long-term key does not help an attacker decrypt past sessions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When forward secrecy is not in place, encrypted data from past sessions is at risk. If an attacker obtains the server&#8217;s long-term private key, they can decrypt all previously recorded traffic that was encrypted with that key. This can lead to the exposure of sensitive information.</p>
</div>
<div class="sect2">
<h3 id="_exposure_of_sensitive_information">Exposure of Sensitive Information</h3>
<div class="paragraph">
<p>An attacker could gain access to sensitive information exchanged in past sessions. This might include usernames, passwords, credit card numbers, or private messages. Once decrypted, this information could be used for identity theft, financial fraud, or other malicious activities.</p>
</div>
</div>
<div class="sect2">
<h3 id="_retroactive_data_breaches">Retroactive Data Breaches</h3>
<div class="paragraph">
<p>The risk is not limited to future communications. An attacker can store large amounts of encrypted data and wait for an opportunity to obtain the server&#8217;s key. Once the key is compromised, all past communications that were recorded can be decrypted. This means a security breach today could reveal data from months or even years ago.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it_in_security_framework">How to fix it in Security Framework</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To ensure forward secrecy, you should correctly configure your app&#8217;s App Transport Security (ATS) settings. ATS is a feature that improves user security and privacy by requiring iOS and macOS to use secure network connections over HTTPS. Forward secrecy is a default requirement of ATS.</p>
</div>
<div class="paragraph">
<p>The issue arises when an exception is created for a specific domain that weakens this protection. You can resolve this by removing the insecure exception from the <code>Info.plist</code> file.</p>
</div>
<div class="sect2">
<h3 id="_noncompliant_code_example">Noncompliant code example</h3>
<div class="paragraph">
<p>The following entry in the <code>Info.plist</code> file creates an exception for <code>example.com</code> and disables the forward secrecy requirement. This allows the app to communicate with the server using cipher suites that do not support forward secrecy.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;key&gt;NSAppTransportSecurity&lt;/key&gt;
&lt;dict&gt;
    &lt;key&gt;NSExceptionDomains&lt;/key&gt;
    &lt;dict&gt;
        &lt;key&gt;example.com&lt;/key&gt;
        &lt;dict&gt;
            &lt;key&gt;NSIncludesSubdomains&lt;/key&gt;
            &lt;true/&gt;
            &lt;key&gt;NSExceptionRequiresForwardSecrecy&lt;/key&gt;
            &lt;false/&gt;&lt;!-- Noncompliant --&gt;
        &lt;/dict&gt;
    &lt;/dict&gt;
&lt;/dict&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_compliant_solution">Compliant solution</h3>
<div class="paragraph">
<p>To fix this, set the`NSExceptionRequiresForwardSecrecy` key to <code>true</code> or remove it from the domain&#8217;s exception dictionary in your <code>Info.plist</code> file. Doing either will restore the default setting, which requires forward secrecy for that domain&#8217;s connections.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;key&gt;NSAppTransportSecurity&lt;/key&gt;
&lt;dict&gt;
    &lt;key&gt;NSExceptionDomains&lt;/key&gt;
    &lt;dict&gt;
        &lt;key&gt;example.com&lt;/key&gt;
        &lt;dict&gt;
            &lt;key&gt;NSIncludesSubdomains&lt;/key&gt;
            &lt;true/&gt;
            &lt;key&gt;NSExceptionRequiresForwardSecrecy&lt;/key&gt;
            &lt;true/&gt;
        &lt;/dict&gt;
    &lt;/dict&gt;
&lt;/dict&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Apple Developer Documentation - <a href="https://developer.apple.com/documentation/security/preventing-insecure-network-connections#Ensure-the-Network-Server-Meets-Minimum-Requirements">Preventing Insecure Network Connections</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_standards">Standards</h3>
<div class="ulist">
<ul>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/327.html">CWE-327: Use of a Broken or Risky Cryptographic Algorithm</a></p>
</li>
<li>
<p>OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a></p>
</li>
<li>
<p>OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data Exposure</a></p>
</li>
<li>
<p>OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security Misconfiguration</a></p>
</li>
<li>
<p>OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication">Mobile Top 10 2016 Category M3 - Insecure Communication</a></p>
</li>
<li>
<p>OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2023-risks/m5-insecure-communication">Mobile Top 10 2024 Category M5 - Insecure Communication</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>