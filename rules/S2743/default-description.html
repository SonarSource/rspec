<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A static field in a generic type is not shared among instances of different closed constructed types, thus <code>LengthLimitedSingletonCollection&lt;int&gt;.instances</code> and <code>LengthLimitedSingletonCollection&lt;string&gt;.instances</code> will point to different objects, even though <code>instances</code> is seemingly shared among all <code>LengthLimitedSingletonCollection&lt;&gt;</code> generic classes.</p>
</div>
<div class="paragraph">
<p>If you need to have a static field shared among instances with different generic arguments, define a non-generic base class to store your static members, then set your generic type to inherit from the base class.</p>
</div>
<div class="sect2">
<h3 id="_noncompliant_code_example">Noncompliant code example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">public class LengthLimitedSingletonCollection&lt;T&gt; where T : new()
{
  protected const int MaxAllowedLength = 5;
  protected static Dictionary&lt;Type, object&gt; instances = new Dictionary&lt;Type, object&gt;(); // Noncompliant

  public static T GetInstance()
  {
    object instance;

    if (!instances.TryGetValue(typeof(T), out instance))
    {
      if (instances.Count &gt;= MaxAllowedLength)
      {
        throw new Exception();
      }
      instance = new T();
      instances.Add(typeof(T), instance);
    }
    return (T)instance;
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_compliant_solution">Compliant solution</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">public class SingletonCollectionBase
{
  protected static Dictionary&lt;Type, object&gt; instances = new Dictionary&lt;Type, object&gt;();
}

public class LengthLimitedSingletonCollection&lt;T&gt; : SingletonCollectionBase where T : new()
{
  protected const int MaxAllowedLength = 5;

  public static T GetInstance()
  {
    object instance;

    if (!instances.TryGetValue(typeof(T), out instance))
    {
      if (instances.Count &gt;= MaxAllowedLength)
      {
        throw new Exception();
      }
      instance = new T();
      instances.Add(typeof(T), instance);
    }
    return (T)instance;
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_exceptions">Exceptions</h3>
<div class="paragraph">
<p>If the static field or property uses a type parameter, then the developer is assumed to understand that the static member is not shared among the closed constructed types.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">public class Cache&lt;T&gt;
{
   private static Dictionary&lt;string, T&gt; CacheDictionary { get; set; } // Compliant
}</code></pre>
</div>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>A static field in a generic type is not shared among instances of different close constructed types.</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_20_mar_2015_130759_tamas_vajk_wrote">on 20 Mar 2015, 13:07:59 Tamas Vajk wrote:</h3>
<div class="paragraph">
<p>This is the first draft of this rule, I don&#8217;t know which properties need to be set. (SQALE, tags, &#8230;&#8203;)</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_20_mar_2015_132120_ann_campbell_wrote">on 20 Mar 2015, 13:21:20 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>\[~tamas.vajk] if you&#8217;ll expand the description to include the reasons (bad thing that will happen if you break the rule or good thing that will happen if you follow it) that will help me with filling in the other fields.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_10_apr_2015_080930_tamas_vajk_wrote">on 10 Apr 2015, 08:09:30 Tamas Vajk wrote:</h3>
<div class="paragraph">
<p>Ann, I&#8217;ve added an exception to this rule, could you please check it?</p>
</div>
<div class="paragraph">
<p>Thanks</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_10_apr_2015_121012_ann_campbell_wrote">on 10 Apr 2015, 12:10:12 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>The exception looks fine, but I think it would be helpful if you added a small code sample.</p>
</div>
<div class="paragraph">
<p>You can use a "// Compliant" or "// Ignored" comment to mark the line that&#8217;s being ignored.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_13_apr_2015_125055_tamas_vajk_wrote">on 13 Apr 2015, 12:50:55 Tamas Vajk wrote:</h3>
<div class="paragraph">
<p>\[~ann.campbell.2]: [~dinesh.bolkensteyn] asked for a more meaningful example, so I updated the description.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_11_may_2015_121149_tamas_vajk_wrote">on 11 May 2015, 12:11:49 Tamas Vajk wrote:</h3>
<div class="paragraph">
<p>Added the code sample as well to the Exception</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_11_may_2015_140333_ann_campbell_wrote">on 11 May 2015, 14:03:33 Ann Campbell wrote:</h3>
<div class="paragraph">
<p>thanks [~tamas.vajk]</p>
</div>
</div>
</div>
</div>