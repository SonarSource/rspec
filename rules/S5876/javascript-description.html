<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>An attacker may trick a user into using a predetermined session identifier. Consequently, this attacker can gain unauthorized access and impersonate the user&#8217;s session. This kind of attack is called session fixation, and protections against it should not be disabled.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Session fixation attacks take advantage of the way web applications manage session identifiers. Here&#8217;s how a session fixation attack typically works:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When a user visits a website or logs in, a session is created for them.</p>
</li>
<li>
<p>This session is assigned a unique session identifier, stored in a cookie, in local storage, or through URL parameters.</p>
</li>
<li>
<p>In a session fixation attack, an attacker tricks a user into using a predetermined session identifier controlled by the attacker. For example, the attacker sends the victim an email containing a link with this predetermined session identifier.</p>
</li>
<li>
<p>When the victim clicks on the link, the web application does not create a new session identifier but uses this identifier known to the attacker.</p>
</li>
<li>
<p>At this point, the attacker can hijack and impersonate the victim&#8217;s session.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>Session fixation attacks pose a significant security risk to web applications and their users. By exploiting this vulnerability, attackers can gain unauthorized access to user sessions, potentially leading to various malicious activities. Some of the most relevant scenarios are the following:</p>
</div>
<div class="sect3">
<h4 id="_impersonation">Impersonation</h4>
<div class="paragraph">
<p>Once an attacker successfully fixes a session identifier, they can impersonate the victim and gain access to their account without providing valid credentials. This can result in unauthorized actions, such as modifying personal information, making unauthorized transactions, or even performing malicious activities on behalf of the victim. An attacker can also manipulate the victim into performing actions they wouldn&#8217;t normally do, such as revealing sensitive information or conducting financial transactions on the attacker&#8217;s behalf.</p>
</div>
</div>
<div class="sect3">
<h4 id="_data_breach">Data Breach</h4>
<div class="paragraph">
<p>If an attacker gains access to a user&#8217;s session, they may also gain access to sensitive data associated with that session. This can include personal information, financial details, or any other confidential data that the user has access to within the application. The compromised data can be used for identity theft, financial fraud, or other malicious purposes.</p>
</div>
</div>
<div class="sect3">
<h4 id="_privilege_escalation">Privilege Escalation</h4>
<div class="paragraph">
<p>In some cases, session fixation attacks can be used to escalate privileges within a web application. By fixing a session identifier with higher privileges, an attacker can bypass access controls and gain administrative or privileged access to the application. This can lead to unauthorized modifications, data manipulation, or even complete compromise of the application and its underlying systems.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it_in_passport">How to fix it in Passport</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="paragraph">
<p>Upon user authentication, it is crucial to regenerate the session identifier to prevent fixation attacks. Passport provides a mechanism to achieve this by using the <code>req.session.regenerate()</code> method. By calling this method after successful authentication, you can ensure that each user is assigned a new and unique session ID.</p>
</div>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">app.post('/login',
  passport.authenticate('local', { failureRedirect: '/login' }),
  function(req, res) {
    // Noncompliant - no session.regenerate after login
    res.redirect('/');
  });</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">app.post('/login',
  passport.authenticate('local', { failureRedirect: '/login' }),
  function(req, res) {
    let prevSession = req.session;
    req.session.regenerate((err) =&gt; {
      Object.assign(req.session, prevSession);
      res.redirect('/');
    });
  });</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_how_does_this_work">How does this work?</h3>
<div class="paragraph">
<p>The protection works by ensuring that the session identifier, which is used to identify and track a user&#8217;s session, is changed or regenerated during the authentication process.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s how session fixation protection typically works:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>When a user visits a website or logs in, a session is created for them. This session is assigned a unique session identifier, which is stored in a cookie or passed through URL parameters.</p>
</li>
<li>
<p>In a session fixation attack, an attacker tricks a user into using a predetermined session identifier controlled by the attacker. This allows the attacker to potentially gain unauthorized access to the user&#8217;s session.</p>
</li>
<li>
<p>To protect against session fixation attacks, session fixation protection mechanisms come into play during the authentication process. When a user successfully authenticates, this mechanism generates a new session identifier for the user&#8217;s session.</p>
</li>
<li>
<p>The old session identifier, which may have been manipulated by the attacker, is invalidated and no longer associated with the user&#8217;s session. This ensures that any attempts by the attacker to use the fixed session identifier are rendered ineffective.</p>
</li>
<li>
<p>The user is then assigned the new session identifier, which is used for subsequent requests and session tracking. This new session identifier is typically stored in a new session cookie or passed through URL parameters.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>By regenerating the session identifier upon authentication, session fixation protection helps ensure that the user&#8217;s session is tied to a new, secure identifier that the attacker cannot predict or control. This mitigates the risk of an attacker gaining unauthorized access to the user&#8217;s session and helps maintain the integrity and security of the application&#8217;s session management process.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Express.js Documentation - <a href="http://expressjs.com/en/resources/middleware/session.html">express-session</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_articles_blog_posts">Articles &amp; blog posts</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://medium.com/passportjs/fixing-session-fixation-b2b68619c51d">Fixing Session Fixation</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_standards">Standards</h3>
<div class="ulist">
<ul>
<li>
<p>OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and Authentication Failures</a></p>
</li>
<li>
<p>OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication">Top 10 2017 Category A2 - Broken Authentication</a></p>
</li>
<li>
<p><a href="https://owasp.org/www-community/attacks/Session_fixation">OWASP Session Fixation</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/384">CWE-384 - Session Fixation</a></p>
</li>
<li>
<p>STIG Viewer - <a href="https://stigviewer.com/stigs/application_security_and_development/2024-12-06/finding/V-222579">Application Security and Development: V-222579</a> - Applications must use system-generated session identifiers that protect against session fixation.</p>
</li>
<li>
<p>STIG Viewer - <a href="https://stigviewer.com/stigs/application_security_and_development/2024-12-06/finding/V-222582">Application Security and Development: V-222582</a> - The application must not re-use or recycle session IDs.</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Create a new session during user authentication to prevent session fixation attacks.</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_19_jan_2021_105122_costin_zaharia_wrote">on 19 Jan 2021, 10:51:22 Costin Zaharia wrote:</h3>
<div class="paragraph">
<p>As far as I can tell this rule does not apply to <strong>ASP.Net</strong> and <strong>ASP.Net Core</strong> where the session id cannot be changed. According to <a href="https://owasp.org/www-community/controls/Session_Fixation_Protection">OWASP</a>:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Unfortunately, some platforms, notably Microsoft ASP, do not generate new values for sessionid cookies, but rather just associate the existing value with a new session. This guarantees that almost all ASP apps will be vulnerable to session fixation, unless they have taken specific measures to protect against it.</p>
</div>
</blockquote>
</div>
</div>
</div>
</div>