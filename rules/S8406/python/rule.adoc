This is an issue when a Pydantic validator is used to apply default values or transformations, but lacks the `always=True` parameter or the model's `Config` lacks `validate_assignment=True`. This causes validators to run inconsistently - only during initialization but not during field updates.

== Why is this an issue?

Pydantic validators are functions that validate and transform field values in data models. By default, they only run during model initialization, which can lead to unexpected behavior.

There are two key settings that control when validators run:

* `always=True` parameter: Controls whether the validator runs when no value is provided for a field
* `validate_assignment=True` in Config: Controls whether validators run when fields are updated after model creation

Without these settings, validators exhibit inconsistent behavior:

*Default behavior (no special settings)*:

* Validators run during initialization only when a value is explicitly provided
* Validators do NOT run when fields are updated after model creation
* Validators do NOT run when `None` is passed or no value is provided

*With `always=True`*:

* Validators run during initialization even when no value is provided or `None` is passed
* Still do NOT run on field updates unless `validate_assignment=True` is also set

*With `validate_assignment=True` in Config*:

* Validators run on field updates after model creation
* Still follow the default behavior regarding `None` values unless `always=True` is also set

This inconsistency is particularly problematic when validators are used to:

* Apply default values when `None` is provided
* Normalize or transform data (e.g., trimming strings, hashing passwords)
* Enforce business rules that should apply throughout the model's lifetime

When validators don't run consistently, the same field can have different validation rules applied depending on whether it was set during initialization or updated later. This violates the principle of least surprise and can lead to bugs that are difficult to diagnose.

=== What is the potential impact?

The inconsistent validation behavior can lead to data integrity issues. Fields may contain invalid or unexpected values when updated after initialization, bypassing important transformations or business rules. This can cause runtime errors, security vulnerabilities (e.g., unhashed passwords), or incorrect application behavior that only manifests under specific conditions.

== How to fix it

Add both `always=True` to the validator decorator and `validate_assignment=True` to the model's Config class. This ensures the validator runs consistently during initialization (even with `None` values) and during field updates.

=== Code examples

==== Noncompliant code example

[source,python,diff-id=1,diff-type=noncompliant]
----
from pydantic import BaseModel, validator
from typing import Optional

class User(BaseModel):
    name: Optional[str] = ''
    
    @validator('name')  # Noncompliant
    def set_name(cls, name):
        return name or 'default_name'

user = User(name=None)
print(user.name)  # 'default_name'
user.name = None
print(user.name)  # None - validator not applied!
----

==== Compliant solution

[source,python,diff-id=1,diff-type=compliant]
----
from pydantic import BaseModel, validator
from typing import Optional

class User(BaseModel):
    name: Optional[str] = ''
    
    class Config:
        validate_assignment = True
    
    @validator('name', pre=True, always=True)
    def set_name(cls, name):
        return name or 'default_name'

user = User(name=None)
print(user.name)  # 'default_name'
user.name = None
print(user.name)  # 'default_name' - validator applied!
----

== Resources

=== Documentation

 * Pydantic v1 - Validators - https://docs.pydantic.dev/1.10/usage/validators/[Official documentation for Pydantic v1 validators, including the `always` parameter]

 * Pydantic v1 - Model Config - https://docs.pydantic.dev/1.10/usage/model_config/[Documentation for Pydantic v1 model configuration options, including `validate_assignment`]

 * Pydantic v2 - Field Validators - https://docs.pydantic.dev/latest/concepts/validators/[Official documentation for Pydantic v2 field validators]

 * Pydantic v2 - Model Config - https://docs.pydantic.dev/latest/api/config/[Documentation for Pydantic v2 ConfigDict, including `validate_assignment`]
