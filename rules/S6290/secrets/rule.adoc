== Why is this an issue?

Hard-coded secrets are one of the most widespread causes of secret leaks. It
happens when a developer or a machine writes a password into a file that is
pushed into the code repository afterward.

In general, passwords, secrets, and any type of credentials should only be used
to authenticate a single entity (a person or a system).

Keeping credentials in plain text in a code base is tantamount to sharing that
password with anyone who has access to the source code and runtime servers. +
Thus, it is a breach of trust, as these individuals have the ability to
impersonate others.

Most of the time, as leaking a secret allows third parties to authenticate as
another system or person, they can impersonate legitimate identities and
undermine trust within the organization. Third parties include other
developers, end-users, bots that crawl git repositories, or malicious actors
after penetrating the organization. +
It does not matter if the impersonation is malicious: In either case, it is a
clear breach of trust in the system, as the systems involved falsely assume
that the authenticated entity is who it claims to be. +
The consequences can be catastrophic.

== What is the potential impact?

==== Data theft

The malicious users now have the ability to steal various types of data stored
in the cloud services, such as customer information, intellectual property,
financial data, or other sensitive data.

This vulnerability affects a number of services, including:

* Data storage buckets
* Relational databases
* Code repositories or version control systems, which can expose proprietary code and sensitive algorithms
* Secret managers, when the user has access to other secrets that are supposed to be hidden
* Backups

==== Termination of service

With compromised credentials, an attacker can terminate various types of
services, resulting in the loss of virtual servers, clusters and all data
stored on them.

For example:

* Virtual machines, services and load balancers
* Database instances
* Kubernetes clusters and containers
* Serverless functions

==== Malicious exploitation on a large scale

With the goal of either undermining the organization's reputation or profiting
from newly acquired computing capabilities, malicious users can also perform a
variety of actions that are not always publicized in the mainstream media.

Such examples include

* Mining cryptocurrencies by exploiting the computing resources of compromised instances or containers for their own profit.
* Malware distribution and remote control by building a network of compromised instances or containers to form a botnet that can be used for DDoS attacks, spam distribution, malware distribution, or other malicious activities
* Phishing or spoofing architectures. From the victim's perspective, the attack originates from the victim's organization rather than a malicious organization


== How to fix it

To eliminate the security risks associated with leaked cloud provider secrets,
it is important to list where this secret is used, who or what is using it, and
carefully proceed with the following steps.

=== Revoke the secret
Once a secret access key is compromised or leaked, you must immediately revoke
it, change it, and apply the changes to the entity using it.

It is also important that the number of entities using this secret is as close
to **1** as possible. If revoking and changing a secret results in multiple
denials of service, this is another problem: passwords, secrets, and any type
of credentials should only be used to authenticate a single entity (a person or
a system).

Revocation can be done via the cloud provider's web application or via its CLI
and APIS.

By revoking the secret access key, the compromised credentials are no longer
valid, which might immediately stop the movements of a particular intruder.
However, remember that the intruder may have used the credentials to add
a backdoor.

**Important**: If a forensic analysis and incident response is underway, it is
important to ask investigators before revoking secret access. If an attacker is
currently lurking in the infrastructure, the unexpected revocation of their
access will immediately tell them that they have been found and they could do
their best to cover their tracks.

=== Use a secret manager in backends
After revoking a secret, it is important that you do not reinsert it into a
plaintext file that is also stored in a public location. +
Instead, use a dedicated secret management service provided by the cloud
provider or your organization and follow its integration steps.

These services enable centralized and secure storage of access keys and provide
additional protection against unauthorized access and facilitate secure
rotation of access keys.

=== Using keystores in frontends

When it comes to frontend applications and client-side environments, it is
important to stop keeping the secret in code after revocation, even with
obfuscation. Instead, use secure keystores or credential management systems
provided by the programming language, framework, or environment in use. +
These keystores can securely store access keys and ensure that they are
protected from unauthorized access or accidental disclosure.

=== Checking API access for malicious activity

To determine if the leaked secret was used by a malicious actor, it is
important to thoroughly review API access to identify possible malicious
activity. +
The following steps can be taken to assess and remediate the situation:

**Review API logs**: Review the logs of API calls and activities within the
scope of the compromised account using the cloud provider's logging services. +
Analyze the log data to identify unusual or suspicious API activity related to
the leaked secret.

**Identify unauthorized access**: Look for API calls made with the compromised
secret access key. Check for unauthorized actions or attempts to access
sensitive resources. Watch for API calls that deviate from normal usage
patterns.

**Investigate abnormal behavior**: Analyze the timestamps, source IP addresses,
and other relevant details of API calls associated with the leaked secret. +
Identify any anomalies or patterns that indicate unauthorized access or
malicious activity.

**Determine the extent of the security breach**: Assess the impact of the
leaked secret by examining the scope of the unauthorized access. Identify the
resources, data, or services that may have been compromised or accessed without
authorization.

== Resources

=== Standards
* https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/[OWASP Top 10 2021 Category A7] - Identification and Authentication Failures
* https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure[OWASP Top 10 2017 Category A3] - Sensitive Data Exposure
* https://cwe.mitre.org/data/definitions/798[MITRE, CWE-798] - Use of Hard-coded Credentials
* https://cwe.mitre.org/data/definitions/259[MITRE, CWE-259] - Use of Hard-coded Password
* https://www.sans.org/top25-software-errors/#cat3[SANS Top 25] - Porous Defenses

ifdef::env-github,rspecator-view[]

'''
== Implementation Specification
(visible only on this page)

=== Message

"xxxxx" detected here. Remove this cedential from your code.
- AWS Secret Access Key
- AWS Access Key ID
- AWS Session Token


endif::env-github,rspecator-view[]
