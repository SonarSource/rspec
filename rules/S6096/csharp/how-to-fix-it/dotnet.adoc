=== How to fix it in .NET

:canonicalization_function1: System.IO.Path.GetFullPath
:canonicalization_function2: System.IO.Path.GetFileName

include::../../common/fix/code-rationale.adoc[]

[cols="a"]
|===
h| Non-compliant code example
|
[source,csharp]
----
public class ExampleController : Controller
{
    private static string targetDirectory = "/example/directory/";

    public void ExtractEntry(IEnumerator<ZipArchiveEntry> entriesEnumerator)
    {
        ZipArchiveEntry entry = entriesEnumerator.Current;
        string destinationPath = Path.Combine(targetDirectory, entry.FullName);

        entry.ExtractToFile(destinationPath); // Noncompliant
    }
}
----
h| Compliant solution
|
[source,csharp]
----
public class ExampleController : Controller
{
    private static string targetDirectory = "/example/directory/";
    
    public void ExtractEntry(IEnumerator<ZipArchiveEntry> entriesEnumerator)
    {
        ZipArchiveEntry entry = entriesEnumerator.Current;
        string destinationPath = Path.Combine(targetDirectory, entry.FullName);
        string canonicalDestinationPath = Path.GetFullPath(destinationPath);

        if (canonicalDestinationPath.StartsWith(targetDirectory, StringComparison.Ordinal))
        {
            entry.ExtractToFile(canonicalDestinationPath);
        }
    }
}
----
|===

=== How does this work?

include::../../common/fix/how-does-this-work.adoc[]
