<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Classes marked with the <a href="https://api.flutter.dev/flutter/meta/immutable-constant.html"><code>@immutable</code> annotation</a> should only have <a href="https://dart.dev/language/constructors#constant-constructors"><code>const</code> constructors</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>meta.dart</code> package defines an <code>@immutable</code> annotation that can be used to mark classes that are <a href="https://en.wikipedia.org/wiki/Immutable_object">immutable</a>, meaning that all their instance variables, directly defined or inherited, have to be <a href="https://dart.dev/language/variables#final-and-const"><code>final</code></a>, that is, once the instance is created, it cannot be modified.</p>
</div>
<div class="paragraph">
<p>However, like any other annotation, the <code>@immutable</code> annotation only provides information to the developer using the class and to developer tools such as the analyzer package, and it does not enforce any constraint.</p>
</div>
<div class="paragraph">
<p>Therefore, there is nothing that prevents a developer from creating a mutable class and marking it as <code>@immutable</code>, as in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-dart" data-lang="dart">import 'package:meta/meta.dart';

@immutable
class Point {
  int x;
  int y;
  Point(this.x, this.y);
}

void main() {
  var p = Point(2, 3);
  p.x = 4;
  print(p.x); // Will print 4
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is a problem because it can lead to confusion and bugs, as developers might expect the class to be immutable and not realize that it is actually not.</p>
</div>
<div class="paragraph">
<p>The best way to prevent this from happening is to make sure that classes marked with the <code>@immutable</code> annotation only have <a href="https://dart.dev/language/constructors#constant-constructors"><code>const</code> constructors</a>. This will in turn ensure that all instance variables are <code>final</code>, hence the instance is truly immutable.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-dart" data-lang="dart">import 'package:meta/meta.dart';

@immutable
class Point {
  final int x; // Final required by the const constructor
  final int y; // Final required by the const constructor
  const Point(this.x, this.y);
}

void main() {
  const p = Point(2, 3);
  // p.x = 4; // This will now be a compile-time error
  print(p.x);
}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>Even if the <code>@immutable</code> class is truly immutable, missing the <code>const</code> constraint on its constructors will lead to subpar performance, as the Dart compiler will not create compile-time constants in a non-constant context, and will raise a compile-time error in a const context.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-dart" data-lang="dart">import 'package:meta/meta.dart';

@immutable
class Point {
  final int x;
  final int y;
  Point(this.x, this.y); // Missing const
}

void main() {
  const p = Point(2, 3); // Compile-time error
  const list = [Point(2, 3)]; // Compile-time error
  var list = const [Point(2, 3)]; // Compile-time error
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Add the constant constraint to each of the class&#8217;s constructors, by adding the <code>const</code> keyword before the constructor&#8217;s name.</p>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-dart" data-lang="dart">import 'package:meta/meta.dart';

@immutable
class Point {
  final int x;
  final int y;
  Point(this.x, this.y); // Non compliant
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-dart" data-lang="dart">import 'package:meta/meta.dart';

@immutable
class Point {
  final int x;
  final int y;
  const Point(this.x, this.y);
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Dart Docs - <a href="https://dart.dev/tools/linter-rules/prefer_const_constructors_in_immutables">Dart Linter rule - prefer_const_constructors_in_immutables</a></p>
</li>
<li>
<p>Dart Docs - <a href="https://dart.dev/language/variables#final-and-const">Language - Final and const</a></p>
</li>
<li>
<p>Dart Docs - <a href="https://dart.dev/language/constructors#constant-constructors">Language - Constant constructors</a></p>
</li>
<li>
<p>Flutter API Reference - <a href="https://api.flutter.dev/flutter/meta/immutable-constant.html">meta.dart - immutable top-level constant</a></p>
</li>
<li>
<p>Wikipedia - <a href="https://en.wikipedia.org/wiki/Immutable_object">Immutable object</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_related_rules">Related rules</h3>
<div class="ulist">
<ul>
<li>
<p><a data-rspec-id="S7112" class="rspec-auto-link">S7112</a> - Const constructors should be invoked with const</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Constructors in '@immutable' classes should be declared as 'const'.</p>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="paragraph">
<p>The name identifier of the constructor: e.g. <code>Point</code> in <code>Point(this.x, this.y);</code>.</p>
</div>
<div class="paragraph">
<p>In the case of an <code>extension type</code>, it&#8217;s the name identifier of the <code>extension type</code> itself: e.g. <code>ExtensionTypeName</code> in <code>extension type ExtensionTypeName(int i)</code>.</p>
</div>
</div>
</div>
</div>