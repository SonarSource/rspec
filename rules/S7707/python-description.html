<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This rule raises an issue when a DataLoader is used with Lightning Fabric but is not wrapped with <code>fabric.setup_dataloaders()</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Lightning Fabric is a framework that simplifies distributed training and device management in PyTorch. When you use Fabric, it needs to coordinate data loading across multiple devices or processes to ensure proper data distribution and avoid issues like data duplication or uneven batch sizes.</p>
</div>
<div class="paragraph">
<p>When you create a DataLoader without wrapping it with <code>fabric.setup_dataloaders()</code>, Fabric cannot properly manage the data loading process. This can lead to several problems:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Incorrect data distribution</strong>: In multi-device setups, each device might receive the same data instead of different portions, leading to inefficient training</p>
</li>
<li>
<p><strong>Synchronization issues</strong>: The data loading might not be properly synchronized with Fabric&#8217;s training loop, causing timing problems</p>
</li>
<li>
<p><strong>Memory inefficiency</strong>: Without proper setup, data might be loaded redundantly across devices</p>
</li>
<li>
<p><strong>Inconsistent batch sizes</strong>: Different devices might end up with different batch sizes, affecting gradient computation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Fabric&#8217;s <code>setup_dataloaders()</code> method handles these concerns automatically by configuring the DataLoader to work correctly with the chosen accelerator, strategy, and number of devices.</p>
</div>
<div class="sect2">
<h3 id="_what_is_the_potential_impact">What is the potential impact?</h3>
<div class="paragraph">
<p>Without proper DataLoader setup, distributed training may fail or produce incorrect results due to improper data distribution across devices. This can lead to poor model performance, training instability, or wasted computational resources.</p>
</div>
</div>
<div class="sect2">
<h3 id="_how_to_fix">How to fix?</h3>
<div class="paragraph">
<p>Wrap your DataLoader with <code>fabric.setup_dataloaders()</code> after creating the Fabric instance. This ensures proper data distribution and compatibility with Fabric&#8217;s distributed training features.</p>
</div>
<div class="sect3">
<h4 id="_non_compliant_code_example">Non-compliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import lightning as L
from torch.utils.data import DataLoader

fabric = L.Fabric()
dataloader = DataLoader(dataset, batch_size=32)

# DataLoader used without setup
for batch in dataloader:  # Noncompliant
    pass</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_code_example">Compliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import lightning as L
from torch.utils.data import DataLoader

fabric = L.Fabric()
dataloader = DataLoader(dataset, batch_size=32)
dataloader = fabric.setup_dataloaders(dataloader)

# DataLoader properly configured for Fabric
for batch in dataloader:
    pass</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Lightning Fabric - Convert PyTorch code to Fabric - <a href="https://lightning.ai/docs/fabric/stable/fundamentals/convert.html">Official guide on converting PyTorch code to use Lightning Fabric, including DataLoader setup</a></p>
</li>
<li>
<p>Lightning Fabric API - setup_dataloaders - <a href="https://lightning.ai/docs/fabric/stable/api/generated/lightning.fabric.fabric.Fabric.html#lightning.fabric.fabric.Fabric.setup_dataloaders">API documentation for the setup_dataloaders method</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>