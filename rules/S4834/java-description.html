<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Controlling permissions is security-sensitive. It has led in the past to the following vulnerabilities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.cve.org/CVERecord?id=CVE-2018-12999">CVE-2018-12999</a></p>
</li>
<li>
<p><a href="https://www.cve.org/CVERecord?id=CVE-2018-10285">CVE-2018-10285</a></p>
</li>
<li>
<p><a href="https://www.cve.org/CVERecord?id=CVE-2017-7455">CVE-2017-7455</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Attackers can only damage what they have access to. Thus limiting their access is a good way to prevent them from wreaking havoc, but it has to be done properly.</p>
</div>
<div class="paragraph">
<p>This rule flags code that controls the access to resources and actions. The goal is to guide security code reviews.</p>
</div>
<div class="paragraph">
<p>More specifically it will raise issues on the following Spring code:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The definition of any class implementing interfaces</p>
<div class="ulist">
<ul>
<li>
<p><code>org.springframework.security.access.AccessDecisionVoter</code></p>
</li>
<li>
<p><code>org.springframework.security.access.AccessDecisionManager</code></p>
</li>
<li>
<p><code>org.springframework.security.access.AfterInvocationProvider</code></p>
</li>
<li>
<p><code>org.springframework.security.access.PermissionEvaluator</code></p>
</li>
<li>
<p><code>org.springframework.security.access.expression.SecurityExpressionOperations</code></p>
</li>
<li>
<p><code>org.springframework.security.access.expression.method.MethodSecurityExpressionHandler</code></p>
</li>
<li>
<p><code>org.springframework.security.core.GrantedAuthority</code></p>
</li>
<li>
<p><code>org.springframework.security.acls.model.PermissionGrantingStrategy</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>The definition of any class extending class</p>
<div class="ulist">
<ul>
<li>
<p><code>org.springframework.security.config.annotation.method.configuration.GlobalMethodSecurityConfiguration</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Any method annotated with</p>
<div class="ulist">
<ul>
<li>
<p>Pre-post annotations: <code>@PreAuthorize</code>, <code>@PreFilter</code>, <code>@PostAuthorize</code> or <code>@PostFilter</code> from <code>org.springframework.security.access.prepost</code> package.</p>
</li>
<li>
<p><code>@org.springframework.security.access.annotation.Secured</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Calls to any of the following methods</p>
<div class="ulist">
<ul>
<li>
<p><code>org.springframework.security.acls.model.MutableAclService</code>: <code>createAcl</code>, <code>deleteAcl</code>, <code>updateAcl</code></p>
</li>
<li>
<p><code>org.springframework.security.config.annotation.web.builders.HttpSecurity</code>: <code>authorizeRequests</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>The instantiation of an anonymous class implementing <code>org.springframework.security.core.GrantedAuthority</code> or of any class implementing this interface directly.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It will also raise issue on JSR-250 annotations <code>@RolesAllowed</code>, <code>@PermitAll</code> and <code>@DenyAll</code> from <code>javax.annotation.security</code> package.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ask_yourself_whether">Ask Yourself Whether</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Granted permission to an entity (user, application) allow access to information or functionalities not needed by this entity.</p>
</li>
<li>
<p>Privileges are easily acquired (eg: based on the location of the user, type of device used, defined by third parties, does not require approval &#8230;&#8203;).</p>
</li>
<li>
<p>Inherited permission, default permission, no privileges (eg: anonymous user) is authorized to access to a protected resource.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There is a risk if you answered yes to any of those questions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_recommended_secure_coding_practices">Recommended Secure Coding Practices</h2>
<div class="sectionbody">
<div class="paragraph">
<p>At minimum, an access control system should:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use a well-defined access control model like <a href="https://en.wikipedia.org/wiki/Role-based_access_control">RBAC</a> or <a href="https://en.wikipedia.org/wiki/Access-control_list">ACL</a>.</p>
</li>
<li>
<p>Entities' permissions should be reviewed regularly to remove permissions that are no longer needed.</p>
</li>
<li>
<p>Respect <a href="https://en.wikipedia.org/wiki/Principle_of_least_privilege">the principle of least privilege</a> ("<em>an entity has access only the information and resources that are necessary for its legitimate purpose</em>").</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/276">CWE-276 - Incorrect Default Permissions</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/732">CWE-732 - Incorrect Permission Assignment for Critical Resource</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/668">CWE-668 - Exposure of Resource to Wrong Sphere</a></p>
</li>
<li>
<p>CWE - <a href="https://cwe.mitre.org/data/definitions/277">CWE-277 - Insecure Inherited Permissions</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Make sure controlling this permission is safe here.</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_and_links">Comments And Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_on_27_mar_2019_101040_nicolas_harraudeau_wrote">on 27 Mar 2019, 10:10:40 Nicolas Harraudeau wrote:</h3>
<div class="paragraph">
<p>Note: <code>javax.annotation</code> https://github.com/eclipse-ee4j/common-annotations-api/tree/master/src/main/java/javax/annotation/security[moved to eclipse EE4J]. See <a href="https://wiki.eclipse.org/New_Maven_Coordinates">Maven mapping</a>.</p>
</div>
</div>
</div>
</div>