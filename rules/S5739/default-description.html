<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When implementing the HTTPS protocol, the website mostly continue to support the HTTP protocol to redirect users to HTTPS when they request a HTTP version of the website. These redirects are not encrypted and are therefore vulnerable to man in the middle attacks. The <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Strict-Transport-Security">Strict-Transport-Security policy header</a> (HSTS) set by an application instructs the web browser to convert any HTTP request to HTTPS.</p>
</div>
<div class="paragraph">
<p>Web browsers that see the Strict-Transport-Security policy header for the first time record information specified in the header:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <code>max-age</code> directive which specify how long the policy should be kept on the web browser.</p>
</li>
<li>
<p>the <code>includeSubDomains</code> optional directive which specify if the policy should apply on all sub-domains or not.</p>
</li>
<li>
<p>the <code>preload</code> optional directive which is not part of the HSTS specification but supported on all modern web browsers.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>With the <code>preload</code> directive the web browser never connects in HTTP to the website and to use this directive, it is required <a href="https://hstspreload.org/">to submit</a> the concerned application to a preload service maintained by Google.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ask_yourself_whether">Ask Yourself Whether</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>The website is accessible with the unencrypted HTTP protocol.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There is a risk if you answered yes to this question.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_recommended_secure_coding_practices">Recommended Secure Coding Practices</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Implement Strict-Transport-Security policy header, it is recommended to apply this policy to all subdomains (<code>includeSubDomains</code>) and for at least 6 months (<code>max-age=15552000</code>) or even better for 1 year (<code>max-age=31536000</code>).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sensitive_code_example">Sensitive Code Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In Express.js application the code is sensitive if the <a href="https://www.npmjs.com/package/helmet">helmet</a> or <a href="https://www.npmjs.com/package/hsts">hsts</a> middleware are disabled or used without recommended values:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>const express = require('express');
const helmet = require('helmet');

let app = express();

app.use(helmet.hsts({
  maxAge: 3153600, // Sensitive, recommended &gt;= 15552000
  includeSubDomains: false // Sensitive, recommended 'true'
}));</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In Express.js application a standard way to implement HSTS is with the <a href="https://www.npmjs.com/package/helmet">helmet</a> or <a href="https://www.npmjs.com/package/hsts">hsts</a> middleware:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const express = require('express');
const helmet = require('helmet');

let app = express();

app.use(helmet.hsts({
  maxAge: 31536000,
  includeSubDomains: true
})); // Compliant</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a></p>
</li>
<li>
<p>OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data Exposure</a></p>
</li>
<li>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Strict-Transport-Security">developer.mozilla.org</a> - Strict Transport Security</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Make sure disabling Strict-Transport-Security policy is safe here.</p>
</div>
</div>
</div>
</div>